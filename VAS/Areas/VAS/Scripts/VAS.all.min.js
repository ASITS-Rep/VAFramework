(function (n, t) { function i(i) { var o, s, h, u, f; this.onClose = null; this.dGrid = null; o = "SelectDeselectAll"; s = !0; this.arrListColumns = []; this.log = n.Logging.VLogger.getVLogger("VCreateFrom"); this.divPaging = null; this.ulPaging = null; this.liFirstPage = null; this.liPrevPage = null; this.liCurrPage = null; this.liNextPage = null; this.liLastPage = null; this.cmbPage = null; h = []; this.multiValues = []; this.editedItems = []; this.NonEditableRecord = []; var r = this, e = n.Application.contextUrl, c = e + "JsonData/JDataSet", l = e + "JsonData/ExecuteNonQuer"; this.$root = t("<div style='position:relative'>"); this.log = n.Logging.VLogger.getVLogger("VCreateFrom"); this.$busyDiv = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); this.topDiv = t("<div class='vis-locatormainwrap vis-formouterwrpdiv'>"); this.middelDiv = t("<div class='vis-crtfrm-datawrp'>"); this.bottomDiv = t("<div class='vis-ctrfrm-btnwrp'>"); this.divPaging = t("<div>"); this.record_ID = 0; this.windowNo = i.getWindowNo(); this.mTab = i; this.initOK = !1; this.isApplied = !1; u = "btnOk_" + this.windowNo; this.Okbtn = t("<input id='" + u + "' class='VIS_Pref_btn-2' type='button' value='" + n.Msg.getMsg("OK") + "'>"); u = "btnCancel_" + this.windowNo; this.cancelbtn = t("<input id='" + u + "' class='VIS_Pref_btn-2' type='button' value='" + n.Msg.getMsg("Cancel") + "'>"); u = "btnDelete_" + this.windowNo; f = n.Application.contextUrl + "Areas/VIS/Images/base/uncheck-icon.png"; this.selectAllButton = t("<button type='button' id='" + u + "' style='margin-bottom:0px;margin-top:0px;display: none;float: left;padding: 0px;border: 0px;' value='Ok' role='button' aria-disabled='false'><img src='" + f + "'><\/button>"); u = "btnRefresh_" + this.windowNo; f = n.Application.contextUrl + "Areas/VIS/Images/base/Refresh24.png"; this.btnRefresh = t("<button id='" + u + "' style='margin-bottom: 1px; margin-top: 0px;display: none; float: left; margin-left: 0px;height: 38px; ' class='VIS_Pref_btn-2'><img src='" + f + "'><\/button>"); u = "btnApply_" + this.windowNo; this.Applybtn = t("<input id='" + u + "' class='VIS_Pref_btn-2' style='display: none;' type='button' value='" + n.Msg.getMsg("Apply") + "'>"); this.lblBankAccount = new n.Controls.VLabel; this.lblBPartner = new n.Controls.VLabel; this.lblOrder = new n.Controls.VLabel; this.lblInvoice = new n.Controls.VLabel; this.lblShipment = new n.Controls.VLabel; this.lblLocator = new n.Controls.VLabel; this.lblDeliveryDate = new n.Controls.VLabel; this.lblProduct = new n.Controls.VLabel; this.lblDocumentNoRef = new n.Controls.VLabel; this.lblDocumentNo = new n.Controls.VLabel; this.lblDate = new n.Controls.VLabel; this.lblAmount = new n.Controls.VLabel; this.lblDepositSlip = new n.Controls.VLabel; this.lblAuthCode = new n.Controls.VLabel; this.lblCheckNo = new n.Controls.VLabel; this.lblContainer = null; f = n.Application.contextUrl + "Areas/VIS/Images/pallet-icon.png"; this.ContainerTree = t("<img id='ContainerTree_" + this.windowNo + "' style='height: 27px;' class='pull-left VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled' src='" + f + "'>"); this.DocumentNo = null; this.Date = null; this.Amount = null; this.DepositSlip = null; this.AuthCode = null; this.CheckNo = null; this.froMVABInvoice = !1; this.deliveryDate = null; this.cmbOrder = new n.Controls.VComboBox("", !1, !1, !0); this.cmbInvoice = new n.Controls.VComboBox("", !1, !1, !0); this.cmbShipment = new n.Controls.VComboBox("", !1, !1, !0); this.cmbContainer = null; this.DocumentNoRef = null; this.vProduct = null; this.cmbBankAccount = null; this.vBPartner = null; this.locatorField = null; this.child = null; this.relatedToOrg = new n.Controls.VCheckBox("Related To My Organization", !1, !1, !0, "Related To My Organization", null); this.pattrLookup = new n.MPAttributeLookup(n.context, r.windowNo); this.$productAttribute = new n.Controls.VPAttribute("VAM_PFeature_SetInstance_ID", !1, !1, !0, n.DisplayType.PAttribute, r.pattrLookup, r.windowNo, !1, !1, !1, !0); this.title = ""; this.vetoablechange = function (t) { var f; if (t.propertyName == "VAM_Product_ID") { r.isApplied = !1; r.setBusy(!0); r.multiValues = []; r.dGrid != null && (r.dGrid.destroy(), r.dGrid = null); var u = r.cmbOrder.getControl().find("option:selected").val(), e = r.cmbInvoice.getControl().find("option:selected").val(), o = r.cmbShipment.getControl().find("option:selected").val(), i = r.vProduct.getValue(), s = r.deliveryDate.getValue(); u != null ? r.locatorField != null ? r.loadOrders(u, i, s, !1, 1) : r.loadOrders(u, i, s, !0, 1) : e != null ? n.VCreateFromShipment.prototype.loadInvoices(e, i, 1) : o != null ? n.VCreateFroMVABInvoice.prototype.loadShipments(o, i, 1) : r.setBusy(!1) } else if (t.propertyName == "VAB_BusinessPartner_ID") { r.setBusy(!0); r.multiValues = []; r.dGrid != null && (r.dGrid.destroy(), r.dGrid = null); var h = r.cmbBankAccount.getControl().find("option:selected").val(), c = r.Date.getValue(), l = r.vBPartner.getValue(), a = r.DepositSlip.getValue(), v = r.DocumentNo.getValue(), y = r.AuthCode.getValue(), p = r.CheckNo.getValue(), w = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(h, l, c, v, a, y, p, w, 1) } else t.propertyName == "VAM_Locator_ID" ? r.locatorField != null && (r.isApplied = !1, f = parseInt(r.locatorField.getValue()), f > 0 && n.VCreateFromShipment.prototype.initContainerDetails(f)) : this.locatorField.setBackground("") }; this.createPageSettings = function () { this.ulPaging = t('<ul class="vis-statusbar-ul">'); this.liFirstPage = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="First Page" style="opacity: 0.6;"><\/i><\/div><\/li>'); this.liPrevPage = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="Page Up" style="opacity: 0.6;"><\/i><\/div><\/li>'); this.cmbPage = t("<select>"); this.liCurrPage = t("<li>").append(this.cmbPage); this.liNextPage = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="Page Down" style="opacity: 0.6;"><\/i><\/div><\/li>'); this.liLastPage = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="Last Page" style="opacity: 0.6;"><\/i><\/div><\/li>'); this.ulPaging.append(this.liFirstPage).append(this.liPrevPage).append(this.liCurrPage).append(this.liNextPage).append(this.liLastPage); this.pageEvents() }; this.pageEvents = function () { this.liFirstPage.on("click", function () { var i, u; if (t(this).css("opacity") == "1") { r.setBusy(!0); var f = r.cmbOrder.getControl().find("option:selected").val(), o = r.cmbInvoice.getControl().find("option:selected").val(), s = r.cmbShipment.getControl().find("option:selected").val(), e = null; if (r.cmbBankAccount != null && (e = r.cmbBankAccount.getControl().find("option:selected").val()), i = null, u = null, r.vProduct != null && (i = r.vProduct.getValue()), r.deliveryDate != null && (u = r.deliveryDate.getValue()), f != null) r.locatorField != null ? r.loadOrders(f, i, u, !1, 1) : r.loadOrders(f, i, u, !0, 1); else if (o != null) n.VCreateFromShipment.prototype.loadInvoices(o, i, 1); else if (s != null) n.VCreateFroMVABInvoice.prototype.loadShipments(s, i, 1); else if (e != null) { var h = r.Date.getValue(), c = r.vBPartner.getValue(), l = r.DepositSlip.getValue(), a = r.DocumentNo.getValue(), v = r.AuthCode.getValue(), y = r.CheckNo.getValue(), p = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(e, c, h, a, l, v, y, p, 1) } } }); this.liPrevPage.on("click", function () { var i, u; if (t(this).css("opacity") == "1") { r.setBusy(!0); var f = r.cmbOrder.getControl().find("option:selected").val(), o = r.cmbInvoice.getControl().find("option:selected").val(), s = r.cmbShipment.getControl().find("option:selected").val(), e = null; if (r.cmbBankAccount != null && (e = r.cmbBankAccount.getControl().find("option:selected").val()), i = null, u = null, r.vProduct != null && (i = r.vProduct.getValue()), r.deliveryDate != null && (u = r.deliveryDate.getValue()), f != null) r.locatorField != null ? r.loadOrders(f, i, u, !1, parseInt(r.cmbPage.val()) - 1) : r.loadOrders(f, i, u, !0, parseInt(r.cmbPage.val()) - 1); else if (o != null) n.VCreateFromShipment.prototype.loadInvoices(o, i, parseInt(r.cmbPage.val()) - 1); else if (s != null) n.VCreateFroMVABInvoice.prototype.loadShipments(s, i, parseInt(r.cmbPage.val()) - 1); else if (e != null) { var h = r.Date.getValue(), c = r.vBPartner.getValue(), l = r.DepositSlip.getValue(), a = r.DocumentNo.getValue(), v = r.AuthCode.getValue(), y = r.CheckNo.getValue(), p = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(e, c, h, a, l, v, y, p, parseInt(r.cmbPage.val()) - 1) } } }); this.liNextPage.on("click", function () { var i, u; if (t(this).css("opacity") == "1") { r.setBusy(!0); var f = r.cmbOrder.getControl().find("option:selected").val(), o = r.cmbInvoice.getControl().find("option:selected").val(), s = r.cmbShipment.getControl().find("option:selected").val(), e = null; if (r.cmbBankAccount != null && (e = r.cmbBankAccount.getControl().find("option:selected").val()), i = null, u = null, r.vProduct != null && (i = r.vProduct.getValue()), r.deliveryDate != null && (u = r.deliveryDate.getValue()), f != null) r.locatorField != null ? r.loadOrders(f, i, u, !1, parseInt(r.cmbPage.val()) + 1) : r.loadOrders(f, i, u, !0, parseInt(r.cmbPage.val()) + 1); else if (o != null) n.VCreateFromShipment.prototype.loadInvoices(o, i, parseInt(r.cmbPage.val()) + 1); else if (s != null) n.VCreateFroMVABInvoice.prototype.loadShipments(s, i, parseInt(r.cmbPage.val()) + 1); else if (e != null) { var h = r.Date.getValue(), c = r.vBPartner.getValue(), l = r.DepositSlip.getValue(), a = r.DocumentNo.getValue(), v = r.AuthCode.getValue(), y = r.CheckNo.getValue(), p = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(e, c, h, a, l, v, y, p, parseInt(r.cmbPage.val()) + 1) } } }); this.liLastPage.on("click", function () { var i, u; if (t(this).css("opacity") == "1") { r.setBusy(!0); var f = r.cmbOrder.getControl().find("option:selected").val(), o = r.cmbInvoice.getControl().find("option:selected").val(), s = r.cmbShipment.getControl().find("option:selected").val(), e = null; if (r.cmbBankAccount != null && (e = r.cmbBankAccount.getControl().find("option:selected").val()), i = null, u = null, r.vProduct != null && (i = r.vProduct.getValue()), r.deliveryDate != null && (u = r.deliveryDate.getValue()), f != null) r.locatorField != null ? r.loadOrders(f, i, u, !1, parseInt(r.cmbPage.find("Option:last").val())) : r.loadOrders(f, i, u, !0, parseInt(r.cmbPage.find("Option:last").val())); else if (o != null) n.VCreateFromShipment.prototype.loadInvoices(o, i, parseInt(r.cmbPage.find("Option:last").val())); else if (s != null) n.VCreateFroMVABInvoice.prototype.loadShipments(s, i, parseInt(r.cmbPage.find("Option:last").val())); else if (e != null) { var h = r.Date.getValue(), c = r.vBPartner.getValue(), l = r.DepositSlip.getValue(), a = r.DocumentNo.getValue(), v = r.AuthCode.getValue(), y = r.CheckNo.getValue(), p = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(e, c, h, a, l, v, y, p, parseInt(r.cmbPage.find("Option:last").val())) } } }); this.cmbPage.on("change", function () { var t, i; r.setBusy(!0); var u = r.cmbOrder.getControl().find("option:selected").val(), e = r.cmbInvoice.getControl().find("option:selected").val(), o = r.cmbShipment.getControl().find("option:selected").val(), f = null; if (r.cmbBankAccount != null && (f = r.cmbBankAccount.getControl().find("option:selected").val()), t = null, i = null, r.vProduct != null && (t = r.vProduct.getValue()), r.deliveryDate != null && (i = r.deliveryDate.getValue()), u != null) r.locatorField != null ? r.loadOrders(u, t, i, !1, r.cmbPage.val()) : r.loadOrders(u, t, i, !0, r.cmbPage.val()); else if (e != null) n.VCreateFromShipment.prototype.loadInvoices(e, t, r.cmbPage.val()); else if (o != null) n.VCreateFroMVABInvoice.prototype.loadShipments(o, t, r.cmbPage.val()); else if (f != null) { var s = r.Date.getValue(), h = r.vBPartner.getValue(), c = r.DepositSlip.getValue(), l = r.DocumentNo.getValue(), a = r.AuthCode.getValue(), v = r.CheckNo.getValue(), y = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(f, h, s, l, c, a, v, y, r.cmbPage.val()) } }) }; this.resetPageCtrls = function (n) { if (this.cmbPage.empty(), n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)this.cmbPage.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); this.cmbPage.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (this.liNextPage.css("opacity", "1"), this.liLastPage.css("opacity", "1")) : (this.liNextPage.css("opacity", "0.6"), this.liLastPage.css("opacity", "0.6")); n.CurrentPage > 1 ? (this.liFirstPage.css("opacity", "1"), this.liPrevPage.css("opacity", "1")) : (this.liFirstPage.css("opacity", "0.6"), this.liPrevPage.css("opacity", "0.6")); n.TotalPage == 1 && (this.liFirstPage.css("opacity", "0.6"), this.liPrevPage.css("opacity", "0.6"), this.liNextPage.css("opacity", "0.6"), this.liLastPage.css("opacity", "0.6")) } else this.liFirstPage.css("opacity", "0.6"), this.liPrevPage.css("opacity", "0.6"), this.liNextPage.css("opacity", "0.6"), this.liLastPage.css("opacity", "0.6") }; this.setBusy = function (n) { this.$busyDiv.css("display", n ? "block" : "none") }; this.MergeItemsForSave = function () { var f = r.cmbOrder.getControl().find("option:selected").val(), e = r.cmbInvoice.getControl().find("option:selected").val(), o = r.cmbShipment.getControl().find("option:selected").val(), n, i, u; if (r.editedItems.length > 0) for (n in r.editedItems) i = r.editedItems[n].VAM_Product_ID_K, u = t.grep(r.multiValues, function (t) { return f != null ? t.VAM_Product_ID_K == i && t.VAB_Order_ID_K == r.editedItems[n].VAB_Order_ID_K : e != null ? t.VAM_Product_ID_K == i && t.VAB_Invoice_ID_K == r.editedItems[n].VAB_Invoice_ID_K : o != null ? t.VAM_Product_ID_K == i && t.VAM_Inv_InOut_ID_K == r.editedItems[n].VAM_Inv_InOut_ID_K : t.VAB_Payment_ID_K == r.editedItems[n].VAB_Payment_ID_K }), u.length > 0 || r.multiValues.push(r.editedItems[n]) }; this.showDialog = function () { this.locatorField && (this.locatorField.setBackground(!1), this.locatorField.addVetoableChangeListener(this)); this.vProduct && this.vProduct.addVetoableChangeListener(this); this.vBPartner && this.vBPartner.addVetoableChangeListener(this); var n = this; this.$root.append(this.$busyDiv); this.setBusy(!1); this.$root.dialog({ modal: !0, title: this.title, width: 900, height: 600, resizable: !1, position: { at: "center top", of: window }, close: function () { n.dispose(); n.dGrid != null && n.dGrid.destroy(); r = null; n.$root.dialog("destroy"); n.$root = null } }) }; this.disposeComponent = function () { r = null; this.Okbtn && this.Okbtn.off("click"); this.cancelbtn && this.cancelbtn.off("click"); this.selectAllButton && this.selectAllButton.off("click"); this.btnRefresh && this.btnRefresh.off("click"); this.Applybtn && this.Applybtn.off("click"); this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; i.prototype.create = function (t) { var i = n.Env.getCtx().getContextAsInt(t.getWindowNo(), "BaseTable_ID"), r = null; if (i == 392) r = new n.VCreateFromStatement(t); else if (i == 318) r = new n.VCreateFroMVABInvoice(t); else if (i == 319) r = new n.VCreateFromShipment(t); else return i == 426 ? null : null; return r }; i.prototype.initBPDetails = function (n) { return n }; i.prototype.initBPartner = function (t) { var r = n.MLookupFactory.getMLookUp(n.Env.getCtx(), this.windowNo, 3499, n.DisplayType.Search), i; return this.vBPartner = new n.Controls.VTextBoxButton("VAB_BusinessPartner_ID", !0, !1, !0, n.DisplayType.Search, r), i = n.Env.getCtx().getContextAsInt(this.windowNo, "VAB_BusinessPartner_ID"), this.vBPartner.setValue(i), this.initBPartnerOIS(i, t) }; i.prototype.initBPartnerOIS = function (i, r) { var e = this.cmbOrder, u, f; return t(e).html(""), u = !1, r ? (f = n.dataContext.getJSONRecord("MVABDocTypes/GetDocType", n.Env.getCtx().getContextAsInt(this.windowNo, "VAB_DocTypesTarget_ID").toString()), u = n.Utility.Util.getValueOfBoolean(f.IsReturnTrx)) : u = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsReturnTrx")), this.getOrders(n.Env.getCtx(), i, u, r), this.initBPDetails(i) }; i.prototype.getOrders = function (i, r, u, f) { var o = "o.DocumentNo||' - ' ||".concat(n.DB.to_char("o.DateOrdered", n.DisplayType.Date, n.Env.getVAF_Language(i))).concat("||' - '||").concat(n.DB.to_char("o.GrandTotal", n.DisplayType.Amount, n.Env.getVAF_Language(i))), e = "m.VAM_Inv_InOutLine_ID"; f && (e = "m.VAB_InvoiceLine_ID"); var s = n.Env.getCtx().getContextAsInt(this.windowNo, "VAF_Org_ID"), h = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsDropShip")), c = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsSOTrx")), l = n.context.getWindowContextAsInt(this.windowNo, "VAB_Invoice_ID", !0); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/VCreateGetOrders", type: "POST", data: { displays: o, columns: e, VAB_BusinessPartner_IDs: r, isReturnTrxs: u, OrgIds: s, IsDrop: h, IsSOTrx: c, forInvoices: f, recordID: l }, success: function (t) { var r = t.result, u, f, i; if (r && r.length > 0) try { for (i = 0; i < r.length; i++)u = n.Utility.Util.getValueOfInt(r[i].key), f = n.Utility.encodeText(r[i].value), i == 0 && $self.cmbOrder.getControl().append(" <option value=0> <\/option>"), $self.cmbOrder.getControl().append(" <option value=" + u + ">" + f + "<\/option>"); $self.cmbOrder.getControl().prop("selectedIndex", 0) } catch (e) { } }, error: function (n) { $self.log.info(n) } }) }; i.prototype.jbInit = function () { this.init(); this.lblBankAccount.getControl().text(n.Msg.getMsg("BankAcctCurrency")); this.lblBPartner.getControl().text(n.Msg.getMsg("BusinessPartner")); this.lblOrder.getControl().text(n.Msg.getMsg("Order")); this.lblInvoice.getControl().text(n.Msg.getMsg("Invoice")); this.lblShipment.getControl().text(n.Msg.getMsg("Shipment/Receipt")); this.lblLocator.getControl().text(n.Msg.getMsg("VAM_Locator_ID")); this.lblDeliveryDate.getControl().text(n.Msg.getMsg("DeliveryDate")); this.lblProduct.getControl().text(n.Msg.getMsg("ProductName")); this.lblDocumentNoRef.getControl().text(n.Msg.getMsg("DocumentNo")); this.lblDocumentNo.getControl().text(n.Msg.getMsg("DocumentNo")); this.lblDate.getControl().text(n.Msg.getMsg("DateAcct")); this.lblAmount.getControl().text(n.Msg.getMsg("Amount")); this.lblDepositSlip.getControl().text(n.Msg.getMsg("DepositSlipNo")); this.lblAuthCode.getControl().text(n.Msg.getMsg("AuthCode")); this.lblCheckNo.getControl().text(n.Msg.getMsg("CheckNo")); var f = t("<div class='VIS_Pref_show'>"), u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>"); this.topDiv.append(f); f.append(u); u.append(r); r.append(i); r.append(e); this.vBPartner != null && (this.cmbBankAccount != null ? (i.append(this.vBPartner.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")), e.append(this.vBPartner.getBtn(0)), e.append(this.vBPartner.getBtn(1))) : (i.append(this.vBPartner.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")), e.append(this.vBPartner.getBtn(0))), i.append(this.lblBPartner.getControl().addClass("VIS_Pref_Label_Font"))); u = t("<div class='VIS_Pref_dd'>"); r = t("<div class='input-group vis-input-wrap'><\/div>"); i = t("<div class='vis-control-wrap'><\/div>"); e = t("<div class='input-group-append'>"); f.append(u); u.append(r); r.append(i); r.append(e); this.cmbBankAccount != null ? (i.append(this.cmbBankAccount.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblBankAccount.getControl().addClass("VIS_Pref_Label_Font"))) : this.DocumentNoRef != null && (i.append(this.DocumentNoRef.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblDocumentNoRef.getControl().addClass("VIS_Pref_Label_Font"))); f = t("<div class='VIS_Pref_show'>"); this.Amount != null ? (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>")) : (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>")); this.topDiv.append(f); f.append(u); u.append(r); r.append(i); this.DocumentNo != null && (u.append(r), i.append(this.DocumentNo.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblDocumentNo.getControl().addClass("VIS_Pref_Label_Font"))); this.cmbOrder != null && (u.append(r), i.append(this.cmbOrder.getControl()), i.append(this.lblOrder.getControl().addClass("VIS_Pref_Label_Font"))); this.Amount != null && (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), f.append(u), u.append(r), r.append(i), i.append(this.Amount.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblAmount.getControl().addClass("VIS_Pref_Label_Font"))); this.Amount != null ? (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>")) : (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>")); f.append(u); u.append(r); r.append(i); this.cmbInvoice != null && (i.append(this.cmbInvoice.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblInvoice.getControl().addClass("VIS_Pref_Label_Font"))); this.cmbShipment != null && (i.append(this.cmbShipment.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblShipment.getControl().addClass("VIS_Pref_Label_Font"))); this.Date != null && (i.append(this.Date.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblDate.getControl().addClass("VIS_Pref_Label_Font"))); (this.locatorField != null || this.cmbContainer != null) && (this.middelDiv.css("height", "48.5%"), f = t("<div class='VIS_Pref_show'>"), u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>"), this.topDiv.append(f), f.append(u), u.append(r), r.append(i), r.append(e), this.locatorField != null && (i.append(this.locatorField.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")), e.append(this.locatorField.getBtn(0)), i.append(this.lblLocator.getControl().addClass("VIS_Pref_Label_Font"))), u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>"), f.append(u), u.append(r), r.append(i), r.append(e), this.cmbContainer != null && (u.css("visibility", "hidden"), n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"] != undefined && n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y", !0) && (u.css("visibility", "visible"), this.ContainerTree.removeClass("VIS_Tree-Container-disabled")), i.append(this.cmbContainer.getControl().attr("disabled", !0).attr("data-placeholder", "").attr("placeholder", " ")), e.append(this.ContainerTree), i.append(this.lblContainer.getControl().addClass("VIS_Pref_Label_Font")))); f = t("<div class='VIS_Pref_show'>"); this.CheckNo != null ? (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>")) : (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>")); this.topDiv.append(f); f.append(u); u.append(r); r.append(i); r.append(e); this.DepositSlip != null && (i.append(this.DepositSlip.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblDepositSlip.getControl().addClass("VIS_Pref_Label_Font"))); this.deliveryDate != null && (i.append(this.deliveryDate.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblDeliveryDate.getControl().addClass("VIS_Pref_Label_Font"))); this.CheckNo != null && (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), f.append(u), u.append(r), r.append(i), i.append(this.CheckNo.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblCheckNo.getControl().addClass("VIS_Pref_Label_Font"))); this.CheckNo != null ? (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>")) : (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>")); f.append(u); u.append(r); r.append(i); r.append(e); this.vProduct != null && (i.append(this.vProduct.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")), e.append(this.vProduct.getBtn(0)), e.append(this.vProduct.getBtn(1)), i.append(this.lblProduct.getControl().addClass("VIS_Pref_Label_Font"))); this.AuthCode != null && (i.append(this.AuthCode.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblAuthCode.getControl().addClass("VIS_Pref_Label_Font"))); this.relatedToOrg != null && (f = t("<div class='VIS_Pref_show'>"), u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), this.topDiv.append(f), f.append(u), u.append(r), r.append(i), i.append(this.relatedToOrg.getControl())) }; i.prototype.init = function () { this.createPageSettings(); this.divPaging.append(this.ulPaging); this.$root.append(this.topDiv).append(this.middelDiv).append(this.divPaging).append(this.bottomDiv); this.bottomDiv.append(this.selectAllButton); this.bottomDiv.append(this.btnRefresh); this.bottomDiv.append(this.cancelbtn); this.bottomDiv.append(this.Applybtn); this.bottomDiv.append(this.Okbtn); this.bottomDiv.append(this.divPaging); this.middelDiv.append(this.dGrid); $self = this; this.Okbtn.on("click", function () { var r; if ($self.isApplied) { $self.$root.dialog("close"); return } $self.setBusy(!0); var u = $self.cmbOrder.getControl().find("option:selected").val(), f = $self.cmbInvoice.getControl().find("option:selected").val(), e = $self.cmbShipment.getControl().find("option:selected").val(), i = null; if ($self.dGrid != null && (i = $self.dGrid.getSelection()), i == null || i.length == 0) { n.ADialog.info("RecordSelectionRequired"); $self.setBusy(!1); return } if ($self.locatorField != null) { if ($self.dGrid != null && u != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.VAM_Product_ID_K == $self.dGrid.get(i[item]).VAM_Product_ID_K && n.VAB_Order_ID_K == $self.dGrid.get(i[item]).VAB_Order_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); else if ($self.dGrid != null && f != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.VAM_Product_ID_K == $self.dGrid.get(i[item]).VAM_Product_ID_K && n.VAB_Invoice_ID_K == $self.dGrid.get(i[item]).VAB_Invoice_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); $self.MergeItemsForSave(); n.VCreateFromShipment.prototype.saveMVAMInvInOut(!1) } else if ($self.cmbBankAccount != null) { if ($self.dGrid != null) for (item in i) { if ($self.dGrid.get(i[item]).Date == "") return n.ADialog.error("VIS_PLAccountDate"), !1; r = t.grep($self.multiValues, function (n) { return n.VAB_Payment_ID_K == $self.dGrid.get(i[item]).VAB_Payment_ID_K }); r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])) } n.VCreateFromStatement.prototype.saveStatment(); $self.middelDiv.css("height", "61%") } else { if ($self.dGrid != null && u != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.VAM_Product_ID_K == $self.dGrid.get(i[item]).VAM_Product_ID_K && n.VAB_Order_ID_K == $self.dGrid.get(i[item]).VAB_Order_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); if ($self.dGrid != null && e != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.VAM_Product_ID_K == $self.dGrid.get(i[item]).VAM_Inv_InOut_ID_K && n.VAM_Inv_InOut_ID_K == $self.dGrid.get(i[item]).VAM_Inv_InOut_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); n.VCreateFroMVABInvoice.prototype.saveInvoice() } }); this.Applybtn.on("click", function () { var r; $self.setBusy(!0); var u = $self.cmbOrder.getControl().find("option:selected").val(), f = $self.cmbInvoice.getControl().find("option:selected").val(), e = $self.cmbShipment.getControl().find("option:selected").val(), i = null; if ($self.dGrid != null && (i = $self.dGrid.getSelection()), i == null || i.length == 0) { n.ADialog.info("RecordSelectionRequired"); $self.setBusy(!1); return } if ($self.locatorField != null) { if ($self.dGrid != null && u != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.VAM_Product_ID_K == $self.dGrid.get(i[item]).VAM_Product_ID_K && n.VAB_Order_ID_K == $self.dGrid.get(i[item]).VAB_Order_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); else if ($self.dGrid != null && f != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.VAM_Product_ID_K == $self.dGrid.get(i[item]).VAM_Product_ID_K && n.VAB_Invoice_ID_K == $self.dGrid.get(i[item]).VAB_Invoice_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); $self.MergeItemsForSave(); n.VCreateFromShipment.prototype.saveMVAMInvInOut(!0) } else if ($self.cmbBankAccount != null) { if ($self.dGrid != null) for (item in i) { if ($self.dGrid.get(i[item]).Date == "") return n.ADialog.error("VIS_PLAccountDate"), !1; r = t.grep($self.multiValues, function (n) { return n.VAB_Payment_ID_K == $self.dGrid.get(i[item]).VAB_Payment_ID_K }); r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])) } n.VCreateFromStatement.prototype.saveStatment(); $self.middelDiv.css("height", "61%") } else { if ($self.dGrid != null && u != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.VAM_Product_ID_K == $self.dGrid.get(i[item]).VAM_Product_ID_K && n.VAB_Order_ID_K == $self.dGrid.get(i[item]).VAB_Order_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); if ($self.dGrid != null && e != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.VAM_Product_ID_K == $self.dGrid.get(i[item]).VAM_Inv_InOut_ID_K && n.VAM_Inv_InOut_ID_K == $self.dGrid.get(i[item]).VAM_Inv_InOut_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); n.VCreateFroMVABInvoice.prototype.saveInvoice() } }); i.prototype.callBackSave = function (t) { if (t == !1) $self.setBusy(!1); else { $self.isApplied = !0; n.ADialog.info("VIS_SuccessFullyInserted", null, null, null); var i = $self.cmbOrder.getControl().find("option:selected").val(), r = $self.cmbInvoice.getControl().find("option:selected").val(), e = $self.cmbShipment.getControl().find("option:selected").val(), u = $self.vProduct.getValue(), f = $self.deliveryDate.getValue(); (i > 0 || r > 0) && ($self.locatorField != null ? ($self.dGrid.selectNone(), i > 0 && ($self.multiValues = [], $self.loadOrders(i, u, f, !1, 1)), r > 0 && ($self.multiValues = [], n.VCreateFromShipment.prototype.loadInvoices(r, u, 1)), $self.dGrid.selectNone(), $self.editedItems = []) : ($self.dGrid.selectNone(), i > 0 && ($self.multiValues = [], $self.loadOrders(i, u, f, !0, 1)), r > 0 && ($self.multiValues = [], n.VCreateFromShipment.prototype.loadInvoices(r, u, 1)), $self.dGrid.selectNone(), $self.editedItems = [])) } }; this.cancelbtn.on("click", function () { $self.setBusy(!1); $self.$root.dialog("close") }); this.selectAllButton.on("click", function () { }); if (this.relatedToOrg) this.relatedToOrg.getControl().on("click", function () { var n, t, i; $self.isApplied = !1; $self.setBusy(!0); $self.multiValues = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); n = $self.cmbOrder.getControl().find("option:selected").val(); n != null ? ($self.cmbInvoice.getControl().prop("selectedIndex", -1), $self.cmbShipment.getControl().prop("selectedIndex", -1), t = $self.vProduct.getValue(), i = $self.deliveryDate.getValue(), $self.loadOrders(n, t, i, !1, 1)) : $self.setBusy(!1) }); if (this.btnRefresh) this.btnRefresh.on("click", function () { var t; if ($self.cmbBankAccount != null && ($self.setBusy(!0), t = $self.cmbBankAccount.getControl().find("option:selected").val(), t)) { var i = $self.Date.getValue(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(t, r, i, f, u, e, o, s, $self.cmbPage.val()) } }); if (this.cmbOrder && this.cmbOrder.getControl().change(function () { var n, t, i; $self.isApplied = !1; $self.setBusy(!0); $self.editedItems = []; $self.multiValues = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); n = $self.cmbOrder.getControl().find("option:selected").val(); $self.cmbInvoice.getControl().prop("selectedIndex", -1); $self.cmbShipment.getControl().prop("selectedIndex", -1); $self.lblDeliveryDate.setVisible(!0); $self.deliveryDate.setVisible(!0); t = $self.vProduct.getValue(); i = $self.deliveryDate.getValue(); $self.locatorField != null ? $self.loadOrders(n, t, i, !1, 1) : $self.loadOrders(n, t, i, !0, 1) }), this.cmbBankAccount && this.cmbBankAccount.getControl().change(function () { var t; if ($self.editedItems = [], $self.setBusy(!0), t = $self.cmbBankAccount.getControl().find("option:selected").val(), t) { n.VCreateFromStatement.prototype.initBPartner(t); $self.Date.setValue(""); $self.DepositSlip.setValue(""); $self.DocumentNo.setValue(""); $self.AuthCode.setValue(""); var i = $self.vBPartner.getValue(), r = $self.Date.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(t, i, r, f, u, e, o, s, 1) } }), this.Date && this.Date.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.DocumentNo && this.DocumentNo.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.DepositSlip && this.DepositSlip.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.AuthCode && this.AuthCode.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.CheckNo && this.CheckNo.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.Amount && this.Amount.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.cmbInvoice && this.cmbInvoice.getControl().change(function () { $self.isApplied = !1; $self.setBusy(!0); $self.editedItems = []; $self.multiValues = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.cmbInvoice.getControl().find("option:selected").val(), i = $self.vProduct.getValue(); $self.cmbOrder.getControl().prop("selectedIndex", -1); $self.cmbShipment.getControl().prop("selectedIndex", -1); $self.lblDeliveryDate.setVisible(!1); $self.deliveryDate.setVisible(!1); n.VCreateFromShipment.prototype.loadInvoices(t, i, 1) }), this.cmbShipment && this.cmbShipment.getControl().change(function () { $self.setBusy(!0); $self.editedItems = []; $self.multiValues = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.cmbShipment.getControl().find("option:selected").val(), i = $self.vProduct.getValue(); $self.cmbOrder.getControl().prop("selectedIndex", -1); $self.cmbInvoice.getControl().prop("selectedIndex", -1); $self.lblDeliveryDate.setVisible(!1); $self.deliveryDate.setVisible(!1); n.VCreateFroMVABInvoice.prototype.loadShipments(t, i, 1) }), this.deliveryDate && this.deliveryDate.getControl().change(function () { $self.isApplied = !1; $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var n = $self.cmbOrder.getControl().find("option:selected").val(), t = $self.vProduct.getValue(), i = $self.deliveryDate.getValue(); $self.locatorField != null ? $self.loadOrders(n, t, i, !1, 1) : $self.loadOrders(n, t, i, !0, 1) }), this.ContainerTree) this.ContainerTree.on("click", function () { var i, t; (n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"] == undefined || n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y", !0)) && (i = $self.locatorField.getValue(), i > 0 && (t = new n.productContainerTree(0, i, 0), t != null && (t.showDialog(), t.onClosing = function (n, t) { $self.cmbContainer.getControl().empty(); $self.cmbContainer.getControl().append(" <option value=" + n + ">" + t + "<\/option>") }), t = null), i = null) }) }; i.prototype.isInitOK = function () { return this.initOK }; i.prototype.loadOrders = function (t, i, r, u, f) { var e = this.getOrdersData(n.Env.getCtx(), t, i, r, u, f) }; i.prototype.getOrdersData = function (i, r, u, f, e, o) { var h, v, p, s; if ($self.dGrid != null) { h = $self.dGrid.getSelection(); for (item in h) v = t.grep($self.multiValues, function (n) { return n.VAM_Product_ID_K == $self.dGrid.get(h[item]).VAM_Product_ID_K && n.VAB_Order_ID_K == $self.dGrid.get(h[item]).VAB_Order_ID_K }), v.length > 0 || $self.multiValues.push($self.dGrid.get(h[item])) } if ($self.mTab.keyColumnName == "VAM_Inv_InOut_ID" ? $self.record_ID = $self.mTab.getValue("VAM_Inv_InOut_ID") : $self.mTab.keyColumnName == "VAB_Invoice_ID" && ($self.record_ID = $self.mTab.getValue("VAB_Invoice_ID")), $self.relatedToOrg.getValue()) { var c = "", l = "", a = "", y = ""; o || (o = 1); c = n.Env.isBaseLanguage(i, "VAB_UOM") ? " LEFT OUTER JOIN VAB_UOM uom ON (l.VAB_UOM_ID=uom.VAB_UOM_ID)" : " LEFT OUTER JOIN VAB_UOM_TL uom ON (l.VAB_UOM_ID=uom.VAB_UOM_ID AND uom.VAF_Language='" + n.Env.getVAF_Language(i).concat("')"); u != null && (l = " AND l.VAM_Product_ID=" + u); f != null && (s = n.DB.to_date(f, !0), y = s, a = " AND l.DatePromised <= " + s); p = $self.mTab.getValue("VAF_Org_ID"); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetOrdersDataCommon", dataType: "json", type: "POST", data: { keyColumnName: $self.mTab.keyColumnName, tableName: "VAB_OrderLine", recordID: $self.record_ID, pageNo: o, forInvoicees: e, C_Ord_IDs: r, isBaseLangess: c, MVAMProductIDss: l, DelivDates: a, adOrgIDSs: p }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); $self.setBusy(!1); $self.log.info(t); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); $self.setBusy(!1); return } $self.resetPageCtrls(i.pSetting); $self.loadGrid(i.data); $self.setBusy(!1) } }) } else { var c = "", l = "", a = "", y = ""; c = n.Env.isBaseLanguage(i, "VAB_UOM") ? " LEFT OUTER JOIN VAB_UOM uom ON (l.VAB_UOM_ID=uom.VAB_UOM_ID)" : " LEFT OUTER JOIN VAB_UOM_TL uom ON (l.VAB_UOM_ID=uom.VAB_UOM_ID AND uom.VAF_Language='" + n.Env.getVAF_Language(i) + "') INNER JOIN VAB_UOM uom1 ON uom1.VAB_UOM_ID = uom.VAB_UOM_ID "; u > 0 && (l = " AND l.VAM_Product_ID=" + u); f != null && (s = n.DB.to_date(f, !0), a = " AND l.DatePromised <= " + s); o || (o = 1); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetOrdersDataCommonOrg", dataType: "json", type: "POST", data: { keyColumnName: $self.mTab.keyColumnName, tableName: "VAB_OrderLine", recordID: $self.record_ID, pageNo: o, forInvoicees: e, C_Ord_IDs: r, isBaseLangess: c, MVAMProductIDss: l, DelivDates: a }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); $self.setBusy(!1); $self.log.info(t); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); $self.setBusy(!1); return } $self.resetPageCtrls(i.pSetting); $self.loadGrid(i.data); $self.setBusy(!1) } }) } return [] }; i.prototype.loadOrder = function (t, i) { var r = null; r = this.getOrderData(n.Env.getCtx(), t, i); this.loadGrid(r) }; i.prototype.getOrderData = function (i, r, u) { var o = [], s, f, e; return $self.relatedToOrg.getValue() ? (f = "", f = n.Env.isBaseLanguage(i, "VAB_UOM") ? " LEFT OUTER JOIN VAB_UOM uom ON (l.VAB_UOM_ID=uom.VAB_UOM_ID)" : " LEFT OUTER JOIN VAB_UOM_TL uom ON (l.VAB_UOM_ID=uom.VAB_UOM_ID AND uom.VAF_Language='" + n.Env.getVAF_Language(i) + "')", s = $self.mTab.getValue($self.windowNo, "VAF_Org_ID"), e = n.Env.getVAF_Language(i), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetOrderDataCommons", dataType: "json", type: "POST", async: !1, data: { forInvoices: u, isBaseLangs: f, VAB_OrderID: r, orggetVals: s, langs: e }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); $self.setBusy(!1); $self.log.info(t); return }, success: function (n) { var i = JSON.parse(n), u, r, t; if (i && i != null && i.length > 0) for (u = 1, r = 0; r < i.length; r++)t = {}, t.Quantity = i[r].quantity, t.QuantityEntered = i[r].quantityentered, t.VAB_UOM_ID = i[r].VAB_UOM_id, t.VAM_Product_ID = i[r].VAM_Product_id, t.VAM_PFeature_SetInstance_ID = i[r].VAM_PFeature_SetInstance_id, t.VAB_Order_ID = i[r].VAB_Order_id, t.VAM_Inv_InOut_ID = null, t.VAB_Invoice_ID = null, t.VAB_UOM_ID_K = i[r].VAB_UOM_id_k, t.VAM_Product_ID_K = i[r].VAM_Product_id_k, t.VAM_PFeature_SetInstance_ID_K = i[r].VAM_PFeature_SetInstance_id_k, t.VAB_Order_ID_K = i[r].VAB_Order_id_k, t.VAM_Inv_InOut_ID_K = null, t.VAB_Invoice_ID_K = null, t.VAB_PaymentTerm_ID = i[r].VAB_PaymentTerm_ID, t.PaymentTermName = i[r].PaymentTermName, t.IsAdvance = i[r].IsAdvance, t.VAB_InvoicePaymentTerm_ID = i[r].VAB_InvoicePaymentTerm_ID, t.IsInvoicePTAdvance = i[r].IsInvoicePTAdvance, t.recid = u, o.push(t); $self.setBusy(!1) } }), o) : (f = "", f = n.Env.isBaseLanguage(i, "VAB_UOM") ? " LEFT OUTER JOIN VAB_UOM uom ON (l.VAB_UOM_ID=uom.VAB_UOM_ID)" : " LEFT OUTER JOIN VAB_UOM_TL uom ON (l.VAB_UOM_ID=uom.VAB_UOM_ID AND uom.VAF_Language='" + n.Env.getVAF_Language(i) + "')", e = n.Env.getVAF_Language(i), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetOrderDataCommonsNotOrg", dataType: "json", type: "POST", async: !1, data: { forInvoices: u, isBaseLangs: f, VAB_OrderID: r, langs: e }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); $self.setBusy(!1); $self.log.info(t); return }, success: function (n) { var i = JSON.parse(n), u, r, t; if (i && i != null && i.length > 0) for (u = 1, r = 0; r < i.length; r++)t = {}, t.Quantity = i[r].quantity, t.QuantityEntered = i[r].quantityentered, t.VAB_UOM_ID = i[r].VAB_UOM_id, t.VAM_Product_ID = i[r].VAM_Product_id, t.VAM_PFeature_SetInstance_ID = i[r].VAM_PFeature_SetInstance_id, t.VAB_Order_ID = i[r].VAB_Order_id, t.VAM_Inv_InOut_ID = null, t.VAB_Invoice_ID = null, t.VAB_UOM_ID_K = i[r].VAB_UOM_id_k, t.VAM_Product_ID_K = i[r].VAM_Product_id_k, t.VAM_PFeature_SetInstance_ID_K = i[r].VAM_PFeature_SetInstance_id_k, t.VAB_Order_ID_K = i[r].VAB_Order_id_k, t.VAM_Inv_InOut_ID_K = null, t.VAB_Invoice_ID_K = null, t.VAB_PaymentTerm_ID = i[r].VAB_PaymentTerm_ID, t.PaymentTermName = i[r].PaymentTermName, t.IsAdvance = i[r].IsAdvance, t.VAB_InvoicePaymentTerm_ID = i[r].VAB_InvoicePaymentTerm_ID, t.IsInvoicePTAdvance = i[r].IsInvoicePTAdvance, t.recid = u, o.push(t); $self.setBusy(!1) } }), o) }; i.prototype.loadGrid = function (i) { function c() { for (var n = 0; n < $self.dGrid.records.length; n++)$self.NonEditableRecord.indexOf(n + 1) >= 0 && ($self.dGrid.unselect(n + 1), t("#grid_" + $self.dGrid.name + "_rec_" + (n + 1) + "  input").attr("disabled", !0)) } function l(n, i) { var r = $self.dGrid.records[i].VAM_Product_ID_K, e = t.grep($self.editedItems, function (n) { return u != null ? n.VAM_Product_ID_K == r && n.VAB_Order_ID_K == $self.dGrid.records[i].VAB_Order_ID_K : f != null ? n.VAM_Product_ID_K == r && n.VAB_Invoice_ID_K == $self.dGrid.records[i].VAB_Invoice_ID_K : s != null ? n.VAM_Product_ID_K == r && n.VAM_Inv_InOut_ID_K == $self.dGrid.records[i].VAM_Inv_InOut_ID_K : n.VAB_Payment_ID_K == $self.dGrid.records[item].VAB_Payment_ID_K }); e.length > 0 ? ($self.editedItems.splice($self.editedItems.indexOf(e[0]), 1), $self.editedItems.push($self.dGrid.records[i])) : $self.editedItems.push($self.dGrid.records[i]) } function y(t, i) { var f = !1, u, r; if (t.value_new = n.Utility.Util.getValueOfString(i), t.value_new.contains(".")) { for (f = !0, u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "." && u.push(r); u.length > 1 && (t.value_new = a(t.value_new, ".")) } if (t.value_new.contains(",")) if (f) t.value_new = a(t.value_new, ","); else { for (u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "," && u.push(r); t.value_new = u.length > 1 ? a(t.value_new, ",") : t.value_new.replace(",", ".") } return t.value_new == "" && (t.value_new = "0"), t.value_new } function a(n, t) { var i = n.split(t); return n = i.slice(0, -1).join("") + "." + i.slice(-1), n.indexOf(".") == n.length - 1 && (n = n.replace(".", "")), n } function b(n, i, r) { var u = null; return t.ajax({ url: w, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } var h = n.DisplayType.GetNumberFormat(n.DisplayType.Amount), e = n.Env.isDecimalPoint(), o, v, r; this.dGrid != null && (this.dGrid.destroy(), this.dGrid = null); this.arrListColumns.length == 0 && (this.arrListColumns.push({ field: "Select", caption: n.Msg.getMsg("Select"), sortable: !1, size: "50px", hidden: !1, render: function () { return '<div><input type=checkbox disabled="true"><\/div>' } }), this.arrListColumns.push({ field: "Quantity", caption: n.Msg.getMsg("QtyPending"), sortable: !1, size: "150px", hidden: !1, render: function (n) { var t = n.Quantity; return parseFloat(t).toLocaleString(undefined, { minimumFractionDigits: 4 }) } }), this.arrListColumns.push({ field: "QuantityPending", caption: n.Msg.getMsg("Quantity"), sortable: !1, size: "150px", render: "number:4", hidden: !0 }), this.arrListColumns.push({ field: "QuantityEntered", caption: n.Msg.getMsg("QtyEntered"), editable: { type: "number" }, sortable: !1, size: "150px", hidden: !1, render: function (n) { var t = n.QuantityEntered; return t = y(event, t), parseFloat(t).toLocaleString(undefined, { minimumFractionDigits: 4 }) } }), this.arrListColumns.push({ field: "VAB_UOM_ID", caption: n.Msg.getMsg("UomName"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "VAM_Product_SearchKey", caption: n.Msg.getMsg("ProductSearchKey"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "VAM_Product_ID", caption: n.Msg.getMsg("ProductName"), sortable: !0, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "VAM_PFeature_SetInstance_ID", caption: n.Msg.getMsg("ASI"), sortable: !1, size: "150px", editable: { type: "custom", ctrl: $self.$productAttribute, showAll: !0 }, render: function (n) { var t = $self.pattrLookup, i = n.VAM_PFeature_SetInstance_ID, r; return n.changes && typeof n.changes.VAM_PFeature_SetInstance_ID != "undefined" && (i = n.changes.VAM_PFeature_SetInstance_ID), t && (r = t.getDisplay(i, !0)), r } }), this.arrListColumns.push({ field: "VAB_PaymentTerm_ID", caption: n.Msg.getMsg("VAB_PaymentTerm_ID"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "PaymentTermName", caption: n.Msg.getMsg("PaymentTermName"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "IsAdvance", caption: n.Msg.getMsg("IsAdvance"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "VAB_InvoicePaymentTerm_ID", caption: n.Msg.getMsg("VAB_InvoicePaymentTerm_ID"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "IsInvoicePTAdvance", caption: n.Msg.getMsg("IsInvoicePTAdvance"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "VAB_Order_ID", caption: n.Msg.getMsg("OrderLine"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "VAM_Inv_InOut_ID", caption: n.Msg.getMsg("Shipment/Receipt"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "VAB_Invoice_ID", caption: n.Msg.getMsg("Invoice"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "VAB_UOM_ID_K", caption: n.Msg.getMsg("UomName"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "VAM_Product_ID_K", caption: n.Msg.getMsg("ProductName"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "VAB_Order_ID_K", caption: n.Msg.getMsg("Order"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "VAM_Inv_InOut_ID_K", caption: n.Msg.getMsg("Shipment/Receipt"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "VAB_Invoice_ID_K", caption: n.Msg.getMsg("Invoice"), sortable: !1, size: "150px", hidden: !0 })); w2utils.encodeTags(i); o = "gridCreateForm" + this.windowNo; o = o.replace(".", ""); this.dGrid = t(this.middelDiv).w2grid({ name: o, recordHeight: 30, show: { selectColumn: !0 }, multiSelect: !0, columns: this.arrListColumns, records: i, onSelect: function (n) { n.onComplete = function () { c() } }, onEditField: function (n) { if (id = n.recid, n.column == 3) { $self.dGrid.records[n.index].QuantityEntered = y(n, $self.dGrid.records[n.index].QuantityEntered); var i = h.GetFormatAmount($self.dGrid.records[n.index].QuantityEntered, "init", e); $self.dGrid.records[n.index].QuantityEntered = h.GetConvertedString(i, e); t("#grid_" + $self.dGrid.name + "_rec_" + id).keydown(function (n) { if (e || n.keyCode != 190 && n.keyCode != 110) { if (e && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) ? n.target.value.indexOf(".") > -1 && (n.target.value = n.target.value.replace(".", "")) : n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && n.target.value.indexOf(",") > -1 && (n.target.value = n.target.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } } }); this.dGrid.selectNone(); var u = $self.cmbOrder.getControl().find("option:selected").val(), f = $self.cmbInvoice.getControl().find("option:selected").val(), s = $self.cmbShipment.getControl().find("option:selected").val(); for (itm in $self.multiValues) for (item in $self.dGrid.records) v = t.grep($self.multiValues, function (n) { return u != null ? n.VAM_Product_ID_K == $self.dGrid.records[item].VAM_Product_ID_K && n.VAB_Order_ID_K == $self.dGrid.records[item].VAB_Order_ID_K : f != null ? n.VAM_Product_ID_K == $self.dGrid.records[item].VAM_Product_ID_K && n.VAB_Invoice_ID_K == $self.dGrid.records[item].VAB_Invoice_ID_K : s != null ? n.VAM_Product_ID_K == $self.dGrid.records[item].VAM_Product_ID_K && n.VAM_Inv_InOut_ID_K == $self.dGrid.records[item].VAM_Inv_InOut_ID_K : n.VAB_Payment_ID_K == $self.dGrid.records[item].VAB_Payment_ID_K }), v.length > 0 && $self.dGrid.select(parseInt(item) + 1); if (this.dGrid.records.length > 0) for ($self.NonEditableRecord = [], r = 0; r < $self.dGrid.records.length; r++)t(t("#grid_" + $self.dGrid.name + "_rec_" + (r + 1)).find("input[type=checkbox]")[1]).prop("checked", i[r].Select), $self.dGrid.records[r].VAB_InvoicePaymentTerm_ID == $self.dGrid.records[r].VAB_PaymentTerm_ID || $self.dGrid.records[r].VAB_InvoicePaymentTerm_ID == 0 || $self.dGrid.records[r].VAB_InvoicePaymentTerm_ID != $self.dGrid.records[r].VAB_PaymentTerm_ID && $self.dGrid.records[r].IsAdvance == !1 && $self.dGrid.records[r].IsInvoicePTAdvance == !1 || (t("#grid_" + $self.dGrid.name + "_rec_" + (r + 1) + "  input").attr("disabled", !0), $self.NonEditableRecord.push(r + 1)); this.dGrid.on("change", function (t) { if (c(), $self.dGrid.columns[t.column].field == "QuantityEntered") { var i = h.GetConvertedNumber(t.value_new, e); if ($self.froMVABInvoice) { if ($self.dGrid.records[t.index].QuantityPending < i.toFixed(4)) { n.ADialog.error("InvoiceQtyGreater"); t.value_new = t.value_original; return } } else if ($self.dGrid.records[t.index].QuantityPending < i.toFixed(4)) { n.ADialog.error("QtyCanNotbeGreater"); t.value_new = t.value_original; return } $self.dGrid.records[t.index].QuantityEntered = i.toFixed(4); (u > 0 || f > 0) && l("QuantityEntered", t.index, i.toFixed(4)) } else $self.dGrid.columns[t.column].field == "VAM_PFeature_SetInstance_ID" ? ($self.dGrid.records[t.index].VAM_PFeature_SetInstance_ID = t.value_new, (u > 0 || f > 0) && l("VAM_PFeature_SetInstance_ID", t.index, t.value_new)) : $self.dGrid.columns[t.column].field == "Date" && ($self.dGrid.records[t.index].Date = t.value_new, $self.dGrid.records[t.index].Date != "" && l("Date", t.index, t.value_new)) }); this.dGrid.on("click", function (t) { t.preventDefault; c(); n.Env.getCtx().setContext($self.windowNo, "VAM_Product_ID", n.Utility.Util.getValueOfInt($self.dGrid.records[t.recid - 1].VAM_Product_ID_K)) }); var k = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return b(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, p = n.Application.contextUrl, w = p + "JsonData/JDataSet", d = p + "JsonData/ExecuteNonQuer"; this.dGrid.on("unselect", function (n) { if (n.all) n.onComplete = function () { for (item in $self.dGrid.records) { var n = t.grep($self.multiValues, function (n) { return u != null ? n.VAM_Product_ID_K == $self.dGrid.records[item].VAM_Product_ID_K && n.VAB_Order_ID_K == $self.dGrid.records[item].VAB_Order_ID_K : f != null ? n.VAM_Product_ID_K == $self.dGrid.records[item].VAM_Product_ID_K && n.VAB_Invoice_ID_K == $self.dGrid.records[item].VAB_Invoice_ID_K : s != null ? n.VAM_Product_ID_K == $self.dGrid.records[item].VAM_Product_ID_K && n.VAM_Inv_InOut_ID_K == $self.dGrid.records[item].VAM_Inv_InOut_ID_K : n.VAB_Payment_ID_K == $self.dGrid.records[item].VAB_Payment_ID_K }); n.length > 0 && $self.multiValues.splice($self.multiValues.indexOf(n[0]), 1) } }; else { var i = w2ui[n.target].records[n.index].VAM_Product_ID_K, r = t.grep($self.multiValues, function (t) { return u != null ? t.VAM_Product_ID_K == i && t.VAB_Order_ID_K == w2ui[n.target].records[n.index].VAB_Order_ID_K : f != null ? t.VAM_Product_ID_K == i && t.VAB_Invoice_ID_K == w2ui[n.target].records[n.index].VAB_Invoice_ID_K : s != null ? t.VAM_Product_ID_K == i && t.VAM_Inv_InOut_ID_K == w2ui[n.target].records[n.index].VAM_Inv_InOut_ID_K : t.VAB_Payment_ID_K == $self.dGrid.records[item].VAB_Payment_ID_K }); r.length > 0 && $self.multiValues.splice($self.multiValues.indexOf(r[0]), 1) } }) }; n.VCreateFrom = i })(VIS, jQuery), function (n, t) { function i(i) { function f() { var e, t, i, u, f; r.title = n.Msg.getElement(n.Env.getCtx(), "VAM_Inv_InOut_ID", !1) + " .. " + n.Msg.translate(n.Env.getCtx(), "CreateFrom"); r.lblShipment != null && r.lblShipment.getControl().css("display", "none"); r.cmbShipment != null && r.cmbShipment.getControl().css("display", "none"); r.Applybtn && r.Applybtn.css("display", "block"); e = 3537; t = new n.MVAMLocatorLookup(n.Env.getCtx(), r.windowNo); r.locatorField = new n.Controls.VLocator("VAM_Locator_ID", !0, !1, !0, n.DisplayType.Locator, t); r.deliveryDate = new n.Controls.VDate("DeliveryDate", !1, !1, !0, n.DisplayType.Date, "DeliveryDate"); i = n.MLookupFactory.getMLookUp(n.Env.getCtx(), r.windowNo, 2221, n.DisplayType.Search); r.vProduct = new n.Controls.VTextBoxButton("VAM_Product_ID", !0, !1, !0, n.DisplayType.Search, i); r.DocumentNoRef = new n.Controls.VTextBox("DocumentNo", !1, !0, !0, 50, 100, null, null, !1); r.lblContainer = new n.Controls.VLabel; r.cmbContainer = new n.Controls.VComboBox("", !1, !1, !0); r.lblContainer.getControl().text(n.Msg.getMsg("VIS_Container")); r.lblContainer != null && r.lblContainer.getControl().css("display", "block"); r.cmbContainer != null && r.cmbContainer.getControl().css("display", "block"); u = n.Env.getCtx().getContext(r.windowNo, "DocumentNo"); r.DocumentNoRef.setValue(u); f = r.initBPartner(!1); r.vBPartner.setReadOnly(!0); o(f) } function e(i, f, e) { var o = "i.DocumentNo||' - '||".concat(n.DB.to_char("DateInvoiced", n.DisplayType.Date, n.Env.getVAF_Language(i))).concat("|| ' - ' ||").concat(n.DB.to_char("GrandTotal", n.DisplayType.Amount, n.Env.getVAF_Language(i))), s = "Y".equals(n.Env.getCtx().getWindowContext(u.windowNo, "IsDropShip")); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetInvoicesVCreate", type: "POST", data: { displays: o, cBPartnerId: f, isReturnTrxs: e, IsDrops: s }, success: function (t) { var u = JSON.parse(t), f, e, i; if (u && u.length > 0) try { for (i = 0; i < u.length; i++)f = n.Utility.Util.getValueOfInt(u[i].key), e = n.Utility.encodeText(u[i].value), i == 0 && r.cmbInvoice.getControl().append(" <option value=0> <\/option>"), r.cmbInvoice.getControl().append(" <option value=" + f + ">" + e + "<\/option>"); r.cmbInvoice.getControl().prop("selectedIndex", 0) } catch (o) { } }, error: function (n) { u.log.info(n) } }) } function o(t) { r.cmbInvoice.getControl().html(""); var i = "Y".equals(n.Env.getCtx().getWindowContext(r.windowNo, "IsReturnTrx")); e(n.Env.getCtx(), t, i) } var r = this.$super, u; r.constructor(i); u = this; f(); r.jbInit(); r.initOK = !0; this.log = n.Logging.VLogger.getVLogger("VCreateFromShipment"); this.disposeComponent = function () { r = null; u = null; this.disposeComponent = null } } n.Utility.inheritPrototype(i, n.VCreateFrom); i.prototype.saveMVAMInvInOut = function (t) { var u, i, r, f, e; if (this.$super.dGrid == null || (u = {}, i = this.$super.multiValues, i == null) || i.length <= 0) return this.$super.setBusy(!1), !1; for (r = 0; r < i.length; r++)u[r] = i[r]; if (f = this.$super.locatorField.getValue(), f == null || f == 0) return n.ADialog.info("Error", !0, n.Msg.translate(n.Env.getCtx(), "VIS_locfieldMandatory"), ""), this.$super.setBusy(!1), !1; if (u.length == 0) return this.$super.setBusy(!1), !1; e = this.$super.cmbContainer.getValue(); e === undefined && (e = 0); var o = f, s = this.$super.mTab.getValue("VAM_Inv_InOut_ID"), h = this.$super.cmbInvoice.getControl().find("option:selected").val(), c = this.$super.cmbOrder.getControl().find("option:selected").val(); return this.saveData(u, "", c, h, o, s, e, t) }; i.prototype.loadInvoices = function (t, i, r) { var u = this.getInvoicesData(n.Env.getCtx(), t, i, r) }; i.prototype.getInvoicesData = function (i, r, u, f) { var e = this, o, c, s, h; if (this.$super.record_ID = $self.mTab.getValue("VAM_Inv_InOut_ID"), e.$super.dGrid != null) { o = e.$super.dGrid.getSelection(); for (item in o) c = t.grep(e.$super.multiValues, function (n) { return n.VAM_Product_ID_K == e.$super.dGrid.get(o[item]).VAM_Product_ID_K && n.VAB_Invoice_ID_K == e.$super.dGrid.get(o[item]).VAB_Invoice_ID_K }), c.length > 0 || e.$super.multiValues.push(e.$super.dGrid.get(o[item])) } return s = "", h = "", s = n.Env.isBaseLanguage(i, "VAB_UOM") ? "FROM VAB_UOM uom INNER JOIN VAB_InvoiceLine l ON (l.VAB_UOM_ID=uom.VAB_UOM_ID) " : "FROM VAB_UOM_TL uom Left join VAB_UOM uom1 on (uom1.VAB_UOM_ID=uom.VAB_UOM_ID) INNER JOIN VAB_InvoiceLine l ON (l.VAB_UOM_ID=uom.VAB_UOM_ID AND uom.VAF_Language='" + n.Env.getVAF_Language(i) + "') ", u != null && (h = " AND l.VAM_Product_ID = " + u), f || (f = 1), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetInvoicesDataVCreate", dataType: "json", type: "POST", data: { keyColumnName: e.$super.mTab.keyColumnName, tableName: "VAB_InvoiceLine", recordID: e.$super.record_ID, pageNo: f, isBaseLangss: s, cInvoiceID: r, MVAMProductIDs: h }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); selfChild.log.info(t); e.$super.setBusy(!1); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); e.$super.setBusy(!1); return } e.$super.resetPageCtrls(i.pSetting); e.$super.loadGrid(i.data); e.$super.setBusy(!1) } }), [] }; i.prototype.initContainerDetails = function () { this.$super.cmbContainer.getControl().html("") }; i.prototype.loadInvoice = function (t) { var i = this.getInvoiceData(n.Env.getCtx(), t); this.$super.loadGrid(i) }; i.prototype.getInvoiceData = function (t, i) { var o = [], f = "SELECT round((l.QtyInvoiced-SUM(COALESCE(mi.Qty,0))) * (CASE WHEN l.QtyInvoiced=0 THEN 0 ELSE l.QtyEntered/l.QtyInvoiced END ),2) as QUANTITY,round((l.QtyInvoiced-SUM(COALESCE(mi.Qty,0))) * (CASE WHEN l.QtyInvoiced=0 THEN 0 ELSE l.QtyEntered/l.QtyInvoiced END ),2) as QTYENTER, l.VAB_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name), l.VAM_Product_ID,p.Name, l.VAB_InvoiceLine_ID,l.Line, l.VAB_OrderLine_ID ", u, e; f = n.Env.isBaseLanguage(t, "VAB_UOM") ? f.concat("FROM VAB_UOM uom ").concat("INNER JOIN VAB_InvoiceLine l ON (l.VAB_UOM_ID=uom.VAB_UOM_ID) ") : f.concat("FROM VAB_UOM_TL uom ").concat("INNER JOIN VAB_InvoiceLine l ON (l.VAB_UOM_ID=uom.VAB_UOM_ID AND uom.VAF_Language='").concat(n.Env.getVAF_Language(t)).concat("') "); f = f.concat("INNER JOIN VAM_Product p ON (l.VAM_Product_ID=p.VAM_Product_ID) ").concat("LEFT OUTER JOIN VAM_MatchInvoice mi ON (l.VAB_InvoiceLine_ID=mi.VAB_InvoiceLine_ID) ").concat("WHERE l.VAB_Invoice_ID=" + i + " GROUP BY l.QtyInvoiced,l.QtyEntered,l.VAB_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name),l.VAM_Product_ID,p.Name, l.VAB_InvoiceLine_ID,l.Line,l.VAB_OrderLine_ID ORDER BY l.Line"); u = null; try { for (u = n.DB.executeReader(f.toString(), null, null), e = 1; u.read();) { var r = {}, s = u.getDecimal(0), h = u.getDecimal(1); r.Quantity = s; r.QuantityEntered = h; r.VAB_UOM_ID = u.getString(3); r.VAM_Product_ID = u.getString(5); r.VAB_Order_ID = "."; r.VAM_Inv_InOut_ID = null; r.VAB_Invoice_ID = u.getString(7); r.VAB_UOM_ID_K = u.getString(2); r.VAM_Product_ID_K = u.getInt(4); r.VAB_Order_ID_K = u.getInt(8); r.VAM_Inv_InOut_ID_K = null; r.VAB_Invoice_ID_K = u.getInt(6); r.recid = e; e++; o.push(r) } u.close() } catch (c) { } return o }; i.prototype.saveData = function (i, r, u, f, e, o, s, h) { var c = this; console.log(e); t.ajax({ type: "POST", url: n.Application.contextUrl + "Common/SaveShipment", dataType: "json", data: { model: i, selectedItems: r, VAB_Order_ID: u, VAB_Invoice_ID: f, VAM_Locator_ID: e, VAM_Inv_InOut_ID: o, Container_ID: s }, success: function (n) { if (returnValue = n.result, returnValue) { h ? c.$super.callBackSave(returnValue) : (c.dispose(), c.$super.setBusy(!1), c.$super.$root.dialog("close")); return } }, error: function (n, t, i) { console.log(t); c.$super.setBusy(!1); alert(i) } }) }; i.prototype.dispose = function () { this.disposeComponent != null && this.disposeComponent() }; n.VCreateFromShipment = i }(VIS, jQuery), function (n, t) { function i(t) { function f() { var f, e, t; return i.mTab.getValue("VAB_BankingJRNL_ID") == null ? (n.ADialog.error(n.Msg.getMsg("SaveErrorRowNotFound", !0)), !1) : (i.title = n.Msg.getElement(n.Env.getCtx(), "VAB_BankingJRNL_ID", !1) + " .. " + n.Msg.getMsg("CreateFrom"), i.relatedToOrg = null, i.lblOrder != null && i.lblOrder.getControl().css("display", "none"), i.cmbOrder != null && i.cmbOrder.getControl().css("display", "none"), i.lblShipment != null && i.lblShipment.getControl().css("display", "none"), i.cmbShipment != null && i.cmbShipment.getControl().css("display", "none"), i.lblInvoice != null && i.lblInvoice.getControl().css("display", "none"), i.cmbInvoice != null && i.cmbInvoice.getControl().css("display", "none"), f = 4917, e = n.MLookupFactory.getMLookUp(n.Env.getCtx(), u, f, n.DisplayType.TableDir), i.cmbBankAccount = new n.Controls.VComboBox("VAB_Bank_Acct_ID", !0, !0, !0, e, 150, n.DisplayType.TableDir, 0), i.Date = new n.Controls.VDate("Date", !1, !1, !0, n.DisplayType.Date, "Date"), i.DocumentNo = new n.Controls.VTextBox("DocumentNo", !1, !1, !0, 50, 100, null, null, !1), i.Amount = new n.Controls.VAmountTextBox("Amount", !1, !1, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")), i.DepositSlip = new n.Controls.VTextBox("DepositSlip", !1, !1, !0, 50, 100, null, null, !1), i.AuthCode = new n.Controls.VTextBox("AuthCode", !1, !1, !0, 50, 100, null, null, !1), i.CheckNo = new n.Controls.VTextBox("CheckNo", !1, !1, !0, 50, 100, null, null, !1), i.cmbBankAccount.getControl().prop("selectedIndex", 0), t = n.Env.getCtx().getContextAsInt(u, "VAB_Bank_Acct_ID"), i.cmbBankAccount.setValue(t), r.initBPartner(t), r.loadBankAccounts(t, 0, "", "", "", "", "", "0", 1), i.btnRefresh && i.btnRefresh.css("display", "black"), !0) } var i = this.$super, r, u; i.constructor(t); r = this; u = t.getWindowNo(); f(); i.jbInit(); i.initOK = !0; i.middelDiv.css("height", "61%"); this.disposeComponent = function () { this.disposeComponent = null } } function u(n, i, r) { var u = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } var f, o; n.Utility.inheritPrototype(i, n.VCreateFrom); i.prototype.initBPartner = function (t) { var i = this.$super, r = " VAB_BusinessPartner.VAB_BusinessPartner_ID IN (SELECT  p.VAB_BusinessPartner_ID as VAB_BusinessPartner_ID FROM VAB_Payment p WHERE p.Processed='Y' AND p.IsReconciled='N' AND p.DocStatus IN ('CO','CL','RE','VO') AND p.PayAmt<>0 AND p.VAB_Bank_Acct_ID = " + t + " AND NOT EXISTS (SELECT * FROM VAB_BankingJRNLLine l WHERE p.VAB_Payment_ID=l.VAB_Payment_ID AND l.StmtAmt <> 0) )", u = n.MLookupFactory.get(n.Env.getCtx(), this.windowNo, 5398, n.DisplayType.Search, "VAB_BusinessPartner_ID", 0, !1, r); i.vBPartner = new n.Controls.VTextBoxButton("VAB_BusinessPartner_ID", !0, !1, !0, n.DisplayType.Search, u) }; i.prototype.getTableFieldVOs = function () { var t = this.$super, i; t.arrListColumns = []; t.arrListColumns.push({ field: "Date", caption: n.Msg.getMsg("DateAcct"), sortable: !0, size: "100px", hidden: !1, editable: { type: "date" }, render: function (n) { var t = n.Date; return new Date(t).toLocaleDateString() } }); t.arrListColumns.push({ field: "VAB_Payment_ID", caption: n.Msg.getMsg("Payment"), sortable: !0, size: "100px", hidden: !1 }); t.arrListColumns.push({ field: "VAB_Currency_ID", caption: n.Msg.getMsg("Currency"), sortable: !0, size: "80px", hidden: !1 }); i = n.Utility.Util.getValueOfInt(f("VIS_145")); i > 0 && t.arrListColumns.push({ field: "VA034_DepositSlipNo", caption: n.Msg.getMsg("DepositSlipNo"), sortable: !0, size: "100px", hidden: !1 }); t.arrListColumns.push({ field: "AuthCode", caption: n.Msg.getMsg("AuthCode"), sortable: !0, size: "100px", hidden: !1 }); t.arrListColumns.push({ field: "CheckNo", caption: n.Msg.getMsg("CheckNo"), sortable: !0, size: "80px", hidden: !1 }); t.arrListColumns.push({ field: "Amount", caption: n.Msg.getMsg("Amount"), sortable: !0, size: "80px", hidden: !1, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.Amount); return i.toLocaleString() } }); t.arrListColumns.push({ field: "ConvertedAmount", caption: n.Msg.getMsg("ConvertedAmount"), sortable: !0, size: "80px", hidden: !1, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.ConvertedAmount); return i.toLocaleString() } }); t.arrListColumns.push({ field: "Description", caption: n.Msg.getMsg("Description"), sortable: !0, size: "250px", hidden: !1 }); t.arrListColumns.push({ field: "VAB_BusinessPartner_ID", caption: n.Msg.getMsg("BusinessPartner"), sortable: !0, size: "150px", hidden: !1 }); t.arrListColumns.push({ field: "Type", caption: n.Msg.getMsg("Type"), sortable: !0, size: "80px", hidden: !0 }); t.arrListColumns.push({ field: "VAB_Payment_ID_K", caption: n.Msg.getMsg("Payment"), sortable: !0, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "VAB_Currency_ID_K", caption: n.Msg.getMsg("Currency"), sortable: !0, size: "150px", hidden: !0 }) }; i.prototype.loadBankAccounts = function (t, i, r, u, f, e, o, s, h) { var c = this.$super, l = c.mTab.getValue("StatementDate"), a = this.getBankAccountsData(n.Env.getCtx(), t, i, r, l, u, f, e, o, s, h); this.getTableFieldVOs() }; i.prototype.getBankAccountsData = function (i, r, u, f, e, o, s, h, c, l, a) { var v = this, y, p, nt, tt; if (v.$super.dGrid != null) { y = v.$super.dGrid.getSelection(); for (item in y) p = t.grep(v.$super.multiValues, function (n) { return n.VAB_Payment_ID_K == v.$super.dGrid.get(y[item]).VAB_Payment_ID_K }), p.length > 0 || v.$super.multiValues.push(v.$super.dGrid.get(y[item])) } e == null && (e = DateTime.Today.Date); var it = n.DB.to_date(e, !0), w = "", b = "", k = "0", d = "", g = ""; return u > 0 && (k = " AND p.VAB_BusinessPartner_ID = " + u), o != "" && (d = " AND p.DocumentNo LIKE '" + o + "'"), f != "" && f != null && (nt = n.DB.to_date(f, !0), w = " AND p.DateAcct = " + nt), o != "" && (g = " AND cs.DocumentNo LIKE '" + o + "'"), f != "" && f != null && (tt = n.DB.to_date(f, !0), b = " AND cs.DateAcct = " + tt), a || (a = 1), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetBankAccountsData", dataType: "json", type: "POST", data: { pageNo: a, dates: it, trxDatess: w, trxDatesUnions: b, cBPartnerIDs: k, DocumentNos: d, DocumentNoUnions: g, DepositSlips: s, AuthCodes: h, CheckNos: c, Amounts: l, cBankAccountId: r }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); v.$super.setBusy(!1); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); v.$super.setBusy(!1); return } v.$super.resetPageCtrls(i.pSetting); v.$super.loadGrid(i.data); v.$super.setBusy(!1) } }), [] }; i.prototype.loadBankAccount = function (t) { var i = this.$super, r = i.mTab.getValue("StatementDate"), u = this.getBankAccountData(n.Env.getCtx(), t, r); this.getTableFieldVOs(); setTimeout(function () { i.loadGrid(u) }, 10) }; i.prototype.getBankAccountData = function (i, r, u) { var s = [], f, o, e; try { for (u == null && (u = DateTime.Today.Date), f = null, t.ajax({ url: n.Application.contextUrl + "Form/GetBankAccontData", async: !1, data: { VAB_Bank_Acct_ID: r, ts: u } }).done(function (t) { f = (new n.DB.DataReader).toJson(t) }), o = 1; f.read();)e = {}, e.Date = f.getString(0), e.VAB_Payment_ID = f.getString(2), e.VAB_Currency_ID = f.getString(4), e.Amount = f.getDecimal(5), e.ConvertedAmount = f.getDecimal(6), e.VAB_BusinessPartner_ID = f.getString(7), e.Type = f.getString(8), e.VAB_Payment_ID_K = f.getString(1), e.VAB_Currency_ID_K = f.getInt(3), e.recid = o, o++, s.push(e) } catch (h) { } return s }; var r = n.Application.contextUrl, e = r + "JsonData/JDataSetWithCode", s = r + "JsonData/ExecuteNonQuer"; f = function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, f = null; return u(o, e, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); f = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; e && r(f) }), f }; o = function (t, i, r) { var o = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, f; return i && (e.param = i), f = null, u(e, o, function (t) { f = (new n.DB.DataReader).toJson(t); r && r(f) }), f }; i.prototype.saveStatment = function () { var n; if (this.$super.dGrid == null) return !1; var r = this.$super.mTab.getValue("VAB_BankingJRNL_ID"), i = {}, t = this.$super.multiValues; if (t == null || t.length <= 0) return !1; for (n = 0; n < t.length; n++)i[n] = t[n]; return this.saveData(i, "", r) }; i.prototype.saveData = function (i, r, u) { var f = this; t.ajax({ type: "POST", url: n.Application.contextUrl + "Common/SaveStatment", dataType: "json", data: { model: i, selectedItems: r, VAB_BankingJRNL_ID: u }, success: function (n) { if (returnValue = n.result, returnValue) { f.dispose(); f.$super.$root.dialog("close"); f.$super.setBusy(!1); return } f.$super.setBusy(!1); alert(returnValue) }, error: function (n, t, i) { console.log(t); f.$super.setBusy(!1); alert(i) } }) }; i.prototype.dispose = function () { this.disposeComponent != null && this.disposeComponent() }; n.VCreateFromStatement = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { var f, e; this.windowNo = i; this.VAF_Client_ID = r; this.VAF_Org_ID = 0; this.DateFrom = null; this.DateTo = null; f = this; this.ASchemas = []; this.ASchema = []; this.log = n.Logging.VLogger.getVLogger("AccountViewer"); this.dataByData = null; this._elements = []; this.documentQuery = !1; this.VAB_AccountBook_ID = 0; this.PostingType = ""; this.VAF_TableView_ID = u; this.Record_ID = 0; this.whereInfo = []; this.tableInfo = []; this.displayQty = !1; this.displaySourceAmt = !1; this.displayDocumentInfo = !1; this.sortBy1 = ""; this.sortBy2 = ""; this.sortBy3 = ""; this.sortBy4 = ""; this.group1 = !1; this.group2 = !1; this.group3 = !1; this.group4 = !1; this._leadingColumns = 0; this._ref1 = null; this._ref2 = null; this.TABLE_ALIAS = "zz"; this.FUNCTION_COUNT = "Count"; this.FUNCTION_SUM = "Sum"; this.onLoaded = null; this.HasOrgUnit = null; this.VAF_Client_ID == 0 && (this.VAF_Client_ID = n.Env.getCtx().getContextAsInt(this.windowNo, "VAF_Client_ID")); this.VAF_Client_ID == 0 && (this.VAF_Client_ID = n.Env.getCtx().ctx.VAF_Client_ID); this.VAF_Org_ID == 0 && (this.VAF_Org_ID = Number(n.context.getWindowTabContext(this.windowNo, 0, "VAF_Org_ID"))); e = ["AmtAcctCr", "AmtAcctDr",]; n.translatedTexts = n.Msg.translate(n.Env.getCtx(), e, !0); this.ELEMENTTYPE_VAF_Control_Ref_ID = 181; this.ELEMENTTYPE_Account = "AC"; this.ELEMENTTYPE_Activity = "AY"; this.ELEMENTTYPE_BPartner = "BP"; this.ELEMENTTYPE_LocationFrom = "LF"; this.ELEMENTTYPE_LocationTo = "LT"; this.ELEMENTTYPE_Campaign = "MC"; this.ELEMENTTYPE_Organization = "OO"; this.ELEMENTTYPE_OrgTrx = "OT"; this.ELEMENTTYPE_Project = "PJ"; this.ELEMENTTYPE_Product = "PR"; this.ELEMENTTYPE_SubAccount = "SA"; this.ELEMENTTYPE_SalesRegion = "SR"; this.ELEMENTTYPE_UserList1 = "U1"; this.ELEMENTTYPE_UserList2 = "U2"; this.ELEMENTTYPE_UserElement1 = "X1"; this.ELEMENTTYPE_UserElement2 = "X2"; this.getClientAcctSchema = function (i, r) { var e = [], u = this; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/GetClientAcctSchema", type: "POST", async: !0, data: { vaf_client_id: i, vaf_org_id: r }, success: function (t) { var r, f, o, i, s; if (t.result && t.result.AcctSchemas) for (r = t.result.AcctSchemas, i = 0; i < r.length; i++)f = {}, VAB_AccountBook_id = r[i].Key, f.Key = VAB_AccountBook_id, f.Name = n.Utility.encodeText(r[i].Name), e.push(f); if (t.result && t.result.OtherAcctSchemas) for (o = t.result.OtherAcctSchemas, i = 0; i < o.length; i++)s = {}, s.Key = o[i].Key, s.Name = n.Utility.encodeText(o[i].Name), e.push(s); u.ASchemas = e; u.ASchema = e[0]; u.onLoaded && u.onLoaded() }, error: function (n) { f.log.info(n); u.onLoaded && u.onLoaded() } }), e }; this.getClientAcctSchema(this.VAF_Client_ID, this.VAF_Org_ID) } function r(r, u, f, e, o) { function yf() { nf.getControl().text(n.Msg.getMsg("Selection")); vr.getControl().text(n.Msg.translate(n.Env.getCtx(), or)); hi.getControl().text(n.Msg.translate(n.Env.getCtx(), or)); yr.getControl().text(n.Msg.translate(n.Env.getCtx(), lu)); ft.find("label").text(n.Msg.getMsg(au)); br.getControl().text(n.Msg.translate(n.Env.getCtx(), sr)); kr.getControl().text(n.Msg.translate(n.Env.getCtx(), yi)); pr.getControl().text(n.Msg.translate(n.Env.getCtx(), vu)); wr.getControl().text(n.Msg.translate(n.Env.getCtx(), "AcctDateTo")); dr.getControl().text(n.Msg.translate(n.Env.getCtx(), cr)); gr.getControl().text(n.Msg.translate(n.Env.getCtx(), lr)); nu.getControl().text(n.Msg.translate(n.Env.getCtx(), "Project")); pu.getControl().text(n.Msg.translate(n.Env.getCtx(), ar)); gu.getControl().text(n.Msg.translate(n.Env.getCtx(), "OrganizationUnit")); tf.getControl().text(n.Msg.getMsg("Display")); gi.find("label").text(n.Msg.getMsg("DisplayQty")); tr.find("label").text(n.Msg.getMsg("DisplaySourceInfo")); nr.find("label").text(n.Msg.getMsg("DisplayDocumentInfo")); tu.getControl().text(n.Msg.getMsg("SortBy")); iu.getControl().text(n.Msg.getMsg("GroupBy")); ni.getControl().css("color", "rgba(var(--v-c-primary), 1)"); a.text(n.Msg.getMsg("RePost")); notShowPosted ? (a.hide(), nt.find("label").text(n.Msg.getMsg("Force")), nt.hide()) : (a.show(), nt.find("label").text(n.Msg.getMsg("Force")), nt.show()) } function ou() { oi.css("color", "rgba(var(--v-c-on-secondary), 1)"); ei.css("font-size", "1rem").css("color", "rgba(var(--v-c-primary), 1)"); yt.show(); w.show(); ii.css("display", "none"); a.hide(); nt.hide(); hi.getControl().hide(); g.getControl().hide(); w.find("#btnSelctDoc_" + h).attr("name", w.find("#btnSelctDoc_" + h).parent().find("select").val() + "_ID"); w.find("#btnSelctDocClear_" + h).attr("name", w.find("#btnSelctDocClear_" + h).parent().find("select").val() + "_ID") } function ur() { ei.css("color", "rgba(var(--v-c-on-secondary), 1)"); oi.css("font-size", "1rem").css("color", "rgba(var(--v-c-primary), 1)"); yt.hide(); w.hide(); ii.css("display", "block"); notShowPosted ? (a.hide(), nt.hide()) : (a.show(), nt.show()); hi.getControl().show(); g.getControl().show() } function tt(n) { er.css("display", n ? "block" : "none") } function pf(i) { var e, s, o, u, f, r, l; for (c.dGrid != null && (c.dGrid.destroy(), c.dGrid = null), c.arrListColumns = [], e = [], s = 1, o = 0; o < i.Data.length; o++) { for (u = i.Data[o], f = {}, r = 0; r < i.Columns.length; r++)c.arrListColumns.length != i.Columns.length && (u[r] != null && typeof u[r] == "number" && (n.translatedTexts.AmtAcctCr == i.Columns[r] || n.translatedTexts.AmtAcctDr == i.Columns[r]) ? c.arrListColumns.push({ field: i.Columns[r], caption: n.Msg.translate(n.Env.getCtx(), i.Columns[r]), sortable: !0, size: "16%", hidden: !1, style: "text-align: right" }) : c.arrListColumns.push({ field: i.Columns[r], caption: n.Msg.translate(n.Env.getCtx(), i.Columns[r]), sortable: !0, size: "16%", hidden: !1 })), u[r] != null && typeof u[r] == "object" ? f[i.Columns[r]] = u[r].Name : u[r] != null && i.Columns[r].indexOf("Date") > 0 ? u[r] != "" && (l = new Date(parseInt(u[r].substr(6))), e != null && (f[i.Columns[r]] = l.toLocaleDateString())) : f[i.Columns[r]] = u[r] != null && typeof u[r] == "number" && (n.translatedTexts.AmtAcctCr == i.Columns[r] || n.translatedTexts.AmtAcctDr == i.Columns[r]) ? parseFloat(u[r]).toLocaleString() : u[r]; f.recid = s; s++; e.push(f) } setTimeout(10); w2utils.encodeTags(e); c.dGrid = t(ii).w2grid({ name: "gridAccViewer" + h, recordHeight: 40, columns: c.arrListColumns, records: e }) } function ct(n) { var i = n.attr("name"), t; return n.find("span").text(" "), s.whereInfo.length > 0 && (t = s.whereInfo.map(function (n) { return n.Key == i }).indexOf(!0), s.whereInfo.splice(t, 1)), n.width = 44, 0 } function wf() { if (ei != null) ei.on(n.Events.onTouchStartOrClick, function () { ou() }); if (oi != null) oi.on(n.Events.onTouchStartOrClick, function () { c.dGrid.refresh(); ur() }); if (at != null && at.getControl().change(function () { rf() }), g != null && g.getControl().change(function () { tt(!0); s.VAB_AccountBook_ID = g.getControl().find("option:selected").val(); setTimeout(function () { s.Query(r, uf) }, 2) }), lt != null) lt.on("click", function () { tt(!0); g.setValue(at.getControl().find("option:selected").val()); fr(); tt(!1) }); if (ft != null && ft.change(function () { ff() }), vt != null && vt.getControl().change(function () { ef(); s.Record_ID = f; s.VAF_TableView_ID }), a != null) a.on("click", function () { tt(!0); var n = gf(); setTimeout(function () { n ? bf(s.Record_ID) : tt(!1) }, 5) }); if (l != null) l.on("click", function () { ri(l) }); if (b != null) b.on("click", function () { ri(b) }); if (v != null) v.on("click", function () { ri(v) }); if (y != null) y.on("click", function () { ri(y) }); if (p != null) p.on("click", function () { ri(p) }); if (k != null) k.on("click", function () { ri(k) }); if (d != null) d.on("click", function () { ri(d) }); if (et != null) et.on("click", function () { ct(l) }); if (ot != null) ot.on("click", function () { ct(b) }); if (it != null) it.on("click", function () { ct(v) }); if (rt != null) rt.on("click", function () { ct(y) }); if (ut != null) ut.on("click", function () { ct(p) }); if (st != null) st.on("click", function () { ct(k) }); if (ht != null) ht.on("click", function () { ct(d) }) } function bf(i) { t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerRePost", type: "POST", async: !0, data: { dataRecID: i }, success: function () { }, error: function (n) { $selfObj.log.info(n); tt(!1) } }) } function kf() { var u, f; notShowPosted = n.Env.getCtx().getContext("#SHOW_REPOST").equals("N"); ir = t("<div id='topDiv_" + h + "' style='float: left; width: 100%;'><div id='queryDiv_" + h + "'style='display: inline-block; margin-right: 15px; margin-top: 5px' ><label id='lblquery_" + h + "' class='VIS_Pref_Label_Font' style='cursor: pointer;font-size: 1rem;color: rgba(var(--v-c-primary), 1);'>" + n.Msg.getMsg("ViewerQuery") + "<\/label><\/div><div id='resulttopDiv_" + h + "' style='display: inline-block; width: 160px;'><label id='lblresult_" + h + "' class='VIS_Pref_Label_Font' style='vertical-align: middle; cursor: pointer;'>" + n.Msg.getMsg("ViewerResult") + "<\/label><\/div><\/div><\/div>"); var k = t("<div id='resultTopFilterDiv_" + h + "' style='float: right;width: 50%;'>"), tt = t('<div class="input-group vis-input-wrap">'), st = t('<div class="vis-control-wrap">'); k.append(tt); tt.append(st); st.append(g.getControl()).append(hi.getControl()); ir.append(k); w = t("<div class='vis-leftsidebarouterwrap' id='leftSideDiv_" + h + "' style='float: left;background-color: rgba(var(--v-c-secondary), 1);overflow: auto;padding: 10px;'>"); n.Application.isRTL && w.css("float", "right"); w.css("width", "50%"); w.css("height", rr); ti = t("<div style='float: left;width: 100%;height: 100%;' id='parameterLeftDiv_" + h + "'>"); w.append(ti); var e = t("<table style='width: 100%;height: 100%;'>"), r = t("<tr>"), i = t("<td>"), u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'); ti.append(e); e.append(r); r.append(i); i.append(u); u.append(f); f.append(at.getControl()).append(vr.getControl()); r = t("<tr>"); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); f.append(pi.getControl()).append(yr.getControl()); r = t("<tr>"); i = t("<td>"); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); e.append(r); r.append(i); i.append(u); u.append(f); f.append(ft); r = t("<tr>"); i = t("<td>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'); e.append(r); r.append(i); i.append(u); u.append(f); u.append(o); f.append(vt.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")); o.append(l).append(et); r = t("<tr>"); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); f.append(ci).append(pr.getControl()); r = t("<tr>"); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); f.append(li).append(wr.getControl()); r = t("<tr>"); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); f.append(fi.getControl()).append(br.getControl()); r = t("<tr>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'), s = t('<input type="text" readonly data-hasbtn=" ">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); u.append(o); f.append(s).append(kr.getControl()); o.append(b).append(ot); r = t("<tr>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'), s = t('<input type="text" readonly data-hasbtn=" ">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); u.append(o); f.append(s).append(gu.getControl()); o.append(d).append(ht); r = t("<tr>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'), s = t('<input type="text" readonly data-hasbtn=" ">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); u.append(o); f.append(s).append(dr.getControl()); o.append(v).append(it); r = t("<tr>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'), s = t('<input type="text" readonly data-hasbtn=" ">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); u.append(o); f.append(s).append(gr.getControl()); o.append(y).append(rt); r = t("<tr>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'), s = t('<input type="text" readonly data-hasbtn=" ">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); u.append(o); f.append(s).append(nu.getControl()); o.append(p).append(ut); yt = t("<div id='rightSideDiv_" + h + "' style='float: right;margin-bottom: 3px; margin-right: 0px; '>"); yt.css("width", "50%"); yt.css("height", rr); ti = t("<div style='float: left;width: 100%;height: 100%;' id='parameterRightDiv_" + h + "'>"); yt.append(ti); e = t("<table style='width: 100%;height: 100%;'>"); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); ti.append(e); e.append(r); r.append(i); i.append(nr); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(tr); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(gi); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(tu.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); i = t("<td style='padding: 0px 15px 0px;'>"); r.append(i); i.append(iu.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(bt.getControl().css("display", "inline-block").css("width", "100%").css("height", "32px")); i = t("<td style='padding: 0px 15px 0px;'>"); r.append(i); i.append(ru); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(kt.getControl().css("display", "inline-block").css("width", "100%").css("height", "32px")); i = t("<td style='padding: 0px 15px 0px;'>"); r.append(i); i.append(uu); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(dt.getControl().css("display", "inline-block").css("width", "100%").css("height", "32px")); i = t("<td style='padding: 0px 15px 0px;'>"); r.append(i); i.append(fu); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(gt.getControl().css("display", "inline-block").css("width", "100%").css("height", "32px")); i = t("<td style='padding: 0px 15px 0px;'>"); r.append(i); i.append(eu); pt = t("<div class='vis-acctviewerbottdiv'>"); c.getIsMenu() || (pt.append(a), pt.append(nt)); pt.append(ni.getControl().addClass("VIS_Pref_Label_Font")); pt.append(lt); pt.append(si); ii = t("<div id='resultDiv_" + h + "' style='float: left; width: 100%; display: none;'>"); ii.css("height", rr); wt.append(ir).append(w).append(yt).append(ii).append(pt); wt.append(er) } function df(t, u) { s = new i(h, r, t); s.onLoaded = function () { vi(at.getControl(), s.getAcctSchema()); g.getControl().append("<option value='-1' ><\/option>"); vi(g.getControl(), s.getAcctSchema()); rf(); vi(vt.getControl(), s.getTable()); vi(pi.getControl(), s.getPostingType()); vi(fi.getControl(), s.getOrg()); l.find("span").text(""); b.attr("Name", yi); ot.attr("Name", yi); b.find("span").text(""); v.attr("Name", cr); it.attr("Name", cr); v.find("span").text(""); y.attr("Name", lr); rt.attr("Name", lr); y.find("span").text(""); p.attr("Name", yu); ut.attr("Name", yu); p.find("span").text(""); k.attr("Name", ar); st.attr("Name", ar); k.find("span").text(""); d.attr("Name", hr); ht.attr("Name", hr); d.find("span").text(""); var i = t != 0 && u != 0; i && ft.find("input").prop("checked", !0); ff(); ef(); ni.getControl().text(n.Msg.getMsg("VIS_EnterSelctionAndDisplayToQueryFind")); ni.getControl().css("color", "rgba(var(--v-c-primary), 1)"); i && (s.VAF_TableView_ID = t, s.Record_ID = u); fr() } } function rf() { var o = at.getControl().find("option:selected").val(), e, r, t, i, u; if (o != null) { for (s.VAB_AccountBook_ID = o, e = s.getAcctSchemaElements(s.VAB_AccountBook_ID), bt.getControl().empty(), kt.getControl().empty(), dt.getControl().empty(), gt.getControl().empty(), ai({ Key: "", Name: "" }), ai({ Key: "DateAcct", Name: n.Msg.translate(n.Env.getCtx(), "DateAcct") }), ai({ Key: "DateTrx", Name: n.Msg.translate(n.Env.getCtx(), "DateTrx") }), ai({ Key: "VAB_YearPeriod_ID", Name: n.Msg.translate(n.Env.getCtx(), "VAB_YearPeriod_ID") }), r = [], r.push(wu), r.push(bu), r.push(ku), r.push(du), t = [], t.push(v), t.push(y), t.push(p), t.push(k), t.push(it), t.push(rt), t.push(ut), t.push(st), t.push(wi), t.push(bi), t.push(ki), t.push(di), t.push(d), t.push(ht), i = 0, u = 0; u < e.length && i < r.length; u++) { var f = e[u][0], h = s.getColumnName(f.elementtype), c = s.getColumnName(f.elementtype); ai({ Key: h, Name: n.Msg.translate(n.Env.getCtx(), c) }); f.elementtype == "OO" || f.elementtype == "AC" || (r[i].getControl().text(n.Msg.translate(n.Env.getCtx(), c)), r[i].getControl().show(), t[i].attr("Name", h), t[i].find("span").text(""), t[i].show(), i++) } while (i < r.length) r[i].getControl().hide(), i++; bt.getControl().prop("selectedIndex", 0); kt.getControl().prop("selectedIndex", 0); dt.getControl().prop("selectedIndex", 0); gt.getControl().prop("selectedIndex", 0) } } function ai(n) { bt.getControl().append(" <option selected value='" + n.Key + "' >" + n.Name + "<\/option>"); kt.getControl().append(" <option selected value='" + n.Key + "' >" + n.Name + "<\/option>"); dt.getControl().append(" <option selected value='" + n.Key + "' >" + n.Name + "<\/option>"); gt.getControl().append(" <option selected value='" + n.Key + "' >" + n.Name + "<\/option>") } function fr() { var t = "", i, u, f; if (s.VAB_AccountBook_ID = 0, s.VAF_Org_ID = 0, i = at.getControl().find("option:selected").val(), i != null && (s.VAB_AccountBook_ID = i), t = t.concat("VAB_AccountBook_ID=").concat(s.VAB_AccountBook_ID), i = pi.getControl().find("option:selected").val(), i != null && i != "0" && (s.PostingType = i), t = t.concat(", PostingType=").concat(s.PostingType), s.documentQuery = ft.find("input").prop("checked"), t = t.concat(", DocumentQuery=").concat(s.documentQuery), ft.find("input").prop("checked")) { if (s.VAF_TableView_ID == 0 || s.Record_ID == 0) return; t = t.concat(", VAF_TableView_ID=").concat(s.VAF_TableView_ID).concat(", Record_ID=").concat(s.Record_ID) } else if (s.DateFrom = ci.val(), s.DateFrom != "" && (t = t.concat(", DateFrom=").concat(s.DateFrom)), s.DateTo = li.val(), s.DateTo != "" && (t = t.concat(", DateTo=").concat(s.DateTo)), i = fi.getControl().find("option:selected").val(), i != null && (s.VAF_Org_ID = i), t = t.concat(", VAF_Org_ID=").concat(s.VAF_Org_ID), u = s.whereInfo, u != null) for (f = 0; f < u.length; f++)t = t.concat(", ").concat(u[f].Value); s.displayQty = gi.prop("checked"); t = t.concat(", - Display Qty=").concat(s.displayQty); s.displaySourceAmt = tr.prop("checked"); t = t.concat(", Source=").concat(s.displaySourceAmt); s.displayDocumentInfo = nr.prop("checked"); t = t.concat(", Doc=").concat(s.displayDocumentInfo); bt.getControl().find("option:selected").val() != null && (s.sortBy1 = bt.getControl().find("option:selected").val()); s.group1 = ru.prop("checked"); t = t.concat(" - Sorting: ").concat(s.sortBy1).concat("/").concat(s.group1); kt.getControl().find("option:selected").val() != null && (s.sortBy2 = kt.getControl().find("option:selected").val()); s.group2 = uu.prop("checked"); t = t.concat(", ").concat(s.sortBy2).concat("/").concat(s.group2); dt.getControl().find("option:selected").val() != null && (s.sortBy3 = dt.getControl().find("option:selected").val()); s.group3 = fu.prop("checked"); t = t.concat(", ").concat(s.sortBy3).concat("/").concat(s.group3); gt.getControl().find("option:selected").val() != null && (s.sortBy4 = gt.getControl().find("option:selected").val()); s.group4 = eu.prop("checked"); t = t.concat(", ").concat(s.sortBy4).concat("/").concat(s.group4); lt.Enabled = !1; ni.getControl().text(n.Msg.translate(n.Env.getCtx(), "Processing")); c.getIsMenu() ? cu ? (c.dGrid.refresh(), ur()) : ou() : ur(); cu = !0; s.Query(r, uf); s.VAB_AccountBook_ID > 0 && g.setValue(s.VAB_AccountBook_ID); lt.Enabled = !0; ni.getControl().text(n.Msg.getMsg("VIS_EnterSelctionAndDisplayToQueryFind")) } function uf(n) { n != null && pf(n); tt(!1) } function ff() { var n = ft.find("input").prop("checked"); n ? (vt.getControl().removeAttr("disabled"), l.removeAttr("disabled"), et.removeAttr("disabled"), ci.attr("disabled", "disabled"), li.attr("disabled", "disabled"), fi.getControl().attr("disabled", "disabled"), b.attr("disabled", "disabled"), v.attr("disabled", "disabled"), y.attr("disabled", "disabled"), p.attr("disabled", "disabled"), k.attr("disabled", "disabled"), d.attr("disabled", "disabled"), ot.attr("disabled", "disabled"), it.attr("disabled", "disabled"), rt.attr("disabled", "disabled"), ut.attr("disabled", "disabled"), st.attr("disabled", "disabled"), ht.attr("disabled", "disabled"), wi.attr("disabled", "disabled"), bi.attr("disabled", "disabled"), ki.attr("disabled", "disabled"), di.attr("disabled", "disabled")) : (vt.getControl().attr("disabled", "disabled"), l.attr("disabled", "disabled"), et.attr("disabled", "disabled"), ci.removeAttr("disabled"), li.removeAttr("disabled"), fi.getControl().removeAttr("disabled"), b.removeAttr("disabled"), v.removeAttr("disabled"), y.removeAttr("disabled"), p.removeAttr("disabled"), k.removeAttr("disabled"), d.removeAttr("disabled"), ot.removeAttr("disabled"), it.removeAttr("disabled"), rt.removeAttr("disabled"), ut.removeAttr("disabled"), st.removeAttr("disabled"), ht.removeAttr("disabled"), wi.removeAttr("disabled"), bi.removeAttr("disabled"), ki.removeAttr("disabled"), di.removeAttr("disabled")) } function ef() { var n = vt.getControl().find("option:selected").val(); n != null && jQuery.grep(s.tableInfo, function (t) { return t.Name == n })[0] != null && (s.VAF_TableView_ID = jQuery.grep(s.tableInfo, function (t) { return t.Name == n })[0].Key); l.find("span").text(""); l.attr("Name", n + "_ID"); et.attr("Name", n + "_ID") } function ri(t) { var r, o, f; s.HasOrgUnit == null && te(); var u = t.attr("name"), e = "IsSummary='N'", i = u; u.equals("Account_ID") ? (i = "VAB_Acct_Element_ID", r = s.getAcctSchemaElement("AC"), r != null && (e += " AND VAB_Element_ID=" + r.VAB_Element_id)) : u.equals("User1_ID") ? (i = "VAB_Acct_Element_ID", r = s.getAcctSchemaElement("U1"), r != null && (e += " AND VAB_Element_ID=" + r.VAB_Element_id)) : u.equals("User2_ID") ? (i = "VAB_Acct_Element_ID", r = s.getAcctSchemaElement("U2"), r != null && (e += " AND VAB_Element_ID=" + r.VAB_Element_id)) : ft.find("input").prop("checked") && (e = ""); o = i.substring(0, i.length - 3); u == "VAM_Product_ID" ? f = new n.InfoWindow(101, "", s.windowNo, "", !1) : u == "VAB_BusinessPartner_ID" ? f = new n.InfoWindow(100, "", s.windowNo, "", !1) : u == hr ? (i = sr, o = i.substring(0, i.length - 3), s.HasOrgUnit && (e += " AND (IsCostCenter='Y' OR IsProfitCenter='Y')"), f = new n.infoGeneral(!0, s.windowNo, "", o, i, !1, e)) : f = new n.infoGeneral(!0, s.windowNo, "", o, i, !1, e); f.onClose = function () { var r = null, n = f.getSelectedValues(); return (n != null && n.length > 0 && (r = i + "=" + n.toString()), f = null, r == null || r.length == 0 || n.length == 0) ? (ct(t), 0) : (t == l ? s.Record_ID = n : (ct(t), s.whereInfo.push({ Key: u, Value: u + "=" + n })), t.find("span").text(s.getButtonText(o, i, r)), t.find("span").text() != "" ? t.AutoSize = !0 : t.Width = 44, n) }; f.show() } function gf() { if (n.ADialog.ask("PostImmediate?")) { if (s.documentQuery && s.VAF_TableView_ID != 0 && s.Record_ID != 0) { var i = nt.prop("checked"); ne(function (r) { var u = !1, f, e; r == "Yes" && (u = !0); window.FRPT && u ? (f = Number(n.context.getWindowTabContext(h, 0, "VAF_Org_ID")), e = Number(n.context.getWindowTabContext(h, 0, "VAB_DocTypes_ID")), t.ajax({ url: n.Application.contextUrl + "FRPT/PostingLogicFRPT/PostImediateFRPT", dataType: "json", async: !0, data: { VAF_Client_ID: s.VAF_Client_ID, VAF_TableView_ID: s.VAF_TableView_ID, Record_ID: s.Record_ID, force: i, OrgID: f, VAF_Screen_ID: sf, DocTypeID: e }, error: function () { tt(!1); n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer")) }, success: function (n) { n.result && fr() } })) : t.ajax({ url: n.Application.contextUrl + "Posting/PostImmediate", dataType: "json", data: { VAF_Client_ID: s.VAF_Client_ID, VAF_TableView_ID: s.VAF_TableView_ID, Record_ID: s.Record_ID, force: i }, error: function () { tt(!1); n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer")) }, success: function (n) { n.result == "OK" && fr() } }) }) } return !0 } return tt(!1), !1 } function ne(i) { t.ajax({ url: n.Application.contextUrl + "Posting/PostByNewLogic", dataType: "json", async: !0, data: { VAF_Client_ID: n.context.getVAF_Client_ID() }, error: function () { alert(n.Msg.getMsg("ERRORGettingPostingServer")) }, success: function (n) { i && i(n.result) } }) } function te() { t.ajax({ url: n.Application.contextUrl + "AcctViewerData/HasOrganizationUnit", dataType: "json", async: !1, error: function () { alert(n.Msg.getMsg("ERROR")) }, success: function (n) { n != null && (s.HasOrgUnit = n.result) } }) } function vi(t, i) { for (var r = 0; r < i.length; r++)t.append(" <option selected value='" + i[r].Key + "' >" + n.Utility.decodeText(i[r].Name) + "<\/option>"); t.prop("selectedIndex", 0) } var wt = t("<div style='position:relative;'>"), er = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), c = this, of = r, su = u, hu = f, h = e, sf = o; this.arrListColumns = []; this.dGrid = null; this.menuForm = !1; var cu = !1, or = "VAB_AccountBook_ID", hf = "DocumentType", lu = "PostingType", sr = "VAF_Org_ID", hr = "VAF_OrgTrx_ID", yi = "Account_ID", au = "SelectDocument", vu = "AcctDateFrom", cr = "VAM_Product_ID", lr = "VAB_BusinessPartner_ID", yu = "VAB_Project_ID", ar = "VAB_Promotion_ID", ui = n.Application.contextUrl + "Areas/VIS/Images/base/Find24.gif", ie = n.Application.contextUrl + "Areas/VIS/Images/cancel-18.png", cf = n.Application.contextUrl + "Areas/VIS/Images/base/Refresh24.png", lf = n.Application.contextUrl + "Areas/VIS/Images/base/Print24.PNG", lt = t("<button id='btnRefresh_" + h + "'style='margin-top: 0;' class='VIS_Pref_btn-2'><i class='vis vis-refresh'><\/i><\/button>"), si = t("<button class='VIS_Pref_btn-2' id='btnPrint_" + h + "' style='margin-top: 0px; margin-left: 10px;'><i class='vis vis-print'><\/button>"), a = t("<button class='VIS_Pref_btn-2' id='btnRePost_" + h + "' style='margin-top: 0px;'><img src='" + ui + "'/><\/button>"), l = t("<button class='input-group-text' Name='btnSelctDoc' id='btnSelctDoc_" + h + "'><i class='vis vis-find'><\/i><\/button>"), b = t("<button class='input-group-text' Name='btnAccount' id='btnAccount_" + h + "'><i class='vis vis-find'><\/i><\/button>"), v = t("<button class='input-group-text' Name='btnProduct' id='btnProduct_" + h + "'><i class='vis vis-find'><\/i><\/button>"), y = t("<button class='input-group-text' Name='btnBPartner' id='btnBPartner_" + h + "'><i class='vis vis-find'><\/i><\/button>"), p = t("<button class='input-group-text'Name='btnProject' id='btnProject_" + h + "'><i class='vis vis-find'><\/i><\/button>"), k = t("<button class='input-group-text' Name='btnCampaning' id='btnCampaning_" + h + "'><i class='vis vis-find'><\/i><\/button>"), d = t("<button class='input-group-text' Name='btnOrgUnit' id='btnOrgUnit_" + h + "'><i class='vis vis-find'><\/i><\/button>"), et = t("<button Name='btnSelctDocClear' id='btnSelctDocClear_" + h + "' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), ot = t("<button  Name='btnAccountClear' id='btnAccountClear_" + h + "'   class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), it = t("<button  Name='btnProductClear' id='btnProductClear_" + h + "'   class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), rt = t("<button Name='btnBPartnerClear' id='btnBPartnerClear_" + h + "' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), ut = t("<button  Name='btnProjectClear' id='btnProjectClear_" + h + "'   class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), st = t("<button Name='btnCampaningClear' id='btnCampaningClear_" + h + "' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), ht = t("<button Name='btnOrgUnitClear' id='btnOrgUnitClear_" + h + "' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), at = new n.Controls.VComboBox("", !1, !1, !0), g = new n.Controls.VComboBox("", !1, !1, !0), pi = new n.Controls.VComboBox("", !1, !1, !0), fi = new n.Controls.VComboBox("", !1, !1, !0), vt = new n.Controls.VComboBox("", !1, !1, !0), bt = new n.Controls.VComboBox("", !1, !1, !0), kt = new n.Controls.VComboBox("", !1, !1, !0), dt = new n.Controls.VComboBox("", !1, !1, !0), gt = new n.Controls.VComboBox("", !1, !1, !0), vr = new n.Controls.VLabel, hi = new n.Controls.VLabel, yr = new n.Controls.VLabel, pr = new n.Controls.VLabel, wr = new n.Controls.VLabel, br = new n.Controls.VLabel, kr = new n.Controls.VLabel, dr = new n.Controls.VLabel, gr = new n.Controls.VLabel, nu = new n.Controls.VLabel, pu = new n.Controls.VLabel, tu = new n.Controls.VLabel, iu = new n.Controls.VLabel, wu = new n.Controls.VLabel, bu = new n.Controls.VLabel, ku = new n.Controls.VLabel, du = new n.Controls.VLabel, gu = new n.Controls.VLabel, wi = t("<button id='btnSel5_" + h + "' style='border: 0px;background-color: transparent; padding: 0px;'><img src='" + ui + "' /><span><\/span><\/button>"), bi = t("<button id='btnSel6_" + h + "' style='border: 0px;background-color: transparent; padding: 0px;'><img src='" + ui + "' /><span><\/span><\/button>"), ki = t("<button id='btnSel7_" + h + "' style='border: 0px;background-color: transparent; padding: 0px;'><img src='" + ui + "' /><span><\/span><\/button>"), di = t("<button id='btnSel8_" + h + "' style='border: 0px;background-color: transparent; padding: 0px;'><img src='" + ui + "' /><span><\/span><\/button>"), ni = new n.Controls.VLabel, nf = new n.Controls.VLabel, tf = new n.Controls.VLabel, ei = null, oi = null, ft = t("<label id='lblSelectDoc_" + h + "' class='VIS_Pref_Label_Font vis-ec-col-lblchkbox'><input id='chkSelectDoc_" + h + "' type='checkbox' checked class='VIS_Pref_automatic'>SelectDoc<\/label>"), gi = t("<input id='chkQty_" + h + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblQty_" + h + "' class='VIS_Pref_Label_Font'>chkQty<\/label><\/span>"), nt = t("<input id='chkforcePost_" + h + "' type='checkbox' class='VIS_Pref_automatic' style='display: inline-block;margin-left: 20px; margin-top: 0;'><span><label id='lblforcePost_" + h + "' class='VIS_Pref_Label_Font'>chkforcePost<\/label><\/span>"), nr = t("<input id='chkDisDocinfo_" + h + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblDisDocinfo_" + h + "' class='VIS_Pref_Label_Font'>chkDisDocinfo<\/label><\/span>"), tr = t("<input id='chkDisSouce_" + h + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblDisSouce_" + h + "' class='VIS_Pref_Label_Font'>chkDisSouce<\/label><\/span>"), ru = t("<input id='chkSumriz1_" + h + "' type='checkbox' class='VIS_Pref_automatic'>"), uu = t("<input id='chkSumriz2_" + h + "' type='checkbox' class='VIS_Pref_automatic'>"), fu = t("<input id='chkSumriz3_" + h + "' type='checkbox' class='VIS_Pref_automatic'>"), eu = t("<input id='chkSumriz4_" + h + "' type='checkbox' class='VIS_Pref_automatic'>"), ci = t("<input id='vdtpkAccDateFrom_" + h + "' type='date' name='DateOrdered'>"), li = t("<input id='vdtpkAccDateTo_" + h + "' type='date' name='DateOrdered'>"), ir = null, w = null, yt = null, ti = null, pt = null, ii = null, af = t(window).width() / 2, vf = t(window).width() / 2, rr = t(window).height() - 200, s = null; this.showDialog = function () { kf(); tt(!0); ei = wt.find("#lblquery_" + h); oi = wt.find("#lblresult_" + h); c.getIsMenu() ? ou() : ur(); a.hide(); nt.hide(); si.hide(); yf(); wf(); df(su, hu); wt.dialog({ modal: !0, resizable: !1, title: n.Msg.getMsg("AcctViewer"), width: t(window).width() / 2 + t(window).width() / 4, position: { at: "center top", of: window }, close: function () { c.dGrid != null && (c.dGrid.destroy(), c.dGrid = null); c.dispose(); c = null; wt.dialog("destroy"); wt = null } }) }; this.disposeComponent = function () { lt && lt.off("click"); si && si.off("click"); a && a.off("click"); l && l.off("click"); b && b.off("click"); v && v.off("click"); y && y.off("click"); p && p.off("click"); k && k.off("click"); et && et.off("click"); ot && ot.off("click"); it && it.off("click"); rt && rt.off("click"); ut && ut.off("click"); st && st.off("click"); ht && ht.off("click"); d && d.off("click"); of = null; su = null; hu = null; h = null; this.arrListColumns = null; this.dGrid = null; or = null; hf = null; lu = null; sr = null; yi = null; au = null; vu = null; ui = null; cf = null; lf = null; lt = null; si = null; a = null; l = null; b = null; v = null; y = null; p = null; k = null; et = null; ot = null; it = null; rt = null; ut = null; st = null; at = null; g = null; pi = null; fi = null; vt = null; bt = null; kt = null; dt = null; gt = null; vr = null; hi = null; yr = null; pr = null; wr = null; br = null; kr = null; dr = null; gr = null; nu = null; pu = null; tu = null; iu = null; wu = null; bu = null; ku = null; du = null; wi = null; bi = null; ki = null; di = null; ni = null; nf = null; tf = null; ei = null; oi = null; ft = null; gi = null; nt = null; nr = null; tr = null; ru = null; uu = null; fu = null; eu = null; ci = null; li = null; ir = null; w = null; yt = null; ti = null; pt = null; ii = null; af = null; vf = null; rr = null; s = null; er = null; this.disposeComponent = null } } i.prototype.getAcctSchema = function () { return this.ASchemas }; i.prototype.getTable = function () { var i = [], r = null, u = this; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerGetTabelData", type: "POST", async: !1, success: function (t) { var o, f; if ((this.tableInfo == undefined || this.tableInfo == null) && (this.tableInfo = []), t.result) for (i.push({ Key: "", Name: "" }), o = t.result, f = 0; f < o.length; f++) { var s = o[f].VAF_TableView_ID, e = n.Utility.encodeText(o[f].TableName), h = ""; h = e == "VAB_Order" ? n.Msg.getMsg("Order") : n.Msg.translate(n.Env.getCtx(), e + "_ID"); i.push({ Key: e, Name: h }); u.tableInfo.push({ Key: s, Name: e }); s == this.VAF_TableView_ID && (r = e) } }, error: function (n) { $selfObj.log.info(n) } }), i }; i.prototype.getOrg = function () { var i = [], r = this.VAF_Client_ID; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerGetOrgData", type: "POST", async: !1, data: { client_id: r }, success: function (t) { var u = t.result, r; if (u) for (i.push({ Key: 0, Name: "" }), r = 0; r < u.length; r++)i.push({ Key: u[r].VAF_Org_ID, Name: n.Utility.encodeText(u[r].OrgName) }) }, error: function (n) { $selfObj.log.info(n) } }), i }; i.prototype.getPostingType = function () { var i = []; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerGetPostingType", type: "POST", async: !1, data: { reference_id: 125 }, success: function (t) { var u = t.result, r; if (u) for (i.push({ Key: 0, Name: "" }), r = 0; r < u.length; r++)i.push({ Key: u[r].PostingValue, Name: n.Utility.encodeText(u[r].PostingName) }) }, error: function (n) { $selfObj.log.info(n) } }), i }; i.prototype.getAcctSchemaElements = function (i) { this._elements = []; var r = this._elements; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerGetAcctSchElements", type: "POST", async: !0, data: { keys: i }, success: function (t) { var u = t.result, i, f; if (u) for (i = 0; i < u.length; i++)f = [], f.push({ VAB_AccountBook_element_id: u[i].VAB_AccountBook_Element_ID, name: n.Utility.encodeText(u[i].ElementName), elementtype: u[i].ElementType, VAB_Acct_Element_id: u[i].VAB_Acct_Element_ID, seqno: u[i].SeqNo, detail: u[i].Detail, VAB_Element_id: u[i].VAB_Element_ID }), r.push(f) }, error: function (n) { $selfObj.log.info(n) } }), r }; i.prototype.getAcctSchemaElement = function (n) { var t, i; for (this._elements == null && this.getAcctSchemaElements(), t = 0; t < this._elements.length; t++)if (i = this._elements[t][0], i.elementtype.equals(n)) return i; return null }; i.prototype.getColumnName = function (n) { return n.equals(this.ELEMENTTYPE_Organization) ? "VAF_Org_ID" : n.equals(this.ELEMENTTYPE_Account) ? "Account_ID" : n.equals(this.ELEMENTTYPE_BPartner) ? "VAB_BusinessPartner_ID" : n.equals(this.ELEMENTTYPE_Product) ? "VAM_Product_ID" : n.equals(this.ELEMENTTYPE_Activity) ? "VAB_BillingCode_ID" : n.equals(this.ELEMENTTYPE_LocationFrom) ? "VAB_LocFrom_ID" : n.equals(this.ELEMENTTYPE_LocationTo) ? "VAB_LocTo_ID" : n.equals(this.ELEMENTTYPE_Campaign) ? "VAB_Promotion_ID" : n.equals(this.ELEMENTTYPE_OrgTrx) ? "VAF_OrgTrx_ID" : n.equals(this.ELEMENTTYPE_Project) ? "VAB_Project_ID" : n.equals(this.ELEMENTTYPE_SalesRegion) ? "VAB_SalesRegionState_ID" : n.equals(this.ELEMENTTYPE_UserList1) ? "User1_ID" : n.equals(this.ELEMENTTYPE_UserList2) ? "User2_ID" : n.equals(this.ELEMENTTYPE_UserElement1) ? "UserElement1_ID" : n.equals(this.ELEMENTTYPE_UserElement2) ? "UserElement2_ID" : "" }; i.prototype.getButtonText = function (i, r, u) { var e = n.Env.getVAF_Language(n.Env.getCtx()), o = n.MLookupFactory.getLookup_TableDirEmbed(e, r, "avd", r), f = "<" + u + ">"; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerGetButtonText", type: "POST", async: !1, data: { lookupDirEmbeded: o, tName: i, wheres: " avd WHERE avd.", selectSQLs: u }, success: function (n) { var t = n.result; t != "" && (f = t) }, error: function (n) { $selfObj.log.info(n) } }), f }; i.prototype.Query = function (t, i) { var r = "", f, e, o, u; if (this.VAB_AccountBook_ID != 0 && (r = r.concat(this.TABLE_ALIAS).concat(".VAB_AccountBook_ID=").concat(this.VAB_AccountBook_ID)), this.PostingType != null && this.PostingType.length > 0 && (r.length > 0 && (r = r.concat(" AND ")), r = r.concat(this.TABLE_ALIAS).concat(".PostingType='").concat(this.PostingType).concat("'")), this.documentQuery) r.length > 0 && (r = r.concat(" AND ")), r = r.concat(this.TABLE_ALIAS).concat(".VAF_TableView_ID=").concat(this.VAF_TableView_ID).concat(" AND ").concat(this.TABLE_ALIAS).concat(".Record_ID=").concat(this.Record_ID); else { if (f = this.whereInfo, f != null) for (e = 0; e < f.length; e++)o = f[e].Value, o != null && o.length > 0 && (r.length > 0 && (r = r.concat(" AND ")), r = r.concat(this.TABLE_ALIAS).concat(".").concat(o)); (!this.DateFrom != null || this.DateTo != null) && (r.length > 0 && (this.DateFrom != "" || this.DateTo != "") && (r = r.concat(" AND ")), this.DateFrom != "" && this.DateTo != "" ? r = r.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') BETWEEN ").concat(n.DB.to_date(this.DateFrom)).concat(" AND ").concat(n.DB.to_date(this.DateTo)) : this.DateFrom != "" ? r = r.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') >= ").concat(n.DB.to_date(this.DateFrom)) : this.DateTo != "" && (r = r.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') <= ").concat(n.DB.to_date(this.DateTo)))); this.VAF_Org_ID != 0 && (r.length > 0 && (r = r.concat(" AND ")), r = r.concat(this.TABLE_ALIAS).concat(".VAF_Org_ID=").concat(this.VAF_Org_ID)) } u = ""; this.sortBy1.length > 0 && (u = u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy1)); this.sortBy2.length > 0 && (u.length > 0 && (u = u.concat(",")), u = u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy2)); this.sortBy3.length > 0 && (u.length > 0 && (u = u.concat(",")), u = u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy3)); this.sortBy4.length > 0 && (u.length > 0 && (u = u.concat(",")), u = u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy4)); u.length == 0 && (u = u.concat(this.TABLE_ALIAS).concat(".Actual_Acct_Detail_ID")); this.getDataModel(t, r, u, this.group1, this.group2, this.group3, this.group4, this.sortBy1, this.sortBy2, this.sortBy3, this.sortBy4, this.displayDocumentInfo, this.displaySourceAmt, this.displayQty, i) }; i.prototype.getDataModel = function (i, r, u, f, e, o, s, h, c, l, a, v, y, p, w) { var b = this; t.ajax({ url: n.Application.contextUrl + "Common/GetDataQuery", async: !0, dataType: "json", type: "POST", data: { VAF_Client_ID: i, whereClause: r, orderClause: u, gr1: f, gr2: e, gr3: o, gr4: s, sort1: h, sort2: c, sort3: l, sort4: a, displayDocInfo: v, displaySrcAmt: y, displayqty: p }, success: function (n) { b.dataByData = n.result; w(n.result) } }) }; r.prototype.dispose = function () { this.disposeComponent() }; r.prototype.setIsMenu = function (n) { n != null && n != undefined && (this.menuForm = n) }; r.prototype.getIsMenu = function () { return this.menuForm }; n.AcctViewer = r }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { n.AcctViewerMenu = function () { function e() { r.on("click", function () { i.frame.dispose() }) } this.frame; this.windowNo; var f, i = this, r = "", u = t("<div>"); this.initalize = function () { u.append('<a id="VIS_btnResult_' + i.windowNo + '">button<\/a>'); r = u.find("#VIS_btnResult_" + i.windowNo); e() }; this.openAccountViewer = function () { var t = new n.AcctViewer(n.context.getVAF_Client_ID(), 1, 1, this.windowNo, 1); t != null && (t.setIsMenu(!0), t.showDialog()); r.trigger("click") }; this.getRoot = function () { return u } }; n.AcctViewerMenu.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.initalize(); this.openAccountViewer(); this.frame.getContentGrid().append(this.getRoot()) }; n.AcctViewerMenu.prototype.dispose = function () { this.disposeComponent(); this.frame = null } }(VIS, jQuery), function (n, t) { function i() { function g() { var rt = "topDiv_" + i.windowNo, p = "btnSpaceDiv_" + i.windowNo, ut = "btnSpace_" + i.windowNo, ft = "spnSelect_" + i.windowNo, et = "spnGenerate_" + i.windowNo, w = "lblGenerate_" + i.windowNo, b = "lblSelect_" + i.windowNo, k, d, u, f, g, nt, tt, a, it, v, y; o = t('<div class="input-group-append"><button id = "btnClearBP_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" tabindex="-1" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button><\/div>'); s = t('<div class="input-group-append"><button id = "btnClearOrd_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" tabindex="-1" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button><\/div>'); i.topDiv = t("<div id='" + rt + "' class='vis-archive-l-s-head vis-frm-ls-top' style='padding: 0;'><div id='" + p + "' class='vis-l-s-headwrp'><button id='" + ut + "'  class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><div id='" + ft + "'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='" + b + "' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 28px;color: rgba(var(--v-c-primary), 1);'>" + n.Msg.translate(n.Env.getCtx(), "Select") + "<\/label><\/div><div id='" + et + "' style='display: inline-block; width: 160px;'><label id='" + w + "' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 17px;'>" + n.Msg.translate(n.Env.getCtx(), "Generate") + "<\/label><\/div><\/div>"); k = "sideDiv_" + i.windowNo; d = "parameterDiv_" + i.windowNo; i.btnSpaceDiv = i.topDiv.find("#" + p); this.lblGenrate = i.topDiv.find("#" + w); this.lblSelect = i.topDiv.find("#" + b); i.sideDiv = t("<div id='" + k + "' class='vis-archive-l-s-content vis-leftsidebarouterwrap'>"); i.sideDiv.css("width", r); i.sideDiv.css("height", "calc(100% - 103px)"); i.div = t("<div class='vis-archive-l-s-content-inner' id='" + d + "'>"); i.sideDiv.append(i.div); var l = t("<table style='width: 100%;'>"), e = t("<tr>"), h = t("<td style='padding: 10px 10px 0px;'>"); i.div.append(l); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); l.append(e); e.append(h); h.append(u); u.append(f); f.append(i.cmbWarehouse.getControl()); f.append(i.lblWarehouse.getControl().addClass("VIS_Pref_Label_Font")); e = t("<tr>"); h = t("<td style='padding: 0px 10px 0px;'>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), c = t('<div class="input-group-append">'); l.append(e); e.append(h); h.append(u); u.append(f); f.append(i.vSearchBPartner.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); f.append(i.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")); u.append(c); c.append(i.vSearchBPartner.getBtn(0)); u.append(o); g = n.Msg.translate(n.Env.getCtx(), "SalesOrder_No"); e = t("<tr>"); h = t("<td style='padding: 0px 10px 0px;'>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), c = t('<div class="input-group-append">'); l.append(e); e.append(h); h.append(u); u.append(f); f.append(i.vSearchOrder.getControl(0).attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); f.append("<label>" + g + "<\/label>"); u.append(c); c.append(i.vSearchOrder.getBtn(0)); u.append(s); nt = "gridSelectDiv_" + i.windowNo; tt = "gridGenerateDiv_" + i.windowNo; i.gridSelectDiv = t("<div id='" + nt + "' class='vis-frm-grid-outerwrp'>"); i.gridGenerateDiv = t("<div id='" + tt + "' style='height: 85%; float: right; display: none; background-color: rgba(var(--v-c-secondary), .8); margin-left: 15px;margin-right: 15px;'>"); i.gridGenerateDiv.css("width", t(window).width() - 30); a = "btnOk_" + i.windowNo; i.okBtn = t("<input id='" + a + "' class='VIS_Pref_btn-2' style='margin-top: 0px;width: 70px;height: 38px;' type='button' value='Ok'>"); a = "btnRefresh_" + i.windowNo; i.btnRefresh = t("<button id='" + a + "' style='margin-top: 0px;' class='VIS_Pref_btn-2'><i class='vis vis-refresh'><\/i><\/button>"); it = "discriptionDiv_" + i.windowNo; i.bottumDiv = t("<div class='vis-info-btmcnt-wrap vis-p-t-10'>"); v = t("<div id='" + it + "' style='flex: 1;padding: 0 10px;'>"); v.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font")); y = t("<div>"); y.append(i.okBtn); i.bottumDiv.append(i.btnRefresh).append(v).append(y); i.$root.append(i.$busyDiv); i.$busyDiv[0].style.visibility = "hidden"; i.$root.append(i.topDiv).append(i.sideDiv).append(i.gridSelectDiv).append(i.gridGenerateDiv).append(i.bottumDiv) } function nt() { i.lblWarehouse.getControl().text(n.Msg.translate(n.Env.getCtx(), "VAM_Warehouse_ID")); i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID")); i.tabSelect.getControl().text(n.Msg.getMsg("Select", !1, !1)); i.tabGenrate.getControl().text(n.Msg.getMsg("Generate", !1, !1)); i.lblStatusInfo.getControl().text(n.Msg.getMsg("VIS_OrderGenShip", !1, !1)) } function tt() { var u = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 2223, n.DisplayType.TableDir, "VAM_Warehouse_ID", 0, !1, "VAM_Warehouse.IsActive='Y'"), t, r; i.cmbWarehouse = new n.Controls.VComboBox("VAM_Warehouse_ID", !0, !1, !0, u, 150, n.DisplayType.TableDir, 0); t = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 2762, n.DisplayType.Search, "VAB_BusinessPartner_ID", 0, !1, "VAB_BusinessPartner.IsActive ='Y' And VAB_BusinessPartner.Issummary ='N'"); i.vSearchBPartner = new n.Controls.VTextBoxButton("VAB_BusinessPartner_ID", !0, !1, !0, n.DisplayType.Search, t); r = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 2161, n.DisplayType.Search, "VAB_Order_ID", 0, !1, "DocStatus='CO'"); i.vSearchOrder = new n.Controls.VTextBoxButton("VAB_Order_ID", !0, !1, !0, n.DisplayType.Search, r) } function p(r) { i.dGrid != null && (i.dGrid.destroy(), i.dGrid = null); i.arrListColumns.length == 0 && (i.arrListColumns.push({ field: "VAF_Org_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAF_Org_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "VAB_DocTypes_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAB_DocTypes_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "DocumentNo", caption: n.Msg.getElement(n.Env.getCtx(), "DocumentNo"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "VAB_BusinessPartner_ID", caption: n.Msg.getElement(n.Env.getCtx(), "VAB_BusinessPartner_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "DateOrdered", caption: n.Msg.getElement(n.Env.getCtx(), "DateOrdered"), sortable: !0, size: "16%", min: 150, hidden: !1, render: function (n) { var t; return t = n.changes == undefined || n.changes.DateOrdered == undefined ? n.DateOrdered : n.changes.DateOrdered, new Date(t).toLocaleDateString() } }), i.arrListColumns.push({ field: "VAB_Order_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAB_UOM_ID"), sortable: !0, size: "150px", hidden: !0 })); setTimeout(10); w2utils.encodeTags(r); i.dGrid = t(i.gridSelectDiv).w2grid({ name: "gridGenShipForm" + i.windowNo, recordHeight: 40, show: { selectColumn: !0 }, multiSelect: !0, columns: i.arrListColumns, records: r }) } function y() { var r = [], s = n.Env.getCtx().getVAF_Client_ID(), u = "", f = "", o = ""; e != null && e.toString() != "-1" && (u = " AND ic.VAM_Warehouse_ID=" + e); l != null && (f = " AND ic.VAB_BusinessPartner_ID=" + l); v != null && (o = " AND VAB_Order_ID=" + v); t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "VCreateFrom/ExecuteQueryVinoutgen", type: "POST", data: { adClientID: s, mWarehouseIDs: u, cBPartnerIDs: f, cOrderIDSearchs: o }, success: function (u) { var f = JSON.parse(u), s, e, o; if (f && f.length > 0) try { for (s = 1, e = 0; e < f.length; e++)o = {}, o.VAB_Order_ID = f[e].VAB_Order_id, o.VAF_Org_ID = f[e].ord, o.VAB_DocTypes_ID = f[e].doctype, o.DocumentNo = n.Utility.encodeText(f[e].documentno), o.VAB_BusinessPartner_ID = f[e].bpname, o.DateOrdered = f[e].dateordered, o.recid = s, s++, r.push(o) } catch (h) { } else n.ADialog.info("NoDataFound"), i.okBtn.attr("disabled", "disabled"); p(r); t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "hidden" }, error: function () { t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "hidden" } }) } function it() { var r, u, f, e, t, n; if (i.dGrid == null) return !1; if ((r = [], u = i.dGrid.getSelection(), u != null) && !(u.length <= 0)) { for (f = u.toString().split(","), n = 0; n < f.length; n++)r[n] = i.dGrid.get(f[n]).VAB_Order_ID; if (r.length == 0) return ""; for (e = "VAB_Order_ID", t = e, t = r.length > 1 ? t.concat(" IN (") : t.concat("="), n = 0; n < r.length; n++)n > 0 && (t = t.concat(",")), t = e.endsWith("_ID") ? t.concat(r[n].toString()) : t.concat("'").concat(r[n].toString()); return r.length > 1 && (t = t.concat(")")), t.toString() } } function rt(r) { var u = i; i.$busyDiv[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Common/GenerateShipments", dataType: "json", data: { whereClause: r, VAM_Warehouse_ID: e }, success: function (r) { r.DocumentText != null && (ut(!0), u.gridGenerateDiv.html(r.DocumentText), u.lblStatusInfo.getControl().text(r.lblStatusInfo)); r.ErrorMsg != null && n.ADialog.info("", null, r.ErrorMsg, null); u.$busyDiv[0].style.visibility = "hidden"; t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv") }, error: function () { u.$busyDiv[0].style.visibility = "hidden"; t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv") } }) } function ut(n) { n && (i.btnRefresh.hide(), i.okBtn.hide(), i.btnToggel.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), n = !1, i.gridSelectDiv.animate({ width: f }, "fast"), i.sideDiv.animate({ width: "toggle", height: "toggle" }, "slow")); i.gridSelectDiv.css("display", "none"); i.sideDiv.css("display", "none"); i.gridGenerateDiv.css("display", "block"); i.btnToggel.hide(); lblSelect.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary), 1)"); lblGenrate.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)") } var i; this.frame; this.windowNo; i = this; this.arrListColumns = []; this.dGrid = null; var c = null, e = null, l = null, w = !1, b = !1, u = !1, v = null; this.lblWarehouse = new n.Controls.VLabel; this.lblBPartner = new n.Controls.VLabel; this.lblStatusInfo = new n.Controls.VLabel; this.tabSelect = new n.Controls.VLabel; this.tabGenrate = new n.Controls.VLabel; this.cmbWarehouse = new n.Controls.VComboBox("", !1, !1, !0); this.vSearchBPartner = null; this.vSearchOrder = null; this.$root = t("<div style='width: 100%; height: 100%; background-color: white;'>"); this.$busyDiv = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); this.topDiv = null; this.sideDiv = null; this.gridSelectDiv = null; this.gridGenerateDiv = null; this.bottumDiv = null; this.div = null; this.okBtn = null; this.cancelBtn = null; this.btnRefresh = null; this.btnToggel = null; this.spnSelect = null; this.spnGenerate = null; this.btnSpaceDiv = null; this.lblGenrate = null; this.lblSelect = null; var o = null, s = null, r = 260, h = 50, f = t(window).width() - (r + 20), a = t(window).width() - (20 + h), k = f + r + 5, d = t(window).height() - 210; this.vetoablechange = function () { l = i.vSearchBPartner.getValue(); v = i.vSearchOrder.getValue(); i.okBtn.removeAttr("disabled"); y() }; this.sizeChanged = function (n, t) { f = t - (r + 20); a = t - (20 + h); u == !0 ? (i.btnSpaceDiv.animate({ width: h }, "slow"), i.sideDiv.animate({ width: h }, "slow"), i.div.css("display", "none"), i.gridSelectDiv.animate({ width: a }, "slow", null, function () { i.dGrid.resize() })) : (i.btnSpaceDiv.animate({ width: r }, "slow"), i.gridSelectDiv.animate({ width: f }, "slow"), i.div.css("display", "block"), i.sideDiv.animate({ width: r }, "slow", null, function () { i.dGrid.resize() })) }; this.Initialize = function () { if (tt(), nt(), g(), this.btnToggel = this.$root.find("#btnSpace_" + i.windowNo), this.spnSelect = this.$root.find("#spnSelect_" + i.windowNo), this.spnGenerate = this.$root.find("#spnGenerate_" + i.windowNo), this.okBtn != null) this.okBtn.on(n.Events.onTouchStartOrClick, function () { var r = i; if (i.cmbWarehouse.getControl().find("option:selected").val() == undefined) { n.ADialog.error("SelectWarehouseFirst"); return } i.$busyDiv[0].style.visibility = "visible"; t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv"); i.okBtn.attr("disabled", "disabled"); c = it(); c != null && c.length > 0 ? rt(c) : (n.ADialog.error("PlzSelectatLeast1Inv"), i.$busyDiv[0].style.visibility = "hidden"); i.okBtn.removeAttr("disabled") }); if (this.cancelBtn != null) this.cancelBtn.on(n.Events.onTouchStartOrClick, function () { i.$root.dialog("close") }); if (this.btnRefresh != null) this.btnRefresh.on(n.Events.onTouchStartOrClick, function () { i.okBtn.removeAttr("disabled"); e = i.cmbWarehouse.getControl().find("option:selected").val(); l = i.vSearchBPartner.getValue(); y() }); if (this.btnToggel != null) this.btnToggel.on(n.Events.onTouchStartOrClick, function () { var e = 0; u ? (e = n.Application.isRTL ? 180 : 0, i.btnToggel.animate({ borderSpacing: e }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !1, i.btnSpaceDiv.animate({ width: r }, "slow"), i.gridSelectDiv.animate({ width: f }, "slow"), i.div.css("display", "block"), i.sideDiv.animate({ width: r }, "slow", null, function () { i.dGrid.resize() })) : (e = n.Application.isRTL ? 0 : 180, i.btnToggel.animate({ borderSpacing: e }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !0, i.btnSpaceDiv.animate({ width: h }, "slow"), i.sideDiv.animate({ width: h }, "slow"), i.div.css("display", "none"), i.gridSelectDiv.animate({ width: a }, "slow", null, function () { i.dGrid.resize() })) }); if (this.spnGenerate != null) this.spnGenerate.on(n.Events.onTouchStartOrClick, function () { i.btnRefresh.hide(); i.okBtn.hide(); u && (i.btnToggel.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !1, i.gridSelectDiv.animate({ width: f }, "fast"), i.sideDiv.animate({ width: r }, "fast"), i.btnSpaceDiv.animate({ width: r }, "fast")); i.gridSelectDiv.css("display", "none"); i.sideDiv.css("display", "none"); i.gridGenerateDiv.css("display", "block"); i.btnToggel.hide(); lblSelect.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary), 1)"); lblGenrate.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)") }); if (this.spnSelect != null) this.spnSelect.on(n.Events.onTouchStartOrClick, function () { u || (i.btnRefresh.show(), i.okBtn.show(), i.gridGenerateDiv.css("display", "none"), i.gridSelectDiv.css("display", "block"), i.sideDiv.css("display", "block"), i.div.css("display", "block"), i.gridSelectDiv.animate({ width: f }, "fast"), i.btnToggel.show(), lblSelect.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)"), lblGenrate.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary), 1)")) }); if (this.cmbWarehouse != null && this.cmbWarehouse.getControl().change(function () { i.okBtn.removeAttr("disabled"); e = i.cmbWarehouse.getControl().find("option:selected").val(); y() }), this.vSearchBPartner != null && this.vSearchBPartner.addVetoableChangeListener(this), this.vSearchOrder != null && this.vSearchOrder.addVetoableChangeListener(this), o != null) o.on(n.Events.onTouchStartOrClick, function () { i.vSearchBPartner.isReadOnly || i.vSearchBPartner.setValue(null, !1, !0) }); if (s != null) s.on(n.Events.onTouchStartOrClick, function () { i.vSearchOrder.isReadOnly || i.vSearchOrder.setValue(null, !1, !0) }) }; this.display = function () { p(null) }; this.getRoot = function () { return this.$root }; this.disposeComponent = function () { this.okBtn && this.okBtn.off(n.Events.onTouchStartOrClick); this.cancelBtn && this.cancelBtn.off(n.Events.onTouchStartOrClick); o && o.off(n.Events.onTouchStartOrClick); s && s.off(n.Events.onTouchStartOrClick); i = null; this.frame = null; this.windowNo = null; this.arrListColumns = null; this.dGrid = null; c = null; e = null; l = null; w = null; b = null; u = null; this.lblWarehouse = null; this.lblBPartner = null; this.lblStatusInfo = null; this.tabSelect = null; this.tabGenrate = null; this.cmbWarehouse = null; this.vSearchBPartner = null; this.$root = null; this.$busyDiv = null; this.topDiv = null; this.sideDiv = null; this.gridSelectDiv = null; this.gridGenerateDiv = null; this.bottumDiv = null; this.okBtn = null; this.cancelBtn = null; this.btnRefresh = null; this.btnToggel = null; this.spnSelect = null; this.spnGenerate = null; r = null; f = null; a = null; k = null; d = null; this.getRoot = null; this.disposeComponent = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (t, i) { this.frame = i; this.windowNo = t; n.Env.getCtx().setContext(this.windowNo, "IsSOTrx", "Y"); try { var r = this.Initialize() } catch (u) { } this.frame.getContentGrid().append(this.getRoot()); this.display(); this.cmbWarehouse.getControl().focus() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VInOutGen = i }(VIS, jQuery), function (n, t) { function i() { function g() { var it = "topDiv_" + i.windowNo, y = "btnSpaceDiv_" + i.windowNo, rt = "btnSpace_" + i.windowNo, ut = "spnSelect_" + i.windowNo, ft = "spnGenerate_" + i.windowNo, p = "lblGenerate_" + i.windowNo, w = "lblSelect_" + i.windowNo, b, k, h, f, u, d, g, nt, c, l, tt, a, v; o = t('<button id = "btnClearBP_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button>'); s = t('<button id = "btnClearOrd_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button>'); l = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; i.topDiv = t("<div id='" + it + "' class='vis-archive-l-s-head vis-frm-ls-top' style='padding: 0;'><div id='" + y + "' class='vis-l-s-headwrp'><button id='" + rt + "' class='vis-archive-sb-t-button' ><i class='vis vis-arrow-left'><\/i><\/button><\/div><div id='" + ut + "'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='" + w + "' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 28px;color: rgba(var(--v-c-primary), 1);'>" + n.Msg.translate(n.Env.getCtx(), "Select") + "<\/label><\/div><div id='" + ft + "' style='display: inline-block; width: 160px;'><label id='" + p + "' class='VIS_Pref_Label_Font' style='vertical-align: middle; font-size: 17px;'>" + n.Msg.translate(n.Env.getCtx(), "Generate") + "<\/label><\/div><\/div>"); b = "sideDiv_" + i.windowNo; k = "parameterDiv_" + i.windowNo; i.btnSpaceDiv = i.topDiv.find("#" + y); this.lblGenrate = i.topDiv.find("#" + p); this.lblSelect = i.topDiv.find("#" + w); i.sideDiv = t("<div id='" + b + "' class='vis-archive-l-s-content vis-leftsidebarouterwrap'>"); i.sideDiv.css("width", r); i.sideDiv.css("height", "calc(100% - 103px)"); i.div = t("<div class='vis-archive-l-s-content-inner' id='" + k + "'>"); i.sideDiv.append(i.div); h = t("<table style='width: 100%;'>"); i.div.append(h); tr = t("<tr>"); td = t("<td style='padding: 10px 10px 0px;'>"); f = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); h.append(tr); tr.append(td); td.append(f); f.append(u); u.append(i.cmbOrg.getControl()); u.append(i.lblOrg.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); var f = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'), e = t('<div class="input-group-append">'); h.append(tr); tr.append(td); td.append(f); f.append(u); u.append(i.vSearchBPartner.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); e.append(i.vSearchBPartner.getBtn(0)); e.append(o); u.append(i.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")); f.append(e); d = n.Msg.translate(n.Env.getCtx(), "DocumentNo"); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); var f = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'), e = t('<div class="input-group-append">'); h.append(tr); tr.append(td); td.append(f); f.append(u); u.append(i.vSearchOrderShipment.getControl(0).attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); e.append(i.vSearchOrderShipment.getBtn(0)); e.append(s); u.append("<label>" + d + "<\/label>"); f.append(e); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;font-size:12px;'>"); h.append(tr); tr.append(td); td.append("(" + n.Msg.getMsg("SalesOrderNo", !1, !1) + ")"); g = "gridSelectDiv_" + i.windowNo; nt = "gridGenerateDiv_" + i.windowNo; i.gridSelectDiv = t("<div id='" + g + "' class='vis-frm-grid-outerwrp'>"); i.gridGenerateDiv = t("<div id='" + nt + "' style='height: 85%; float: right; display: none; background-color: #F1F1F1; margin-left: 15px;;margin-right: 15px;'>"); i.gridGenerateDiv.css("width", t(window).width() - 30); c = "btnOk_" + i.windowNo; i.okBtn = t("<input id='" + c + "' class='VIS_Pref_btn-2' style='margin-top: 0px; float: right;width: 70px;height: 38px;' type='button' value='Ok'>"); c = "btnRefresh_" + i.windowNo; l = n.Application.contextUrl + "Areas/VIS/Images/base/Refresh24.png"; i.btnRefresh = t("<button id='" + c + "' style='margin-top: 0px; float: left;height: 38px; ' class='VIS_Pref_btn-2'><i class='vis vis-refresh'><\/i><\/button>"); tt = "discriptionDiv_" + i.windowNo; i.bottumDiv = t("<div class='vis-info-btmcnt-wrap vis-p-t-10'>"); a = t("<div id='" + tt + "' style='flex: 1;padding: 0 10px;'>"); a.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font")); v = t("<div>"); v.append(i.okBtn); i.bottumDiv.append(i.btnRefresh).append(a).append(v); i.$root.append(i.$busyDiv); i.$busyDiv[0].style.visibility = "hidden"; i.$root.append(i.topDiv).append(i.sideDiv).append(i.gridSelectDiv).append(i.gridGenerateDiv).append(i.bottumDiv) } function nt() { i.lblOrg.getControl().text(n.Msg.translate(n.Env.getCtx(), "VAF_Org_ID")); i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID")); i.tabSelect.getControl().text(n.Msg.getMsg("Select", !1, !1)); i.tabGenrate.getControl().text(n.Msg.getMsg("Generate", !1, !1)); i.lblStatusInfo.getControl().text(n.Msg.getMsg("VIS_OrderGenInv", !1, !1)) } function tt() { var u = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 2163, n.DisplayType.TableDir, "VAF_Org_ID", 0, !1, "VAF_Org.VAF_Org_ID <> 0  AND VAF_Org.IsSummary='N' AND VAF_Org.IsActive='Y'"), t, r; i.cmbOrg = new n.Controls.VComboBox("VAF_Org_ID", !0, !1, !0, u, 150, n.DisplayType.TableDir, 0); t = n.MLookupFactory.getMLookUp(n.Env.getCtx(), i.windowNo, 2762, n.DisplayType.Search); i.vSearchBPartner = new n.Controls.VTextBoxButton("VAB_BusinessPartner_ID", !0, !1, !0, n.DisplayType.Search, t, 0); r = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 2161, n.DisplayType.Search, "VAB_Order_ID", 0, !1, "DocStatus='CO'"); i.vSearchOrderShipment = new n.Controls.VTextBoxButton("VAB_Order_ID", !0, !1, !0, n.DisplayType.Search, r, 0) } function p(r) { i.dGrid != null && (i.dGrid.destroy(), i.dGrid = null); i.arrListColumns.length == 0 && (i.arrListColumns.push({ field: "VAF_Org_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAF_Org_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "VAB_DocTypes_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAB_DocTypes_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "DocumentNo", caption: n.Msg.getElement(n.Env.getCtx(), "DocumentNo"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "VAB_BusinessPartner_ID", caption: n.Msg.getElement(n.Env.getCtx(), "VAB_BusinessPartner_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "DateOrdered", caption: n.Msg.getElement(n.Env.getCtx(), "DateOrdered"), sortable: !0, size: "16%", min: 150, hidden: !1, render: function (n) { var t; return t = n.changes == undefined || n.changes.DateOrdered == undefined ? n.DateOrdered : n.changes.DateOrdered, new Date(t).toLocaleDateString() } }), i.arrListColumns.push({ field: "TotalLines", caption: n.Msg.getElement(n.Env.getCtx(), "TotalLines"), sortable: !0, size: "20%", min: 150, hidden: !1, align: "right", render: function (n) { var t = n.TotalLines; return parseFloat(t).toLocaleString() } }), i.arrListColumns.push({ field: "VAB_Order_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAB_UOM_ID"), sortable: !0, size: "150px", hidden: !0 })); w2utils.encodeTags(r); i.dGrid = t(i.gridSelectDiv).w2grid({ name: "gridGenForm" + i.windowNo, recordHeight: 40, show: { selectColumn: !0 }, multiSelect: !0, columns: i.arrListColumns, records: r }) } function y() { var r = [], s = n.Env.getCtx().getVAF_Client_ID(), u = "", f = "", o = ""; e != null && e.toString() != "-1" && (u = " AND ic.VAF_Org_ID=" + e); l != null && (f = " AND ic.VAB_BusinessPartner_ID=" + l); a != null && (o = " AND VAB_Order_ID=" + a); t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "VCreateFrom/ExecuteQueryVInvoiceGen", type: "POST", data: { adClientID: s, adOrgIDs: u, cBPartnerIDs: f, ordShipmentids: o }, success: function (u) { var f = JSON.parse(u), s, e, o; if (f && f.length > 0) try { for (s = 1, e = 0; e < f.length; e++)o = {}, o.VAB_Order_ID = f[e].VAB_Order_id, o.VAF_Org_ID = f[e].ord, o.VAB_DocTypes_ID = f[e].doctype, o.DocumentNo = f[e].documentno, o.VAB_BusinessPartner_ID = f[e].bpname, o.DateOrdered = f[e].dateordered, o.TotalLines = f[e].tLines, o.recid = s, s++, r.push(o) } catch (h) { } else n.ADialog.info("NoDataFound"), i.okBtn.attr("disabled", "disabled"); p(r); t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "hidden" }, error: function () { t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "hidden" } }) } function it() { var r, u, f, t, n; if (i.dGrid == null) return !1; if ((r = [], u = i.dGrid.getSelection(), u != null) && !(u.length <= 0)) { for (f = u.toString().split(","), n = 0; n < f.length; n++)r[n] = i.dGrid.get(f[n]).VAB_Order_ID; if (r.length == 0) return ""; for (t = "", n = 0; n < r.length; n++)n > 0 && (t = t.concat(",")), t = t.concat(r[n].toString()); return t.toString() } } function rt(r) { var u = i; i.$busyDiv[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Common/GenerateInvoices", dataType: "json", data: { whereClause: r }, success: function (r) { r.DocumentText != null && (ut(!0), u.gridGenerateDiv.html(r.DocumentText), u.lblStatusInfo.getControl().text(r.lblStatusInfo)); r.ErrorMsg != null && n.ADialog.info("", null, r.ErrorMsg, null); u.$busyDiv[0].style.visibility = "hidden"; t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv") }, error: function () { u.$busyDiv[0].style.visibility = "hidden"; t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv") } }) } function ut(n) { n && (i.btnRefresh.hide(), i.okBtn.hide(), i.btnToggel.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), n = !1, i.gridSelectDiv.animate({ width: f }, "fast"), i.sideDiv.animate({ width: "toggle", height: "toggle" }, "slow")); i.gridSelectDiv.css("display", "none"); i.sideDiv.css("display", "none"); i.gridGenerateDiv.css("display", "block"); i.btnToggel.hide(); lblSelect.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary),1)"); lblGenrate.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)") } var i, a; this.frame; this.windowNo; i = this; this.arrListColumns = []; this.dGrid = null; var c = null, e = null, l = null, w = !1, b = !1, u = !1; this.lblOrg = new n.Controls.VLabel; this.lblBPartner = new n.Controls.VLabel; this.lblStatusInfo = new n.Controls.VLabel; this.tabSelect = new n.Controls.VLabel; this.tabGenrate = new n.Controls.VLabel; this.cmbOrg = new n.Controls.VComboBox("", !1, !1, !0); this.vSearchBPartner = null; this.vSearchOrderShipment = null; a = null; this.$root = t("<div style='width: 100%; height: 100%; background-color: white;'>"); this.$busyDiv = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); this.topDiv = null; this.sideDiv = null; this.gridSelectDiv = null; this.gridGenerateDiv = null; this.bottumDiv = null; this.div = null; this.okBtn = null; this.cancelBtn = null; this.btnRefresh = null; this.btnToggel = null; this.spnSelect = null; this.spnGenerate = null; this.btnSpaceDiv = null; this.lblGenrate = null; this.lblSelect = null; var o = null, s = null, r = 260, h = 50, f = t(window).width() - (r + 20 + 5), v = t(window).width() - (20 + h), k = f + r + 5, d = t(window).height() - 210; this.vetoablechange = function () { l = i.vSearchBPartner.getValue(); a = i.vSearchOrderShipment.getValue(); i.okBtn.removeAttr("disabled"); y() }; this.sizeChanged = function (n, t) { f = t - (r + 20); v = t - (20 + h); u == !0 ? (i.btnSpaceDiv.animate({ width: h }, "slow"), i.sideDiv.animate({ width: h }, "slow"), i.div.css("display", "none"), i.gridSelectDiv.animate({ width: v }, "slow", null, function () { i.dGrid.resize() })) : (i.btnSpaceDiv.animate({ width: r }, "slow"), i.gridSelectDiv.animate({ width: f }, "slow"), i.div.css("display", "block"), i.sideDiv.animate({ width: r }, "slow", null, function () { i.dGrid.resize() })) }; this.Initialize = function () { if (tt(), nt(), g(), this.btnToggel = this.$root.find("#btnSpace_" + i.windowNo), this.spnSelect = this.$root.find("#spnSelect_" + i.windowNo), this.spnGenerate = this.$root.find("#spnGenerate_" + i.windowNo), this.okBtn != null) this.okBtn.on(n.Events.onTouchStartOrClick, function () { i.$busyDiv[0].style.visibility = "visible"; t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv"); i.okBtn.attr("disabled", "disabled"); c = it(); c != null && c.length > 0 ? rt(c) : (i.$busyDiv[0].style.visibility = "hidden", n.ADialog.error("PlzSelectatLeast1Inv")); i.okBtn.removeAttr("disabled") }); if (this.cancelBtn != null) this.cancelBtn.on(n.Events.onTouchStartOrClick, function () { i.$root.dialog("close") }); if (this.btnRefresh != null) this.btnRefresh.on(n.Events.onTouchStartOrClick, function () { i.okBtn.removeAttr("disabled"); e = i.cmbOrg.getControl().find("option:selected").val(); l = i.vSearchBPartner.getValue(); y() }); if (this.btnToggel != null) var a = 0; this.btnToggel.on(n.Events.onTouchStartOrClick, function () { u ? (a = n.Application.isRTL ? 180 : 0, i.btnToggel.animate({ borderSpacing: a }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !1, i.btnSpaceDiv.animate({ width: r }, "slow"), i.gridSelectDiv.animate({ width: f }, "slow"), i.div.css("display", "block"), i.sideDiv.animate({ width: r }, "slow", null, function () { i.dGrid.resize() })) : (a = n.Application.isRTL ? 0 : 180, i.btnToggel.animate({ borderSpacing: a }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !0, i.btnSpaceDiv.animate({ width: h }, "slow"), i.sideDiv.animate({ width: h }, "slow"), i.div.css("display", "none"), i.gridSelectDiv.animate({ width: v }, "slow", null, function () { i.dGrid.resize() })) }); if (this.spnGenerate != null) this.spnGenerate.on(n.Events.onTouchStartOrClick, function () { i.btnRefresh.hide(); i.okBtn.hide(); u && (i.btnToggel.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !1, i.gridSelectDiv.animate({ width: f }, "fast"), i.sideDiv.animate({ width: r }, "fast"), i.btnSpaceDiv.animate({ width: r }, "fast")); i.gridSelectDiv.css("display", "none"); i.sideDiv.css("display", "none"); i.gridGenerateDiv.css("display", "block"); i.btnToggel.hide(); lblSelect.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary),1)"); lblGenrate.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)") }); if (this.spnSelect != null) this.spnSelect.on(n.Events.onTouchStartOrClick, function () { u || (i.btnRefresh.show(), i.okBtn.show(), i.gridGenerateDiv.css("display", "none"), i.gridSelectDiv.css("display", "block"), i.sideDiv.css("display", "block"), i.div.css("display", "block"), i.gridSelectDiv.animate({ width: f }, "fast"), i.btnToggel.show(), lblSelect.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)"), lblGenrate.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary),1)")) }); if (this.cmbOrg != null && this.cmbOrg.getControl().change(function () { i.okBtn.removeAttr("disabled"); e = i.cmbOrg.getControl().find("option:selected").val(); y() }), this.vSearchBPartner != null && this.vSearchBPartner.addVetoableChangeListener(this), this.vSearchOrderShipment != null && this.vSearchOrderShipment.addVetoableChangeListener(this), o != null) o.on(n.Events.onTouchStartOrClick, function () { i.vSearchBPartner.isReadOnly || i.vSearchBPartner.setValue(null, !1, !0) }); if (s != null) s.on(n.Events.onTouchStartOrClick, function () { i.vSearchOrderShipment.isReadOnly || i.vSearchOrderShipment.setValue(null, !1, !0) }) }; this.display = function () { p(null) }; this.getRoot = function () { return this.$root }; this.disposeComponent = function () { this.okBtn && this.okBtn.off(n.Events.onTouchStartOrClick); this.cancelBtn && this.cancelBtn.off(n.Events.onTouchStartOrClick); o && o.off(n.Events.onTouchStartOrClick); s && s.off(n.Events.onTouchStartOrClick); i = null; this.frame = null; this.windowNo = null; this.arrListColumns = null; this.dGrid = null; c = null; e = null; l = null; w = null; b = null; u = null; this.lblOrg = null; this.lblBPartner = null; this.lblStatusInfo = null; this.tabSelect = null; this.tabGenrate = null; this.cmbOrg = null; this.vSearchBPartner = null; this.$root = null; this.$busyDiv = null; this.topDiv = null; this.sideDiv = null; this.gridSelectDiv = null; this.gridGenerateDiv = null; this.bottumDiv = null; this.okBtn = null; this.cancelBtn = null; this.btnRefresh = null; this.btnToggel = null; this.spnSelect = null; this.spnGenerate = null; r = null; f = null; v = null; k = null; d = null; this.getRoot = null; this.disposeComponent = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (t, i) { this.frame = i; this.windowNo = t; n.Env.getCtx().setContext(this.windowNo, "IsSOTrx", "Y"); try { var r = this.Initialize() } catch (u) { } this.frame.getContentGrid().append(this.getRoot()); this.display(); this.cmbOrg.getControl().focus() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VInvoiceGen = i }(VIS, jQuery), function (n, t) { function i() { function ci() { var tt = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png", e, f, u, r, h; d = t('<button id = "btnClearBP_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button>'); g = t('<button id = "btnClearOrd_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button>'); i.topDiv = t("<div id='topDiv_" + i.windowNo + "'  class='vis-archive-l-s-head vis-frm-ls-top' style='padding: 0;'><div id='btnSpaceDiv_" + i.windowNo + "' class='vis-l-s-headwrp'><button id='btnToggelDiv_" + i.windowNo + "' class='vis-archive-sb-t-button' ><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>"); e = t("<div class='vis-frm-contenthead'>"); e.append(i.lblInvoice.getControl().addClass("VIS_Pref_Label_Font")); e.append(chkSameBPartnerDiv); e.append(chkSameProductDiv); e.append(chkSameQtyDiv); i.topDiv.append(e); i.invoiceTopDiv = e; i.btnSpaceDiv = i.topDiv.find("#btnSpaceDiv_" + i.windowNo); i.sideDiv = t("<div id='sideDiv_" + i.windowNo + "' class='vis-archive-l-s-content vis-mi-ls-wrp vis-leftsidebarouterwrap'>"); i.sideDiv.css("width", v); i.div = t("<div class='vis-archive-l-s-content-inner' id='parameterDiv_" + i.windowNo + "'>"); i.sideDiv.append(i.div); f = t("<table style='width: 100%;height: 100%;'>"); i.div.append(f); tr = t("<tr>"); td = t("<td style='padding: 10px 10px 0px;'>"); u = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.cmbMatchFrom.getControl()); r.append(i.lblMatchFrom.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); u = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.cmbMatchTo.getControl()); r.append(i.lblMatchTo.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); u = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.cmbMatchMode.getControl()); r.append(i.lblMatchMode.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); var u = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.onlyVendor.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); r.append(i.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")); o.append(i.onlyVendor.getBtn(0)); o.append(d); u.append(o); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); var u = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.onlyProduct.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); r.append(i.lblProduct.getControl().addClass("VIS_Pref_Label_Font")); o.append(i.onlyProduct.getBtn(0)); o.append(g); u.append(o); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); u = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.dtpFrom); r.append(i.lblDateFrom.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); u = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.dtpTo); r.append(i.lblDateTo.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); f.append(tr); tr.append(td); td.append(chkIsReturnTrxDiv); i.divForGrid = t("<div id='divForGrid_" + i.windowNo + "' class='vis-mi-main-contntwrp'>"); i.gridInvoiceDiv = t("<div id='gridInvoiceDiv_" + i.windowNo + "' style='width: 100%;flex: 1; '>"); i.invoicegrd = t("<div style='float: left; width: 100%;height: 100%;'>"); i.gridInvoiceDiv.append(i.invoicegrd); i.gridReciptDiv = t("<div id='gridReciptDiv_" + i.windowNo + "' style='width: 100%;flex: 1;'>"); h = t("<div style='float: left; width: 100%; margin-top: 0px;'>"); h.append(i.lblReceipt.getControl().css("display", "inline-block").css("font-size", "24px").css("color", "rgba(var(--v-c-primary), 1)").addClass("VIS_Pref_Label_Font")); i.reciptgrd = t("<div style='float: left; width: 100%;height: 100%;'>"); i.gridReciptDiv.append(i.reciptgrd); var s = t("<div class='vis-info-btnfileds-wrap'>"), y = t("<div class='vis-info-botdatafield'>"), p = t("<div class='input-group vis-input-wrap'>"), c = t("<div class='vis-control-wrap'>"); y.append(p); p.append(c); c.append(i.txtMatched.getControl()); c.append(i.lblMatched.getControl().addClass("VIS_Pref_Label_Font")); s.append(y); var w = t("<div class='vis-info-botdatafield' style='padding-left: 15px;'>"), b = t("<div class='input-group vis-input-wrap'>"), l = t("<div class='vis-control-wrap'>"); w.append(b); b.append(l); l.append(i.txtMatchedTo.getControl()); l.append(i.lblMatchedTo.getControl().addClass("VIS_Pref_Label_Font")); s.append(w); var k = t("<div class='vis-info-botdatafield' style='padding-left: 15px;'>"), nt = t("<div class='input-group vis-input-wrap'>"), a = t("<div class='vis-control-wrap'>"); k.append(nt); nt.append(a); a.append(i.txtDifference.getControl()); a.append(i.lblDifference.getControl().addClass("VIS_Pref_Label_Font")); s.append(k); i.bottumButtonDiv = t("<div class='vis-info-btmcnt-wrap'>"); i.searchBtnWrap = t("<div class='vis-info-searchbtn-wrap'>"); i.bottumButtonDiv.append(i.searchBtnWrap); i.searchBtnWrap.append(i.btnSearch); i.bottumButtonDiv.append(s); i.bottumButtonDiv.append(i.btnProcess); i.bottumDiv = t("<div class='vis-mi-bot-div'>"); i.bottumDiv.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font")); i.bottumDiv.append(i.lblStatusCount.getControl().css("float", "right").addClass("VIS_Pref_Label_Font")); i.divForGrid.append(i.gridInvoiceDiv).append(h).append(i.gridReciptDiv); i.$root.append(i.topDiv).append(i.sideDiv).append(i.divForGrid).append(i.bottumButtonDiv).append(i.bottumDiv); i.$root.append(i.$busyDiv) } function li() { var r = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; i.dtpFrom = t("<input id='dateFrom_" + i.windowNo + "' type='date' name='DateOrdered'>"); i.dtpTo = t("<input id='dateTo_" + i.windowNo + "' type='date' name='DateOrdered'>"); this.chkIsReturnTrxDiv = t("<div>"); i.chkIsReturnTrx = t("<input id='chkIsReturnTrx_" + i.windowNo + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblIsReturnTrx_" + i.windowNo + "' class='VIS_Pref_Label_Font'>Return Transaction<\/label><\/span>"); this.chkIsReturnTrxDiv.append(i.chkIsReturnTrx); this.chkSameBPartnerDiv = t("<div class='vis-matchpoTopcheckwrap'>"); i.chkSameBPartner = t("<input id='chkSameBPartner_" + i.windowNo + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameBPartner_" + i.windowNo + "' class='VIS_Pref_Label_Font'>Same BPartner<\/label><\/span>"); this.chkSameBPartnerDiv.append(i.chkSameBPartner); this.chkSameProductDiv = t("<div class='vis-matchpoTopcheckwrap'>"); i.chkSameProduct = t("<input id='chkSameProduct_" + i.windowNo + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameProduct_" + i.windowNo + "' class='VIS_Pref_Label_Font'>Same Product<\/label><\/span>"); this.chkSameProductDiv.append(i.chkSameProduct); this.chkSameQtyDiv = t("<div class='vis-matchpoTopcheckwrap'>"); i.chkSameQty = t("<input id='chkSameQty_" + i.windowNo + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameQty_" + i.windowNo + "' class='VIS_Pref_Label_Font'>Same Quantity<\/label><\/span>"); this.chkSameQtyDiv.append(i.chkSameQty); i.btnSearch = t("<input id='btnSearch_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin-top: 0px;' type='button' value='Search'>"); i.btnProcess = t("<Button id='btnProcess_" + i.windowNo + "' style='margin-top: 0px;' class='VIS_Pref_btn-2'>" + n.Msg.getMsg("Match") + "<\/Button>"); i.lblInvoice.getControl().text(n.Msg.translate(n.Env.getCtx(), "Invoice")); i.lblReceipt.getControl().text(n.Msg.translate(n.Env.getCtx(), "Receipt")); i.lblMatchFrom.getControl().text(n.Msg.translate(n.Env.getCtx(), "MatchFrom")); i.lblMatchTo.getControl().text(n.Msg.translate(n.Env.getCtx(), "MatchTo")); i.lblMatchMode.getControl().text(n.Msg.translate(n.Env.getCtx(), "MatchMode")); i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID")); i.lblProduct.getControl().text(n.Msg.translate(n.Env.getCtx(), "VAM_Product_ID")); i.lblDateFrom.getControl().text(n.Msg.translate(n.Env.getCtx(), "DateFrom")); i.lblDateTo.getControl().text(n.Msg.translate(n.Env.getCtx(), "DateTo")); i.lblMatched.getControl().text(n.Msg.translate(n.Env.getCtx(), "ToBeMatched")); i.lblMatchedTo.getControl().text(n.Msg.translate(n.Env.getCtx(), "Matching")); i.lblDifference.getControl().text(n.Msg.translate(n.Env.getCtx(), "Difference")); i.chkIsReturnTrx.prop("checked", !1); i.btnProcess.attr("disabled", "disabled"); i.chkSameProduct.prop("checked", !0); i.chkSameBPartner.prop("checked", !0); i.chkSameQty.prop("checked", !1); i.chkIsReturnTrx.next("label").text(n.Msg.translate(n.Env.getCtx(), "isReturnTrx")); i.chkSameProduct.next("label").text(n.Msg.translate(n.Env.getCtx(), "SameProduct")); i.chkSameBPartner.next("label").text(n.Msg.translate(n.Env.getCtx(), "SameBPartner")); i.chkSameQty.next("label").text(n.Msg.translate(n.Env.getCtx(), "SameQty")); i.lblSearch.getControl().text(n.Msg.translate(n.Env.getCtx(), "Search")); i.btnSearch.text(n.Msg.translate(n.Env.getCtx(), "Search")) } function wt() { ri(); bt(); i.lblStatusInfo.getControl().text(""); i.lblStatusCount.getControl().text(0) } function ai() { var t = n.MLookupFactory.getMLookUp(n.Env.getCtx(), i.windowNo, 3499, n.DisplayType.Search); i.onlyVendor = new n.Controls.VTextBoxButton("VAB_BusinessPartner_ID", !0, !1, !0, n.DisplayType.Search, t); t = n.MLookupFactory.getMLookUp(n.Env.getCtx(), i.windowNo, 3840, n.DisplayType.Search); i.onlyProduct = new n.Controls.VTextBoxButton("VAM_Product_ID", !0, !1, !0, n.DisplayType.Search, t) } function bt() { i.cmbMatchTo.getControl().empty(); var n = null; i.cmbMatchFrom.getControl().find("option").length > 0 && (n = i.cmbMatchFrom.getControl().find("option:selected").val(), n.equals(r[o]) ? i.cmbMatchTo.getControl().append(" <option value='" + r[f] + "'>" + r[f] + "<\/option>") : n.equals(r[u]) ? i.cmbMatchTo.getControl().append(" <option value='" + r[f] + "'>" + r[f] + "<\/option>") : (i.cmbMatchTo.getControl().append(" <option value='" + r[o] + "'>" + r[o] + "<\/option>"), i.cmbMatchTo.getControl().append(" <option value='" + r[u] + "'>" + r[u] + "<\/option>")), i.cmbMatchTo.getControl().prop("selectedIndex", 0), i.lblInvoice.getControl().text(n)); kt() } function kt() { selection = i.cmbMatchTo.getControl().find("option:selected").val(); i.lblReceipt.getControl().text(selection) } function et() { var v = i.cmbMatchFrom.getControl()[0].selectedIndex, c = i.cmbMatchTo.getControl().find("option:selected").val(), h = o, l, a, t, e; c.equals(r[f]) ? h = f : c.equals(r[u]) && (h = u); yt = h; ti(v, h); ft = ""; i.vdgvReceipt != null && i.vdgvReceipt.clear(); i.onlyProduct.getValue() != null && (l = i.onlyProduct.getValue(), at = " AND lin.VAM_Product_ID=" + l); i.onlyVendor.getValue() != null && (a = i.onlyVendor.getValue(), vt = " AND hdr.VAB_BusinessPartner_ID=" + a); t = i.dtpFrom.val(); e = i.dtpTo.val(); t != "" && e != "" ? ht = " AND " + s + " BETWEEN " + n.DB.to_date(t) + " AND " + n.DB.to_date(e) : t != "" ? ct = " AND " + s + " >= " + n.DB.to_date(t) : e != "" && (lt = " AND " + s + " <= " + n.DB.to_date(e)); ii(i.vdgvInvoice); i.txtMatched.getControl().val(0); i.lblStatusInfo.getControl().text(i.cmbMatchFrom.getControl().find("option:selected").val() + "# = " + i.vdgvInvoice.records.length + " -" + i.cmbMatchTo.getControl().find("option:selected").val() + "# = " + i.vdgvReceipt.records.length); i.lblStatusCount.getControl().text(0) } function c(n) { var t, s, h, e, c, v, p, a, w; nt = ""; tt = ""; it = ""; t = -1; n != null ? t = n : i.vdgvInvoice.getSelection().length > 0 && (t = Number(i.vdgvInvoice.getSelection().toString())); s = 0; t < 0 ? i.$busyDiv[0].style.visibility = "hidden" : (h = i.cmbMatchTo.getControl().find("option:selected").val(), e = o, h.equals(r[f]) ? e = f : h.equals(r[u]) && (e = u), c = i.cmbMatchFrom.getControl()[0].selectedIndex, yt = c, ti(e, c), v = { key: i.vdgvInvoice.get(t).VAB_BusinessPartner_ID_K, value: i.vdgvInvoice.get(t).VAB_BusinessPartner_ID }, p = { key: i.vdgvInvoice.get(t).VAM_Product_ID_K, value: i.vdgvInvoice.get(t).VAM_Product_ID }, i.chkSameBPartner.prop("checked") && (nt = " AND hdr.VAB_BusinessPartner_ID=" + v.key), i.chkSameProduct.prop("checked") && (tt = " AND lin.VAM_Product_ID=" + p.key), a = i.vdgvInvoice.get(t).Qty, w = i.vdgvInvoice.get(t).Matched, s = a - w, i.chkSameQty.prop("checked") && (it = " AND " + y + "=" + a), ft = i.vdgvInvoice.get(t).Line_K, ii(i.vdgvReceipt)); l = s; i.txtMatched.setValue(l); i.txtMatchedTo.setValue(0); i.txtDifference.setValue(l); i.lblStatusInfo.getControl().text(i.cmbMatchFrom.getControl().find("option:selected").val() + "# = " + i.vdgvInvoice.records.length + " -" + i.cmbMatchTo.getControl().find("option:selected").val() + "# = " + i.vdgvReceipt.records.length); i.lblStatusCount.getControl().text(0) } function vi() { var n = -1, o, h, c; if (i.vdgvInvoice.getSelection().length > 0 && (n = Number(i.vdgvInvoice.getSelection().toString())), n < 0) { e = !1; i.$busyDiv[0].style.visibility = "hidden"; return } var b = { key: i.vdgvInvoice.get(n).VAB_BusinessPartner_ID_K, value: i.vdgvInvoice.get(n).VAB_BusinessPartner_ID }, a = { key: i.vdgvInvoice.get(n).Line_K, value: i.vdgvInvoice.get(n).Line }, v = { key: i.vdgvInvoice.get(n).VAM_Product_ID_K, value: i.vdgvInvoice.get(n).VAM_Product_ID }, y = l, k = i.vdgvInvoice.get(n).Matched, f = i.vdgvReceipt.getSelection().toString(); if (f == null) { e = !1; i.$busyDiv[0].style.visibility = "hidden"; return } if (f.length <= 0) { e = !1; i.$busyDiv[0].style.visibility = "hidden"; return } o = !0; (i.cmbMatchFrom.getControl().find("option:selected").val().equals(r[u]) || i.cmbMatchTo.getControl().find("option:selected").val().equals(r[u])) && (o = !1); var p = i.cmbMatchMode.getControl()[0].selectedIndex, w = i.cmbMatchFrom.getControl()[0].selectedIndex, s = [], t = f.toString().split(","); for (n = 0; n < t.length; n++)if (h = i.vdgvReceipt.get(t[n])._ID, h != null) { if (c = { key: i.vdgvReceipt.get(t[n]).VAM_Product_ID_K, value: i.vdgvReceipt.get(t[n]).VAM_Product_ID }, v.key != c.key) continue; s.push(i.vdgvReceipt.get(t[n])) } else continue; if (s.length > 0) yi(o, p, w, a.key, y, s); else { e = !1; i.$busyDiv[0].style.visibility = "hidden"; return } } function ti(n) { nt = ""; tt = ""; it = ""; ht = ""; ct = ""; lt = ""; at = ""; vt = ""; ni = i.cmbMatchMode.getControl()[0].selectedIndex == pt; ot = ""; dt = i.chkIsReturnTrx.prop("checked"); st = ""; gt = !1; matchToTypeMATCH_ORDER = "matchToTypeMATCH_ORDER"; n == o ? (ot = "displayMATCH_INVOICE", s = "hdr.DateInvoiced", y = "lin.QtyInvoiced") : n == u ? (st = "displayMATCH_ORDER", s = "hdr.DateOrdered", y = "lin.QtyOrdered") : (s = "hdr.MovementDate", y = "lin.MovementQty") } function ii(r) { var e = [], o = { displayMATCH_INVOICEs: ot, chkIsReturnTrxProps: dt, displayMATCH_ORDERs: st, matchToTypeMATCH_SHIPMENTs: gt, matchedsss: ni, chkSameBPartnerss: nt, chkSameProductss: tt, chkSameQtyss: it, from_ss: ht, fromIfs: ct, to_Dats: lt, matchToTypes: yt, MATCH_SHIPMENTs: f, MATCH_ORDERs: u, onlyProduct_ss: at, onlyVendor_ss: vt, MatchToID: ft }; t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetTableLoadVmatch", dataType: "json", data: o, success: function (n) { var t = JSON.parse(n), o, u, f, s, h; if (t && t != null) for (o = 1, u = 0; u < t.length; u++)f = {}, f._ID = t[u]._ID, f.DocumentNo = t[u].DocNo, s = t[u].Date, h = new Date(s), t[u].Date = h.toLocaleDateString(), f.Date = t[u].Date, f.VAB_BusinessPartner_ID = t[u].CBPartnerIDK, f.VAB_BusinessPartner_ID_K = t[u].CBPartnerID, f.Line = t[u].Line, f.Line_K = t[u].Line_K, f.VAM_Product_ID = t[u].MVAMProductIDK, f.VAM_Product_ID_K = t[u].MVAMProductID, f.Qty = t[u].Qty, f.Matched = t[u].Matched, f.recid = o, o++, e.push(f); e.length < 1 ? (ri(r.name.contains("vdgvReceipt")), i.$busyDiv[0].style.visibility = "hidden") : r.name.contains("vdgvReceipt") ? (wi(i.arrListColumns, e), i.$busyDiv[0].style.visibility = "hidden") : r.name.contains("vdgvInvoice") && (pi(i.arrListColumns, e), c()) }, error: function (n) { console.log(n); i.$busyDiv[0].style.visibility = "hidden" } }) } function yi(r, u, f, o, s, h) { var c = i; t.ajax({ url: n.Application.contextUrl + "Common/CreateMatchRecord", dataType: "json", data: { invoice: r, MatchMode: u, MatchFrom: f, LineMatched: o, ToMatchQty: s, SelectedItems: JSON.stringify(h) }, success: function (t) { et(); i.vdgvReceipt.delete(!0); var r = JSON.parse(t); r.Msg != "" ? n.ADialog.info("", null, r.Msg, null) : r.MatchedPO_ID > 0 ? n.ADialog.info("Matched", null, n.Msg.getMsg("PurchaseOrder") + " - " + r.MatchedPO_ID, null) : r.MatchedInv_ID > 0 && n.ADialog.info("Matched", null, n.Msg.getMsg("Invoice") + " - " + r.MatchedInv_ID, null); e = !1; i.$busyDiv[0].style.visibility = "hidden" }, error: function (n, t) { console.log(t); e = !1; i.$busyDiv[0].style.visibility = "hidden" } }) } function ri(r) { i.arrListColumns.length == 0 && (i.arrListColumns.push({ field: "_ID", caption: "_ID", sortable: !0, size: "11%", hidden: !0 }), i.arrListColumns.push({ field: "DocumentNo", caption: n.Msg.translate(n.Env.getCtx(), "DocumentNo"), sortable: !0, size: "11%", hidden: !1 }), i.arrListColumns.push({ field: "Date", caption: n.Msg.translate(n.Env.getCtx(), "Date"), sortable: !0, size: "11%", hidden: !1 }), i.arrListColumns.push({ field: "VAB_BusinessPartner_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID"), sortable: !0, size: "11%", hidden: !1 }), i.arrListColumns.push({ field: "VAB_BusinessPartner_ID_K", caption: n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID"), sortable: !0, size: "11%", hidden: !0 }), i.arrListColumns.push({ field: "Line", caption: n.Msg.translate(n.Env.getCtx(), "Line"), sortable: !0, size: "11%", hidden: !1 }), i.arrListColumns.push({ field: "Line_K", caption: n.Msg.translate(n.Env.getCtx(), "Line"), sortable: !0, size: "11%", hidden: !0 }), i.arrListColumns.push({ field: "VAM_Product_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAM_Product_ID"), sortable: !0, size: "11%", hidden: !1 }), i.arrListColumns.push({ field: "VAM_Product_ID_K", caption: n.Msg.translate(n.Env.getCtx(), "VAM_Product_ID"), sortable: !0, size: "11%", hidden: !0 }), i.arrListColumns.push({ field: "Qty", caption: n.Msg.translate(n.Env.getCtx(), "Qty"), sortable: !0, size: "11%", hidden: !1, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.Qty); return i.toLocaleString() } }), i.arrListColumns.push({ field: "Matched", caption: n.Msg.translate(n.Env.getCtx(), "Matched"), sortable: !0, size: "11%", hidden: !1 })); r == null ? (i.vdgvInvoice != null && (i.vdgvInvoice.destroy(), i.vdgvInvoice = null), i.vdgvInvoice = t(i.invoicegrd).w2grid({ name: "vdgvInvoice" + i.windowNo, recordHeight: 30, show: { selectColumn: !1 }, onSelect: function (n) { c(n.recid) }, multiSelect: !1, columns: i.arrListColumns, records: null }), i.vdgvReceipt != null && (i.vdgvReceipt.destroy(), i.vdgvReceipt = null), i.vdgvReceipt = t(i.reciptgrd).w2grid({ name: "vdgvReceipt" + i.windowNo, recordHeight: 30, show: { selectColumn: !0 }, onSelect: function (n) { this.multiSelect = !0; a(n.recid, !0) }, onUnselect: function (n) { a(n.recid, !1) }, multiSelect: !1, columns: i.arrListColumns, records: null })) : r ? r && (i.vdgvReceipt != null && (i.vdgvReceipt.destroy(), i.vdgvReceipt = null), i.vdgvReceipt = t(i.reciptgrd).w2grid({ name: "vdgvReceipt" + i.windowNo, recordHeight: 30, show: { selectColumn: !0 }, onSelect: function (n) { this.multiSelect = !0; a(n.recid, !0) }, onUnselect: function (n) { a(n.recid, !1) }, multiSelect: !1, columns: i.arrListColumns, records: null })) : (i.vdgvInvoice != null && (i.vdgvInvoice.destroy(), i.vdgvInvoice = null), i.vdgvInvoice = t(i.invoicegrd).w2grid({ name: "vdgvInvoice" + i.windowNo, recordHeight: 30, show: { selectColumn: !1 }, onSelect: function (n) { c(n.recid) }, multiSelect: !1, columns: i.arrListColumns, records: null })) } function pi(n, r) { i.vdgvInvoice != null && (i.vdgvInvoice.destroy(), i.vdgvInvoice = null); w2utils.encodeTags(r); i.vdgvInvoice = t(i.invoicegrd).w2grid({ name: "vdgvInvoice" + i.windowNo, recordHeight: 30, show: { selectColumn: !1 }, onSelect: function (n) { c(n.recid) }, multiSelect: !1, columns: n, records: r }) } function wi(n, r) { i.vdgvReceipt != null && (i.vdgvReceipt.destroy(), i.vdgvReceipt = null); w2utils.encodeTags(r); i.vdgvReceipt = t(i.reciptgrd).w2grid({ name: "vdgvReceipt" + i.windowNo, recordHeight: 30, show: { selectColumn: !0 }, onSelect: function (n) { this.multiSelect = !0; a(n.recid, !0) }, onUnselect: function (n) { a(n.recid, !1) }, multiSelect: !1, columns: n, records: r }) } function a(n, t) { var o, s, r, u, c, a; if (!(i.vdgvInvoice.records.length < 1)) { if (!i.chkSameProduct.prop("checked")) { setTimeout(function () { i.vdgvReceipt.unselect(Number(n)) }, 10); return } o = -1; s = null; i.vdgvInvoice.getSelection().length > 0 && (o = Number(i.vdgvInvoice.getSelection().toString()), s = { key: i.vdgvInvoice.get(o).VAM_Product_ID_K, value: i.vdgvInvoice.get(o).VAM_Product_ID }); var f = 0, h = 0, e = n + "," + i.vdgvReceipt.getSelection().toString().replace(n, ""); if (t && e != null && e.length > 0) for (e = e.replace(/,$/, ""), r = e.toString().split(","), u = 0; u < r.length; u++)if (c = i.vdgvReceipt.get(r[0])._ID, c != null) { if (a = { key: i.vdgvReceipt.get(r[u]).VAM_Product_ID_K, value: i.vdgvReceipt.get(r[u]).VAM_Product_ID }, s.key != a.key) { setTimeout(function () { i.vdgvReceipt.unselect(Number(n)) }, 10); return } i.cmbMatchMode.getControl()[0].selectedIndex == b && (f = f + Number(i.vdgvReceipt.get(r[u]).Qty)); f = f - Number(i.vdgvReceipt.get(r[u]).Matched); h++ } k = f; i.txtMatchedTo.setValue(k.toString()); i.txtDifference.setValue(l - k); h <= 0 && i.btnProcess.removeAttr("disabled"); i.lblStatusCount.getControl().text(h) } } var i, h; this.frame; this.windowNo; i = this; this.arrListColumns = []; this.vdgvInvoice = null; this.vdgvReceipt = null; this.lblMatchFrom = new n.Controls.VLabel; this.lblMatchTo = new n.Controls.VLabel; this.lblMatchMode = new n.Controls.VLabel; this.lblBPartner = new n.Controls.VLabel; this.lblProduct = new n.Controls.VLabel; this.lblDateFrom = new n.Controls.VLabel; this.lblDateTo = new n.Controls.VLabel; this.lblInvoice = new n.Controls.VLabel; this.lblReceipt = new n.Controls.VLabel; this.lblMatched = new n.Controls.VLabel; this.lblMatchedTo = new n.Controls.VLabel; this.lblDifference = new n.Controls.VLabel; this.lblStatusInfo = new n.Controls.VLabel; this.lblStatusCount = new n.Controls.VLabel; this.lblSearch = new n.Controls.VLabel; this.cmbMatchFrom = new n.Controls.VComboBox("", !1, !1, !0); this.cmbMatchTo = new n.Controls.VComboBox("", !1, !1, !0); this.cmbMatchMode = new n.Controls.VComboBox("", !1, !1, !0); this.chkIsReturnTrx = null; this.chkSameBPartner = null; this.chkSameProduct = null; this.chkSameQty = null; this.onlyVendor = null; this.onlyProduct = null; this.dtpFrom = null; this.dtpTo = null; this.btnSearch = null; this.btnProcess = null; this.btnToggel = null; this.txtMatched = new n.Controls.VTextBox("", !1, !0, !1); this.txtMatchedTo = new n.Controls.VTextBox("", !1, !0, !1); this.txtDifference = new n.Controls.VTextBox("", !1, !0, !1); this.$root = t("<div style='width: 100%; height: 100%; background-color: white;'>"); this.$busyDiv = t("<div id='testBesy' class='vis-busyindicatorouterwrap'><div class='vis-busyindicatorinnerwrap'><i class='vis-busyindicatordiv'><\/i><\/div><\/div>"); this.sideDiv = null; this.gridSelectDiv = null; this.gridInvoiceDiv = null; this.gridReciptDiv = null; this.processlDiv = null; this.bottumDiv = null; this.bottumButtonDiv = null; this.btnSpaceDiv = null; this.topDiv = null; this.div = null; this.divForGrid = null; this.invoicegrd = null; this.reciptgrd = null; this.invoiceTopDiv = null; var p = !1, v = 260, w = 50, rt = t(window).width() - v, ut = t(window).width() - w, ui = t(window).height() - 240, fi = n.Env.getCtx().getVAF_Client_ID(), ei = n.Env.getCtx().getVAF_Org_ID(), oi = n.Env.getCtx().getVAF_UserContact_ID(), o = 0, f = 1, u = 2, b = 0, pt = 1, si = null, s = "", y = "", hi = "", l = 0, k = 0, ft = "", d = null, g = null, e = !1, r = []; r.push(n.Msg.getElement3(n.Env.getVAF_Language(n.Env.getCtx()), "VAB_Invoice_ID", !1)); r.push(n.Msg.getElement3(n.Env.getVAF_Language(n.Env.getCtx()), "VAM_Inv_InOut_ID", !1)); r.push(n.Msg.getElement3(n.Env.getVAF_Language(n.Env.getCtx()), "VAB_Order_ID", !1)); h = []; h.push(n.Msg.getMsg("NotMatched")); h.push(n.Msg.getMsg("Matched")); var ot = "", dt = "", st = "", gt = !1, ni = "", nt = "", tt = "", it = "", ht = "", ct = "", lt = "", at = "", vt = "", yt = ""; this.Initialize = function () { for (var u = 0; u < r.length; u++)this.cmbMatchFrom.getControl().append(" <option value='" + r[u] + "'>" + r[u] + "<\/option>"); for (u = 0; u < h.length; u++)this.cmbMatchMode.getControl().append(" <option value='" + h[u] + "'>" + h[u] + "<\/option>"); if (this.cmbMatchFrom.getControl().prop("selectedIndex", 0), this.cmbMatchMode.getControl().prop("selectedIndex", 0), ai(), li(), ci(), this.btnToggel = this.$root.find("#btnToggelDiv_" + i.windowNo), this.gridSelectDiv = this.$root.find("#divForGrid_" + i.windowNo), this.cmbMatchFrom.getControl() != null && this.cmbMatchFrom.getControl().change(function () { i.$busyDiv[0].style.visibility = "visible"; wt(); bt(); i.$busyDiv[0].style.visibility = "hidden" }), this.cmbMatchTo.getControl() != null && this.cmbMatchTo.getControl().change(function () { i.$busyDiv[0].style.visibility = "visible"; kt(); i.$busyDiv[0].style.visibility = "hidden" }), this.cmbMatchMode.getControl() != null && this.cmbMatchMode.getControl().change(function () { i.cmbMatchMode.getControl()[0].selectedIndex == b ? i.btnProcess.text(n.Msg.getMsg("Match")) : i.btnProcess.text(n.Msg.getMsg("Unmatch")) }), this.btnSearch != null) this.btnSearch.on(n.Events.onTouchStartOrClick, function () { i.$busyDiv[0].style.visibility = "visible"; et() }); if (this.btnProcess != null) this.btnProcess.on(n.Events.onTouchStartOrClick, function () { e || (i.$busyDiv[0].style.visibility = "visible", e = !0, vi()) }); if (this.btnToggel != null) this.btnToggel.on(n.Events.onTouchStartOrClick, function () { p ? (i.btnToggel.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), p = !1, i.btnSpaceDiv.animate({ width: v }, "slow"), i.gridSelectDiv.animate({ width: rt }, "slow"), i.invoiceTopDiv.animate({ width: rt }, "slow"), i.div.css("display", "block"), i.sideDiv.animate({ width: v }, "slow", null, function () { i.vdgvInvoice.resize(); i.vdgvReceipt.resize() })) : (i.btnToggel.animate({ borderSpacing: 180 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), p = !0, i.btnSpaceDiv.animate({ width: w }, "slow"), i.sideDiv.animate({ width: w }, "slow"), i.div.css("display", "none"), i.invoiceTopDiv.animate({ width: ut }, "slow"), i.gridSelectDiv.animate({ width: ut }, "slow", null, function () { i.vdgvInvoice.resize(); i.vdgvReceipt.resize() })) }); if (this.chkSameBPartner.change(function () { i.$busyDiv[0].style.visibility = "visible"; c() }), this.chkSameQty.change(function () { i.$busyDiv[0].style.visibility = "visible"; c() }), this.chkSameProduct.change(function () { i.$busyDiv[0].style.visibility = "visible"; c() }), d != null) d.on(n.Events.onTouchStartOrClick, function () { i.onlyVendor.isReadOnly || i.onlyVendor.setValue(null, !1, !0) }); if (g != null) g.on(n.Events.onTouchStartOrClick, function () { i.onlyProduct.isReadOnly || i.onlyProduct.setValue(null, !1, !0) }); i.$busyDiv[0].style.visibility = "hidden" }; this.display = function () { wt() }; this.getRoot = function () { return this.$root }; this.callConsolidate = function () { t.ajax({ url: n.Application.contextUrl + "Common/Consolidate", dataType: "json", async: !0, success: function () { } }); i.vdgvReceipt.multiSelect = !0; var r = "vdgvReceipt" + i.windowNo; w2ui[r].multiSelect = !0 }; this.disposeComponent = function () { this.btnSearch && this.btnSearch.off(n.Events.onTouchStartOrClick); this.btnProcess && this.btnProcess.off(n.Events.onTouchStartOrClick); this.btnToggel && this.btnToggel.off(n.Events.onTouchStartOrClick); this.frame = null; this.windowNo = null; this.arrListColumns = null; this.vdgvInvoice = null; this.vdgvReceipt = null; this.lblMatchFrom = null; this.lblMatchTo = null; this.lblMatchMode = null; this.lblBPartner = null; this.lblProduct = null; this.lblDateFrom = null; this.lblDateTo = null; this.lblInvoice = null; this.lblReceipt = null; this.lblMatched = null; this.lblMatchedTo = null; this.lblDifference = null; this.lblStatusInfo = null; this.lblStatusCount = null; this.lblSearch = null; this.cmbMatchFrom = null; this.cmbMatchTo = null; this.cmbMatchMode = null; this.chkIsReturnTrx = null; this.chkSameBPartner = null; this.chkSameProduct = null; this.chkSameQty = null; this.onlyVendor = null; this.onlyProduct = null; this.dtpFrom = null; this.dtpTo = null; this.btnSearch = null; this.btnProcess = null; this.btnToggel = null; this.txtMatched = null; this.txtMatchedTo = null; this.txtDifference = null; this.$root = null; this.$busyDiv = null; this.sideDiv = null; this.gridSelectDiv = null; this.gridInvoiceDiv = null; this.gridReciptDiv = null; this.processlDiv = null; this.bottumDiv = null; this.btnSpaceDiv = null; p = null; v = null; w = null; rt = null; ut = null; ui = null; fi = null; ei = null; oi = null; o = null; f = null; u = null; b = null; pt = null; si = null; s = null; y = null; hi = null; l = null; k = null; i = null; r = null; h = null; this.disposeComponent = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (t, i) { this.frame = i; this.windowNo = t; n.Env.getCtx().setContext(this.windowNo, "IsSOTrx", "Y"); try { var r = this.Initialize() } catch (u) { } this.frame.getContentGrid().append(this.getRoot()); this.display(); this.callConsolidate() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VMatch = i }(VIS, jQuery), function (n, t) { function i() { function dt() { var g, w, s, d; setBusy(!0); v.setValue(!0); g = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; u = t("<div id='sideDiv_" + i.windowNo + "' class='vis-archive-left-sidebar vis-leftsidebarouterwrap'>"); ht = t("<div id='btnSpaceDiv_" + i.windowNo + "' class='vis-archive-l-s-head'><button id='btnSpace_" + i.windowNo + "' class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>"); p = t("<div class='vis-archive-l-s-content' id='parameterDiv_" + i.windowNo + "'>"); u.append(ht).append(p); g = n.Application.contextUrl + "Areas/VIS/Images/base/Refresh24.png"; e = t("<button id='btnRefresh_" + i.windowNo + "' style='margin-left: 12px;' class='VIS_Pref_btn-2 vis-frm-button vis-pull-left'><i class='vis vis-refresh'><\/i><\/button>"); y = t("<input id='btnCreateCharge_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' type='button' value='" + n.Msg.getMsg("CreateNew", !1, !1) + "'>"); a = t("<input id='btnCancel_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' type='button' value='" + n.Msg.getMsg("Cancel", !1, !1) + "'>"); l = t("<input id='btnAccount_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' type='button' value='" + n.Msg.getMsg("ChargeFroMVABAccount", !1, !1) + "'>"); var b = t("<table style='width: 100%;'>"), r = t("<tr>"), o = t("<td style='padding: 0px 10px 0px;'>"); p.append(b); r = t("<tr>"); o = t("<td style='padding: 0px 10px 0px;'>"); w = t('<div class="input-group vis-input-wrap">'); s = t('<div class="vis-control-wrap">'); b.append(r); r.append(o); o.append(w); w.append(s); s.append(h.getControl().attr("data-placeholder", "").attr("placeholder", " ")); s.append(tt.getControl().addClass("VIS_Pref_Label_Font")); r = t("<tr>"); o = t("<td style='padding: 0px 10px 0px;'>"); w = t('<div class="input-group vis-input-wrap">'); s = t('<div class="vis-control-wrap">'); b.append(r); r.append(o); o.append(w); w.append(s); s.append(c.getControl().attr("data-placeholder", "").attr("placeholder", " ")); s.append(it.getControl().addClass("VIS_Pref_Label_Font")); r = t("<tr>"); o = t("<td style='padding: 0px 10px 0px;'>"); b.append(r); r.append(o); o.append(v.getControl()); ut = t("<div class='vis-frm-bot-btn-wrp'>"); d = t("<div class='vis-frm-bttsec'>"); d.append(l).append(a); ut.append(y).append(e); f = t("<div id='rightSideGridDiv_" + i.windowNo + "' class='vis-frm-grid-wrap'>"); rt = t("<div id='gridDiv_" + i.windowNo + "' class='vis-frm-grid-inn'>"); f.append(rt); f.append(d); u.append(ut); k.append(st); k.append(u).append(f) } function gt(u) { r != null && (r.destroy(), r = null); s.length == 0 && (s.push({ field: "VAB_Acct_Element_ID", caption: n.Msg.getMsg("VAB_ACCT_ELEMENT_ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }), s.push({ field: "Value", caption: n.Msg.getMsg("SearchKey"), sortable: !0, size: "25%", min: 150, hidden: !1 }), s.push({ field: "Name", caption: n.Msg.getMsg("Name"), sortable: !0, size: "25%", min: 150, hidden: !1 }), s.push({ field: "Expense", caption: n.Msg.getMsg("Expense"), sortable: !0, size: "25%", min: 150, hidden: !1, editable: { type: "checkbox" } })); w2utils.encodeTags(u); r = t(rt).w2grid({ name: "gridAccountElement" + i.windowNo, recordHeight: 40, show: { selectColumn: !0 }, multiSelect: !0, columns: s, records: u }) } function at() { var r = []; nt = n.Env.getCtx().getContextAsInt("$VAB_AccountBook_ID"); ct = n.Env.getCtx().getVAF_Client_ID(); lt = n.Env.getCtx().getVAF_Org_ID(); t.ajax({ url: n.Application.contextUrl + "VCharge/VChargeLodGrideData", dataType: "json", data: { mcAcctSchemaID: nt, mADClientId: ct }, success: function (n) { var e, u, f, t, i; if (n.result.meID != 0) { if (n.result && n.result.VchargeMCElemTaxCatID) { if (e = n.result.VchargeMCElemTaxCatID, et = n.result.VchargeMCElemTaxCatID[0].mCElementID, et == 0) return; ot = n.result.VchargeMCElemTaxCatID[0].mCTaxCategoryID } if (n.result && n.result.VchargeCElementValue) { for (u = n.result.VchargeCElementValue, f = 1, t = 0; t < u.length; t++)i = {}, i.VAB_Acct_Element_ID = u[t].VAB_Acct_Element_ID, i.Value = u[t].Value, i.Name = u[t].Name, i.Expense = u[t].Expense == "false" ? !1 : !0, i.recid = f, f++, r.push(i); gt(r); setBusy(!1) } } }, error: function (n) { setBusy(!1); i.log.info(n) } }) } function ni(i, r, u, f, e) { t.ajax({ url: n.Application.contextUrl + "VCharge/CreateCharge", dataType: "json", data: { m_VAB_AccountBook_ID: i, m_VAB_TaxCategory_ID: r, name: u, VAB_Acct_Element_ID: f, expense: e }, success: function (t) { if (t.ID == 0) { n.ADialog.info("ChargeNotCreated", !0, null); setBusy(!1); return } h.ctrl.val(""); c.ctrl.val(""); var i = t.ID; n.ADialog.info("ChargeCreated", !0, null); at() } }) } function ti(i, r, u, f, e) { t.ajax({ url: n.Application.contextUrl + "VCharge/CreateChargeByList", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ AcctSchemaID: i, TaxCategoryID: r, namepara: u, ElementValuID: f, expense: e }), success: function (t) { t.listCreatedP && n.ADialog.info("ChargeCreated", !0, null); t.listRejectedP && n.ADialog.info("ChargeNotCreated", !0, null); setBusy(!1) } }) } this.frame; this.windowNo; var i = this, s = [], r = null; this.log = n.Logging.VLogger.getVLogger("VCharge"); var vt = !1, yt = !1, b = !1, tt = new n.Controls.VLabel(n.Msg.getMsg("SearchKey", !1, !1), "SearchKey", !1, !0), it = new n.Controls.VLabel(n.Msg.getMsg("Name", !1, !1), "Name", !1, !0), h = new n.Controls.VTextBox("SearchKey", !0, !1, !0, 50, 100, null, null, !1), c = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 100, null, null, !1), v = new n.Controls.VCheckBox("Expense", !1, !1, !0, n.Msg.getMsg("Expense", !1, !1), null), pt = new n.Controls.VCheckBox("SelectAll", !1, !1, !0, n.Msg.getMsg("SelectAll", !1, !1), null), y = null, l = null, wt = new n.Controls.VLabel; this.log = n.Logging.VLogger.getVLogger("VCharge"); var k = t("<div style='width: 100%; height: 100%; background-color: white; '>"), st = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), u = null, f = null, ht = null, p = null, rt = null, ut = null, a = null, e = null, o = null, w = 260, d = 50, g = t(window).width() - (w + 20 + 5), ft = t(window).width() - (20 + d), bt = g + w + 5, kt = t(window).height() - 210, et = 0, nt = 0, ot = 0, ct = 0, lt = 0; setBusy = function (n) { st.css("display", n ? "block" : "none") }; this.Initialize = function () { if (dt(), o = k.find("#btnSpace_" + i.windowNo), a != null) a.on(n.Events.onTouchStartOrClick, function () { i.dispose() }); if (e != null) e.on(n.Events.onTouchStartOrClick, function () { h.ctrl.val(""); c.ctrl.val(""); setBusy(!0); at() }); if (o != null) o.on(n.Events.onTouchStartOrClick, function () { var i = 0; b ? (i = n.Application.isRTL ? 180 : 0, y.show(), e.show(), tt.getControl().show(), it.getControl().show(), h.getControl().show(), c.getControl().show(), v.getControl().show(), o.animate({ borderSpacing: i }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), b = !1, f.animate({ width: g }, "slow"), p.css("display", "block"), u.animate({ width: w }, "slow", null, function () { r.resize() })) : (i = n.Application.isRTL ? 0 : 180, y.hide(), e.hide(), tt.getControl().hide(), it.getControl().hide(), h.getControl().hide(), c.getControl().hide(), v.getControl().hide(), o.animate({ borderSpacing: i }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), b = !0, u.animate({ width: d }, "slow"), p.css("display", "none"), f.animate({ width: ft }, "slow", null, function () { r.resize() })) }); if (this.sizeChanged = function (n, t) { g = t - (w + 1); ft = t - (d + 1); b == !0 ? (u.animate({ width: d }, "slow"), f.animate({ width: ft }, "slow", null, function () { r.resize() })) : (f.animate({ width: g }, "slow"), u.animate({ width: w }, "slow", null, function () { r.resize() })) }, l != null) l.on(n.Events.onTouchStartOrClick, function () { var i, t, n; setBusy(!0); var u = [], f = [], e = []; if (r) { if (i = r.getSelection(), !i) { setBusy(!1); return } if (i.length <= 0) { setBusy(!1); return } for (t = i.toString().split(","), n = 0; n < t.length; n++)u[n] = r.get(t[n]).VAB_Acct_Element_ID, f[n] = r.get(t[n]).Name, e[n] = r.get(t[n]).Expense; if (u.length == 0) return setBusy(!1), ""; ti(nt, ot, f, u, e) } }); if (y != null) y.on(n.Events.onTouchStartOrClick, function () { var u, f, r; if (setBusy(!0), u = v.getValue(), f = h.getValue().trim(), f.length == 0) { n.ADialog.warn("SearchKeyMandatory", !0, null); setBusy(!1); return } if (r = c.getValue().trim(), r.length == 0) { n.ADialog.warn("NameMandatory", !0, null); setBusy(!1); return } t.ajax({ url: n.Application.contextUrl + "VCharge/CreateElementValue", dataType: "json", data: { m_VAF_Org_ID: lt, value: f, name: r, expense: u, m_VAB_Element_ID: et }, success: function (t) { if (t.ID == 0) { i.log.saveError("ChargeNotCreated", t.Msg); n.ADialog.warn(t.Msg, !0, null); setBusy(!1); return } ni(nt, ot, r, t.ID, u) } }) }) }; this.display = function () { setTimeout(at(), 5) }; this.getRoot = function () { return k }; this.disposeComponent = function () { a && a.off(n.Events.onTouchStartOrClick); e && e.off(n.Events.onTouchStartOrClick); o && o.off(n.Events.onTouchStartOrClick); l && l.off(n.Events.onTouchStartOrClick); i.windowNo = null; s = null; r = null; vt = null; yt = null; b = null; tt = null; it = null; h = null; c = null; v = null; pt = null; btnCreateCharg = null; l = null; wt = null; i.log = null; k = null; st = null; u = null; f = null; ht = null; p = null; rt = null; ut = null; a = null; e = null; o = null; w = null; d = null; g = null; ft = null; bt = null; kt = null; et = null; nt = null; ot = null; ct = null; lt = null; i = null; this.getRoot = null; this.disposeComponent = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.display() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VCharge = i }(VIS, jQuery), function (n, t) { function i() { function ti() { var k, y, o, u, p; setBusy(!0); k = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; s = t("<div id='sideDiv_" + i.windowNo + "' class='vis-archive-left-sidebar'>"); v = t("<div id='btnSpaceDiv_" + i.windowNo + "'  class='vis-archive-l-s-head'><button id='btnSpace_" + i.windowNo + "' class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>"); l = t("<div class='vis-archive-l-s-content vis-leftsidebarouterwrap' id='parameterDiv_" + i.windowNo + "'>"); s.append(v).append(l); k = n.Application.contextUrl + "Areas/VIS/Images/base/Refresh24.png"; f = t("<button id='btnRefresh_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button'><i class='vis vis-refresh'><\/i><\/button>"); c = t("<input id='btnOk_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' style='min-width: 70px;' type='button' value='" + n.Msg.getMsg("OK", !1, !1) + "'>"); y = t("<table style='width: 100%;'>"); l.append(y); tr = t("<tr>"); td = t("<td style='padding: 10px 10px 0px'>"); o = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); y.append(tr); tr.append(td); td.append(o); o.append(u); u.append(b.getControl().css("display", "inline-block")); u.append(r.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); o = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); y.append(tr); tr.append(td); td.append(o); o.append(u); u.append(it.getControl().css("display", "inline-block")); u.append(w.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px'>"); o = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); y.append(tr); tr.append(td); td.append(o); o.append(u); u.append(rt.getControl().css("display", "inline-block")); u.append(kt.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px'>"); o = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); y.append(tr); tr.append(td); td.append(o); o.append(u); u.append(ut.getControl().css("display", "inline-block")); u.append(dt.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); g = t("<div class='vis-frm-bot-btn-wrp'>"); p = t("<div class='vis-frm-bot-btn-wrp'>"); p.append(c); g.append(f); h = t("<div id='rightSideGridDiv_" + i.windowNo + "' class='vis-frm-grid-wrap'>"); d = t("<div id='gridDiv_" + i.windowNo + "' class='vis-frm-grid-inn'>"); d.append(e); h.append(d); h.append(p); s.append(g); a.append(ft); a.append(s).append(h) } function ii() { st.push({ Key: "0", Name: n.Msg.getMsg("ModeView", !1, !1) }); ui(); ri() } function ri() { t.ajax({ url: n.Application.contextUrl + "Common/GetDataQueryAttribute", type: "GET", dataType: "json", async: !1, success: function (n) { if (n.lst) { u = n.lst; for (var t = 0; t < u.length; t++)at(b.getControl(), u[t].GetKeyNamePair, t), at(it.getControl(), u[t].GetKeyNamePair, t) } n.priceList && ot(rt.getControl(), n.priceList); n.whList && ot(ut.getControl(), n.whList); setBusy(!1) } }) } function ui() { ot(k.getControl(), st) } function ot(n, t) { for (var i = 0; i < t.length; i++)n.append(" <option selected value='" + t[i].Key + "' >" + t[i].Name + "<\/option>"); n.prop("selectedIndex", 0) } function at(n, t, i) { i == 0 && n.append(" <option selected value='0' ><\/option>"); n.append(" <option selected value='" + t.Key + "' >" + t.Name + "<\/option>"); n.prop("selectedIndex", 0) } function fi(i, r) { var s, h, o, f, u; for (r = r < 2 ? 2 : r, i += 1, row = 0; row < i; row++)for (s = t("<tr id='row_" + row + "' >"), e.append(s), col = 0; col < r; col++)h = t("<td id='col_" + col + "'  style='padding: 4px 15px 2px;'>"), s.append(h); o = new n.Controls.VLabel; o.getControl().text("Mode"); f = e.find("#row_0"); r == 2 ? (u = f.find("#col_" + (r - 1)), u.append(k.getControl().css("display", "inline-block").css("width", "236px").css("height", "30px")), u = f.find("#col_" + (r - 2)), u.append(o.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))) : (u = f.find("#col_2"), u.append(k.getControl().css("display", "inline-block").css("width", "236px").css("height", "30px")), u = f.find("#col_1"), u.append(o.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))) } function ei(r, u) { var f = 0, e = 0, o = 0, s = 0; r && (f = r.GetVAM_ProductFeature_ID, e = r.GetVAM_PFeature_Value_ID); u && (o = u.GetVAM_ProductFeature_ID, s = u.GetVAM_PFeature_Value_ID); t.ajax({ url: n.Application.contextUrl + "Common/GetGridElement", dataType: "json", data: { xVAM_ProductFeature_ID: f, xVAM_PFeature_Value_ID: e, yVAM_ProductFeature_ID: o, yVAM_PFeature_Value_ID: s, VAM_PriceListVersion_ID: ht, VAM_Warehouse_ID: ct, windowNo: i.windowNo }, async: !1, success: function () { setBusy(!1) } }) } function oi() { var h, c, a, t, f, p, w; if (b != null && !tt) { if (h = b.getControl()[0].selectedIndex, c = it.getControl()[0].selectedIndex, h == c) { i.log.warning("Same Attribute Selected"); return } tt = !0; ht = rt.getControl().find("option:selected").val(); ct = ut.getControl().find("option:selected").val(); var v = 2, o = [], s = [], l = null, y = null; for (h > 0 && (o = u[h - 1].GetMVAMPFeatureValues), o != null && (v = o.length + 1, i.log.info("X - " + u[h - 1].GetName + " #" + o.length)), a = 2, c > 0 && (s = u[c - 1].GetMVAMPFeatureValues), s.length > 0 && (a = s.length + 1, i.log.info("Y - " + u[c - 1].GetName + " #" + s.length)), i.log.info("Rows=" + a + " - Cols=" + v), fi(a, v), t = null, f = null, row = 0; row < a; row++)for (col = 0; col < v; col++)o != null && (l = o[col]), s != null && (y = s[row]), row == 0 && col == 0 ? (p = new n.Controls.VLabel, w = new n.Controls.VLabel, o != null && (p.getControl().text(u[h - 1].GetName), t = e.find("#row_1"), f = t.find("#col_" + col), f.append(p.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))), s.length > 0 && (w.getControl().text(u[c - 1].GetName), t = e.find("#row_1"), f = t.find("#col_" + col), f.append(w.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))), l != null && (r = new n.Controls.VLabel, r.getControl().text(l.Name), t = e.find("#row_1"), f = t.find("#col_" + (col + 1)), f.append(r.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")))) : row == 0 ? l != null && (r = new n.Controls.VLabel, r.getControl().text(l.Name), t = e.find("#row_1"), f = t.find("#col_" + (col + 1)), f.append(r.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))) : col == 0 ? y != null && (r = new n.Controls.VLabel, r.getControl().text(y.Name), t = e.find("#row_" + row + 1), f = t.find("#col_" + col), f.append(r.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))) : ei(l, y, col, row + 1); tt = !1 } } function si() { var n = k.getControl().find("option:selected").val(); n != wt && n != bt && n == pt } this.frame; this.windowNo; var i = this, vt = !1, yt = !1, p = !1, tt = !1, st = [], pt = 0, wt = 0, bt = 0, ht = 0, ct = 0, u = [], r = new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(), "VAM_ProductFeature_ID"), "VAM_ProductFeature_ID", !1, !0), w = new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(), "VAM_ProductFeature_ID"), "VAM_ProductFeature_ID", !1, !0), kt = new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(), "VAM_PriceList_ID"), "VAM_PriceList_ID", !1, !0), dt = new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(), "VAM_Warehouse_ID"), "VAM_Warehouse_ID", !1, !0), hi = new n.Controls.VLabel(n.Msg.getMsg("Mode", !1, !1), "Mode", !1, !0), b = new n.Controls.VComboBox("", !1, !1, !0), it = new n.Controls.VComboBox("", !1, !1, !0), rt = new n.Controls.VComboBox("", !1, !1, !0), ut = new n.Controls.VComboBox("", !1, !1, !0), k = new n.Controls.VComboBox("", !1, !1, !0); this.log = n.Logging.VLogger.getVLogger("VAttributeGrid"); var a = t("<div class='vis-forms-container' style='width: 100%; height: 100%; background-color: white; '>"), ft = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), s = null, h = null, v = null, l = null, d = null, g = null, c = null, f = null, o = null, y = 260, nt = 50, et = t(window).width() - y, lt = t(window).width() - nt, gt = et + y + 5, ni = t(window).height() - 210, e = t("<table style='width: 100%;'>"); setBusy = function (n) { ft.css("display", n ? "block" : "none") }; this.Initialize = function () { if (ti(), o = a.find("#btnSpace_" + i.windowNo), c != null) c.on(n.Events.onTouchStartOrClick, function () { si(); i.dispose() }); if (f != null) f.on(n.Events.onTouchStartOrClick, function () { setBusy(!0); e.empty(); oi(); setBusy(!1) }); if (o != null) var u = 0; o.on(n.Events.onTouchStartOrClick, function () { p ? (f.show(), r.getControl().show(), w.getControl().show(), u = n.Application.isRTL ? 180 : 0, o.animate({ borderSpacing: u }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), p = !1, h.animate({ width: et }, "slow"), l.css("display", "block"), v.animate({ width: y }, "slow"), s.animate({ width: y }, "slow")) : (u = n.Application.isRTL ? 0 : 180, f.hide(), r.getControl().hide(), w.getControl().hide(), o.animate({ borderSpacing: u }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), p = !0, h.animate({ width: lt }, "slow"), s.animate({ width: nt }, "slow"), v.animate({ width: nt }, "slow"), l.css("display", "none")) }) }; this.display = function () { setTimeout(ii(), 5) }; this.getRoot = function () { return a }; this.disposeComponent = function () { c && c.off(n.Events.onTouchStartOrClick); f && f.off(n.Events.onTouchStartOrClick); o && o.off(n.Events.onTouchStartOrClick); i.windowNo = null; vt = null; yt = null; p = null; r = null; w = null; i.log = null; a = null; ft = null; s = null; h = null; v = null; l = null; d = null; g = null; c = null; f = null; o = null; y = null; nt = null; et = null; lt = null; gt = null; ni = null; i = null; this.getRoot = null; this.disposeComponent = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.display() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VAttributeGrid = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function r() { function dt() { w = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); w[0].style.visibility = "hidden"; b.append(w) } function o(n) { w[0].style.visibility = n ? "visible" : "hidden" } function gt() { var f = t(window).height() * (94 / 100), i, u; k = t("<div class='vis-mainContainer'>"); i = " <div class='vis-pSelectInfo vis-leftsidebarouterwrap'><div class='vis-pSelectInner'> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <select id='VIS_cmbBankAccount_" + r.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "VAB_Bank_Acct_ID") + " <\/label><\/div><\/div> <\/div> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrentBal_" + r.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.getMsg("CurrentBalance") + ' <\/label><\/div><\/div>  <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbbusinessPartner_' + r.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID") + ' <\/label><\/div><\/div>  <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <input  id=\'VIS_cmbPayDate_' + r.windowNo + "'type='date' data-placeholder='' placeholder=' '> <label>" + n.Msg.translate(n.Env.getCtx(), "PayDate") + ' <\/label><\/div><\/div>  <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbPaymentMethod_' + r.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "PaymentRule") + " <\/label><\/div><\/div>  <\/div> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='number' id='VIS_txtPaymentAmount_" + r.windowNo + "' disabled MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.getMsg("PaymentAmount") + " <\/label><\/div><\/div>  <\/div> <div class='vis-paymentselect-field'> <input type='checkbox' id='VIS_chkOnlyDue_" + r.windowNo + "' data-placeholder='' placeholder=' '> <label for='VIS_chkOnlyDue_" + r.windowNo + "'>" + n.Msg.getMsg("OnlyDue") + " <\/label>  <\/div> <div class='vis-paymentselect-field'> <label for='VIS_lblShowDetail_" + r.windowNo + "'><\/label> <\/div> <\/div> <div class='vis-paymentselect-field'> <button class='VIS_Pref_btn-2' disabled id='VIS_btnRefresh_" + r.windowNo + "' style='margin-top: 0px;'><i class='vis vis-refresh'><\/i><\/button> <\/div> <\/div>"; d = t("<div class='vis-pSelectIionGrid'>"); u = " <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_" + r.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("Cancel") + "' ><\/input> <input id='VIS_btnOK_" + r.windowNo + "' disabled class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("OK") + "' ><\/input> <\/div> <\/div>"; k.append(t(i)).append(d).append(t(u)); b.append(k); ni() } function ni() { f = t("#VIS_cmbBankAccount_" + r.windowNo); s = t("#VIS_cmbbusinessPartner_" + r.windowNo); h = t("#VIS_cmbPaymentMethod_" + r.windowNo); tt = t("#VIS_txtCurrentBal_" + r.windowNo); y = t("#VIS_chkOnlyDue_" + r.windowNo); a = t("#VIS_txtPaymentAmount_" + r.windowNo); ut = t("#VIS_lblShowDetail_" + r.windowNo); p = t("#VIS_btnRefresh_" + r.windowNo); v = t("#VIS_cmbPayDate_" + r.windowNo); g = t("#VIS_btnOK_" + r.windowNo); it = t("#VIS_btnCancel_" + r.windowNo); var n = new Date, i = ("0" + n.getDate()).slice(-2), u = ("0" + (n.getMonth() + 1)).slice(-2), e = n.getFullYear() + "-" + u + "-" + i; v.val(e); ft(); ti(); ri(); l.BankAccount.length > 0 && et() } function ti() { p.on("click", function () { o(!0); ei() && window.setTimeout(function () { ii(); o(!1) }, 20) }); g.on("click", function () { var t, i; if (e.getSelection().length <= 0) return n.ADialog.info("PleaseSelectRecord"), !1; if (t = e.getSelection(), t.length > 0) { for (i = 0; i < t.length; i++)rt[t[i]].SELECT = !0; o(!0); window.setTimeout(function () { oi() }, 20) } }); it.on("click", function () { r.dispose() }); f.on("change", function () { o(!0); window.setTimeout(function () { fi(); et(); o(!1) }, 20) }); y.on("click", function () { p.trigger("click") }) } function ft() { try { e != null && (e.destroy(), e = null) } catch (t) { } u.length == 0 && (u.push({ field: "SELECT", caption: n.Msg.getMsg("SELECT"), sortable: !0, size: "100px", hidden: !0 }), u.push({ field: "VAB_INVOICE_ID", caption: n.Msg.getMsg("Invoice"), sortable: !0, size: "100px" }), u.push({ field: "DUEDATE", caption: n.Msg.getMsg("DueDate"), sortable: !0, size: "100px", render: function (n) { var t; return t = n.changes == undefined || n.changes.DUEDATE == undefined ? n.DUEDATE : n.changes.DUEDATE, new Date(t).toLocaleDateString() } }), u.push({ field: "BUSINESSPARTNER", caption: n.Msg.getMsg("BusinessPartner"), sortable: !0, size: "100px" }), u.push({ field: "DOCUMENTNO", caption: n.Msg.getMsg("Document_No"), sortable: !0, size: "100px" }), u.push({ field: "CURRENCY", caption: n.Msg.getMsg("Currency"), sortable: !0, size: "100px" }), u.push({ field: "GRANDTOTAL", caption: n.Msg.getMsg("GrandTotal"), sortable: !0, size: "100px", render: function (n) { var t = n.GRANDTOTAL; return parseFloat(t).toLocaleString() } }), u.push({ field: "DISCOUNTAMOUNT", caption: n.Msg.getMsg("DiscountAmt"), sortable: !0, size: "100px", render: function (n) { var t = n.DISCOUNTAMOUNT; return parseFloat(t).toLocaleString() } }), u.push({ field: "DISCOUNTDATE", caption: n.Msg.getMsg("DiscountDate"), sortable: !0, size: "100px", render: function (n) { var t; return t = n.changes == undefined || n.changes.DISCOUNTDATE == undefined ? n.DISCOUNTDATE : n.changes.DISCOUNTDATE, new Date(t).toLocaleDateString() } }), u.push({ field: "AMOUNTDUE", caption: n.Msg.getMsg("AmountDue"), sortable: !0, size: "100px", render: function (n) { var t = n.AMOUNTDUE; return parseFloat(t).toLocaleString() } }), u.push({ field: "PAYMENTAMOUNT", caption: n.Msg.getMsg("PaymentAmount"), sortable: !0, size: "100px", render: function (n) { var t = n.PAYMENTAMOUNT; return parseFloat(t).toLocaleString() } })); e = d.w2grid({ name: "gridPaymentSelection_" + r.windowNo, recordHeight: 40, show: { selectColumn: !0 }, multiSelect: !0, columns: u, records: c }); e.on("select", function (t) { nt += n.Utility.Util.getValueOfDecimal(c[t.index].PAYMENTAMOUNT); a.val(nt); var i = e.getSelection(); g.removeAttr("disabled") }); e.on("unselect", function (t) { nt -= n.Utility.Util.getValueOfDecimal(c[t.index].PAYMENTAMOUNT); a.val(nt); var i = e.getSelection() }) } function ii() { var u, r, e; c = []; u = 0; r = []; r.push(f.val()); l != null ? (e = jQuery.grep(l.BankAccount, function (t) { return t.ID == n.Utility.Util.getValueOfInt(f.val()) }), e.length > 0 ? r.push(e[0].Currency_ID) : r.push(0)) : r.push(0); r.push(s.val()); r.push(v.val()); r.push(h.val()); r.push(a.val()); r.push(y.prop("checked")); t.ajax({ url: n.Application.contextUrl + "VPaySelect/GetGridRecords", async: !1, datatype: "Json", type: "POST", cache: !1, contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (n) { var t = JSON.parse(n), r; if (c = [], t != null || t != undefined) for (rt = t, i = 0; i < t.length; i++)r = {}, r.SELECT = t[i].SELECT, r.VAB_INVOICE_ID = t[i].VAB_INVOICE_ID, r.DUEDATE = t[i].DUEDATE, r.BUSINESSPARTNER = t[i].BUSINESSPARTNER, r.DOCUMENTNO = t[i].DOCUMENTNO, r.CURRENCY = t[i].CURRENCY, r.GRANDTOTAL = t[i].GRANDTOTAL, r.DISCOUNTAMOUNT = t[i].DISCOUNTAMOUNT, r.DISCOUNTDATE = t[i].DISCOUNTDATE, r.AMOUNTDUE = t[i].AMOUNTDUE, r.PAYMENTAMOUNT = t[i].PAYMENTAMOUNT, r.recid = u, u++, c.push(r) }, error: function (n) { console.log(n) } }); ft() } function ri() { t.ajax({ url: n.Application.contextUrl + "VPaySelect/GetDetail", async: !1, datatype: "Json", type: "GET", cache: !1, success: function (n) { var t = JSON.parse(n); l = t; (t != null || t != undefined) && t.BankAccount.length > 0 && (p.removeAttr("disabled"), ui(t)); o(!1) }, error: function (n) { console.log(n); o(!1) } }) } function ui(n) { var i; if (n.BankAccount != null || n.BankAccount.length > 0) { f.empty(); for (i in n.BankAccount) f.append(t('<Option value="' + n.BankAccount[i].ID + '">' + n.BankAccount[i].Value + "<\/option>")) } if (n.BusinessPartner != null || n.BusinessPartner.length > 0) { s.empty(); s.append(t('<Option value="-1"><\/option>')); for (i in n.BusinessPartner) s.append(t('<Option value="' + n.BusinessPartner[i].ID + '">' + n.BusinessPartner[i].Value + "<\/option>")) } if (n.PaymentMethod != null || n.PaymentMethod.length > 0) { h.empty(); for (i in n.PaymentMethod) h.append(t('<Option value="' + n.PaymentMethod[i].ID + '">' + n.PaymentMethod[i].Value + "<\/option>")) } o(!1) } function fi() { t.ajax({ url: n.Application.contextUrl + "VPaySelect/GetPaymentMethod", async: !1, datatype: "Json", type: "GET", cache: !1, data: { VAB_Bank_Acct_ID: parseInt(f.val()) }, success: function (n) { var i = JSON.parse(n), r; if ((i != null || i != undefined) && (i != null || i.length > 0)) { h.empty(); for (r in i) h.append(t('<Option value="' + i[r].ID + '">' + i[r].Value + "<\/option>")) } }, error: function (n) { console.log(n) } }) } function et() { var t = jQuery.grep(l.BankAccount, function (t) { return t.ID == n.Utility.Util.getValueOfInt(f.val()) }); t.length > 0 && tt.val(t[0].CurrentBalance + " " + t[0].ISOCode) } function ei() { return s != null && s.val() <= 0 ? (n.ADialog.info("SelectBusinessPartnerFirst"), o(!1), !1) : !0 } function oi() { var i = [], u; i.push(f.val()); l != null ? (u = jQuery.grep(l.BankAccount, function (t) { return t.ID == n.Utility.Util.getValueOfInt(f.val()) }), i.push(u[0].Currency_ID)) : i.push(0); i.push(s.val()); i.push(v.val()); i.push(h.val()); i.push(a.val()); i.push(y.prop("checked")); i.push(JSON.stringify(rt)); t.ajax({ url: n.Application.contextUrl + "VPaySelect/GeneratePaymentSelection", async: !1, datatype: "Json", type: "POST", cache: !1, contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (t) { var f = JSON.parse(t), i, u; (f != null || f != undefined) && (r.dispose(), i = new n.CFrame, u = new n.Apps.AForms.VPayPrint, i.setName(n.Msg.getMsg("Payment Print/Export")), i.setTitle(n.Msg.getMsg("Payment Print/Export")), i.hideHeader(!1), i.setContent(u), i.show(), u.initialize()) }, error: function (n) { console.log(n) } }) } this.windowNo; var b = t("<div style='width: 100%; height: 100%; background-color: white;'>"), r = this, k = null, ot = null, st = null, ht = null, ct = null, lt = null, at = null, vt = null, d = null, yt = null, pt = null, wt = null, bt = null, f = null, s = null, h = null, v = null, kt = null, y = null, tt = null, ut = null, a = null, u = [], e = null, p = null, g = null, it = null, c = [], rt = null, l = null, nt = 0, w = null; this.initialize = function () { dt(); o(!0); window.setTimeout(function () { gt() }, 20) }; this.getRoot = function () { return b }; this.disposeComponent = function () { windowNo = null; b = null; r = this; k = null; ot = null; st = null; ht = null; ct = null; lt = null; at = null; vt = null; d = null; yt = null; pt = null; wt = null; bt = null; f = null; s = null; h = null; v = null; kt = null; y = null; tt = null; ut = null; a = null; u = null; e = null; p = null; g = null; it = null; c = null } } n.Apps.AForms = n.Apps.AForms || {}; r.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.frame.getContentGrid().append(this.getRoot()); this.initialize() }; r.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VPaySelect = r }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function i() { function ut() { h = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); h[0].style.visibility = "hidden"; c.append(h) } function r(n) { h[0].style.visibility = n ? "visible" : "hidden" } function ft() { a = t("<div class='vis-mainContainer vis-formouterwrpdiv'>"); var r = " <div class='vis-pPrintInfo'> <div class='vis-paymentselect-field' style='margin-top: 8px;'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <div class='vis-paymentPrintChk-field'> <input type='checkbox' id='VIS_chkShowPrintPayment_" + i.windowNo + "' data-placeholder='' placeholder=' '> <label for='VIS_chkOnlyDue_" + i.windowNo + "'>" + n.Msg.getMsg("ShowPrintedPayments") + " <\/label> <\/div> <select id='VIS_PaySelection_" + i.windowNo + "'><\/select> <label style='top: 11px;'>" + n.Msg.translate(n.Env.getCtx(), "VAB_PaymentOption_ID") + " <\/label><\/div><\/div> <\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' name='vis-name vis-fieldreadonly' class='vis-fieldreadonly' disabled id='VIS_txtBankAccount_" + i.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.translate(n.Env.getCtx(), "VAB_Bank_Acct_ID") + " <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrentBal_" + i.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.getMsg("CurrentBalance") + " <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <select name='vis-name' id='VIS_cmbPaymentMethod_" + i.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "PaymentRule") + " <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrency_" + i.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.translate(n.Env.getCtx(), "VAB_Currency_ID") + " <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='number' name='vis-name'  id='VIS_txtCheckNo_" + i.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.getMsg("CheckNo") + " <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtNoOfPayments_" + i.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.getMsg("NoOfPayments") + " <\/label> <\/div><\/div><\/div> <\/div>", u = " <div class='vis-pPrintProcess'> <div class='vis-paymentPrint-field'> <input id='VIS_btnCancel_" + i.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("Cancel") + "' > <input id='VIS_btnPrint_" + i.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("Print") + "' ><\/input> <\/div> <\/div>"; a.append(t(r)).append(t(u)); c.append(a); ut(); et() } function et() { u = t("#VIS_PaySelection_" + i.windowNo); p = t("#VIS_txtBankAccount_" + i.windowNo); w = t("#VIS_txtCurrentBal_" + i.windowNo); f = t("#VIS_cmbPaymentMethod_" + i.windowNo); b = t("#VIS_txtCurrency_" + i.windowNo); e = t("#VIS_txtCheckNo_" + i.windowNo); v = t("#VIS_txtNoOfPayments_" + i.windowNo); l = t("#VIS_chkShowPrintPayment_" + i.windowNo); l.attr("disabled", !0); k = t("#VIS_btnPrint_" + i.windowNo); d = t("#VIS_btnExport_" + i.windowNo); g = t("#VIS_btnCancel_" + i.windowNo); y(!0); st() } function y(i) { var f = null; f = i ? 0 : u.val(); r(!0); t.ajax({ url: n.Application.contextUrl + "VPayPrint/GetDetail", async: !1, datatype: "Json", type: "GET", cache: !1, data: { showPrintedPayment: l.prop("checked"), VAB_PaymentSelect_ID: f, isFirstTime: i }, success: function (n) { var t = JSON.parse(n); controlsData = t; (t != null || t != undefined) && (ot(t), nt(), r(!1)) }, error: function (n) { r(!1); console.log(n) } }) } function nt() { t.ajax({ url: n.Application.contextUrl + "VPayPrint/LoadPaymentRuleInfo", async: !1, datatype: "Json", type: "GET", cache: !1, data: { paymentMethod_ID: f.val(), VAB_PaymentOption_ID: u.val(), m_VAB_Bank_Acct_ID: o, PaymentRule: f.text() }, success: function (n) { var t = JSON.parse(n); r(!1); (t != null || t != undefined) && (e.val(t.CheckNo), v.val(t.NoOfPayments)) }, error: function (n) { console.log(n) } }) } function ot(i) { var c, l, y, a, h; try { if (c = u.val(), l = 0, i.PaymentSelection != null || i.PaymentSelection.length > 0) { u.empty(); for (h in i.PaymentSelection) u.append(t('<Option value="' + i.PaymentSelection[h].ID + '">' + i.PaymentSelection[h].Value + "<\/option>")) } if (c > 0 && (u.val(c), y = "VIS_135", a = [], a[0] = new n.DB.SqlParam("@pSelectID", c), l = n.Utility.Util.getValueOfInt(s(y, a))), i.PaymentMethod != null || i.PaymentMethod.length > 0) { f.empty(); for (h in i.PaymentMethod) f.append(t('<Option value="' + i.PaymentMethod[h].ID + '">' + i.PaymentMethod[h].Value + "<\/option>")) } l > 0 && f.val(l); (i.PSelectInfo != null || i.PSelectInfo.length > 0) && (p.val(i.PSelectInfo[0].BankAccount), e.val(i.PSelectInfo[0].CheckNo), w.val(parseFloat(i.PSelectInfo[0].CurrentBalance).toLocaleString()), b.val(i.PSelectInfo[0].Currency), v.val(i.PSelectInfo[0].NoOfPayments), o = i.PSelectInfo[0].BankAccount_ID) } catch (k) { return n.ADialog.info("VPayPrintNoRecords"), r(!1), !1 } if (u.val() == null) return n.ADialog.info("VPayPrintNoRecords"), !1 } function st() { k.on("click", function () { tt() && ht() }); d.on("click", function () { tt() && at() }); g.on("click", function () { i.dispose() }); u.on("change", function () { r(!0); window.setTimeout(function () { y(!1); r(!1) }, 20) }); f.on("change", function () { r(!0); window.setTimeout(function () { nt(); r(!1) }, 20) }); l.on("click", function () { r(!0); window.setTimeout(function () { y(!1); r(!1) }, 20) }) } function tt() { try { if (u == null || u.val() <= -1 || o <= -1 || f.val() <= -1 || e.val().length <= 0) return n.ADialog.info("VPayPrintNoRecords"), !1 } catch (t) { return n.ADialog.info("VPayPrintNoRecords"), !1 } return !0 } function ht() { r(!0); t.ajax({ url: n.Application.contextUrl + "VPayPrint/Cmd_Print", async: !1, datatype: "Json", type: "GET", cache: !1, data: { paymentMethod_ID: f.val(), VAB_PaymentOption_ID: u.val(), m_VAB_Bank_Acct_ID: o, PaymentRule: f.text(), checkNo: e.val() }, success: function (t) { r(!1); var u = JSON.parse(t); if (u != null || u != undefined) n.ADialog.confirm("ContinueCheckPrint?", !0, "", "Confirm", function (n) { n ? (r(!0), window.setTimeout(function () { ct(u) }, 20)) : i.dispose() }); else return n.ADialog.info("VPayPrintNoRecords"), !1 }, error: function (n) { console.log(n) } }) } function ct(h) { var l = h.check_ID[0], c = []; c.push(f.val()); c.push(u.val()); c.push(o); c.push(f.text()); c.push(e.val()); c.push(JSON.stringify(h.check_ID)); c.push(JSON.stringify(h.m_batch)); c.push(JSON.stringify(h.m_checks)); t.ajax({ url: n.Application.contextUrl + "VPayPrint/ContinueCheckPrint", async: !1, datatype: "Json", type: "POST", contentType: "application/json; charset=utf-8", data: JSON.stringify(c), success: function (t) { var f = "VIS_152", h = [], c, l, a, e; h[0] = new n.DB.SqlParam("@BankAcct_ID", o); c = s(f, h); f = "VIS_150"; l = s(f); a = new n.APrint(c, l, parseInt(u.val()), i.windowNo); a.startPdf(null); r(!1); e = JSON.parse(t); (e != null || e != undefined) && n.ADialog.confirm("VPayPrintPrintRemittance?", !0, "", "Confirm", function (n) { n ? (r(!0), window.setTimeout(function () { lt(t) }, 20)) : i.dispose() }) }, error: function (n) { r(!1); console.log(n) } }) } function lt(f) { var e = JSON.parse(f); t.ajax({ url: n.Application.contextUrl + "VPayPrint/VPayPrintRemittance", async: !1, datatype: "Json", type: "POST", contentType: "application/json; charset=utf-8", data: f, success: function (t) { var l, f, o, h, c; r(!1); l = JSON.parse(t); e != null || e != undefined ? (f = "VIS_151", o = s(f), f = "VIS_150", h = s(f), c = new n.APrint(o, h, parseInt(u.val()), i.windowNo), c.startPdf(null), i.dispose()) : n.ADialog.info("PaymentNotProcessed") }, error: function (n) { console.log(n) } }) } function at() { r(!0); t.ajax({ url: n.Application.contextUrl + "VPayPrint/Cmd_Export", async: !1, datatype: "Json", type: "POST", cache: !1, data: { paymentMethod_ID: f.val(), VAB_PaymentOption_ID: u.val(), m_VAB_Bank_Acct_ID: o, PaymentRule: f.text(), checkNo: e.val() }, success: function (t) { r(!1); var i = JSON.parse(t); if (i != null || i != undefined) n.ADialog.confirm("VPayPrintSuccess?", !0, "", "Confirm", function (t) { if (t) { r(!0); window.setTimeout(function () { vt(i) }, 20); var u = n.Application.contextUrl + "TempDownload/" + i.filepath; window.open(u, "_blank") } }); else return n.ADialog.info("VPayPrintNoRecords"), !1 }, error: function (n) { console.log(n) } }) } function vt(i) { var u = []; u.push(JSON.stringify(i.check_ID)); u.push(JSON.stringify(i.m_batch)); u.push(JSON.stringify(i.m_checks)); t.ajax({ url: n.Application.contextUrl + "VPayPrint/VPayPrintSuccess", async: !1, datatype: "Json", type: "POST", contentType: "application/json; charset=utf-8", data: JSON.stringify(u), success: function (n) { r(!1); var t = JSON.parse(n); t != null || t != undefined }, error: function (n) { console.log(n) } }) } function yt(n, i, r) { var u = null; return t.ajax({ url: rt, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } var s; this.windowNo = n.Env.getWindowNo(); var c = t("<div style='width: 100%; height: 100%; background-color: white;'>"), i = this, a = null, u = null, p = null, w = null, f = null, b = null, e = null, v = null, l = null, k = null, d = null, g = null, o = null, h = null, it = n.Application.contextUrl, rt = it + "JsonData/JDataSetWithCode"; this.initialize = function () { ft() }; this.getRoot = function () { return c }; s = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return i && (e.param = i), yt(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; this.lockUI = function () { }; this.unlockUI = function () { }; this.disposeComponent = function () { windowNo = null; c = null; i = this } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.frame.getContentGrid().append(this.getRoot()); this.initialize() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VPayPrint = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function i() { function ut() { l = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); l[0].style.visibility = "hidden"; v.append(l) } function h(n) { l[0].style.visibility = n ? "visible" : "hidden" } function ft() { var e = t(window).height() * (92 / 100), u, f; y = t("<div class='vis-mainContainer'>"); u = " <div class='vis-pSelectInfo vis-leftsidebarouterwrap'><div class='vis-pSelectInner'> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <select id='VIS_cmbProduct_" + i.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "VAM_Product_ID") + ' <\/label><\/div><\/div> <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbinvoice_' + i.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "VAB_Invoice_ID") + ' <\/label><\/div><\/div> <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbOrder_' + i.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "VAB_Order_ID") + ' <\/label><\/div><\/div> <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbOpportunity_' + i.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "VAB_Project_ID") + " <\/label><\/div><\/div> <\/div> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input data-placeholder='' placeholder=' ' type='number' id='VIS_txtQuantity_" + i.windowNo + "' min='0' MaxLength='50'> <label>" + n.Msg.translate(n.Env.getCtx(), "Qty") + "<\/label><\/div><\/div> <\/div> <\/div> <div class='vis-paymentselect-field'> <button class='VIS_Pref_btn-2'  id='VIS_btnRefresh_" + i.windowNo + "' style='margin-top: 0px;'><i class='vis vis-refresh'><\/i><\/button> <\/div> <\/div>"; r = t("<div class='vis-pSelectIionGrid'>"); f = " <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_" + i.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("Cancel") + "' ><\/input> <input id='VIS_btnOK_" + i.windowNo + "' disabled class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("OK") + "' ><\/input> <\/div> <\/div>"; y.append(t(u)).append(r).append(t(f)); v.append(y); et() } function et() { u = t("#VIS_cmbProduct_" + i.windowNo); f = t("#VIS_cmbinvoice_" + i.windowNo); e = t("#VIS_cmbOrder_" + i.windowNo); o = t("#VIS_cmbOpportunity_" + i.windowNo); a = t("#VIS_txtQuantity_" + i.windowNo); p = t("#VIS_btnCancel_" + i.windowNo); s = t("#VIS_btnOK_" + i.windowNo); w = t("#VIS_btnRefresh_" + i.windowNo); b(); ot() } function ot() { w.on("click", function () { h(!0); r.empty(); window.setTimeout(function () { b(); h(!1) }, 20) }); s.on("click", function () { lt() }); p.on("click", function () { i.dispose() }); u.on("change", function () { u.val() > 0 ? s.removeAttr("disabled") : s.attr("disabled", !0); h(!0); window.setTimeout(function () { ht() }, 20) }); f.on("change", function () { f.val() > 0 ? (u.val() > 0 && s.removeAttr("disabled"), e.attr("disabled", !0), o.attr("disabled", !0)) : (s.attr("disabled", !0), e.removeAttr("disabled"), o.removeAttr("disabled")) }); e.on("change", function () { e.val() > 0 ? (u.val() > 0 && s.removeAttr("disabled"), f.attr("disabled", !0), o.attr("disabled", !0)) : (s.attr("disabled", !0), f.removeAttr("disabled"), o.removeAttr("disabled")) }); o.on("change", function () { o.val() > 0 ? (u.val() > 0 && s.removeAttr("disabled"), e.attr("disabled", !0), f.attr("disabled", !0)) : (s.attr("disabled", !0), e.removeAttr("disabled"), f.removeAttr("disabled")) }); a.on("change", function () { for (var i, n = 0; n < t(r[0]).children().length; n++)i = c[n].BOMQty, t(t(t(t(r[0]).children()[n]).children()[0]).children()[1]).attr("Value", i * a.val()) }) } function b() { t.ajax({ url: n.Application.contextUrl + "VBOMDrop/GetDetail", async: !1, datatype: "Json", type: "GET", cache: !1, success: function (n) { var t = JSON.parse(n); controlsData = t; (t != null || t != undefined) && st(t); h(!1) }, error: function (n) { console.log(n); h(!1) } }) } function st(n) { var i; if (n.Product != null || n.Product.length > 0) { u.empty(); u.append(t('<Option value="-1"><\/option>')); for (i in n.Product) u.append(t('<Option value="' + n.Product[i].ID + '">' + n.Product[i].Value + "<\/option>")) } if (n.Invoice != null || n.Invoice.length > 0) { f.empty(); f.append(t('<Option value="-1"><\/option>')); for (i in n.Invoice) f.append(t('<Option value="' + n.Invoice[i].ID + '">' + n.Invoice[i].Value + "<\/option>")) } if (n.Order != null || n.Order.length > 0) { e.empty(); e.append(t('<Option value="-1"><\/option>')); for (i in n.Order) e.append(t('<Option value="' + n.Order[i].ID + '">' + n.Order[i].Value + "<\/option>")) } if (n.Opportunity != null || n.Opportunity.length > 0) { o.empty(); o.append(t('<Option value="-1"><\/option>')); for (i in n.Opportunity) o.append(t('<Option value="' + n.Opportunity[i].ID + '">' + n.Opportunity[i].Value + "<\/option>")) } h(!1) } function ht() { a.val(""); t.ajax({ url: n.Application.contextUrl + "VBOMDrop/GetBOMLines", async: !1, datatype: "Json", type: "GET", cache: !1, data: { productID: parseInt(u.val()) }, success: function (n) { var t = JSON.parse(n); controlsData = t; t != null || t != undefined ? ct(t) : r.empty(); h(!1) }, error: function (n) { console.log(n); h(!1) } }) } function ct(n) { var e = "", i; r.empty(); var u = "", f = ""; for (c = n, i = 0; i < n.length; i++) { e = ""; n[i].BOMType == "P" ? (u = "<input type='checkbox' checked disabled id='VIS_chkBOMLine_" + i + "' style='height: 15px;width: auto;'><\/input>", f = "<input type='number' id='VIS_qtyBOMLine_" + i + "' style='background: pink;width:200%;' min='0' value='" + n[i].BOMQty + "'><\/input>") : n[i].BOMType == "O" ? (u = "<input type='checkbox' id='VIS_chkBOMLine_" + i + "' style='height: 15px;width: auto;'><\/input>", f = "<input type='number' disabled id='VIS_qtyBOMLine_" + i + "' style='background: #FFF5FF;width:200%;'  min='0' value='" + n[i].BOMQty + "'><\/input>") : (u = " <input type='radio' name='vis-radiolist' checked id='VIS_chkBOMLine_" + i + "' style='height: 15px;width: auto;'><\/input>", f = "<input type='number' id='VIS_qtyBOMLine_" + i + "' style='background: pink;width:200%;' min='0' value='" + n[i].BOMQty + "'><\/input>"); e += "<div class='vis-bomlinesdata'> <div style='float:left;width: 50%;'> <label style='margin: 5px;width:100%;'>" + n[i].ProductName + "<\/label>" + f + " <\/div> <div style='float:right;'>" + u + " <label style='margin-right:5px;'>" + n[i].BOMTypeName + "<\/label> <\/div> <\/div>"; r.append(t(e)); t("#VIS_chkBOMLine_" + i).on("click", function () { var n = t(t(t(t(this).parent()).parent().children()[0]).children()[1]); t(this).prop("checked") ? (n.css("background", "pink"), n.removeAttr("disabled")) : (n.css("background", "#FFF5FF"), n.attr("disabled", !0)) }) } } function lt() { var l = [], s, a; for (l.push(u.val()), l.push(f.val()), l.push(e.val()), l.push(o.val()), s = 0; s < t(r[0]).children().length; s++)a = t(t(t(t(r[0]).children()[s]).children()[1]).children()[0]).prop("checked"), a ? (c[s].IsSelected = !0, c[s].BOMQty = t(t(t(t(r[0]).children()[s]).children()[0]).children()[1]).val()) : c[s].IsSelected = !1; l.push(JSON.stringify(c)); t.ajax({ url: n.Application.contextUrl + "VBOMDrop/SaveRecord", async: !1, datatype: "Json", type: "POST", cache: !1, contentType: "application/json; charset=utf-8", data: JSON.stringify(l), success: function (t) { JSON.parse(t) ? i.dispose() : n.ADialog.info("RecordNotSaved") }, error: function (n) { console.log(n); h(!1) } }) } this.windowNo = null; var v = t("<div style='width: 100%; height: 100%; background-color: white;'>"), i = this, y = null, k = null, r = null, d = null, g = null, nt = null, tt = null, it = null, rt = null, u = null, f = null, e = null, o = null, a = null, s = null, p = null, l = null, c = [], w = null; this.initialize = function () { ut(); h(!0); window.setTimeout(function () { ft() }, 20) }; this.getRoot = function () { return v }; this.disposeComponent = function () { v = null; i = null; y = null; k = null; r = null; d = null; g = null; nt = null; tt = null; it = null; rt = null; u = null; f = null; e = null; o = null; a = null; s = null; p = null; l = null; c = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.frame.getContentGrid().append(this.getRoot()); this.initialize() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VBOMDrop = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function i() { function at() { e = t('<div class="vis-busyindicatorouterwrap" style="visibility: hidden;"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); e[0].style.visibility = "hidden"; o.append(e) } function l(n) { e[0].style.visibility = n ? "visible" : "hidden" } function vt() { var ti = t(window).height() * (96 / 100), dt = n.MLookupFactory.get(n.Env.getCtx(), 0, 0, n.DisplayType.TableDir, "VAF_Org_ID", 0, !1, null), et, e, r, nt, tt, ut, ft, kt; a = new n.Controls.VComboBox("VAF_Org_ID", !1, !1, !0, dt, 50); et = n.MLookupFactory.get(n.Env.getCtx(), 0, 0, n.DisplayType.List, "MovementType", 189, !1, null); v = new n.Controls.VComboBox("MovementType", !1, !1, !0, et, 29); var c = t("<div class='input-group vis-input-wrap'>"), y = t("<div class='vis-control-wrap'>"), p = t("<div class='input-group-append'>"), gt = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.Search, "VAM_Locator_ID", 0, !1, ""); u = new n.Controls.VTextBoxButton("VAM_Locator_ID", !1, !1, !0, n.DisplayType.Search, gt); c.append(y); y.append(u.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); c.append(p); p.append(u.getBtn(0)); p.append(u.getBtn(1)); u.getBtn(0).addClass("vis-lookupButtons"); u.getBtn(1).addClass("vis-lookupButtons"); var w = t("<div class='input-group vis-input-wrap'>"), b = t("<div class='vis-control-wrap'>"), k = t("<div class='input-group-append'>"), ni = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.Search, "VAM_Product_ID", 0, !1, ""); f = new n.Controls.VTextBoxButton("VAM_Product_ID", !1, !1, !0, n.DisplayType.Search, ni); w.append(b); b.append(f.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); w.append(k); k.append(f.getBtn(0)); k.append(f.getBtn(1)); f.getBtn(0).addClass("vis-lookupButtons"); f.getBtn(1).addClass("vis-lookupButtons"); s = t("<div class='vis-mainContainer'>"); e = t("<div class='vis-pSelectInfo vis-leftsidebarouterwrap'>"); r = t("<div class='vis-pSelectInner'>"); e.append(r); var ot = t("<div class='vis-paymentselect-field'>"), st = t("<div class='input-group vis-input-wrap'>"), d = t("<div class='vis-control-wrap'>"); ot.append(st); st.append(d); d.append(a.getControl()); d.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "VAF_Org_ID") + " <\/label>")); r.append(ot); var ht = t("<div class='vis-paymentselect-field'>"), ct = t("<div class='input-group vis-input-wrap'>"), g = t("<div class='vis-control-wrap'>"); ht.append(ct); ct.append(g); g.append(v.getControl()); g.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "MovementType") + " <\/label>")); r.append(ht); nt = t("<div class='vis-paymentselect-field'>"); nt.append(c); y.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "VAM_Locator_ID") + " <\/label>")); r.append(nt); tt = t("<div class='vis-paymentselect-field'>"); tt.append(w); b.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "Product") + " <\/label>")); r.append(tt); var lt = t("<div class='vis-paymentselect-field'>"), at = t("<div class='input-group vis-input-wrap'>"), it = t("<div class='vis-control-wrap'>"); it.append(t("<input  id='VIS_dtpFromDate" + i.windowNo + "'type='date'>")); it.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "DateFrom") + " <\/label>")); lt.append(at); at.append(it); r.append(lt); var vt = t("<div class='vis-paymentselect-field'>"), bt = t("<div class='input-group vis-input-wrap'>"), rt = t("<div class='vis-control-wrap'>"); rt.append(t("<input  id='VIS_dtpToDate" + i.windowNo + "'type='date'>")); rt.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "DateTo") + " <\/label>")); vt.append(bt); bt.append(rt); r.append(vt); ut = t("<div class='vis-paymentselect-field'>"); ut.append(t("<button class='VIS_Pref_btn-2' id='VIS_btnRefresh_" + i.windowNo + "' style='margin-top: 0px;'><i class='vis vis-refresh'><\/i><\/button>")); e.append(ut); ft = t("<div class='vis-paymentselect-field'>"); ft.append(t("<button class='VIS_Pref_btn-2' id='VIS_btnZoom_" + i.windowNo + "' style='margin-top: 0px;'><i class='vis vis-find'><\/i><\/button>")); e.append(ft); h = t("<div class='vis-pSelectIionGrid'>"); kt = " <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_" + i.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("Cancel") + "' ><\/input> <input id='VIS_btnOK_" + i.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("OK") + "' ><\/input> <\/div> <\/div>"; s.append(e).append(h).append(t(kt)); o.append(s); yt(); window.setTimeout(function () { wt() }, 20); pt(); l(!0) } function yt() { k = t("#VIS_dtpFromDate" + i.windowNo); d = t("#VIS_dtpToDate" + i.windowNo); y = t("#VIS_btnRefresh_" + i.windowNo); g = t("#VIS_btnZoom_" + i.windowNo); p = t("#VIS_btnOK_" + i.windowNo); w = t("#VIS_btnCancel_" + i.windowNo); var n = new Date, r = ("0" + n.getDate()).slice(-2), u = ("0" + (n.getMonth() + 1)).slice(-2), f = n.getFullYear() + "-" + u + "-" + r } function pt() { y.on("click", function () { nt() }); g.on("click", function () { bt() }); p.on("click", function () { nt() }); w.on("click", function () { i.dispose() }) } function wt() { n.AEnv.getGridWindow(i.windowNo, 223, function (u) { var e, f; if (u.error != null) { n.ADialog.error(u.error); self.dispose(); self = null; return } (e = t.parseJSON(u.result), n.context.setContextOfWindow(t.parseJSON(u.wCtx), i.windowNo), f = new n.GridWindow(e), f != null) && (b = f.getTabs()[0], r = new n.GridController(!1), r.initGrid(!0, i.windowNo, i, b), r.setVisible(!0), window.innerHeight > 700 ? r.sizeChanged(window.innerHeight - 230, window.innerWidth) : r.sizeChanged(window.innerHeight - 215, window.innerWidth), h.append(r.getRoot()), r.activate(), c = new n.Query, c.addRestriction("VAF_Client_ID", n.Query.prototype.EQUAL, n.context.getVAF_Client_ID())) }) } function nt() { var e = null, t, i; e = c != null ? jQuery.extend(!0, {}, c) : new n.Query; t = a.getValue(); (t == null || t.toString() == "-1" || t.toString().trim().length == 0) && (t = null); t != null && t.toString().length > 0 && e.addRestriction("VAF_Org_ID", n.Query.prototype.EQUAL, t); t = u.getValue(); t != null && t.toString().length > 0 && e.addRestriction("VAM_Locator_ID", n.Query.prototype.EQUAL, t); t = f.getValue(); t != null && t.toString().length > 0 && e.addRestriction("VAM_Product_ID", n.Query.prototype.EQUAL, t); t = v.getValue(); (t == null || t.toString() == "-1" || t.toString().trim().length == 0) && (t = null); t != null && t.toString().length > 0 && e.addRestriction("MovementType", n.Query.prototype.EQUAL, t); i = k.val().toString(); i != null && i.length > 0 && (i = new Date(i), e.addRestriction("TRUNC(MovementDate,'DD')", n.Query.prototype.GREATER_EQUAL, i)); i = d.val().toString(); i != null && i.length > 0 && (i = new Date(i), e.addRestriction("TRUNC(MovementDate,'DD')", n.Query.prototype.LESS_EQUAL, i)); b.setQuery(e); r.query(0, 0, !1) } function bt() { var u = 0, f = null, e = null, o = [], t = n.context.getContextAsInt(i.windowNo, "VAM_Inv_InOutLine_ID"), s, h; if (t != 0 ? (n.context.getContext(i.windowNo, "MovementType").equals("C-") ? u = 169 : n.context.getContext(i.windowNo, "MovementType").equals("C+") ? u = 409 : n.context.getContext(i.windowNo, "MovementType").equals("V+") ? u = 184 : n.context.getContext(i.windowNo, "MovementType").equals("V-") && (u = 411), f = "VAM_Inv_InOut_ID", e = "VIS_140", o[0] = new n.DB.SqlParam("@lineID", t)) : (t = n.context.getContextAsInt(i.windowNo, "VAM_InventoryLine_ID"), t != 0 ? (u = 168, f = "VAM_Inventory_ID", e = "VIS_141", o[0] = new n.DB.SqlParam("@lineID", t)) : (t = n.context.getContextAsInt(i.windowNo, "VAM_InvTrf_Line_ID"), t != 0 ? (u = 170, f = "VAM_InventoryTransfer_ID", e = "VIS_142", o[0] = new n.DB.SqlParam("@lineID", t)) : (t = n.context.getContextAsInt(i.windowNo, "VAM_ProductionLine_ID"), t != 0 && (u = 191, f = "VAM_Production_ID", e = "VIS_143", o[0] = new n.DB.SqlParam("@lineID", t))))), u != 0) if (s = 0, h = 0, h = r.getSelectedRows(), h.length > 0) s = n.Utility.Util.getValueOfInt(tt(e, null, null)), dt(f, t, u, s); else return alert(n.Msg.getMsg("NoRecordSelected")) } function kt(n, i, r) { var u = null; return t.ajax({ url: lt, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function dt(t, i, r, u) { var f = new n.Query; f.addRestriction(t, n.Query.prototype.EQUAL, u); n.viewManager.startWindow(r, f) } var tt; this.windowNo = null; var o = t("<div style='width: 100%; height: 100%; background-color: white;'>"), i = this, s = null, it = null, h = null, rt = null, ut = null, ft = null, et = null, a = null, v = null, k = null, d = null, ot = [], st = null, y = null, g = null, p = null, w = null, ht = [], e = null, u = null, f = null, r = null, c = null, b = null, ct = n.Application.contextUrl, lt = ct + "JsonData/JDataSetWithCode"; this.initialize = function () { at(); l(!0); window.setTimeout(function () { vt(); l(!1) }, 20) }; tt = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return kt(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; this.getRoot = function () { return o }; this.dataStatusChanged = function () { }; this.setBusy = function (n) { l(n) }; this.disposeComponent = function () { windowNo = null; o = null; i = this; s = null; it = null; $divBankAccount = null; $divCurrentBalance = null; $divBusinessPartner = null; $divOnlyDueInvoice = null; $divPaymentDate = null; $divPaymentMethod = null; h = null; rt = null; ut = null; ft = null; et = null; $cmbBankAccount = null; $cmbBusinessPartner = null; $cmbPaymentMethod = null; $cmbPaymentDate = null; $lblCurrentBal = null; $chkOnlyDueInvoice = null; $txtCurrentBal = null; $lblMsg = null; $txtPaymentAmount = null; ot = null; st = null; y = null; p = null; w = null; ht = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.frame.getContentGrid().append(this.getRoot()); this.initialize() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VTrxMaterial = i }(VIS, jQuery), function (n) { function fi() { n.CalloutEngine.call(this, "VIS.TestClass") } function u() { n.CalloutEngine.call(this, "VIS.CalloutOrder") } function ei() { n.CalloutEngine.call(this, "VIS.CalloutInventoryMove") } function oi() { n.CalloutEngine.call(this, "VIS.CalloutAssignment") } function h() { n.CalloutEngine.call(this, "VIS.CalloutCashJournal") } function ht() { n.CalloutEngine.call(this, "VIS.CalloutSetAttributeCode") } function k() { n.CalloutEngine.call(this, "VIS.CalloutProduct") } function ct() { n.CalloutEngine.call(this, "VIS.CalloutProject") } function d() { n.CalloutEngine.call(this, "VIS.CalloutBankStatement") } function c() { n.CalloutEngine.call(this, "VIS.CalloutOfferSerIncluded") } function l() { n.CalloutEngine.call(this, "VIS.CalloutOfferServices") } function g() { n.CalloutEngine.call(this, "VIS.CalloutCheckInOut") } function y() { n.CalloutEngine.call(this, "VIS.CalloutInventory") } function o() { n.CalloutEngine.call(this, "VIS.CalloutInvoice") } function a() { n.CalloutEngine.call(this, "VIS.CalloutInvoiceBatch") } function si() { n.CalloutEngine.call(this, "VIS.CalloutMovement") } function hi() { n.CalloutEngine.call(this, "VIS.CalloutObjectData") } function lt() { n.CalloutEngine.call(this, "VIS.CalloutOffer") } function nt() { n.CalloutEngine.call(this, "VIS.CalloutGLJournal") } function tt() { n.CalloutEngine.call(this, "VIS.CalloutProduction") } function it() { n.CalloutEngine.call(this, "VIS.CalloutRequest") } function rt() { n.CalloutEngine.call(this, "VIS.CalloutRequisition") } function at() { n.CalloutEngine.call(this, "VIS.CalloutPaySelection") } function ut() { n.CalloutEngine.call(this, "VIS.CalloutOrderLine") } function ci() { n.CalloutEngine.call(this, "VIS.CalloutOrderlineRecording") } function li() { n.CalloutEngine.call(this, "VIS.CalloutCurrency") } function ai() { n.CalloutEngine.call(this, "VIS.CalloutContractQty") } function vi() { n.CalloutEngine.call(this, "VIS.CalloutContractProduct") } function p() { n.CalloutEngine.call(this, "VIS.CalloutContract") } function vt() { n.CalloutEngine.call(this, "VIS.copyname") } function yi() { n.CalloutEngine.call(this, "VIS.CalloutUserTimeRec") } function yt() { n.CalloutEngine.call(this, "VIS.CalloutTimeExpense") } function pt() { n.CalloutEngine.call(this, "VIS.CalloutTeamForcast") } function wt() { n.CalloutEngine.call(this, "VIS.CalloutTaxAmt") } function pi() { n.CalloutEngine.call(this, "VIS.CalloutTax") } function wi() { n.CalloutEngine.call(this, "VIS.CalloutSetBP") } function bi() { n.CalloutEngine.call(this, "VIS.CalloutProjectLine") } function ki() { n.CalloutEngine.call(this, "VIS.CalloutProductToOpportunity") } function di() { n.CalloutEngine.call(this, "VIS.CalloutPriceListOpp") } function s() { n.CalloutEngine.call(this, "VIS.CalloutInOut") } function bt() { n.CalloutEngine.call(this, "VIS.CalloutPaymentAllocate") } function v() { n.CalloutEngine.call(this, "VIS.CalloutPayment") } function w() { n.CalloutEngine.call(this, "VIS.CalloutOrderContract") } function ft() { n.CalloutEngine.call(this, "VIS.CalloutKPI") } function b() { n.CalloutEngine.call(this, "VIS.CalloutDashboard") } function et() { n.CalloutEngine.call(this, "VIS.CalloutDashboardView") } function gi() { n.CalloutEngine.call(this, "VIS.CalloutService") } function kt() { n.CalloutEngine.call(this, "VIS.CalloutSetReadOnly") } function nr() { n.CalloutEngine.call(this, "VIS.CalloutSetContract") } function dt() { n.CalloutEngine.call(this, "VIS.CallOutWorkflow ") } function tr() { n.CalloutEngine.call(this, "VIS.CalloutSalesQuotation ") } function ir() { n.CalloutEngine.call(this, "VIS.CalloutSetDate ") } function rr() { n.CalloutEngine.call(this, "VIS.CalloutDisplayButton ") } function ur() { n.CalloutEngine.call(this, "VIS.CalloutMoveConfirmLine") } function gt() { n.CalloutEngine.call(this, "VIS.CalloutDocumentType") } function fr() { n.CalloutEngine.call(this, "VIS.CalloutProjectCBPartner") } function er() { n.CalloutEngine.call(this, "VIS.CalloutPaymentTypeSO") } function or() { n.CalloutEngine.call(this, "VIS.CalloutMCampaign") } function ni() { n.CalloutEngine.call(this, "VIS.CalloutMVARRequest") } function ot() { n.CalloutEngine.call(this, "VIS.CalloutModuleMgmt") } function sr() { n.CalloutEngine.call(this, "VIS.CalloutPriclistUOM") } function st() { n.CalloutEngine.call(this, "VIS.CalloutTaxAmount") } function hr() { n.CalloutEngine.call(this, "VIS.CalloutProdCatVal") } function cr() { n.CalloutEngine.call(this, "VIS.CalloutProdTypeVal") } function lr() { n.CalloutEngine.call(this, "VIS.CalloutProfitTax") } function ar() { n.CalloutEngine.call(this, "VIS.CalloutBPartner") } function vr() { n.CalloutEngine.call(this, "VIS.CalloutshipLine") } function yr() { n.CalloutEngine.call(this, "VIS.CalloutRecurring") } function pr() { n.CalloutEngine.call(this, "VIS.CalloutProductionLine") } function ti() { n.CalloutEngine.call(this, "VIS.CalloutProfitLoss") } function wr() { n.CalloutEngine.call(this, "VIS.CalloutShipReceiptConfirmLine") } function ri() { n.CalloutEngine.call(this, "VIS.CalloutCashJournalLine") } function br() { n.CalloutEngine.call(this, "VIS.CalloutUOMConversion") } function kr() { n.CalloutEngine.call(this, "VIS.CalloutIncoTerm") } function gr() { n.CalloutEngine.call(this, "VIS.CalloutBlanketOrderRef") } function ui(n) { var t = new Date(n); return t.setMinutes(-t.getTimezoneOffset() + t.getMinutes()), t.toISOString() } function nu() { n.CalloutEngine.call(this, "VIS.CalloutLocatorPC") } function tu() { n.CalloutEngine.call(this, "VIS.CalloutSetDates") } function iu() { n.CalloutEngine.call(this, "VIS.CalloutLandedCost") } function ru() { n.CalloutEngine.call(this, "VIS.CalloutRFQ") } var i = n.Logging.Level, t = n.Utility.Util, f = !1, r = 0; n.Utility.inheritPrototype(fi, n.CalloutEngine); fi.prototype.set = function (n, t, i, r, u) { return i.setValue("Description", u), "" }; n.Model.TestClass = fi; n.Utility.inheritPrototype(u, n.CalloutEngine); u.prototype.DocType = function (r, u, f, e, o, s) { var d = "PR", y = "WR", it = "F", b, k, a, g, tt, c, ft; if (this.isCalloutActive() || o == null || o.toString() == "" || (b = t.getValueOfInt(o), b == null || b == 0)) return ""; this.setCalloutActive(!0); k = t.getValueOfString(f.getValue("DocumentNo")); a = k == null; !a && k.startsWith("<") && k.endsWith(">") && (a = !0); var rt = t.getValueOfInt(f.getValue("VAB_DocTypes_ID")), p = "SELECT d.DocSubTypeSO,d.HasCharges,'N',d.IsDocNoControlled,s.CurrentNext,s.CurrentNextSys,s.VAF_Record_Seq_ID,d.IsSOTrx, d.IsReturnTrx, d.value, d.IsBlanketTrx FROM VAB_DocTypes d LEFT OUTER JOIN VAF_Record_Seq s ON (d.DocNoSequence_ID=s.VAF_Record_Seq_ID) WHERE VAB_DocTypes_ID=@param1", h = null, v = []; try { g = 0; a || t.getValueOfInt(rt) == 0 || (v[0] = new n.DB.SqlParam("@param1", rt), h = n.DB.executeReader(p, v), h.read() && (g = t.getValueOfInt(h.get("currentnextsys"))), h.close()); v[0] = new n.DB.SqlParam("@param1", b); h = n.DB.executeReader(p, v); v.length = 0; v = null; var l = "", w = !0, nt = !1, ut = ""; if (h.read() && (l = h.get("docsubtypeso"), ut = h.get("value"), l == null && (l = "--"), r.setContext(u, "OrderType", l), r.setContext(u, "DocTypeValue", ut), l == "BO" ? (r.setContext(u, "BlanketOrderType", l), f.setValue("BlanketOrderType", l)) : (r.setContext(u, "BlanketOrderType", "OO"), f.setValue("BlanketOrderType", "OO")), !l == "SO" && f.setValue("IsDropShip", "N"), "N" == h.get("issotrx") && (w = !1), nt = h.get("isreturntrx") == "Y" ? !0 : !1, nt ? l == y ? f.setValue("DeliveryRule", it) : f.setValue("DeliveryRule", "M") : (l == y ? f.setValue("DeliveryRule", it) : l == d ? f.setValue("DeliveryRule", "R") : f.setValue("DeliveryRule", "A"), l == y || l == d || l == "WI" ? f.setValue("InvoiceRule", "I") : f.setValue("InvoiceRule", "D"), l == y ? f.setValue("PaymentRule", "B") : f.setValue("PaymentRule", "P"), r.setContext(u, "HasCharges", t.getValueOfString(h.get("hascharges")))), h.get("isdocnocontrolled") == "Y" && (a || g == t.getValueOfInt(h.get("VAF_Record_Seq_id")) || (a = !0), a && (n.Ini.getLocalStorage(n.IniConstants.P_VIENNASYS) && r.getVAF_Client_ID() < 1e6 ? f.setValue("DocumentNo", "<" + h.tables[0].rows[0].cells.currentnextsys + ">") : f.setValue("DocumentNo", "<" + h.tables[0].rows[0].cells.currentnext + ">")))), h.close(), nt) return this.setCalloutActive(!1), ""; l == y || l == d || (tt = r.getContextAsInt(u, "VAB_BusinessPartner_ID"), p = "SELECT PaymentRule,VAB_PaymentTerm_ID,InvoiceRule,DeliveryRule,FreightCostRule,DeliveryViaRule, PaymentRulePO,PO_PaymentTerm_ID FROM VAB_BusinessPartner WHERE VAB_BusinessPartner_ID=" + tt, tt != 0 && (h = n.DB.executeReader(p, null)), h.read() && (c = h.get(w ? "paymentrule" : "paymentrulepo"), c != null && c.length != 0 && ((w && c == "B" || c == "S" || c == "U") && (c = "P"), w || c != "B" || (c = "P"), f.setValue("PaymentRule", c)), ft = h.get(w ? "VAB_Paymentterm_id" : "po_paymentterm_id"), h != null && f.setValue("VAB_PaymentTerm_ID", ft), c = h.get("invoicerule"), c != null && c.length != 0 && f.setValue("InvoiceRule", c), c = h.get("deliveryrule"), c != null && c.length != 0 && f.setValue("DeliveryRule", c), c = h.get("freightcostrule"), c != null && c.length != 0 && f.setValue("FreightCostRule", c), c = h.get("deliveryviarule"), c != null && c.length != 0 && f.setValue("DeliveryViaRule", c)), h.close()) } catch (et) { return this.setCalloutActive(!1), h != null && (h.close(), h = null), this.log.log(i.SEVERE, p, et), et } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; u.prototype.BlanketOrderLine = function (i, r, u, f, e, o) { var s = null, y, nt, rt, p, ut, ft, g; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (y = 0, e != null && (y = t.getValueOfInt(e.toString())), y == 0) return ""; if (this.setCalloutActive(!0), nt = y.toString(), s = n.dataContext.getJSONRecord("MVABOrderLine/GetOrderLine", nt), s != null) { var l = t.getValueOfInt(s.VAM_Product_ID), et = t.getValueOfInt(s.VAB_Charge_ID), a = t.getValueOfInt(s.Qty), h = t.getValueOfInt(s.QtyOrdered), v = t.getValueOfInt(s.QtyReleased), tt = t.getValueOfDouble(s.PriceList), w = t.getValueOfDouble(s.PriceActual), c = t.getValueOfDouble(s.VAB_UOM_ID), it = t.getValueOfDouble(s.Discount), b = t.getValueOfDouble(s.PriceEntered), k = t.getValueOfInt(s.VAM_PFeature_SetInstance_ID), d = t.getValueOfDouble(s.VAB_TaxRate_ID); QtyEntered = t.getValueOfDecimal(a); paramStr = c.toString().concat(","); rt = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr); p = QtyEntered.toFixed(t.getValueOfInt(rt)); QtyEntered != p && (this.log.fine("Corrected QtyEntered Scale UOM=" + c + "; QtyEntered=" + QtyEntered + "->" + p), QtyEntered = p); paramStr = l.toString().concat(",", c.toString(), ",", QtyEntered.toString()); ut = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr); h = ut; h == null && (h = QtyEntered); ft = QtyEntered != h; ft && (paramStr = l.toString().concat(",", c.toString(), ",", v.toString()), g = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", paramStr), g != null && (v = g)); l != 0 && l != null ? u.setValue("VAM_Product_ID", l) : u.setValue("VAB_Charge_ID", et); a != 0 && a != null && u.setValue("QtyEntered", a); tt != null && u.setValue("PriceList", tt); w != null && (u.setValue("PriceActual", w), u.setValue("LineNetAmt", w * a)); b != null && (u.setValue("PriceEntered", b), u.setValue("PriceEntered", b)); it != null && u.setValue("Discount", it); c != 0 && c != null && u.setValue("VAB_UOM_ID", c); h != 0 && h != null && v != null && u.setValue("QtyBlanket", h + v - v); k != 0 && k != null && u.setValue("VAM_PFeature_SetInstance_ID", k); d != 0 && d != null && u.setValue("VAB_TaxRate_ID", d) } } catch (ot) { return this.setCalloutActive(!1), ot } return this.setCalloutActive(!1), o = null, this.Qty(i, r, u, f, u.getValue("QtyEntered")) }; u.prototype.BlanketOrder = function (i, r, u, f, e, o) { var s = null, h, rt, it; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (h = 0, e != null && (h = t.getValueOfInt(e.toString())), h == 0) return ""; if (this.setCalloutActive(!0), rt = i.isSOTrx(r), it = h.toString(), s = n.dataContext.getJSONRecord("MOrder/GetOrder", it), s != null) { var l = t.getValueOfDouble(s.VAB_BusinessPartner_ID), a = t.getValueOfDouble(s.VAM_PriceList_ID), v = t.getValueOfDouble(s.VAM_Warehouse_ID), y = t.getValueOfDouble(s.VAB_PaymentTerm_ID), p = t.getValueOfDouble(s.PaymentRule), w = t.getValueOfDouble(s.VAB_Payment_ID), b = t.getValueOfDouble(s.VA009_PaymentMethod_ID), k = t.getValueOfDouble(s.VAB_Currency_ID), d = t.getValueOfDouble(s.VAB_Project_ID), g = t.getValueOfDouble(s.VAB_Promotion_ID); c; var c = t.getValueOfDouble(s.VAB_ProjectRef_ID), nt = t.getValueOfDouble(s.SalesRep_ID), tt = t.getValueOfDouble(s.PriorityRule); l != 0 && l != null && u.setValue("VAB_BusinessPartner_ID", l); a != 0 && a != null && u.setValue("VAM_PriceList_ID", a); v != 0 && v != null && u.setValue("VAM_Warehouse_ID", v); y != 0 && y != null && u.setValue("VAB_PaymentTerm_ID", y); p != 0 && p != null && u.setValue("PaymentRule", p); w != 0 && w != null && u.setValue("VAB_Payment_ID", w); b != 0 && b != null && u.setValue("VA009_PaymentMethod_ID", b); k != 0 && k != null && u.setValue("VAB_Currency_ID", k); d != 0 && d != null && u.setValue("VAB_Project_ID", d); g != 0 && g != null && u.setValue("VAB_Promotion_ID", g); c != 0 && c != null && u.setValue("VAB_ProjectRef_ID", c); nt != 0 && nt != null && u.setValue("SalesRep_ID", nt); tt != 0 && tt != null && u.setValue("PriorityRule", tt); u.getField("VAB_IncoTerm_ID") != null && u.setValue("VAB_IncoTerm_ID", t.getValueOfInt(s.VAB_IncoTerm_ID)) } } catch (ut) { return this.setCalloutActive(!1), ut } return this.setCalloutActive(!1), o = null, this.BPartner(i, r, u, f, u.getValue("VAB_BusinessPartner_ID")) }; u.prototype.BPartner = function (i, r, u, f, e, o) { var c = null, h = null, vt, yt, b, et, ot, g, st, ht, v, k, ct, nt, lt, ut, pt, rt, tt, it, s, at, wt, a, bt; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { var p = 0, l = "N", ft = "N"; if ((e != null && (p = t.getValueOfInt(e.toString())), p == 0) || (vt = t.getValueOfBoolean(u.getValue("IsReturnTrx")), vt)) return ""; this.setCalloutActive(!0); var w = !1, k = "VA009_", d = i.isSOTrx(r), h = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", k); if (h != null && (w = h.VA009_), k = w.toString() + "," + p, h = n.dataContext.getJSONRecord("MBPartner/GetBPartnerOrderData", k), h != null) { if (yt = t.getValueOfInt(u.getValue("VAM_PriceList_ID")), a = t.getValueOfDecimal(u.getValue("VAB_Order_Blanket")), yt > 0 && a > 0 || (b = t.getValueOfInt(d ? h.VAM_PriceList_ID : h.PO_PriceList_ID), b != 0 && u.setValue("VAM_PriceList_ID", b)), u.setValue("Bill_BPartner_ID", p), et = t.getValueOfInt(h.Bill_Location_ID), et == 0 ? (ot = t.getValueOfInt(h.Bill_BPartner_ID), ot > 0 && u.setValue("Bill_BPartner_ID", ot)) : u.setValue("Bill_Location_ID", et), g = t.getValueOfInt(h.VAB_BPart_Location_ID), p.toString() == i.getContext("VAB_BusinessPartner_ID") && (st = i.getContext("VAB_BPart_Location_ID"), st.length > 0 && (g = t.getValueOfInt(st))), g == 0 ? u.setValue("VAB_BPart_Location_ID", null) : (u.setValue("VAB_BPart_Location_ID", g), "Y" == t.getValueOfString(h.IsShipTo) && u.setValue("Bill_Location_ID", g)), ht = t.getValueOfInt(h.SalesRep_ID), ht > 0 && u.setValue("SalesRep_ID", ht), w) { var y = t.getValueOfInt(h.VA009_PaymentMethod_ID); a < 0 && (v = n.dataContext.getJSONRecord("MBPartner/GetBPDetails", p), v != null && (l = t.getValueOfString(v.IsVendor), ft = t.getValueOfString(v.IsCustomer), d ? l == "Y" ? (y = 0, c = null, ft == "Y" && (y = t.getValueOfInt(v.VA009_PaymentMethod_ID), c = t.getValueOfString(v.VA009_PAYMENTBASETYPE))) : ft == "Y" && (y = t.getValueOfInt(v.VA009_PaymentMethod_ID), c = t.getValueOfString(v.VA009_PAYMENTBASETYPE)) : l == "Y" ? (y = t.getValueOfInt(v.VA009_PO_PaymentMethod_ID), c = t.getValueOfString(v.VA009_PAYMENTBASETYPEPO)) : (y = 0, c = null))); y == 0 ? (a = t.getValueOfInt(u.getValue("VAB_Order_Blanket")), a > 0 && (k = w.toString() + "," + a.toString(), h = n.dataContext.getJSONRecord("MOrder/GetPaymentMethod", k), h != null && (ct = t.getValueOfInt(h.VA009_PaymentMethod_ID), ct > 0 && (u.setValue("VA009_PaymentMethod_ID", ct), c = t.getValueOfString(h.VA009_PaymentBaseType), c != "W" && c != null && (u.setValue("PaymentMethod", c), l == "N" ? u.setValue("PaymentRule", c) : u.setValue("PaymentRulePO", c)))))) : y == 0 ? u.setValue("VA009_PaymentMethod_ID", null) : (u.setValue("VA009_PaymentMethod_ID", y), c != "W" && c != null ? (u.setValue("PaymentMethod", c), l == "N" ? u.setValue("PaymentRule", c) : u.setValue("PaymentRulePO", c)) : (u.setValue("PaymentMethod", "T"), l == "N" ? u.setValue("PaymentRule", "T") : u.setValue("PaymentRulePO", "T"))) } nt = t.getValueOfInt(h.VAF_UserContact_ID); p.toString() == i.getContext("VAB_BusinessPartner_ID") && (lt = i.getContext("VAF_UserContact_ID"), lt.length > 0 && (nt = t.getValueOfInt(lt))); nt == 0 ? u.setValue("VAF_UserContact_ID", null) : (u.setValue("VAF_UserContact_ID", nt), u.setValue("Bill_User_ID", nt)); d && (ut = t.getValueOfString(h.CreditStatusSettingOn), ut == "CH" ? (tt = t.getValueOfDouble(h.SO_CreditLimit), tt != 0 && (it = t.getValueOfDouble(h.CreditAvailable), it <= 0 && n.ADialog.info("CreditOver"))) : (pt = t.getValueOfInt(u.getValue("VAB_BPart_Location_ID")), rt = n.dataContext.getJSONRecord("MBPartner/GetLocationData", pt.toString()), rt != null && (ut = t.getValueOfString(rt.CreditStatusSettingOn), ut == "CL" && (tt = t.getValueOfDouble(rt.SO_CreditLimit), tt != 0 && (it = t.getValueOfDouble(rt.CreditAvailable), it <= 0 && n.ADialog.info("CreditOver")))))); s = t.getValueOfString(h.POReference); s != null && s.length != 0 && u.setValue("POReference", s); s = t.getValueOfString(h.SO_Description); s != null && s.trim().length != 0 && u.setValue("Description", s); s = t.getValueOfString(h.IsDiscountPrinted); s != null && s.length != 0 ? u.setValue("IsDiscountPrinted", s) : u.setValue("IsDiscountPrinted", "N"); at = i.getContext("OrderType"); u.setValue("InvoiceRule", "D"); u.setValue("DeliveryRule", "A"); w ? c != "W" && c != null ? l == "N" ? u.setValue("PaymentRule", c) : u.setValue("PaymentRulePO", c) : (l == "N" ? u.setValue("PaymentRule", "T") : u.setValue("PaymentRulePO", "T"), u.setValue("PaymentMethod", "T")) : u.setValue("PaymentRule", "P"); at == "PR" ? (u.setValue("InvoiceRule", "I"), u.setValue("DeliveryRule", "R")) : at == "WR" ? w ? c != "W" && c != null ? l == "N" ? u.setValue("PaymentRule", c) : u.setValue("PaymentRulePO", c) : (l == "N" ? u.setValue("PaymentRule", "T") : u.setValue("PaymentRulePO", "T"), u.setValue("PaymentMethod", "T")) : u.setValue("PaymentRule", "B") : (w ? c != "W" && c != null ? l == "N" ? u.setValue("PaymentRule", c) : u.setValue("PaymentRulePO", c) : (l == "N" ? u.setValue("PaymentRule", "T") : u.setValue("PaymentRulePO", "T"), u.setValue("PaymentMethod", "T")) : (s = t.getValueOfString(d ? h.PaymentRule : h.PaymentRulePO), s != null && s.length != 0 && (s == "B" && (s = "P"), (d && s == "S" || s == "U") && (s = "P"), u.setValue("PaymentRule", s))), wt = t.getValueOfInt(u.getValue("VAB_PaymentTerm_ID")), a = t.getValueOfDecimal(u.getValue("VAB_Order_Blanket")), wt > 0 && a > 0 || (b = t.getValueOfInt(d ? h.VAB_PaymentTerm_ID : h.PO_PaymentTerm_ID), bt = this.checkAdvancePaymentTerm(t.getValueOfInt(u.getValue("VAB_DocTypesTarget_ID")), b), bt ? b != 0 && u.setValue("VAB_PaymentTerm_ID", b) : u.setValue("VAB_PaymentTerm_ID", null)), s = t.getValueOfString(h.InvoiceRule), s != null && s.length != 0 && u.setValue("InvoiceRule", s), s = t.getValueOfString(h.DeliveryRule), s != null && s.length != 0 && u.setValue("DeliveryRule", s), s = t.getValueOfString(h.FreightCostRule), s != null && s.length != 0 && u.setValue("FreightCostRule", s), s = t.getValueOfString(h.DeliveryViaRule), s != null && s.length != 0 && u.setValue("DeliveryViaRule", s)) } } catch (kt) { return this.setCalloutActive(!1), kt } return this.setCalloutActive(!1), o = null, this.BPartnerBill(i, r, u, f, u.getValue("Bill_BPartner_ID")) }; u.prototype.BPartnerLoc = function (r, u, f, e, o, s) { var h = null, l = "", c, a, v, y, p, w; if (this.isCalloutActive() || o == null || o.toString() == "") return ""; try { if ((c = 0, o != null && (c = t.getValueOfInt(o.toString())), c == 0) || (a = t.getValueOfBoolean(f.getValue("IsReturnTrx")), a)) return ""; this.setCalloutActive(!0); v = r.isSOTrx(u); v && (l = "SELECT bp.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable FROM VAB_BPart_Location p INNER JOIN VAB_BusinessPartner bp ON (bp.VAB_BusinessPartner_ID = p.VAB_BusinessPartner_ID) WHERE p.VAB_BPart_Location_ID = " + c, h = n.DB.executeReader(l), h.read() && (y = h.getString("CreditStatusSettingOn"), y == "CL" && (p = t.getValueOfDouble(h.get("so_creditlimit")), p != 0 && (w = t.getValueOfDouble(h.get("creditavailable")), h != null && w <= 0 && n.ADialog.info("CreditOver", null, "", ""))))) } catch (b) { return h != null && (h.close(), h = null), this.log.log(i.SEVERE, l, b), this.setCalloutActive(!1), b } this.setCalloutActive(!1); s = null }; u.prototype.BPartnerBill = function (r, u, f, e, o) { var h, c, b, k, l, a, y, v, p, d, g, s, w, nt, tt, it; if (this.isCalloutActive() || o == null || o.toString() == "") return ""; h = null; try { if (c = t.getValueOfInt(o.toString()), c == null || c == 0) return ""; if (this.setCalloutActive(!0), b = t.getValueOfBoolean(f.getValue("IsReturnTrx")), b) return this.setCalloutActive(!1), ""; k = "SELECT p.VAF_Language,p.VAB_PaymentTerm_ID,p.VAM_PriceList_ID,p.PaymentRule,p.POReference,p.SO_Description,p.IsDiscountPrinted,p.InvoiceRule,p.DeliveryRule,p.FreightCostRule,DeliveryViaRule,p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable,c.VAF_UserContact_ID,p.PO_PriceList_ID, p.PaymentRulePO, p.PO_PaymentTerm_ID,lbill.VAB_BPart_Location_ID AS Bill_Location_ID FROM VAB_BusinessPartner p LEFT OUTER JOIN VAB_BPart_Location lbill ON (p.VAB_BusinessPartner_ID=lbill.VAB_BusinessPartner_ID AND lbill.IsBillTo='Y' AND lbill.IsActive='Y') LEFT OUTER JOIN VAF_UserContact c ON (p.VAB_BusinessPartner_ID=c.VAB_BusinessPartner_ID) WHERE p.VAB_BusinessPartner_ID=" + c + " AND p.IsActive='Y'"; l = "Y" == r.getWindowContext(u, "IsSOTrx", !0); h = n.DB.executeReader(k); h.read() && (a = t.getValueOfInt(h.get("bill_location_id")), c.toString() == r.getContext("VAB_BusinessPartner_ID") && (y = r.getContext("VAB_BPart_Location_ID"), y.length > 0 && (a = t.getValueOfInt(y))), a == 0 ? f.setValue("Bill_Location_ID", null) : f.setValue("Bill_Location_ID", t.getValueOfInt(a)), v = t.getValueOfInt(h.get("VAF_UserContact_id")), c.toString() == r.getContext("VAB_BusinessPartner_ID") && (p = r.getContext("VAF_UserContact_ID"), p.length > 0 && (v = t.getValueOfInt(p))), v == 0 ? f.setValue("Bill_User_ID", null) : f.setValue("Bill_User_ID", t.getValueOfInt(v.toString())), l && (d = 0, d != 0 && (g = 0, h != null && g < 0 && n.ADialog.info("CreditLimitOver", null, "", ""))), s = h.get("poreference"), s = h.get("so_description"), s != null && s.toString().trim().length != 0 && f.setValue("Description", s), s = h.get("isdiscountprinted"), s != null && s.toString().length != 0 ? f.setValue("IsDiscountPrinted", s) : f.setValue("IsDiscountPrinted", "N"), w = r.getContext("OrderType"), f.setValue("InvoiceRule", "D"), f.setValue("PaymentRule", "P"), w == "PR" ? f.setValue("InvoiceRule", "I") : w == "WR" ? f.setValue("PaymentRule", "B") : (s = h.get(l ? "paymentrule" : "paymentrulepo"), s != null && s.toString().length != 0 && (s == "B" && (s = "P"), l && (s == "S" || s == "U") && (s = "P"), f.setValue("PaymentRule", s)), nt = t.getValueOfInt(f.getValue("VAB_PaymentTerm_ID")), tt = t.getValueOfDecimal(f.getValue("VAB_Order_Blanket")), nt > 0 && tt > 0 || (ii = h.get(l ? "VAB_Paymentterm_id" : "po_paymentterm_id"), it = this.checkAdvancePaymentTerm(t.getValueOfInt(f.getValue("VAB_DocTypesTarget_ID")), ii), it ? h != null && f.setValue("VAB_PaymentTerm_ID", ii) : f.setValue("VAB_PaymentTerm_ID", null)), s = h.get("invoicerule"), s != null && s.toString().length != 0 && f.setValue("InvoiceRule", s))); h.close() } catch (rt) { return this.setCalloutActive(!1), h != null && (h.close(), h = null), this.log(i.SEVERE, "bPartnerBill", rt), rt } return this.setCalloutActive(!1), this.PriceList(r, u, f, e, f.getValue("VAM_PriceList_ID")) }; u.prototype.PriceList = function (r, u, e, o, s, h) { var a = "", c = null, l, v; if (this.isCalloutActive() || s == null || s.toString() == "") return ""; try { if (l = t.getValueOfInt(s.toString()), l == null || l == 0) return ""; if (this.setCalloutActive(!0), f && this.log.warning("init"), a = "SELECT pl.IsTaxIncluded,pl.EnforcePriceLimit,pl.VAB_Currency_ID,c.StdPrecision,plv.VAM_PriceListVersion_ID,plv.ValidFrom FROM VAM_PriceList pl,VAB_Currency c,VAM_PriceListVersion plv WHERE pl.VAB_Currency_ID=c.VAB_Currency_ID AND pl.VAM_PriceList_ID=plv.VAM_PriceList_ID AND pl.VAM_PriceList_ID=" + l + "ORDER BY plv.ValidFrom DESC", c = n.DB.executeReader(a), c.read()) { e.setValue("IsTaxIncluded", "Y" == c.get("istaxincluded").toString()); r.setContext(u, "EnforcePriceLimit", c.get("enforcepricelimit").toString()); var p = t.getValueOfInt(c.get("VAB_Currency_id")), w = t.getValueOfInt(e.getValue("VAB_Currency_ID")), b = t.getValueOfDecimal(e.getValue("VAB_Order_Blanket")); w > 0 && b > 0 || e.setValue("VAB_Currency_ID", p); v = t.getValueOfInt(c.get("VAM_PriceListVersion_id")); r.setContext(u, "VAM_PriceListVersion_ID", v) } c.close() } catch (y) { return this.setCalloutActive(!1), c != null && c.close(), this.log(i.SEVERE, a, y), y } return f && this.log.warning("finish"), this.setCalloutActive(!1), r = u = e = o = s = h = null, "" }; u.prototype.Product = function (i, u, e, o, s, h) { var k, v, y, c, p, tt, d, a, l, nt, rt, st; if (this.isCalloutActive() || s == null || s.toString() == "") return ""; var w = t.getValueOfInt(s); if (w == null || w == 0 || (v = "Y" == i.getContext("IsReturnTrx"), v)) return ""; this.setCalloutActive(!0); try { f && this.log.warning("init"); e.setValue("VAB_Charge_ID", null); e.setValue("VAM_PFeature_SetInstance_ID", null); var tt = e.getValue("VAM_Product_ID").toString().concat(",", e.getValue("VAB_BusinessPartner_ID").toString()), b = n.dataContext.getJSONRecord("MVABOrderLine/GetProductInfo", tt), ht = b.productType.toString(); ht == "S" ? e.setValue("IsContract", !0) : (e.setValue("IsContract", !1), e.setValue("NoofCycle", null), e.setValue("QtyPerCycle", null), e.setValue("StartDate", null), e.setValue("VAB_Contract_ID", 0), e.setValue("EndDate", null), e.setValue("VAB_Frequency_ID", 0)); k = i.getWindowContext(u, "IsSOTrx", !0) == "Y"; v = i.getWindowContext(u, "IsReturnTrx", !0) == "Y"; b.IsDropShip.toString() == "Y" ? e.setValue("IsDropShip", !0) : e.setValue("IsDropShip", !1); r = t.getValueOfInt(b.countEd011); y = 0; r > 0 && (y = t.getValueOfInt(b.purchasingUom), y > 0 && k == !1 && v == !1 ? e.setValue("VAB_UOM_ID", y) : e.setValue("VAB_UOM_ID", t.getValueOfInt(b.headerUom))); var ft = i.getContextAsInt(u, "VAB_BusinessPartner_ID", !1), ct = t.getValueOfDecimal(e.getValue("QtyOrdered")), k = i.getWindowContext(u, "IsSOTrx", !0) == "Y", lt = i.getContextAsInt(u, "VAM_PriceList_ID", !1), at = i.getContextAsInt(u, "VAM_PriceListVersion_ID", !1), it = i.getContextAsInt(u, "VAM_PFeature_SetInstance_ID", !1), vt = e.getValue("DateOrdered"), yt = t.getValueOfInt(e.getValue("VAB_UOM_ID")), l = w.toString().concat(",", ft.toString(), ",", ct.toString(), ",", k, ",", lt.toString(), ",", at.toString(), ",", vt.toString(), ",", null, ",", it.toString(), ",", yt, ",", r); try { if (c = null, p = n.dataContext.getJSONRecord("MOrder/GetPrecision", e.getValue("VAB_Order_ID").toString()), c = n.dataContext.getJSONRecord("MVAMProductPricing/GetProductPricing", l), c != null && (e.setValue("PriceList", c.PriceList), e.setValue("PriceLimit", c.PriceLimit), e.setValue("PriceActual", t.getValueOfDecimal(c.PriceActual.toFixed(p))), e.setValue("PriceEntered", t.getValueOfDecimal(c.PriceEntered.toFixed(p))), e.setValue("VAB_Currency_ID", t.getValueOfInt(c.VAB_Currency_ID)), e.setValue("Discount", t.getValueOfDecimal(c.Discount.toFixed(p))), r <= 0 && e.setValue("VAB_UOM_ID", t.getValueOfInt(c.VAB_UOM_ID)), e.setValue("QtyOrdered", e.getValue("QtyEntered")), r > 0 && y > 0 && k == !1 && v == !1 && (tt = e.getValue("VAM_Product_ID").toString().concat("," + i.getVAF_Client_ID().toString() + "," + e.getValue("VAB_Order_ID").toString() + "," + ft.toString() + "," + e.getValue("QtyEntered").toString() + "," + t.getValueOfString(y)), d = n.dataContext.getJSONRecord("MVABOrderLine/GetPricesOnProductChange", tt), PriceList = t.getValueOfDecimal(d.PriceList), e.setValue("PriceList", PriceList), PriceEntered = t.getValueOfDecimal(d.PriceEntered), e.setValue("PriceEntered", PriceEntered), PriceActual = t.getValueOfDecimal(d.PriceEntered.toFixed(p)), e.setValue("PriceActual", PriceActual), e.setValue("QtyOrdered", t.getValueOfDecimal(d.QtyOrdered.toFixed(p)))), i.setContext(u, "EnforcePriceLimit", c.IsEnforcePriceLimit ? "Y" : "N"), i.setContext(u, "DiscountSchema", c.IsDiscountSchema ? "Y" : "N"), i.isSOTrx())) { var et = t.getValueOfDecimal(e.getValue("QtyOrdered")), ot = i.getContextAsInt(u, "VAM_Warehouse_ID"), it = i.getContextAsInt(u, "VAM_PFeature_SetInstance_ID"), g = 0; e.getValue("VAB_OrderLine_ID") != null && (g = t.getValueOfInt(e.getValue("VAB_OrderLine_ID"))); g == null && (g = 0); l = w.toString().concat(",", ot.toString(), ",", it.toString(), ",", g.toString()); a = n.dataContext.getJSONRecord("MVAMStorage/GetQtyAvailable", l); a == null && (a = n.Env.ZERO); a == 0 || a.toString().compareTo(et) < 0 || (l = ot.toString() + "," + w.toString() + "," + it.toString() + "," + g.toString(), nt = n.dataContext.getJSONRecord("MVABOrderLine/GetNotReserved", l), nt == null && (nt = n.Env.ZERO), rt = a - nt, rt.compareTo(et) < 0 && (st = n.Msg.parseTranslation(i, "@QtyAvailable@=" + a + " - @QtyNotReserved@=" + nt + " = " + rt), n.ADialog.info("InsufficientQtyAvailable", !0, st, ""))) } f && this.log.warning("fini") } catch (ut) { return this.log.saveError("calloutorder", ut.toString()), this.setCalloutActive(!1), ut.message } this.setCalloutActive(!1) } catch (ut) { this.setCalloutActive(!1); this.log.saveError("calloutorder", ut.toString()) } return this.setCalloutActive(!1), h = null, this.Tax(i, u, e, o, s) }; u.prototype.Charge = function (r, u, f, e, o, s) { var c, v, l, a; try { if (this.isCalloutActive() || o == null || o.toString() == "") return ""; if ((this.setCalloutActive(!0), c = t.getValueOfInt(o), c == null || c == 0) || (v = "Y" == r.getContext("IsReturnTrx"), v)) return this.setCalloutActive(!1), ""; f.getValue("VAM_Product_ID") != null && f.setValue("VAM_Product_ID", null); f.setValue("VAM_PFeature_SetInstance_ID", null); f.setValue("VAS_Res_Assignment_ID", null); l = r.getContextAsInt("#VAB_UOM_ID"); l > 0 ? f.setValue("VAB_UOM_ID", l) : f.setValue("VAB_UOM_ID", 100); r.setContext(u, "DiscountSchema", "N"); var y = "SELECT ChargeAmt FROM VAB_Charge WHERE VAB_Charge_ID=" + c, h = null, p = n.dataContext.getJSONRecord("MOrder/GetPrecision", f.getValue("VAB_Order_ID").toString()); h = n.DB.executeReader(y); h != null && h.read() && (a = t.getValueOfDecimal(h.get("chargeamt"))); f.setValue("PriceEntered", t.getValueOfDecimal(a.toFixed(p))); f.setValue("PriceActual", t.getValueOfDecimal(a.toFixed(p))); f.setValue("PriceLimit", n.Env.ZERO); f.setValue("PriceList", n.Env.ZERO); f.setValue("Discount", n.Env.ZERO); h.close() } catch (w) { return this.setCalloutActive(!1), h != null && (h.close(), h = null), this.log.log(i.SEVERE, y, w), w } return this.setCalloutActive(!1), s = null, this.Tax(r, u, f, e, o) }; u.prototype.Tax = function (i, r, u, e, o, s) { var p, y, l, a, h, w, b, k, d, v; if (this.isCalloutActive() || o == null || o.toString() == "" || (console.log("Before Charge Or Product"), t.getValueOfInt(u.getValue("VAB_Charge_ID")) == 0 && t.getValueOfInt(u.getValue("VAM_Product_ID")) == 0)) return ""; this.setCalloutActive(!0); try { var nt = "", tt = "", ut = t.getValueOfString(u.getValue("VAM_Product_ID")).concat(",", t.getValueOfString(u.getValue("VAB_Order_ID")) + "," + t.getValueOfString(u.getValue("VAB_Charge_ID"))), c = n.dataContext.getJSONRecord("MVABOrderLine/GetTaxId", ut), ft = t.getValueOfInt(c._CountVATAX), it = i.getWindowContext(r, "IsSOTrx", !0) == "Y", rt = i.getWindowContext(r, "IsReturnTrx", !0) == "Y"; if (ft > 0 && (nt = t.getValueOfString(c.taxRule)), nt == "T" && (it == !0 && rt == !1 || it == !1 && rt == !1)) if (p = t.getValueOfInt(c.taxId), t.getValueOfInt(p) > 0) u.setValue("VAB_TaxRate_ID", p); else { if (t.getValueOfInt(u.getValue("VAM_Product_ID")) > 0) return u.setValue("VAM_Product_ID", ""), this.setCalloutActive(!1), c.TaxExempt == "Y" ? n.ADialog.info("TaxNoExemptFound") : n.ADialog.info("VATAX_DefineTax"); if (t.getValueOfInt(u.getValue("VAB_Charge_ID")) > 0) return u.setValue("VAB_Charge_ID", ""), this.setCalloutActive(!1), c.TaxExempt == "Y" ? n.ADialog.info("TaxNoExemptFound") : n.ADialog.info("VATAX_DefineChargeTax") } else { if (y = e.getColumnName(), o == null) return ""; if ((f && this.log.warning("init"), l = 0, l = y == "VAM_Product_ID" ? t.getValueOfInt(o) : t.getValueOfInt(i.getContextAsInt(r, "VAM_Product_ID")), a = 0, a = y == "VAB_Charge_ID" ? t.getValueOfInt(o) : t.getValueOfInt(i.getContextAsInt(r, "VAB_Charge_ID")), this.log.fine("Product=" + l + ", VAB_Charge_ID=" + a), l == 0 && a == 0) || (h = 0, h = y == "VAB_BPart_Location_ID" ? t.getValueOfInt(o) : t.getValueOfInt(i.getContextAsInt(r, "VAB_BPart_Location_ID")), h == 0)) return this.setCalloutActive(!1), this.Amt(i, r, u, e, o); this.log.fine("Ship BP_Location=" + h); w = i.getContext("DateOrdered"); this.log.fine("Bill Date=" + w); b = i.getContext("DatePromised"); this.log.fine("Ship Date=" + b); k = i.getContextAsInt(r, "VAF_Org_ID"); this.log.fine("Org=" + k); d = i.getContextAsInt(r, "VAM_Warehouse_ID"); this.log.fine("Warehouse=" + d); v = i.getContextAsInt(r, "Bill_Location_ID"); v == 0 && (v = h); this.log.fine("Bill BP_Location=" + v); var et = "Y" == i.getWindowContext(r, "IsSOTrx", !0), tt = l.toString() + "," + a.toString() + "," + w.toString() + "," + b.toString() + "," + k.toString() + "," + d.toString() + "," + v.toString() + "," + h.toString() + "," + et.toString(), g = n.dataContext.getJSONRecord("MTax/Get_Tax_ID", tt); this.log.info("Tax ID=" + g); g == 0 || u.setValue("VAB_TaxRate_ID", t.getValueOfInt(g)); f && this.log.warning("fini") } } catch (ot) { return this.setCalloutActive(!1), ot } return this.setCalloutActive(!1), s = null, this.Amt(i, r, u, e, o) }; u.prototype.Amt = function (i, u, e, o, s, h) { var b, ui, v, g, it, c, l, nt, a, y, ot, dt, rt, p, vt, lt, at, w, ht, ti, k, ii, ct, bt; if (this.isCalloutActive() || s == null || s.toString() == "" || (console.log("Before Charge Or Product"), t.getValueOfInt(e.getValue("VAB_Charge_ID")) == 0 && t.getValueOfInt(e.getValue("VAM_Product_ID")) == 0)) return ""; console.log("After Charge Or Product"); this.setCalloutActive(!0); try { f && this.log.Warning("init"); var et = i.getContextAsInt(u, "VAB_UOM_ID"), tt = i.getContextAsInt(u, "VAM_Product_ID"), pt = i.getContextAsInt(u, "VAM_PriceList_ID"), d = t.getValueOfInt(e.getValue("VAB_OrderLine_Blanket_ID")) > 0 ? !0 : !1, kt = t.getValueOfInt(e.getValue("VAB_Quotation_Line_ID")) > 0 ? !0 : !1; kt && (d = kt); b = t.getValueOfDecimal(e.getValue("QtyDelivered")) > 0 ? !0 : !1; b || (b = t.getValueOfDecimal(e.getValue("QtyInvoiced")) > 0 ? !0 : !1); ui = pt.toString(); p = n.dataContext.getJSONRecord("MVAMPriceList/GetPriceList", pt.toString()); v = t.getValueOfInt(p.StdPrecision); g = t.getValueOfDecimal(e.getValue("QtyEntered")); it = t.getValueOfDecimal(e.getValue("QtyOrdered")); this.log.fine("QtyEntered=" + g + ", Ordered=" + it + ", UOM=" + et); c = t.getValueOfDecimal(e.getValue("PriceEntered")); l = t.getValueOfDecimal(e.getValue("PriceActual")); a = t.getValueOfDecimal(e.getValue("Discount")); nt = t.getValueOfDecimal(e.getValue("PriceLimit")); y = t.getValueOfDecimal(e.getValue("PriceList")); this.log.fine("PriceList=" + y + ", Limit=" + nt + ", Precision=" + v); this.log.fine("PriceEntered=" + c + ", Actual=" + l + ", Discount=" + a); var lt = i.getContextAsInt(u, "VAB_BusinessPartner_ID", !1), at = tt.toString().concat(",", t.getValueOfString(e.getValue("VAB_Order_ID")) + "," + t.getValueOfString(e.getValue("VAM_PFeature_SetInstance_ID")) + "," + t.getValueOfString(e.getValue("VAB_UOM_ID")) + "," + i.getVAF_Client_ID().toString() + "," + lt.toString() + "," + e.getValue("QtyEntered").toString()), w = n.dataContext.getJSONRecord("MVABOrderLine/GetPrices", at); if (r = t.getValueOfInt(w.countEd011), ot = t.getValueOfInt(w.countVAPRC), (r >= 1 || ot >= 1) && (l = c), o.getColumnName() == "QtyEntered" && r > 0 && (t.getValueOfInt(e.getValue("Orig_OrderLine_ID")) > 0 || d || b || (y = t.getValueOfDecimal(w.PriceList), e.setValue("PriceList", t.getValueOfDecimal(w.PriceList)), c = t.getValueOfDecimal(w.PriceEntered), e.setValue("PriceEntered", t.getValueOfDecimal(w.PriceEntered)), l = t.getValueOfDecimal(w.PriceEntered), e.setValue("PriceActual", l))), o.getColumnName() != "QtyOrdered" && o.getColumnName() != "QtyEntered" && o.getColumnName() != "VAM_Product_ID" || "N" == i.getContext("DiscountSchema")) o.getColumnName() == "PriceActual" ? (l = t.getValueOfDecimal(s.toFixed(v)), c = l, this.log.fine("PriceActual=" + l + " -> PriceEntered=" + c), e.setValue("PriceEntered", c), e.setValue("PriceActual", l)) : o.getColumnName() == "PriceEntered" && (c = t.getValueOfDecimal(s.toFixed(v)), st = tt.toString().concat(",", et.toString(), ",", c.toString()), ht = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", st), l = ht, t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO  WHERE PREFIX IN('VAPRC_','ED011_')")) > 1 && (l = c), l == null && (l = c), this.log.fine("PriceEntered=" + c + " -> PriceActual=" + l), e.setValue("PriceActual", l), e.setValue("PriceEntered", c)); else if (dt = i.getContextAsInt(u, "VAB_BusinessPartner_ID"), o.getColumnName() == "QtyEntered" && (rt = tt.toString().concat(",", et.toString() + "," + g.toString()), p = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", rt), it = p), it == null && (it = g), !(t.getValueOfInt(e.getValue("Orig_OrderLine_ID")) > 0)) { var fi = i.getWindowContext(u, "IsSOTrx", !0) == "Y", ei = e.getValue("DateOrdered"), st = tt.toString().concat(",", dt.toString(), ",", it.toString(), ",", fi, ",", pt.toString(), ",", "0,", ei.toString(), ",", null, ",", null, ",", et, ",", r), ut = null; ut = n.dataContext.getJSONRecord("MVAMProductPricing/GetProductPricing", st); vt = ut.PriceStd; r <= 0 && ot <= 0 ? (st = tt.toString().concat(",", et.toString(), ",", vt.toString()), ht = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", st), c = ht) : (lt = i.getContextAsInt(u, "VAB_BusinessPartner_ID", !1), d || b || (at = tt.toString().concat(",", e.getValue("VAB_Order_ID").toString() + "," + t.getValueOfString(e.getValue("VAM_PFeature_SetInstance_ID")) + "," + t.getValueOfString(e.getValue("VAB_UOM_ID")) + "," + i.getVAF_Client_ID().toString() + "," + lt.toString() + "," + e.getValue("QtyEntered").toString() + "," + r.toString() + "," + ot.toString()), w = n.dataContext.getJSONRecord("MVABOrderLine/GetPricesOnChange", at), y = t.getValueOfDecimal(w.PriceList), e.setValue("PriceList", t.getValueOfDecimal(w.PriceList)), c = t.getValueOfDecimal(w.PriceEntered))); c == null && (c = vt); this.log.fine("QtyChanged -> PriceActual=" + vt + ", PriceEntered=" + c + ", Discount=" + ut.Discount); l = t.getValueOfDecimal(ut.PriceStd.toFixed(v)); d || b || e.setValue("PriceActual", c); r <= 0 && ot <= 0 ? d || b || e.setValue("Discount", ut.Discount) : d || b || (l = c, e.setValue("Discount", (t.getValueOfDecimal(e.getValue("PriceList")) - c) / t.getValueOfDecimal(e.getValue("PriceList")) * 100)); e.setValue("PriceEntered", c); i.setContext(u, "DiscountSchema", ut.DiscountSchema ? "Y" : "N") } if (o.getColumnName() == "Discount") l = t.getValueOfDecimal((100 - a) / 100 * y), t.scale(l) > v && (l = l.toFixed(v)), c = l, c == null && (c = l), e.setValue("PriceActual", l), e.setValue("PriceEntered", c); else { if (y == 0) a = n.Env.ZERO; else if (a = t.getValueOfDecimal((y - l) / y * 100), isNaN(a)) return this.setCalloutActive(!1), "PriceListNotSelected"; a = t.getValueOfDecimal(a.toFixed(v)); e.setValue("PriceList", t.getValueOfDecimal(y.toFixed(v))); d || b || e.setValue("Discount", a) } this.log.fine("PriceEntered=" + c + ", Actual=" + l + ", Discount=" + a); var gt = !1, ft = i.getContext("EnforcePriceLimit"), yt = i.isSOTrx() && ft != null && ft == "Y"; if (ft == "") { var rt = t.getValueOfInt(e.getValue("VAB_Order_ID")).toString(), ni = n.dataContext.getJSONRecord("MOrder/GetOrder", rt), wt = "SELECT EnforcePriceLimit FROM VAM_PriceList WHERE IsActive = 'Y' AND VAM_PriceList_ID = " + ni.VAM_PriceList_ID; ft = n.DB.executeScalar(wt); yt = ni.IsSOTrx && ft != null && ft == "Y"; wt = "SELECT OverwritePriceLimit FROM VAF_Role WHERE IsActive = 'Y' AND VAF_Role_ID = " + i.getContext("#VAF_Role_ID"); gt = t.getValueOfBoolean(n.DB.executeScalar(wt)) } if (ti = "Y" == i.getContext("IsReturnTrx"), yt && (gt || ti) && (yt = !1), yt && nt != 0 && l.compareTo(nt) < 0 && (l = nt, c = l, c == null && (c = nt), this.log.fine("(under) PriceEntered=" + c + ", Actual" + nt), d || b || (e.setValue("PriceActual", nt), e.setValue("PriceEntered", c)), n.ADialog.info("UnderLimitPrice", !0, "", ""), y != 0 && (a = t.getValueOfDecimal((y - l) / y * 100), a = a.toFixed(2), d || b || e.setValue("Discount", a))), c = t.getValueOfDecimal(e.getValue("PriceEntered")), k = g * c, g > 0 && k == 0 && (ii = t.getValueOfDecimal(e.getValue("VAB_OrderLine_Blanket_ID")), p = n.dataContext.getJSONRecord("MVABOrderLine/GetOrderLine", ii.toString()), p != null)) { var y = t.getValueOfDouble(p.PriceList), l = t.getValueOfDouble(p.PriceActual), c = t.getValueOfDouble(p.PriceEntered), a = t.getValueOfDouble(p.Discount); c != null && (e.setValue("PriceEntered", c), e.setValue("LineNetAmt", c * g), k = c * g); y != null && e.setValue("PriceList", y); a != null && e.setValue("Discount", a); l != null && e.setValue("PriceActual", l) } if (t.scale(k) > v && (k = t.getValueOfDecimal(k.toFixed(v))), this.log.info("LineNetAmt=" + k), e.setValue("LineNetAmt", k), ct = n.Env.ZERO, o.getColumnName() == "TaxAmt") ct = e.getValue("TaxAmt"); else if (bt = e.getValue("VAB_TaxRate_ID"), bt != null) { var oi = bt, ri = this.IsTaxIncluded(u, i), rt = oi.toString().concat(",", k.toString(), ",", ri, ",", v.toString()), p = null; ct = n.dataContext.getJSONRecord("MTax/CalculateTax", rt); e.setValue("TaxAmt", ct); e.getField("SurchargeAmt") != null && e.setValue("SurchargeAmt", 0) } ri ? e.setValue("LineTotalAmt", t.getValueOfDecimal(k.toFixed(v))) : e.setValue("LineTotalAmt", t.getValueOfDecimal(k.toFixed(v)) + t.getValueOfDecimal(ct.toFixed(v))) } catch (si) { return this.setCalloutActive(!1), si } return this.setCalloutActive(!1), i = u = e = o = s = h = null, "" }; u.prototype.IsTaxIncluded = function (t, i) { var r = i.getContext("IsTaxIncluded"), u; try { if (r.toString().length == 0) { if (u = i.getContextAsInt(t, "VAM_PriceList_ID"), u == 0) return !1; r = n.DB.executeScalar("SELECT IsTaxIncluded FROM VAM_PriceList WHERE VAM_PriceList_ID=" + u, null, null).toString(); r == null && (r = "N"); i.setContext(t, "IsTaxIncluded", r) } } catch (f) { this.setCalloutActive(!1); this.log.severe(f.toString()) } return i = t = mTab = mField = value = oldValue = null, "Y" == r }; u.prototype.Qty = function (i, u, e, o, s, h) { var a = "", b, tt, et, dt, gt, ut, ui, it, ni, vt, p, pt, g, k, v, w, y, ti, st, ht, wt, ii; if (this.isCalloutActive() || s == null || s.toString() == "" || (console.log("Before Charge Or Product"), t.getValueOfInt(e.getValue("VAB_Charge_ID")) == 0 && t.getValueOfInt(e.getValue("VAM_Product_ID")) == 0)) return ""; console.log("After Charge Or Product"); this.setCalloutActive(!0); try { b = i.getContextAsInt(u, "VAM_Product_ID"); f && this.log.Warning("init - VAM_Product_ID=" + b + " - "); var l = n.Env.ZERO, c = n.Env.ZERO, li = n.Env.ZERO, nt, d, lt = "Y" == i.getContext("IsReturnTrx"), rt = t.getValueOfInt(e.getValue("VAB_OrderLine_Blanket_ID")) > 0 ? !0 : !1, bt = t.getValueOfInt(e.getValue("VAB_Quotation_Line_ID")) > 0 ? !0 : !1; bt && (rt = bt); var ct = i.getContextAsInt(u, "VAB_BusinessPartner_ID", !1), kt = n.dataContext.getJSONRecord("MBPartner/GetBPartner", ct.toString()), ri = n.dataContext.getJSONRecord("MVAMProduct/GetVAB_UOM_ID", b.toString()); if (b == 0) c = t.getValueOfDecimal(e.getValue("QtyEntered")), l = c, e.setValue("QtyOrdered", l); else if (o.getColumnName() == "VAB_UOM_ID") p = t.getValueOfInt(s), c = t.getValueOfDecimal(e.getValue("QtyEntered")), it = ct.toString().concat(",", e.getValue("VAB_Order_ID").toString() + "," + t.getValueOfString(e.getValue("VAM_PFeature_SetInstance_ID")) + "," + t.getValueOfString(p) + "," + i.getVAF_Client_ID().toString() + "," + e.getValue("VAM_Product_ID").toString() + "," + e.getValue("QtyEntered").toString()), tt = n.dataContext.getJSONRecord("MVABOrderLine/GetProductPriceOnUomChange", it), r = t.getValueOfInt(tt.countEd011), r > 0 && t.getValueOfInt(e.getValue("VAB_Order_ID")) ? (et = t.getValueOfInt(tt.isAttributeValue), et == 1 ? (dt = t.getValueOfDecimal(tt.PriceEntered), rt || (e.setValue("PriceList", t.getValueOfDecimal(tt.PriceList)), e.setValue("PriceLimit", t.getValueOfDecimal(tt.PriceLimit)), e.setValue("PriceActual", t.getValueOfDecimal(tt.PriceEntered)), e.setValue("PriceEntered", t.getValueOfDecimal(tt.PriceEntered))), a = p.toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + p + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", p.toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, y = !1, l != null && (y = c != l), l == null && (y = !1, l = 1), y ? e.setValue("QtyOrdered", l) : e.setValue("QtyOrdered", l * v), rt || (e.setValue("PriceActual", dt), e.setValue("PriceList", t.getValueOfDecimal(tt.PriceList)))) : (et == 2 || et == 0) && (et == 2 ? (gt = t.getValueOfDecimal(tt.PriceEntered), rt || (e.setValue("PriceList", t.getValueOfDecimal(tt.PriceList)), e.setValue("PriceLimit", t.getValueOfDecimal(tt.PriceLimit)), e.setValue("PriceActual", t.getValueOfDecimal(tt.PriceEntered)), e.setValue("PriceEntered", t.getValueOfDecimal(tt.PriceEntered))), a = p.toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + p + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", p.toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, y = !1, l != null && (y = c != l), l == null && (y = !1, l = 1), y ? e.setValue("QtyOrdered", l) : e.setValue("QtyOrdered", l * v), rt || (e.setValue("PriceActual", gt), e.setValue("PriceList", t.getValueOfDecimal(tt.PriceList)))) : (a = p.toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + p + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", p.toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, l == null && (l = c), y = c != l, nt = t.getValueOfDecimal(e.getValue("PriceEntered")), a = b.toString().concat(",", p.toString(), ",", nt.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), d = w, d == null && (d = nt), this.log.fine("UOM=" + p + ", QtyEntered/PriceActual=" + c + "/" + nt + " -> " + y + " QtyOrdered/PriceEntered=" + l + "/" + d), i.setContext(u, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyOrdered", l), e.setValue("PriceEntered", d), ut = 0, ui = 0, rt || (it = b.toString().concat(",", e.getValue("VAB_Order_ID").toString() + "," + t.getValueOfString(e.getValue("VAM_PFeature_SetInstance_ID")) + "," + t.getValueOfString(p) + "," + i.getVAF_Client_ID().toString() + "," + kt.VAM_DiscountCalculation_ID.toString() + "," + kt.FlatDiscount.toString() + "," + e.getValue("QtyEntered").toString() + "," + t.getValueOfString(ri)), g = n.dataContext.getJSONRecord("MVABOrderLine/GetPricesOnUomChange", it), PriceList = t.getValueOfDecimal(g.PriceList), e.setValue("PriceList", t.getValueOfDecimal(g.PriceList)), d = t.getValueOfDecimal(g.PriceEntered), e.setValue("PriceEntered", t.getValueOfDecimal(g.PriceEntered)), nt = t.getValueOfDecimal(g.PriceEntered), e.setValue("PriceActual", nt))))) : (a = p.toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + p + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", p.toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, l == null && (l = c), y = c != l, nt = t.getValueOfDecimal(e.getValue("PriceActual")), a = b.toString().concat(",", p.toString(), ",", nt.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), d = w, d == null && (d = nt), this.log.fine("UOM=" + p + ", QtyEntered/PriceActual=" + c + "/" + nt + " -> " + y + " QtyOrdered/PriceEntered=" + l + "/" + d), i.setContext(u, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyOrdered", l), e.setValue("PriceEntered", d)); else if (o.getColumnName() == "QtyEntered") p = i.getContextAsInt(u, "VAB_UOM_ID"), c = t.getValueOfDecimal(s), a = p.toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + p + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", p.toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, l == null && (l = c), y = c != l, this.log.fine("UOM=" + p + ", QtyEntered=" + c + " -> " + y + " QtyOrdered=" + l), i.setContext(u, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyOrdered", l); else if (o.getColumnName() == "QtyOrdered") { p = i.getContextAsInt(u, "VAB_UOM_ID"); l = t.getValueOfDecimal(s); a = b.toString().concat(","); var k = n.dataContext.getJSONRecord("MVAMProduct/GetUOMPrecision", a), fi = k, at = l.toFixed(fi); l != at && (this.log.fine("Corrected QtyOrdered Scale " + l + "->" + at), l = at, e.setValue("QtyOrdered", l)); a = b.toString().concat(",", p.toString(), ",", l.toString()); ni = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", a); c = ni; c == null && (c = l); y = l != c; this.log.fine("UOM=" + p + ", QtyOrdered=" + l + " -> " + y + " QtyEntered=" + c); i.setContext(u, "UOMConversion", y ? "Y" : "N"); e.setValue("QtyEntered", c) } else l = t.getValueOfDecimal(e.getValue("QtyOrdered")); if (b != 0 && lt && (vt = t.getValueOfInt(e.getValue("Orig_InOutLine_ID")), vt != 0)) { a = vt.toString(); var yt = n.dataContext.getJSONRecord("MVAMInvInOutLine/GetMVAMInvInOutLine", a), ei = yt.MovementQty, ot = t.getValueOfDecimal(ei); l = t.getValueOfDecimal(e.getValue("QtyOrdered")); ot < l && (i.isSOTrx() ? n.ADialog.info("QtyShippedAndReturned", null, ot.toString(), "") : n.ADialog.info("QtyRecievedAndReturnd", null, ot.toString(), ""), e.setValue("QtyOrdered", ot), l = ot, p = i.getContextAsInt(u, "VAB_UOM_ID"), a = b.toString().concat(",", p.toString(), ",", l.toString()), c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", a), c == null && (c = l), e.setValue("QtyEntered", c), this.log.fine("QtyEntered : " + c.toString() + "QtyOrdered : " + l.toString())) } if (b != 0 && l > 0 && !lt && o.getColumnName() == "VAM_PFeature_SetInstance_ID") { c = t.getValueOfDecimal(e.getValue("QtyEntered")); var ut = 0, it = b.toString().concat(",", e.getValue("VAB_Order_ID").toString() + "," + t.getValueOfString(e.getValue("VAM_PFeature_SetInstance_ID")) + "," + t.getValueOfString(e.getValue("VAB_UOM_ID")) + "," + i.getVAF_Client_ID().toString() + "," + ct.toString() + "," + c.toString()), g = n.dataContext.getJSONRecord("MVABOrderLine/GetPrices", it); g != null && (r = t.getValueOfInt(g.countEd011), pt = t.getValueOfInt(g.countVAPRC), d = g.PriceEntered, ut = g.PriceList, rt || (e.setValue("PriceList", ut), e.setValue("PriceActual", d), e.setValue("PriceEntered", d)), r <= 0 && pt <= 0 ? (it = e.getValue("VAB_UOM_ID").toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", it), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + t.getValueOfInt(e.getValue("VAB_UOM_ID")) + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), it = b.toString().concat(",", e.getValue("VAB_UOM_ID").toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", it), l = w, l == null && (l = c), y = c != l, nt = t.getValueOfDecimal(e.getValue("PriceEntered")), a = b.toString().concat(",", e.getValue("VAB_UOM_ID").toString(), ",", nt.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), d = w, d == null && (d = nt), this.log.fine("UOM=" + p + ", QtyEntered/PriceActual=" + c + "/" + nt + " -> " + y + " QtyOrdered/PriceEntered=" + l + "/" + d), i.setContext(u, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyOrdered", l), e.setValue("PriceEntered", d)) : (rt || (it = b.toString().concat(",", e.getValue("VAB_Order_ID").toString() + "," + t.getValueOfString(e.getValue("VAM_PFeature_SetInstance_ID")) + "," + t.getValueOfString(e.getValue("VAB_UOM_ID")) + "," + i.getVAF_Client_ID().toString() + "," + ct.toString() + "," + c.toString() + "," + r.toString() + "," + pt.toString()), g = n.dataContext.getJSONRecord("MVABOrderLine/GetPricesOnChange", it), ut = t.getValueOfDecimal(g.PriceList), e.setValue("PriceList", ut), d = t.getValueOfDecimal(g.PriceEntered), e.setValue("PriceEntered", d), nt = t.getValueOfDecimal(g.PriceEntered), e.setValue("PriceActual", nt)), a = e.getValue("VAB_UOM_ID").toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + t.getValueOfInt(e.getValue("VAB_UOM_ID")) + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", e.getValue("VAB_UOM_ID").toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, y = !1, l != null && (y = c != l), l == null && (y = !1, l = 1), y ? e.setValue("QtyOrdered", l) : e.setValue("QtyOrdered", l * v))) } if (b != 0 && i.isSOTrx() && l > 0 && !lt && (ti = n.dataContext.getJSONRecord("MVAMProduct/GetProduct", b.toString()), st = 0, t.getValueOfBoolean(ti.IsStocked))) { var oi = i.getContextAsInt(u, "VAM_Warehouse_ID"), si = i.getContextAsInt(u, "VAM_PFeature_SetInstance_ID"), hi = b.toString().concat(",", oi.toString(), ",", si.toString(), ",", st.toString()), yt = null, ft = n.dataContext.getJSONRecord("MVAMStorage/GetQtyAvailable", hi); ft == null && (ft = n.Env.ZERO); ft == 0 || ft.toString().compareTo(l) < 0 || (st = e.getValue("VAB_OrderLine_ID") == "" ? 0 : t.getValueOfInt(e.getValue("VAB_OrderLine_ID")), st == null && (st = 0), ht = yt.notReserved, ht == null && (ht = n.Env.ZERO), wt = ft - ht, wt < l && (ii = n.Msg.parseTranslation(i, "@QtyAvailable@=" + ft + "  -  @QtyNotReserved@=" + ht + "  =  " + wt), n.ADialog.info("InsufficientQtyAvailable", null, ii, ""))) } } catch (ci) { return this.setCalloutActive(!1), ci } return this.setCalloutActive(!1), i = u = e = o = s = h = null, "" }; u.prototype.Orig_Order = function (i, r, u, f, e, o) { var h, s, a, v, y, l, c; if (this.isCalloutActive() || e == null || e.toString() == "" || (h = t.getValueOfInt(e), h == null || h == 0)) return ""; this.setCalloutActive(!0); try { s = n.dataContext.getJSONRecord("MOrder/GetOrder", h.toString()); a = n.dataContext.getJSONRecord("MBPartner/GetBPartner", s.VAB_BusinessPartner_ID.toString()); u.setValue("Orig_InOut_ID", null); u.setValue("VAB_BusinessPartner_ID", t.getValueOfInt(s.VAB_BusinessPartner_ID)); u.setValue("VAB_BPart_Location_ID", t.getValueOfInt(s.VAB_BPart_Location_ID)); u.setValue("Bill_BPartner_ID", t.getValueOfInt(s.Bill_BPartner_ID)); u.setValue("Bill_Location_ID", t.getValueOfInt(s.Bill_Location_ID)); s.VAF_UserContact_ID != 0 && u.setValue("VAF_UserContact_ID", t.getValueOfInt(s.VAF_UserContact_ID)); s.Bill_User_ID != 0 && u.setValue("Bill_User_ID", t.getValueOfInt(s.Bill_User_ID)); i.isSOTrx() ? u.setValue("VAM_ReturnRule_ID", t.getValueOfInt(a.VAM_ReturnRule_ID)) : u.setValue("VAM_ReturnRule_ID", t.getValueOfInt(a.PO_ReturnPolicy_ID)); !0 && (this.setCalloutActive(!1), u.setValue("VAM_PriceList_ID", t.getValueOfInt(s.VAM_PriceList_ID)), this.setCalloutActive(!0)); u.setValue("PaymentRule", s.PaymentRule); v = this.checkAdvancePaymentTerm(t.getValueOfInt(u.getValue("VAB_DocTypesTarget_ID")), t.getValueOfInt(s.VAB_PaymentTerm_ID)); v ? u.setValue("VAB_PaymentTerm_ID", t.getValueOfInt(s.VAB_PaymentTerm_ID)) : u.setValue("VAB_PaymentTerm_ID", null); u.setValue("Bill_Location_ID", t.getValueOfInt(s.Bill_Location_ID)); u.setValue("InvoiceRule", s.InvoiceRule); u.setValue("PaymentRule", s.PaymentRule); u.setValue("DeliveryViaRule", s.DeliveryViaRule); u.setValue("FreightCostRule", s.FreightCostRule); y = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")); y > 0 && (l = n.DB.executeScalar("SELECT VA009_PaymentMethod_ID FROM VAB_Order WHERE VAB_Order_ID=" + h), l > 0 && (u.setValue("VA009_PaymentMethod_ID", l), c = n.DB.executeScalar("SELECT VA009_PaymentBaseType FROM VA009_PaymentMethod WHERE VA009_PaymentMethod_ID=" + l), c != "W" && c != null && (u.setValue("PaymentMethod", c), u.setValue("PaymentRule", c)))) } catch (p) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; u.prototype.Orig_InOut = function (i, r, u, f, e, o) { var h, s; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (h = t.getValueOfInt(e), h == null || h == 0) return ""; this.setCalloutActive(!0); s = n.dataContext.getJSONRecord("MVAMInvInOut/GetInOut", h.toString()); u.setValue("VAB_Project_ID", t.getValueOfInt(s.VAB_Project_ID)); u.setValue("VAB_Promotion_ID", t.getValueOfInt(s.VAB_Promotion_ID)); u.setValue("VAB_BillingCode_ID", t.getValueOfInt(s.VAB_BillingCode_ID)); u.setValue("VAF_OrgTrx_ID", t.getValueOfInt(s.VAF_OrgTrx_ID)); u.setValue("User1_ID", t.getValueOfInt(s.User1_ID)); u.setValue("User2_ID", t.getValueOfInt(s.User2_ID)); t.getValueOfString(s.IsDropShip) == "Y" ? (u.setValue("VAM_Warehouse_ID", t.getValueOfInt(s.VAM_Warehouse_ID)), u.setValue("IsDropShip", !0)) : (u.setValue("IsDropShip", !1), u.setValue("VAM_Warehouse_ID", null)) } catch (c) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; u.prototype.Orig_OrderLine = function (i, r, u, f, e, o) { var c, s, a, v, l, y, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (c = t.getValueOfInt(e), c == null || c == 0) return ""; this.setCalloutActive(!0); s = n.dataContext.getJSONRecord("MVABOrderLine/GetOrderLine", c.toString()); u.setValue("Orig_InOutLine_ID", null); u.setValue("VAB_TaxRate_ID", t.getValueOfInt(s.VAB_TaxRate_ID)); u.setValue("PriceList", t.getValueOfDecimal(s.PriceList)); u.setValue("PriceLimit", t.getValueOfDecimal(s.PriceLimit)); u.setValue("PriceActual", t.getValueOfDecimal(s.PriceActual)); u.setValue("PriceEntered", t.getValueOfDecimal(s.PriceEntered)); u.setValue("VAB_Currency_ID", t.getValueOfInt(s.VAB_Currency_ID)); u.setValue("Discount", t.getValueOfDecimal(s.Discount)); a = i.getContextAsInt(r, "VAM_PriceList_ID"); v = n.dataContext.getJSONRecord("MVAMPriceList/GetPriceList", a.toString()); l = t.getValueOfInt(v.StdPrecision); y = t.getValueOfDecimal(u.getValue("QtyOrdered")); h = y * t.getValueOfDecimal(s.PriceActual); t.scale(h) > l && (h = h.toFixed(l)); this.log.info("LineNetAmt=" + h); u.setValue("LineNetAmt", h) } catch (p) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; u.prototype.Orig_InOutLine = function (i, r, u, f, e, o) { var h, s, c; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (h = t.getValueOfInt(e), h == null || h == 0) return ""; if (this.setCalloutActive(!0), s = n.dataContext.getJSONRecord("MVAMInvInOutLine/GetMVAMInvInOutLine", h.toString()), s != null) { u.setValue("VAB_Project_ID", t.getValueOfInt(s.VAB_Project_ID)); u.setValue("VAB_Promotion_ID", t.getValueOfInt(s.VAB_Promotion_ID)); u.setValue("VAM_Product_ID", t.getValueOfInt(s.VAM_Product_ID)); u.setValue("VAM_PFeature_SetInstance_ID", t.getValueOfInt(s.VAM_PFeature_SetInstance_ID)); u.setValue("VAB_UOM_ID", t.getValueOfInt(s.VAB_UOM_ID)); c = t.getValueOfDecimal(s.QtyEntered); u.setValue("QtyEntered", c); var a = s.VAM_Product_ID.toString().concat(",", s.VAB_UOM_ID.toString(), ",", c.toString()), v = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = v; l == null && (l = c); u.setValue("QtyOrdered", l); t.getValueOfString(s.IsDropShip) == "Y" ? (u.setValue("IsDropShip", !0), i.setContext(r, "IsDropShip", t.getValueOfString(s.IsDropShip))) : u.setValue("IsDropShip", !1) } } catch (y) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; u.prototype.checkAdvancePaymentTerm = function (i, r) { var u = !0, f = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), e; return f != null && !f.VA009_ ? u : (t.getValueOfInt(i) != 0 && t.getValueOfInt(r) != 0 && (e = i.toString() + "," + r.toString(), u = n.dataContext.getJSONRecord("MOrder/checkAdvancePaymentTerm", e)), u) }; n.Model.CalloutOrder = u; n.Utility.inheritPrototype(ei, n.CalloutEngine); ei.prototype.UOM = function (i, r, u, f, e, o) { var c, s, v, a, l, h; if (e == 0 || e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; this.setCalloutActive(!0); try { if (c = t.getValueOfDecimal(u.getValue("VAM_Product_ID")), c == 0) return QtyEntered = 1, QtyOrdered = QtyEntered, u.setValue("QtyOrdered", QtyOrdered), u.setValue("QtyEntered", QtyEntered), this.setCalloutActive(!1), i = r = u = f = e = o = null, ""; f.getColumnName() == "VAB_UOM_ID" ? (s = t.getValueOfInt(e), QtyEntered = t.getValueOfDecimal(u.getValue("QtyEntered")), c = t.getValueOfInt(u.getValue("VAM_Product_ID")), paramStr = c.toString().concat(",").concat(s.toString()).concat(",").concat(QtyEntered.toString()), l = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), QtyOrdered = l, h = !1, QtyOrdered != null && (h = QtyEntered != QtyOrdered), QtyOrdered == null && (h = !1, QtyOrdered = 1), h ? u.setValue("MovementQty", QtyOrdered) : u.setValue("MovementQty", QtyOrdered * QtyEntered)) : f.getColumnName() == "QtyEntered" && (s = i.getContextAsInt(r, "VAB_UOM_ID"), QtyEntered = t.getValueOfDecimal(e), paramStr = s.toString().concat(","), v = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr), a = QtyEntered.toFixed(t.getValueOfInt(v)), QtyEntered != a && (this.log.fine("Corrected QtyEntered Scale UOM=" + s + "; QtyEntered=" + QtyEntered + "->" + a), QtyEntered = a, u.setValue("QtyEntered", QtyEntered)), paramStr = c.toString().concat(",", s.toString(), ",", QtyEntered.toString()), l = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), QtyOrdered = l, QtyOrdered == null && (QtyOrdered = QtyEntered), h = QtyEntered != QtyOrdered, this.log.fine("UOM=" + s + ", QtyEntered=" + QtyEntered + " -> " + h + " QtyOrdered=" + QtyOrdered), i.setContext(r, "UOMConversion", h ? "Y" : "N"), u.setValue("MovementQty", QtyOrdered)) } catch (y) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutInventoryMove = ei; n.Utility.inheritPrototype(oi, n.CalloutEngine); oi.prototype.Product = function (r, u, f, e, o, s) { var c, v; if (o == null || o.toString() == "" || this.isCalloutActive() || o == null || (c = t.getValueOfInt(o), c == 0)) return ""; this.setCalloutActive(!0); var l = 0, a = null, y = null, p = null, w = "SELECT p.VAM_Product_ID, ra.Name, ra.Description, ra.Qty FROM VAS_Res_Assignment ra INNER JOIN VAM_Product p ON (p.VAS_Resource_ID=ra.VAS_Resource_ID) WHERE ra.VAS_Res_Assignment_ID=" + c, h = null; try { h = n.DB.executeReader(w, null, null); h.read() && (l = t.getValueOfInt(h.get(0)), a = t.getValueOfString(h.get(1)), y = t.getValueOfString(h.get(2)), p = t.getValueOfDecimal(h.get(3))); h.close() } catch (b) { h != null && (h.close(), h = null); this.setCalloutActive(!1); this.log.log(i.SEVERE, "product", b) } return this.log.fine("VAS_Res_Assignment_ID=" + c + " - VAM_Product_ID=" + l), l != 0 && (f.setValue("VAM_Product_ID", t.getValueOfInt(l)), y != null && (a += " (" + y + ")"), "." != a && f.setValue("Description", a), v = "Qty", f.getTableName().startsWith("VAB_Order") ? v = "QtyOrdered" : f.getTableName().startsWith("VAB_Invoice") && (v = "QtyInvoiced"), p != null && f.setValue(v, p)), this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; n.Model.CalloutAssignment = oi; n.Utility.inheritPrototype(h, n.CalloutEngine); h.prototype.Invoice = function (r, u, f, e, o, s) { var l, v, g, d; if (this.isCalloutActive()) return ""; if (o == null || o.toString() == "") return e.getColumnName() == "VAB_Invoice_ID" && (this.setCalloutActive(!0), f.setValue("VAB_BusinessPartner_ID", null), f.setValue("VAB_BPart_Location_ID", null), f.setValue("VAB_sched_InvoicePayment_ID", null), r.setContext(u, "InvTotalAmt", ""), r.setContext("InvTotalAmt", ""), f.setValue("ConvertedAmt", n.Env.ZERO), f.setValue("Amount", n.Env.ZERO), f.setValue("DiscountAmt", n.Env.ZERO), f.setValue("WriteOffAmt", n.Env.ZERO), f.setValue("OverUnderAmt", n.Env.ZERO), this.setCalloutActive(!1)), ""; this.setCalloutActive(!0); var a = t.getValueOfInt(o), p = 0, w = 0, b = 0, c = null; try { c = n.dataContext.getJSONRecord("MVABInvoice/GetInvPaySchedDetail", a.toString()); c != null && (w = t.getValueOfInt(c.VAB_sched_InvoicePayment_ID), f.setValue("VAB_sched_InvoicePayment_ID", w), p = t.getValueOfDecimal(c.dueAmount), b = 1) } catch (y) { return c != null && (c = null), this.log.log(i.SEVERE, "CalloutCashJournal.Invoice -" + a, y.message), y.toString() } if (a == null || a == 0) return f.setValue("VAB_Currency_ID", null), this.setCalloutActive(!1), ""; var k = new Date(r.getContext(u, "DateAcct")), nt = "TO_DATE( '" + (Number(k.getMonth()) + 1) + "-" + k.getDate() + "-" + k.getFullYear() + "', 'MM-DD-YYYY')", tt = a.toString() + "," + nt.toString() + "," + w.toString(), h = null; try { h = n.dataContext.getJSONRecord("MVABInvoice/GetInvoiceDetails", tt); h != null && (l = 0, f.setValue("VAB_BusinessPartner_ID", t.getValueOfInt(h.VAB_BusinessPartner_ID)), f.setValue("VAB_Currency_ID", t.getValueOfInt(h.VAB_Currency_ID)), f.setValue("VAB_CurrencyType_ID", t.getValueOfInt(h.VAB_CurrencyType_ID)), f.setValue("VAB_BPart_Location_ID", t.getValueOfInt(h.VAB_BPart_Location_ID)), l = b == 0 ? t.getValueOfDecimal(h.invoiceOpen) : p, v = t.getValueOfDecimal(h.paymentTermDiscount), g = "Y" == h.IsSOTrx, g || (l = b == 0 ? l * -1 : p * -1, v = v * -1), d = t.getValueOfString(h.docbaseType), "ARC" == d || "API" == d ? f.setValue("VSS_PAYMENTTYPE", "P") : f.setValue("VSS_PAYMENTTYPE", "R"), r.setContext("InvTotalAmt", l.toString()), f.setValue("Amount", l - v), f.setValue("DiscountAmt", v), f.setValue("WriteOffAmt", n.Env.ZERO)) } catch (y) { return idr != null && (idr.close(), idr = null), this.log.log(i.SEVERE, "invoice", y), this.setCalloutActive(!1), y.toString() } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; h.prototype.SetAmount = function (i, r, u, f, e) { var l, y, p, o, w, a, v, s, c, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; if (this.setCalloutActive(!0), e == null || e.toString() == "") return t.getValueOfInt(u.getValue("VAB_Invoice_ID")) > 0 ? (l = t.getValueOfDecimal(n.dataContext.getJSONRecord("MCashBook/GetPaySheduleAmt", u.getValue("VAB_Invoice_ID").toString())), i.setContext(r, "InvTotalAmt", l.toString()), u.setValue("Amount", l), this.setCalloutActive(!1), "") : ""; if (u.setValue("DiscountAmt", n.Env.ZERO), u.setValue("WriteOffAmt", n.Env.ZERO), u.setValue("OverUnderAmt", n.Env.ZERO), y = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), y.VA009_) { if (i.setContext("InvTotalAmt", ""), s = t.getValueOfInt(e), s == null || s == 0) return i.setContext(r, "InvTotalAmt", null), u.getTableName() == "VAB_Payment" ? (u.setValue("PayAmt", null), u.setValue("PaymentAmount", null)) : u.setValue("Amount", null), u.setValue("DiscountAmt", 0), u.setValue("WriteOffAmt", n.Env.ZERO), i.setContext("InvTotalAmt", 0), this.setCalloutActive(!1), ""; p = s.toString() + "," + u.getValue("VAB_CashJRNL_ID") + "," + u.getValue("VAB_Invoice_ID"); o = n.dataContext.getJSONRecord("MCashBook/GetPaySheduleData", p); o != null && (u.getTableName() == "VAB_Payment" ? (w = o.IsReturnTrx, w == "Y" ? (u.setValue("PayAmt", t.getValueOfDecimal(o.DueAmt) * -1), u.setValue("PaymentAmount", t.getValueOfDecimal(o.DueAmt) * -1)) : (u.setValue("PayAmt", t.getValueOfDecimal(o.DueAmt)), u.setValue("PaymentAmount", t.getValueOfDecimal(o.DueAmt)))) : (u.setValue("Amount", t.getValueOfDecimal(o.DueAmt)), i.setContext(r, "InvTotalAmt", t.getValueOfDecimal(u.getValue("Amount"))), u.setValue("WriteOffAmt", 0), u.setValue("OverUnderAmt", 0), a = t.getValueOfDate(o.accountDate), v = t.getValueOfString(o.isSoTrx), t.getValueOfDate(o.DiscountDate) >= a ? (v == "N" ? u.setValue("DiscountAmt", -1 * t.getValueOfDecimal(o.DiscountAmt)) : u.setValue("DiscountAmt", t.getValueOfDecimal(o.DiscountAmt)), u.setValue("Amount", t.getValueOfDecimal(o.DueAmt) - t.getValueOfDecimal(o.DiscountAmt))) : t.getValueOfDate(o.DiscountDays2) >= a ? (v == "N" ? u.setValue("DiscountAmt", -1 * t.getValueOfDecimal(o.Discount2)) : u.setValue("DiscountAmt", t.getValueOfDecimal(o.Discount2)), u.setValue("Amount", t.getValueOfDecimal(o.DueAmt) - t.getValueOfDecimal(o.Discount2))) : u.setValue("DiscountAmt", 0))) } else { if (s = t.getValueOfInt(e), s == null || s == 0) return i.setContext(r, "InvTotalAmt", null), u.getTableName() == "VAB_Payment" ? (u.setValue("PayAmt", null), u.setValue("PaymentAmount", null)) : u.setValue("Amount", null), this.setCalloutActive(!1), ""; c = n.dataContext.getJSONRecord("MCashBook/GetInvSchedDueAmt", s.toString()); c != null && (h = c.DueAmt, u.getTableName() == "VAB_Payment" ? c.IsReturnTrx == "Y" ? (u.setValue("PayAmt", h * -1), u.setValue("PaymentAmount", h * -1)) : (u.setValue("PayAmt", h), u.setValue("PaymentAmount", h)) : (u.setValue("Amount", h), i.setContext(r, "InvTotalAmt", t.getValueOfDecimal(u.getValue("Amount"))))) } return this.setCalloutActive(!1), "" }; h.prototype.Amounts = function (i, r, u, f, e, o) { var v, c, p, s, b, nt; if (this.isCalloutActive()) return ""; if (v = 0, c = 0, "I" == u.getValue("CashType")) { if (v = i.getContext("InvTotalAmt"), (v == null || v.toString().length == 0) && (v = i.getContext(r, "InvTotalAmt")), v == null || v.toString().length == 0) return ""; c = t.getValueOfDecimal(v) } if (this.setCalloutActive(!0), p = 0, s = t.getValueOfDecimal(u.getValue("Amount")), "I" == u.getValue("CashType")) { var a = t.getValueOfDecimal(u.getValue("DiscountAmt")), l = t.getValueOfDecimal(u.getValue("WriteOffAmt")), h = t.getValueOfDecimal(u.getValue("OverUnderAmt")), w = f.getColumnName(), y = u.getValue("VSS_PaymentType"); y == "P" ? (s > 0 && (s = s * -1, u.setValue("PayAmt", s)), a > 0 && (a = a * -1), l > 0 && (l = l * -1, u.setValue("WriteOffAmt", l)), h > 0 && (h = h * -1, u.setValue("OverUnderAmt", h)), c > 0 && (c = c * -1)) : (s < 0 && (s = s * -1, u.setValue("PayAmt", s)), a < 0 && (a = a * -1), l < 0 && (l = l * -1, u.setValue("WriteOffAmt", l)), h < 0 && (h = h * -1, u.setValue("OverUnderAmt", h)), c < 0 && (c = c * -1)); this.log.fine(w + " - Invoice=" + c + " - Amount=" + s + ", Discount=" + a + ", WriteOff=" + l); w == "Amount" ? (b = c - s, h = b - a - l, (y == "R" && h > 0 || y == "P" && h < 0) && n.ADialog.info("LessScheduleAmount"), (y == "P" && h > 0 || y == "R" && h < 0) && (n.ADialog.info("MoreScheduleAmount"), s = c - a - l, h = c - s - a - l, u.setValue("PayAmt", s)), u.setValue("DiscountAmt", a), u.setValue("OverUnderAmt", h)) : (b = c - a, s = b - l - h, (y == "P" && s > 0 || y == "R" && s < 0) && (n.ADialog.info("MoreScheduleAmount"), w == "OverUnderAmt" && (s = c - a - l, h = c - s - a - l, u.setValue("OverUnderAmt", h)), w == "DiscountAmt" && (s = c - h - l, a = c - s - h - l, u.setValue("DiscountAmt", a)), w == "WriteOffAmt" && (s = c - a - h, l = c - s - a - h, u.setValue("WriteOffAmt", l))), u.setValue("Amount", s), (y == "R" && h > 0 || y == "P" && h < 0) && n.ADialog.info("LessScheduleAmount")) } var k = u.getValue("VAB_CashJRNL_ID").toString(), d = n.dataContext.getJSONRecord("MCashBook/GetCashJournal", k), it = d.DateAcct, g = d.VAB_Currency_ID, tt = d.VAB_Currency_ID; return u.getValue("VAB_Currency_ID") != null && (g = u.getValue("VAB_Currency_ID").toString()), nt = 0, u.getField("VAB_CurrencyType_ID") != null && (nt = t.getValueOfInt(u.getValue("VAB_CurrencyType_ID"))), g != tt ? (k = s.toString() + "," + g + "," + tt + "," + it + "," + nt.toString() + "," + i.getVAF_Client_ID().toString() + "," + i.getVAF_Org_ID().toString(), p = n.dataContext.getJSONRecord("MConversionRate/CurrencyConvert", k), t.getValueOfDecimal(u.getValue("Amount")) != 0 && p == 0 && n.ADialog.info("NoCurrencyConversion")) : p = s, u.setValue("convertedAmt", p), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; h.prototype.BeginningBalCalc = function (r, u, f, e, o, s) { var c, y; if (o == null || o.toString() == "" || this.isCalloutActive()) return ""; if (this.setCalloutActive(!0), c = t.getValueOfInt(o), c == null || c == 0) return f.setValue("BeginningBalance", 0), this.setCalloutActive(!1), ""; var l = t.getValueOfInt(f.getValue("VAB_CashBook_ID")), a = t.getValueOfInt(f.getValue("VAF_Client_ID")), v = t.getValueOfInt(f.getValue("VAF_Org_ID")), b = r.getContext("DateAcct"), w = "SELECT EndingBalance FROM VAB_CashJRNL WHERE VAB_CashBook_ID=" + l + " AND VAF_Client_ID=" + a + " AND VAF_Org_ID=" + v + " AND VAB_CashBook_id IN (SELECT Max(VAB_CashBook_id) FROM VAB_CashJRNL WHERE VAB_CashBook_ID=" + l + "AND VAF_Client_ID=" + a + " AND VAF_Org_ID=" + v + ") AND Processed='Y'", h = null; try { h = n.DB.executeReader(w, null, null); h.read() ? (y = t.getValueOfDecimal(h.get(0)), f.setValue("BeginningBalance", y)) : f.setValue("BeginningBalance", 0); h.close() } catch (p) { return h != null && h.close(), this.log.log(i.SEVERE, "Beginning balance", p), this.setCalloutActive(!1), p.toString() } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; h.prototype.SetCurrency = function (i, r, u, f, e, o) { var s, c, l, w, h, b, k, p; if ((e == null || e.toString() == "") && f.getColumnName() != "VAB_CurrencyType_ID" || this.isCalloutActive()) return ""; if (this.setCalloutActive(!0), s = "", c = t.getValueOfDecimal(u.getValue("Amount")), f.getColumnName() == "VAB_CashBook_ID") { if (l = t.getValueOfInt(e), l == null || l == 0) return u.setValue("VAB_Currency_ID", 0), this.setCalloutActive(!1), ""; s = l.toString(); w = n.dataContext.getJSONRecord("MCashBook/GetCashBook", s); u.setValue("VAB_Currency_ID", w.VAB_Currency_ID) } else if (f.getColumnName() == "VAB_Bank_Acct_ID") { if (h = t.getValueOfInt(e), h == null || h == 0) return u.setValue("VAB_Currency_ID", 0), this.setCalloutActive(!1), ""; s = h.toString(); b = "SELECT VAB_Currency_ID FROM VAB_Bank_Acct WHERE VAB_Bank_Acct_ID = " + h; k = t.getValueOfInt(n.DB.executeScalar(b, null, null)); u.setValue("VAB_Currency_ID", k) } if (c != 0) { s = u.getValue("VAB_CashJRNL_ID").toString(); var a = 0, v = n.dataContext.getJSONRecord("MCashBook/GetCashJournal", s), g = v.DateAcct, y = v.VAB_Currency_ID, d = v.VAB_Currency_ID; u.getValue("VAB_Currency_ID") != null && (y = u.getValue("VAB_Currency_ID").toString()); p = 0; u.getField("VAB_CurrencyType_ID") != null && (p = t.getValueOfInt(u.getValue("VAB_CurrencyType_ID"))); y != d ? (s = c.toString() + "," + y + "," + d + "," + g + "," + p.toString() + "," + i.getVAF_Client_ID().toString() + "," + i.getVAF_Org_ID().toString(), a = n.dataContext.getJSONRecord("MConversionRate/CurrencyConvert", s), a == 0 && n.ADialog.info("NoCurrencyConversion")) : a = c; u.setValue("convertedAmt", a) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; h.prototype.ConvertedAmt = function (i, r, u, f, e, o) { var c, s; if (e == null || e.toString() == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); c = "SELECT CASHLINE.Amount FROM VAB_CashJRNLLine CASHLINE INNER JOIN VAB_CashBook CB ON (CB.VAB_CashBook_ID=CASHLINE.VAB_CashBook_ID) WHERE CASHLINE.VAB_CashJRNLLine_ID =" + e; try { if (s = t.getValueOfInt(n.DB.executeScalar("SELECT VAB_Currency_ID FROM VAB_CashBook WHERE VAB_CashBook_ID=(SELECT VAB_CashBook_ID FROM VAB_CashJRNL WHERE VAB_CashJRNL_ID=" + u.getValue("VAB_CashJRNL_ID") + ")")), s == 0) return this.setCalloutActive(!1), ""; var h = t.getValueOfDecimal(n.DB.executeScalar(c)), a = t.getValueOfInt(n.DB.executeScalar("SELECT VAB_Currency_ID FROM VAB_CashBook WHERE VAB_CashBook_ID= (SELECT VAB_CashBook_ID FROM VAB_CashJRNL WHERE VAB_CashJRNL_ID= (SELECT VAB_CashJRNL_ID FROM VAB_CashJRNLLine WHERE VAB_CashJRNLLine_ID= " + e + "))")), v = h.toString() + "," + a.toString() + "," + s.toString() + "," + i.getVAF_Client_ID().toString() + "," + i.getVAF_Org_ID().toString(), l = n.dataContext.getJSONRecord("MConversionRate/Convert", v); h != 0 && l == 0 && n.ADialog.info("NoCurrencyConversion"); u.setValue("ConvertedAmt", l); u.setValue("Amount", h) } catch (y) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; h.prototype.GetBeginBal = function (i, r, u, f, e) { if (e == null || e == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); var o = t.getValueOfDecimal(n.DB.executeScalar(" select sum(nvl(CompletedBalance,0)) + sum(nvl(runningbalance,0)) as TotalBal from VAB_CashBook where VAB_CashBook_id=" + e)); return u.setValue("BeginningBalance", o), this.setCalloutActive(!1), "" }; n.Model.CalloutCashJournal = h; n.Utility.inheritPrototype(ht, n.CalloutEngine); ht.prototype.FillAttribute = function (i, r, u, f, e) { var o, s, l, h, a, c; return this.isCalloutActive() || e == null || e.toString() == "" ? "" : (o = i.getContext(r, "AttrCode"), this.setCalloutActive(!0), o != null && o != "" && (s = "SELECT VAM_PFeature_Set_ID FROM VAM_Product WHERE VAM_Product_ID = " + t.getValueOfInt(e), l = t.getValueOfInt(n.DB.executeScalar(s)), l > 0 && (s = "SELECT VAM_PFeature_SetInstance_ID FROM VAM_ProductFeatures WHERE UPC = '" + o + "' AND VAM_Product_ID = " + t.getValueOfInt(e), h = t.getValueOfInt(n.DB.executeScalar(s)), h > 0 ? u.setValue("VAM_PFeature_SetInstance_ID", h) : o.indexOf("(01)") >= 0 && (a = o + "," + t.getValueOfInt(e) + "," + r, c = n.dataContext.getJSONRecord("MVAMInvInOut/GetASIID", a), c != 0 && u.setValue("VAM_PFeature_SetInstance_ID", c)))), this.setCalloutActive(!1), "") }; ht.prototype.FillUPC = function (i, r, u, f, e) { var s = "", h = 0, o; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; if (o = i.getContext(r, "AttrCode"), this.setCalloutActive(!0), t.getValueOfString(o) != "") { if (s = "SELECT Count(*) FROM VAM_Manufacturer WHERE IsActive = 'Y' AND UPC = '" + o + "'", h = t.getValueOfInt(n.DB.executeScalar(s, null, null)), h > 0) return this.setCalloutActive(!1), n.Msg.getMsg("Attribute Code Already Exist"); u.setValue("UPC", o) } return this.setCalloutActive(!1), "" }; n.Model.CalloutSetAttributeCode = ht; n.Utility.inheritPrototype(k, n.CalloutEngine); k.prototype.ProductCategory = function (i, r, u, f, e, o) { var s, c, h, l; return e == null || e.toString() == "" ? "" : (s = t.getValueOfInt(e), s == null || t.getValueOfInt(s) == 0 || s == 0) ? "" : (c = t.getValueOfInt(e), h = null, h = n.dataContext.getJSONRecord("MVAMProductCategory/GetProductCategory", c), l = h.IsPurchasedToOrder, u.setValue("IsPurchasedToOrder", l), pc = null, i = r = u = f = e = o = null, "") }; k.prototype.UOM = function (i, r, u, f, e, o) { var s, h, c; return this.isCalloutActive() || e == null || e.toString() == "" ? "" : u.getValue("VAM_Product_id") == null ? "" : (this.setCalloutActive(!0), s = "select count(*) from VAM_Inv_Trx where VAM_Product_id = " + t.getValueOfInt(u.getValue("VAM_Product_id")), h = t.getValueOfInt(n.DB.executeScalar(s, null, null)), h > 0 && (n.ADialog.info("Can't change UOM due to Transactions happens based on existing UOM"), s = "select VAB_UOM_id from VAM_Product where VAM_Product_id =  " + t.getValueOfInt(u.getValue("VAM_Product_id")), c = t.getValueOfInt(n.DB.executeScalar(s, null, null)), u.setValue("VAB_UOM_ID", c)), this.setCalloutActive(!1), i = r = u = f = e = o = null, "") }; k.prototype.ResourceGroup = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = t.getValueOfString(f); return o == null || o.length == 0 ? "" : ("O" == o ? r.setValue("BasisType", null) : r.setValue("BasisType", "I"), n = i = r = u = f = e = null, "") }; k.prototype.Organization = function (i, r, u, f, e, o) { var h, s, c; return e == null || e.toString() == "" ? "" : (h = t.getValueOfInt(e), h == null) ? "" : (s = null, s = n.dataContext.getJSONRecord("MVAMLocator/GetLocator", paramString), c = s.Default_Locator_ID, u.setValue("VAM_Locator_ID", c), i = r = u = f = e = o = null, "") }; n.Model.CalloutProduct = k; n.Utility.inheritPrototype(ct, n.CalloutEngine); ct.prototype.Planned = function (i, r, u, f, e, o) { var d, g, p, a, v; if (e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; this.setCalloutActive(!0); var y, s, c, h, w = 0, l = i.getStdPrecision(), b = t.getValueOfInt(u.getValue("VAB_ProjectJob_ID")), nt = "SELECT VAB_Project_ID FROM VAB_ProjectStage WHERE VAB_ProjectStage_id IN (select VAB_ProjectStage_id from VAB_ProjectJob WHERE VAB_ProjectJob_ID=" + b + ")", k = t.getValueOfInt(n.DB.executeScalar(nt, null, null)); return b == 0 && (k = t.getValueOfInt(u.getValue("VAB_Project_ID"))), d = "SELECT PriceLimit FROM VAM_ProductPrice WHERE VAM_PriceListVersion_ID = (SELECT c.VAM_PriceListVersion_id FROM  VAB_Project c WHERE c.VAB_Project_ID=" + k + ")  AND VAM_Product_id=" + t.getValueOfInt(u.getValue("VAM_Product_ID")), g = t.getValueOfDecimal(n.DB.executeScalar(d, null, null)), y = t.getValueOfDecimal(u.getValue("PlannedQty")), y == null ? y = Envs.ONE : w = (t.getValueOfDecimal(u.getValue("PlannedPrice")) - g) * t.getValueOfDecimal(u.getValue("PlannedQty")), s = t.getValueOfDecimal(u.getValue("PlannedPrice")), s == null && (s = n.Env.ZERO), c = u.getValue("PriceList"), c == null && (c = s), h = u.getValue("Discount"), h == null && (h = n.Env.ZERO), p = f.getColumnName(), p == "PlannedPrice" ? (c == 0 ? h = n.Env.ZERO : (a = (s * n.Env.ONEHUNDRED / c).toFixed(l), h = n.Env.ONEHUNDRED - a), u.setValue("Discount", h), this.log.fine("PriceList=" + c + " - Discount=" + h + " -> [PlannedPrice=" + s + "] (Precision=" + l + ")")) : p == "PriceList" ? (n.Env.signum(c) == 0 ? h = n.Env.ZERO : (a = (s * n.Env.ONEHUNDRED / c).toFixed(l), h = n.Env.ONEHUNDRED - a), u.setValue("Discount", h), this.log.fine("[PriceList=" + c + "] - Discount=" + h + " -> PlannedPrice=" + s + " (Precision=" + l + ")")) : p == "Discount" && (a = (h / n.Env.ONEHUNDRED).toFixed(10), a = n.Env.ONE - a, s = c * a, t.scale(s) > l && (s = s.toFixed(l)), u.setValue("PlannedPrice", s), this.log.fine("PriceList=" + c + " - [Discount=" + h + "] -> PlannedPrice=" + s + " (Precision=" + l + ")")), v = y * s, t.scale(v) > l && (v = v.toFixed(l)), this.log.fine("PlannedQty=" + y + " * PlannedPrice=" + s + " -> PlannedAmt=" + v + " (Precision=" + l + ")"), u.setValue("PlannedAmt", v), u.setValue("PlannedMarginAmt", w), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; ct.prototype.Product = function (i, r, u, f, e, o) { var c, l, a, h, p; if (e == null || e.toString() == "" || (c = t.getValueOfInt(e), l = i.getContextAsInt(r, "VAM_PriceListVersion_ID"), c == null || t.getValueOfInt(c) == 0 || l == 0)) return ""; this.setCalloutActive(!0); var v = i.getContextAsInt(r, "VAB_BusinessPartner_ID"), y = t.getValueOfDecimal(u.getValue("PlannedQty")), s = t.getValueOfDateTime(u.getValue("PlannedDate")); return s == null ? (s = t.getValueOfDateTime(u.getValue("DateContract")), s == null && (s = t.getValueOfDateTime(u.getValue("DateFinish")), s == null && (s = new Date)), a = c.toString().concat(",", v.toString(), ",", y.toString(), ",", isSOTrx, ",", VAM_PriceList_ID.toString(), ",", l.toString(), ",", s.toString(), ",", null), h = null, h = n.dataContext.getJSONRecord("MVAMProductPricing/GetProductPricing", a), p = null, u.setValue("PriceList", h.PriceList), u.setValue("PlannedPrice", h.PriceActual), u.setValue("Discount", h.Discount), u.setValue("PlannedAmt", h.LineAmt), "") : (i = r = u = f = e = o = null, "") }; n.Model.CalloutProject = ct; n.Utility.inheritPrototype(d, n.CalloutEngine); d.prototype.BankAccount = function (t, r, u, f, e, o) { if (e == null || e.toString() == "") return ""; try { var l = e, h = e.toString(), s; s = n.dataContext.getJSONRecord("MBankStatement/GetCurrentBalance", h); u.setValue("BeginningBalance", s) } catch (c) { this.setCalloutActive(!1); this.log.log(i.SEVERE, "", c) } return t = r = u = f = e = o = null, "" }; d.prototype.Amount = function (n, t, i, r, u, f) { var s, h, o, e, c; return u == null || u.toString() == "" ? "" : this.isCalloutActive() ? "" : (this.setCalloutActive(!0), s = i.getValue("StmtAmt"), s == null && (s = 0), h = i.getValue("TrxAmt"), h == null && (h = 0), e = i.getValue("ChargeAmt"), e == null && (e = 0), o = s - h, r.getColumnName() == "ChargeAmt" ? (e = u, e == null && (e = 0), o = o - e, i.setValue("InterestAmt", o)) : (c = i.getValue("InterestAmt"), c == null && (c = 0), o = o - c, i.setValue("ChargeAmt", o)), this.setCalloutActive(!1), n = t = i = r = u = f = null, "") }; d.prototype.Payment = function (t, r, u, f, e, o) { var s, h, a, c, v, l; if (e == null || e.toString() == "" || (s = e, s == null || s == 0)) return u.setValue("StmtAmt", 0), u.setValue("TrxAmt", 0), u.setValue("ChargeAmt", 0), u.setValue("ChargeAmt", 0), u.setValue("VAB_BusinessPartner_ID", 0), u.setValue("VAB_Invoice_ID", 0), ""; h = u.getValue("StmtAmt"); h == null && (h = 0); a = u.getValue("VAB_Currency_ID"); c = u.getValue("ValutaDate"); c == null && (c = new Date); try { v = s.toString() + "," + a.toString() + "," + c.toString(); l = n.dataContext.getJSONRecord("MBankStatement/GetPayment", v); u.setValue("TrxAmt", l); h == 0 && u.setValue("StmtAmt", l) } catch (y) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, "BankStmt_Payment", y), y.toString() } return this.Amount(t, r, u, f, e), t = r = u = f = e = o = null, "" }; d.prototype.SetConvertedAmt = function (r, u, f, e, o, s) { var h, c, l, a, v; if (o == null || o.toString() == "" || this.isCalloutActive() || (h = t.getValueOfInt(f.getValue("VAB_Payment_ID")), h == 0)) return ""; c = f.getValue("VAB_Currency_ID"); l = f.getValue("DateAcct"); try { a = h.toString() + "," + c.toString() + "," + l.toString(); v = n.dataContext.getJSONRecord("MBankStatement/GetConvertedAmt", a); f.setValue("StmtAmt", v) } catch (y) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, "BankStmt_DateAcct", y), y.toString() } return this.Amount(r, u, f, e, o), r = u = f = e = o = s = null, "" }; n.Model.CalloutBankStatement = d; n.Utility.inheritPrototype(c, n.CalloutEngine); c.prototype.CalculatePrice = function (n, t, i) { return Decimal.Subtract(Decimal.Multiply(n, t), i) }; c.prototype.CalculateRebate = function (n, t, i) { return Decimal.Multiply(Decimal.Multiply(n, t), Decimal.Multiply(new Decimal(.01), i)) }; c.prototype.OfferServices = function (i, r, u, f, e, o) { var it, ht, kt, st; if (e == null || e.toString() == "" || (it = 24, ht = t.getValueOfInt(e), ht == null || ht == 0)) return ""; var ct = 0, lt = new Decimal(0), at = new Decimal(0), vt = new Decimal(0), s, l, a, v, h, k, d, pt, wt, ut = null; try { for (st = [], st[0] = new n.DB.SqlParam("@FO_SERVICE_ID", ht), ut = n.DB.executeReader("select uom.FO_HOTEL_UOM_ID,s.DESCRIPTION from FO_HOTEL_UOM uom inner join FO_SERVICE s ON(uom.FO_HOTEL_UOM_ID= s.FO_HOTEL_UOM_ID) where s.FO_SERVICE_ID=@FO_SERVICE_ID ", st, null); ut.read();)ct = t.getValueOfInt(ut[0]), u.setValue("AUOM_ID", ct), u.setValue("CG1UOM_ID", ct), u.setValue("CG2UOM_ID", ct), u.setValue("DESCRIPTION", t.getValueOfString(ut[1])); ut.close() } catch (bt) { this.setCalloutActive(!1); ut != null && ut.close(); this.log.severe(bt.toString()) } kt = "select PRICE,CHILDGROUP1,CHILDGROUP2,UOM1,UOM2 from FO_SERVICE_PRICE_PRICELINE where CREATED=(select max(CREATED) from FO_SERVICE_PRICE_PRICELINE where FO_SERVICE_ID=@FO_SERVICE_ID)"; try { for (st = [], st[0] = new n.DB.SqlParam("@FO_SERVICE_ID", ht), ut = n.DB.executeReader(kt, st, null); ut.read();)lt = t.getValueOfDecimal(ut[0]), at = t.getValueOfDecimal(ut[1]), vt = t.getValueOfDecimal(ut[2]), pt = ut[3].toString(), wt = ut[4].toString(), pt.equals("Y") && (at = Decimal.Multiply(Decimal.Multiply(lt, at), new Decimal(.01))), wt.equals("Y") && (vt = Decimal.Multiply(Decimal.Multiply(lt, vt), new Decimal(.01))), u.setValue("APRICE", lt), u.setValue("CG1PRICE", at), u.setValue("CG2PRICE", vt); ut.close() } catch (bt) { this.setCalloutActive(!1); this.log.severe(bt.toString()) } var dt = u.getValue("AUOM_ID").toString(), g = t.getValueOfInt(u.getValue("ANUM")), p = t.getValueOfDecimal(u.getValue("AP0RICE")), b = t.getValueOfDecimal(u.getValue("AREBATE")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1P0RICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), gt = t.getValueOfDateTime(u.getValue("ADATETO")), ni = t.getValueOfDateTime(u.getValue("ADATEFROM")), c = Utility.timeUtil.getDaysBetween(ni, gt), yt = ni.Subtract(gt), ft, rt, ti = c / 30, ri = c % 30, ii = c / 7, ui = c % 7; ft = ri == 0 ? ti : ti + 1; rt = ui == 0 ? ii : ii + 1; var fi = yt.TotalMilliseconds, et = yt.TotalSeconds, ot = yt.TotalMinutes; if (t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(dt)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(rt), p, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(it * c), p, h); l = CalculatePrice(new Decimal(it * c), y, h); a = CalculatePrice(new Decimal(it * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(ot), p, h); l = CalculatePrice(new Decimal(ot), y, h); a = CalculatePrice(new Decimal(ot), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(et), p, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) } } else switch (int.Parse(dt)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(rt), p, b); s = CalculatePrice(new Decimal(rt), p, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), w, b); a = CalculatePrice(new Decimal(rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(it * c), p, b); s = CalculatePrice(new Decimal(it * c), p, h); k = CalculateRebate(new Decimal(it * c), y, b); l = CalculatePrice(new Decimal(it * c), y, k); d = CalculateRebate(new Decimal(it * c), w, b); a = CalculatePrice(new Decimal(it * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(ot), p, b); s = CalculatePrice(new Decimal(ot), p, h); k = CalculateRebate(new Decimal(ot), y, b); l = CalculatePrice(new Decimal(ot), y, k); d = CalculateRebate(new Decimal(ot), w, b); a = CalculatePrice(new Decimal(ot), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(et), p, b); s = CalculatePrice(new Decimal(et), p, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), w, b); a = CalculatePrice(new Decimal(et), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; c.prototype.tochkdate = function (i, r, u, f, e, o) { var it, s, l, a, h, k, d, v, ct, vt, yt, at, st; if (e == null || e.toString() == "" || (it = 24, ct = t.getValueOfDateTime(e), ct == null || ct.equals(0))) return ""; var ot = t.getValueOfDateTime(e), ht = t.getValueOfDateTime(u.getValue("ADATEFROM")), g = t.getValueOfInt(u.getValue("CG1NUM")), nt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), p = t.getValueOfDecimal(u.getValue("CG2PRICE")); try { if (ot = t.getValueOfDateTime(u.getValue("ADATETO")), vt = Utility.timeUtil.getDaysBetween(ht, ot), vt <= 0) yt = Utility.TimeUtil.AddDays(ht, 1), u.setValue("ADATETO", yt); else if (ot.compareTo(ht) > 0) { var lt = ot.Subtract(ht), c = Utility.timeUtil.getDaysBetween(ht, ot), gt = lt.TotalMilliseconds, ft = lt.TotalMinutes, et = lt.TotalMinutes, ut, rt, pt = c / 30, bt = c % 30, wt = c / 7, kt = c % 7; ut = bt == 0 ? pt : pt + 1; rt = kt == 0 ? wt : wt + 1; at = t.getValueOfDateTime(u.getValue("ADATEFROM")); u.setValue("CG1DATETO", ot); u.setValue("CG2DATETO", ot); u.setValue("CG1DATEFROM", at); u.setValue("CG2DATEFROM", at); st = u.getValue("AUOM_ID").toString(); (st == "" || st.toString().trim().length == 0) && (st = "0"); var w = t.getValueOfDecimal(u.getValue("APRICE")), tt = t.getValueOfInt(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")); if (t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(st)) { case 1000003: s = w; l = y; a = p; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), w, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ut), w, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(rt), w, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), w, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(it * c), w, h); l = CalculatePrice(new Decimal(it * c), y, h); a = CalculatePrice(new Decimal(it * c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), w, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), w, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(tt * rt), w, h); l = CalculatePrice(new Decimal(g * rt), y, h); a = CalculatePrice(new Decimal(nt * rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(tt * rt), w, h); l = CalculatePrice(new Decimal(g * rt), y, h); a = CalculatePrice(new Decimal(nt * rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); l = CalculatePrice(new Decimal(g * (c + 1)), y, h); a = CalculatePrice(new Decimal(nt * (c + 1)), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * tt), w, h); l = CalculatePrice(new Decimal((c + 1) * g), y, h); a = CalculatePrice(new Decimal((c + 1) * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(it * c * tt), w, h); l = CalculatePrice(new Decimal(it * c * g), y, h); a = CalculatePrice(new Decimal(it * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(it * c * tt), w, h); l = CalculatePrice(new Decimal(it * c * g), y, h); a = CalculatePrice(new Decimal(it * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) } } else switch (int.Parse(st)) { case 1000003: s = w; l = y; a = p; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), w, b); s = CalculatePrice(new Decimal(c), w, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), p, b); a = CalculatePrice(new Decimal(c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ut), w, b); s = CalculatePrice(new Decimal(ut), w, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), p, b); a = CalculatePrice(new Decimal(ut), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(rt), w, b); s = CalculatePrice(new Decimal(rt), w, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), p, b); a = CalculatePrice(new Decimal(rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), w, b); s = CalculatePrice(new Decimal(c + 1), w, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), p, b); a = CalculatePrice(new Decimal(c + 1), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(it * c), w, b); s = CalculatePrice(new Decimal(it * c), w, h); k = CalculateRebate(new Decimal(it * c), y, b); l = CalculatePrice(new Decimal(it * c), y, k); d = CalculateRebate(new Decimal(it * c), p, b); a = CalculatePrice(new Decimal(it * c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), w, b); s = CalculatePrice(new Decimal(et), w, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), p, b); a = CalculatePrice(new Decimal(et), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), w, b); s = CalculatePrice(new Decimal(ft), w, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), p, b); a = CalculatePrice(new Decimal(ft), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(tt * rt), w, b); s = CalculatePrice(new Decimal(tt * rt), w, h); k = CalculateRebate(new Decimal(g * rt), y, b); l = CalculatePrice(new Decimal(g * rt), y, k); d = CalculateRebate(new Decimal(nt * rt), p, b); a = CalculatePrice(new Decimal(nt * rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(tt * rt), w, b); s = CalculatePrice(new Decimal(tt * rt), w, h); k = CalculateRebate(new Decimal(g * rt), y, b); l = CalculatePrice(new Decimal(g * rt), y, k); d = CalculateRebate(new Decimal(nt * rt), p, b); a = CalculatePrice(new Decimal(nt * rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal((c + 1) * tt), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(it * c * tt), w, b); s = CalculatePrice(new Decimal(it * c * tt), w, h); k = CalculateRebate(new Decimal(it * c * g), y, b); l = CalculatePrice(new Decimal(it * c * g), y, k); d = CalculateRebate(new Decimal(it * c * nt), p, b); a = CalculatePrice(new Decimal(it * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(it * c * tt), w, b); s = CalculatePrice(new Decimal(it * c * tt), w, h); k = CalculateRebate(new Decimal(it * c * g), y, b); l = CalculatePrice(new Decimal(it * c * g), y, k); d = CalculateRebate(new Decimal(it * c * nt), p, b); a = CalculatePrice(new Decimal(it * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) }tt == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)); g == 0 && u.setValue("CG1TOTAL_AMOUNT", 0); nt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0) } } catch (dt) { this.setCalloutActive(!1); this.log.severe(dt.toString()) } return i = r = u = f = e = o = null, "" }; c.prototype.fromchkdate = function (i, r, u, f, e, o) { var it, s, l, a, h, k, d, v, ct, vt, at, ht; if (e == null || e.toString() == "" || (it = 24, ct = t.getValueOfDateTime(e), ct == null || ct.equals(0))) return ""; var ot = t.getValueOfDateTime(u.getValue("ADATEFROM")), st = t.getValueOfDateTime(u.getValue("ADATETO")), g = t.getValueOfInt(u.getValue("CG1NUM")), nt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), p = t.getValueOfDecimal(u.getValue("CG2PRICE")); try { if (ot = t.getValueOfDateTime(u.getValue("ADATEFROM")), ot.compareTo(st) > 0) u.setValue("CG1DATEFROM", ot), u.setValue("CG2DATEFROM", ot), vt = Utility.timeUtil.addDays(ot, 1), u.setValue("ADATETO", vt); else if (st.compareTo(ot) > 0) { var lt = st.Subtract(ot), c = Utility.timeUtil.getDaysBetween(ot, st), dt = lt.TotalMilliseconds, ft = lt.TotalSeconds, et = lt.TotalMinutes, ut, rt, yt = c / 30, wt = c % 30, pt = c / 7, bt = c % 7; ut = wt == 0 ? yt : yt + 1; rt = bt == 0 ? pt : pt + 1; at = t.getValueOfDateTime(u.getValue("ADATEFROM")); u.setValue("CG1DATETO", st); u.setValue("CG2DATETO", st); u.setValue("CG1DATEFROM", at); u.setValue("CG2DATEFROM", at); ht = u.getValue("AUOM_ID").toString(); (ht == "" || ht.toString().trim().length == 0) && (ht = "0"); var w = t.getValueOfDecimal(u.getValue("APRICE")), tt = t.getValueOfInt(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")); if (t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(ht)) { case 1000003: s = w; l = y; a = p; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), w, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ut), w, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(rt), w, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), w, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(it * c), w, h); l = CalculatePrice(new Decimal(it * c), y, h); a = CalculatePrice(new Decimal(it * c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), w, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), w, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(tt * rt), w, h); l = CalculatePrice(new Decimal(g * rt), y, h); a = CalculatePrice(new Decimal(nt * rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(tt * rt), w, h); l = CalculatePrice(new Decimal(g * rt), y, h); a = CalculatePrice(new Decimal(nt * rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); l = CalculatePrice(new Decimal(g * (c + 1)), y, h); a = CalculatePrice(new Decimal(nt * (c + 1)), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * tt), w, h); l = CalculatePrice(new Decimal((c + 1) * g), y, h); a = CalculatePrice(new Decimal((c + 1) * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(it * c * tt), w, h); l = CalculatePrice(new Decimal(it * c * g), y, h); a = CalculatePrice(new Decimal(it * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(it * c * tt), w, h); l = CalculatePrice(new Decimal(it * c * g), y, h); a = CalculatePrice(new Decimal(it * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) } } else switch (int.Parse(ht)) { case 1000003: s = w; l = y; a = p; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), w, b); s = CalculatePrice(new Decimal(c), w, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), p, b); a = CalculatePrice(new Decimal(c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ut), w, b); s = CalculatePrice(new Decimal(ut), w, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), p, b); a = CalculatePrice(new Decimal(ut), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(rt), w, b); s = CalculatePrice(new Decimal(rt), w, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), p, b); a = CalculatePrice(new Decimal(rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), w, b); s = CalculatePrice(new Decimal(c + 1), w, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), p, b); a = CalculatePrice(new Decimal(c + 1), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(it * c), w, b); s = CalculatePrice(new Decimal(it * c), w, h); k = CalculateRebate(new Decimal(it * c), y, b); l = CalculatePrice(new Decimal(it * c), y, k); d = CalculateRebate(new Decimal(it * c), p, b); a = CalculatePrice(new Decimal(it * c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), w, b); s = CalculatePrice(new Decimal(et), w, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), p, b); a = CalculatePrice(new Decimal(et), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), w, b); s = CalculatePrice(new Decimal(ft), w, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), p, b); a = CalculatePrice(new Decimal(ft), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(tt * rt), w, b); s = CalculatePrice(new Decimal(tt * rt), w, h); k = CalculateRebate(new Decimal(g * rt), y, b); l = CalculatePrice(new Decimal(g * rt), y, k); d = CalculateRebate(new Decimal(nt * rt), p, b); a = CalculatePrice(new Decimal(nt * rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(tt * rt), w, b); s = CalculatePrice(new Decimal(tt * rt), w, h); k = CalculateRebate(new Decimal(g * rt), y, b); l = CalculatePrice(new Decimal(g * rt), y, k); d = CalculateRebate(new Decimal(nt * rt), p, b); a = CalculatePrice(new Decimal(nt * rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal((c + 1) * tt), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(it * c * tt), w, b); s = CalculatePrice(new Decimal(it * c * tt), w, h); k = CalculateRebate(new Decimal(it * c * g), y, b); l = CalculatePrice(new Decimal(it * c * g), y, k); d = CalculateRebate(new Decimal(it * c * nt), p, b); a = CalculatePrice(new Decimal(it * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(it * c * tt), w, b); s = CalculatePrice(new Decimal(it * c * tt), w, h); k = CalculateRebate(new Decimal(it * c * g), y, b); l = CalculatePrice(new Decimal(it * c * g), y, k); d = CalculateRebate(new Decimal(it * c * nt), p, b); a = CalculatePrice(new Decimal(it * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) }tt == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)); g == 0 && u.setValue("CG1TOTAL_AMOUNT", 0); nt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0) } } catch (kt) { this.setCalloutActive(!1); this.log.severe(kt.toString()) } return i = r = u = f = e = o = null, "" }; c.prototype.UOMSelected = function (i, r, u, f, e, o) { var it, s, l, a, h, k, d, v, ot; if (e == null || e.toString() == "" || (it = 24, ot = t.getValueOfInt(e), ot = t.getValueOfInt(u.getValue("AUOM_ID")), ot == null)) return ""; u.setValue("CG1UOM_ID", ot); u.setValue("CG2UOM_ID", ot); var ht = u.getValue("AUOM_ID").toString(), p = t.getValueOfDecimal(u.getValue("APRICE")), g = t.getValueOfInt(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), ct = t.getValueOfDateTime(u.getValue("ADATETO")), lt = t.getValueOfDateTime(u.getValue("ADATEFROM")), st = ct.Subtract(lt), c = Utility.timeUtil.getDaysBetween(lt, ct), wt = st.TotalMilliseconds, ft = st.TotalSeconds, et = st.TotalMinutes, ut, rt, at = c / 30, yt = c % 30, vt = c / 7, pt = c % 7; if (ut = yt == 0 ? at : at + 1, rt = pt == 0 ? vt : vt + 1, t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(ht)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ut), p, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(rt), p, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(it * c), p, h); l = CalculatePrice(new Decimal(it * c), y, h); a = CalculatePrice(new Decimal(it * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), p, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) } } else switch (int.Parse(ht)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ut), p, b); s = CalculatePrice(new Decimal(ut), p, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), w, b); a = CalculatePrice(new Decimal(ut), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(rt), p, b); s = CalculatePrice(new Decimal(rt), p, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), w, b); a = CalculatePrice(new Decimal(rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(it * c), p, b); s = CalculatePrice(new Decimal(it * c), p, h); k = CalculateRebate(new Decimal(it * c), y, b); l = CalculatePrice(new Decimal(it * c), y, k); d = CalculateRebate(new Decimal(it * c), w, b); a = CalculatePrice(new Decimal(it * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), p, b); s = CalculatePrice(new Decimal(et), p, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), w, b); a = CalculatePrice(new Decimal(et), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; c.prototype.AVALSelected = function (i, r, u, f, e, o) { var it, s, l, a, h, k, d, v, ot; if (e == null || e.toString() == "") return ""; it = 24; ot = null; try { ot = u.getValue("AUOM_ID").toString() } catch (pt) { return this.setCalloutActive(!1), "" } var p = t.getValueOfDecimal(u.getValue("APRICE")), b = t.getValueOfDecimal(u.getValue("AREBATE")), g = t.getValueOfInt(u.getValue("ANUM")), ht = t.getValueOfDateTime(u.getValue("ADATETO")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), ct = t.getValueOfDateTime(u.getValue("ADATEFROM")), st = ht.Subtract(ct), c = Utility.timeUtil.getDaysBetween(ct, ht), wt = st.TotalMilliseconds, ft = st.TotalSeconds, et = st.TotalMinutes, ut, rt, lt = c / 30, vt = c % 30, at = c / 7, yt = c % 7; if (ut = vt == 0 ? lt : lt + 1, rt = yt == 0 ? at : at + 1, t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(ot)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ut), p, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(rt), p, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(it * c), p, h); l = CalculatePrice(new Decimal(it * c), y, h); a = CalculatePrice(new Decimal(it * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), p, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) } } else switch (int.Parse(ot)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ut), p, b); s = CalculatePrice(new Decimal(ut), p, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), w, b); a = CalculatePrice(new Decimal(ut), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(rt), p, b); s = CalculatePrice(new Decimal(rt), p, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), w, b); a = CalculatePrice(new Decimal(rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(it * c), p, b); s = CalculatePrice(new Decimal(it * c), p, h); k = CalculateRebate(new Decimal(it * c), y, b); l = CalculatePrice(new Decimal(it * c), y, k); d = CalculateRebate(new Decimal(it * c), w, b); a = CalculatePrice(new Decimal(it * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), p, b); s = CalculatePrice(new Decimal(et), p, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), w, b); a = CalculatePrice(new Decimal(et), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; n.Model.CalloutOfferSerIncluded = c; n.Utility.inheritPrototype(l, n.CalloutEngine); l.prototype.CalculatePrice = function (n, t, i) { return Decimal.Subtract(Decimal.Multiply(n, t), i) }; l.prototype.CalculateRebate = function (n, t, i) { return Decimal.Multiply(Decimal.Multiply(n, t), Decimal.Multiply(new Decimal(.01), i)) }; l.prototype.OfferServices = function (i, r, u, f, e, o) { var st, wt, ot, ft, et; if (e == null || e.toString() == "" || (st = t.getValueOfInt(e), st == null || st == 0)) return ""; var ht = 0, ct = new Decimal(0), lt = new Decimal(0), at = new Decimal(0), s, l, a, v, h, k, d, vt, yt, rt = null; try { for (ot = [], ot[0] = new n.DB.SqlParam("@FO_SERVICE_ID", st), rt = n.DB.executeReader("select uom.FO_HOTEL_UOM_ID,s.DESCRIPTION from FO_HOTEL_UOM uom inner join FO_SERVICE s ON(uom.FO_HOTEL_UOM_ID= s.FO_HOTEL_UOM_ID) where s.FO_SERVICE_ID=@FO_SERVICE_ID ", ot, null); rt.read();)ht = t.getValueOfInt(rt[0]), u.setValue("AUOM_ID", ht), u.setValue("CG1UOM_ID", ht), u.setValue("CG2UOM_ID", ht), u.setValue("DESCRIPTION", t.getValueOfString(rt[1])); rt.close() } catch (pt) { this.setCalloutActive(!1); rt != null && rt.close(); this.log.severe(pt.toString()) } finally { rt != null && rt.close() } wt = "select PRICE,CHILDGROUP1,CHILDGROUP2,UOM1,UOM2 from FO_SERVICE_PRICE_PRICELINE where CREATED=(select max(CREATED) from FO_SERVICE_PRICE_PRICELINE where FO_SERVICE_ID=@FO_SERVICE_ID)"; try { for (ot = [], ot[0] = new SqlParameter("@FO_SERVICE_ID", st), rt = n.DB.executeReader(wt, ot, null); rt.read();)ct = t.getValueOfDecimal(rt[0]), lt = t.getValueOfDecimal(rt[1]), at = t.getValueOfDecimal(rt[2]), vt = rt[3].toString(), yt = rt[4].toString(), vt == "Y" && (lt = Decimal.Multiply(Decimal.Multiply(ct, lt), new Decimal(.01))), yt == "Y" && (at = Decimal.Multiply(Decimal.Multiply(ct, at), new Decimal(.01))), u.setValue("APRICE", ct), u.setValue("CG1PRICE", lt), u.setValue("CG2PRICE", at) } catch (pt) { this.setCalloutActive(!1); this.log.severe(pt.toString()) } finally { rt != null && rt.close() } var bt = u.getValue("AUOM_ID").toString(), g = t.getValueOfInt(u.getValue("ANUM")), p = t.getValueOfDecimal(u.getValue("APRICE")), b = t.getValueOfDecimal(u.getValue("AREBATE")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), kt = t.getValueOfDateTime(u.getValue("ADATETO")), dt = t.getValueOfDateTime(u.getValue("ADATEFROM")), c = Utility.timeUtil.getDaysBetween(dt, kt), gt = dt.Subtract(kt), ut, it, ni = c / 30, ii = c % 30, ti = c / 7, ri = c % 7; if (ut = ii == 0 ? ni : ni + 1, it = ri == 0 ? ti : ti + 1, ft = gt.Seconds, et = gt.Minutes, t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(bt)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ut), p, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(it), p, h); l = CalculatePrice(new Decimal(it), y, h); a = CalculatePrice(new Decimal(it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(24 * c), p, h); l = CalculatePrice(new Decimal(24 * c), y, h); a = CalculatePrice(new Decimal(24 * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), p, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") } } else switch (int.Parse(bt)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ut), p, b); s = CalculatePrice(new Decimal(ut), p, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), w, b); a = CalculatePrice(new Decimal(ut), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(it), p, b); s = CalculatePrice(new Decimal(it), p, h); k = CalculateRebate(new Decimal(it), y, b); l = CalculatePrice(new Decimal(it), y, k); d = CalculateRebate(new Decimal(it), w, b); a = CalculatePrice(new Decimal(it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(24 * c), p, b); s = CalculatePrice(new Decimal(24 * c), p, h); k = CalculateRebate(new Decimal(24 * c), y, b); l = CalculatePrice(new Decimal(24 * c), y, k); d = CalculateRebate(new Decimal(24 * c), w, b); a = CalculatePrice(new Decimal(24 * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), p, b); s = CalculatePrice(new Decimal(et), p, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), w, b); a = CalculatePrice(new Decimal(et), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; l.prototype.tochkdate = function (i, r, u, f, e, o) { var s, l, a, h, k, d, v, ht, ut, at, vt, lt, ot; if (e == null || e.toString() == "" || (ht = t.getValueOfDateTime(e), ht == null || ht.equals(0))) return ""; ut = t.getValueOfDateTime(e); ut = t.getValueOfDateTime(u.getValue("ADATETO")); var st = t.getValueOfDateTime(u.getValue("ADATEFROM")), g = t.getValueOfInt(u.getValue("CG1NUM")), nt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), p = t.getValueOfDecimal(u.getValue("CG2PRICE")); try { if (ut = t.getValueOfDateTime(u.getValue("ADATETO")), at = Utility.TimeUtil.getDaysBetween(st, ut), at <= 0) vt = Utility.TimeUtil.AddDays(st, 1), u.setValue("ADATETO", vt); else if (ut.compareTo(st) > 0) { var ct = ut.Subtract(st), c = Utility.TimeUtil.getDaysBetween(st, ut), dt = ct.Milliseconds, ft = ct.Seconds, et = ct.Minutes, rt, it, yt = c / 30, wt = c % 30, pt = c / 7, bt = c % 7; rt = wt == 0 ? yt : yt + 1; it = bt == 0 ? pt : pt + 1; lt = t.getValueOfDateTime(u.getValue("ADATEFROM")); u.setValue("CG1DATETO", ut); u.setValue("CG2DATETO", ut); u.setValue("CG1DATEFROM", lt); u.setValue("CG2DATEFROM", lt); ot = u.getValue("AUOM_ID").toString(); (ot == "" || ot.Trim().Length == 0) && (ot = "0"); var w = t.getValueOfDecimal(u.getValue("APRICE")), tt = System.Convert.ToInt16(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")); if (t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(ot)) { case 1000003: s = w; l = y; a = p; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), w, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(rt), w, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(it), w, h); l = CalculatePrice(new Decimal(it), y, h); a = CalculatePrice(new Decimal(it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), w, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(24 * c), w, h); l = CalculatePrice(new Decimal(24 * c), y, h); a = CalculatePrice(new Decimal(24 * c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), w, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), w, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(tt * it), w, h); l = CalculatePrice(new Decimal(g * it), y, h); a = CalculatePrice(new Decimal(nt * it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(tt * it), w, h); l = CalculatePrice(new Decimal(g * it), y, h); a = CalculatePrice(new Decimal(nt * it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); l = CalculatePrice(new Decimal(g * (c + 1)), y, h); a = CalculatePrice(new Decimal(nt * (c + 1)), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * tt), w, h); l = CalculatePrice(new Decimal((c + 1) * g), y, h); a = CalculatePrice(new Decimal((c + 1) * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(24 * c * tt), w, h); l = CalculatePrice(new Decimal(24 * c * g), y, h); a = CalculatePrice(new Decimal(24 * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(24 * c * tt), w, h); l = CalculatePrice(new Decimal(24 * c * g), y, h); a = CalculatePrice(new Decimal(24 * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") } } else switch (int.Parse(ot)) { case 1000003: s = w; l = y; a = p; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), w, b); s = CalculatePrice(new Decimal(c), w, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), p, b); a = CalculatePrice(new Decimal(c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(rt), w, b); s = CalculatePrice(new Decimal(rt), w, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), p, b); a = CalculatePrice(new Decimal(rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(it), w, b); s = CalculatePrice(new Decimal(it), w, h); k = CalculateRebate(new Decimal(it), y, b); l = CalculatePrice(new Decimal(it), y, k); d = CalculateRebate(new Decimal(it), p, b); a = CalculatePrice(new Decimal(it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), w, b); s = CalculatePrice(new Decimal(c + 1), w, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), p, b); a = CalculatePrice(new Decimal(c + 1), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(24 * c), w, b); s = CalculatePrice(new Decimal(24 * c), w, h); k = CalculateRebate(new Decimal(24 * c), y, b); l = CalculatePrice(new Decimal(24 * c), y, k); d = CalculateRebate(new Decimal(24 * c), p, b); a = CalculatePrice(new Decimal(24 * c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), w, b); s = CalculatePrice(new Decimal(et), w, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), p, b); a = CalculatePrice(new Decimal(et), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), w, b); s = CalculatePrice(new Decimal(ft), w, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), p, b); a = CalculatePrice(new Decimal(ft), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(tt * it), w, b); s = CalculatePrice(new Decimal(tt * it), w, h); k = CalculateRebate(new Decimal(g * it), y, b); l = CalculatePrice(new Decimal(g * it), y, k); d = CalculateRebate(new Decimal(nt * it), p, b); a = CalculatePrice(new Decimal(nt * it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(tt * it), w, b); s = CalculatePrice(new Decimal(tt * it), w, h); k = CalculateRebate(new Decimal(g * it), y, b); l = CalculatePrice(new Decimal(g * it), y, k); d = CalculateRebate(new Decimal(nt * it), p, b); a = CalculatePrice(new Decimal(nt * it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal((c + 1) * tt), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(24 * c * tt), w, b); s = CalculatePrice(new Decimal(24 * c * tt), w, h); k = CalculateRebate(new Decimal(24 * c * g), y, b); l = CalculatePrice(new Decimal(24 * c * g), y, k); d = CalculateRebate(new Decimal(24 * c * nt), p, b); a = CalculatePrice(new Decimal(24 * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(24 * c * tt), w, b); s = CalculatePrice(new Decimal(24 * c * tt), w, h); k = CalculateRebate(new Decimal(24 * c * g), y, b); l = CalculatePrice(new Decimal(24 * c * g), y, k); d = CalculateRebate(new Decimal(24 * c * nt), p, b); a = CalculatePrice(new Decimal(24 * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") }tt == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)); g == 0 && u.setValue("CG1TOTAL_AMOUNT", 0); nt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0) } } catch (kt) { this.setCalloutActive(!1); this.log.severe(kt.toString()) } return i = r = u = f = e = o = null, "" }; l.prototype.fromchkdate = function (i, r, u, f, e, o) { var s, l, a, h, k, d, v, ht, at, lt, st; if (e == null || e.toString() == "" || (ht = t.getValueOfDateTime(e), ht == null || ht.equals(0))) return ""; var et = t.getValueOfDateTime(u.getValue("ADATEFROM")), ot = t.getValueOfDateTime(u.getValue("ADATETO")), g = t.getValueOfInt(u.getValue("CG1NUM")), nt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), p = t.getValueOfDecimal(u.getValue("CG2PRICE")); try { if (et = t.getValueOfDateTime(u.getValue("ADATEFROM")), et.compareTo(ot) > 0) u.setValue("CG1DATEFROM", et), u.setValue("CG2DATEFROM", et), at = et.addDays(1), u.setValue("ADATETO", at); else if (ot.compareTo(et) > 0) { var ct = et.subtract(ot), c = Utility.TimeUtil.getDaysBetween(et, ot), kt = ct.Milliseconds, ut = ct.Seconds, ft = ct.Minutes, rt, it, vt = c / 30, pt = c % 30, yt = c / 7, wt = c % 7; rt = pt == 0 ? vt : vt + 1; it = wt == 0 ? yt : yt + 1; lt = t.getValueOfDateTime(u.getValue("ADATEFROM")); u.setValue("CG1DATETO", ot); u.setValue("CG2DATETO", ot); u.setValue("CG1DATEFROM", lt); u.setValue("CG2DATEFROM", lt); st = u.getValue("AUOM_ID").toString(); (st == "" || st.Trim().Length == 0) && (st = "0"); var w = t.getValueOfDecimal(u.getValue("APRICE")), tt = t.getValueOfInt(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")); if (t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(st)) { case 1000003: s = w; l = y; a = p; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), w, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(rt), w, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(it), w, h); l = CalculatePrice(new Decimal(it), y, h); a = CalculatePrice(new Decimal(it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), w, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(24 * c), w, h); l = CalculatePrice(new Decimal(24 * c), y, h); a = CalculatePrice(new Decimal(24 * c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(ft), w, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ut), w, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(tt * it), w, h); l = CalculatePrice(new Decimal(g * it), y, h); a = CalculatePrice(new Decimal(nt * it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(tt * it), w, h); l = CalculatePrice(new Decimal(g * it), y, h); a = CalculatePrice(new Decimal(nt * it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); l = CalculatePrice(new Decimal(g * (c + 1)), y, h); a = CalculatePrice(new Decimal(nt * (c + 1)), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * tt), w, h); l = CalculatePrice(new Decimal((c + 1) * g), y, h); a = CalculatePrice(new Decimal((c + 1) * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(24 * c * tt), w, h); l = CalculatePrice(new Decimal(24 * c * g), y, h); a = CalculatePrice(new Decimal(24 * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(24 * c * tt), w, h); l = CalculatePrice(new Decimal(24 * c * g), y, h); a = CalculatePrice(new Decimal(24 * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") } } else switch (int.Parse(st)) { case 1000003: s = w; l = y; a = p; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), w, b); s = CalculatePrice(new Decimal(c), w, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), p, b); a = CalculatePrice(new Decimal(c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(rt), w, b); s = CalculatePrice(new Decimal(rt), w, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), p, b); a = CalculatePrice(new Decimal(rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(it), w, b); s = CalculatePrice(new Decimal(it), w, h); k = CalculateRebate(new Decimal(it), y, b); l = CalculatePrice(new Decimal(it), y, k); d = CalculateRebate(new Decimal(it), p, b); a = CalculatePrice(new Decimal(it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), w, b); s = CalculatePrice(new Decimal(c + 1), w, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), p, b); a = CalculatePrice(new Decimal(c + 1), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(24 * c), w, b); s = CalculatePrice(new Decimal(24 * c), w, h); k = CalculateRebate(new Decimal(24 * c), y, b); l = CalculatePrice(new Decimal(24 * c), y, k); d = CalculateRebate(new Decimal(24 * c), p, b); a = CalculatePrice(new Decimal(24 * c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(ft), w, b); s = CalculatePrice(new Decimal(ft), w, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), p, b); a = CalculatePrice(new Decimal(ft), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ut), w, b); s = CalculatePrice(new Decimal(ut), w, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), p, b); a = CalculatePrice(new Decimal(ut), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(tt * it), w, b); s = CalculatePrice(new Decimal(tt * it), w, h); k = CalculateRebate(new Decimal(g * it), y, b); l = CalculatePrice(new Decimal(g * it), y, k); d = CalculateRebate(new Decimal(nt * it), p, b); a = CalculatePrice(new Decimal(nt * it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(tt * it), w, b); s = CalculatePrice(new Decimal(tt * it), w, h); k = CalculateRebate(new Decimal(g * it), y, b); l = CalculatePrice(new Decimal(g * it), y, k); d = CalculateRebate(new Decimal(nt * it), p, b); a = CalculatePrice(new Decimal(nt * it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal((c + 1) * tt), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(24 * c * tt), w, b); s = CalculatePrice(new Decimal(24 * c * tt), w, h); k = CalculateRebate(new Decimal(24 * c * g), y, b); l = CalculatePrice(new Decimal(24 * c * g), y, k); d = CalculateRebate(new Decimal(24 * c * nt), p, b); a = CalculatePrice(new Decimal(24 * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(24 * c * tt), w, b); s = CalculatePrice(new Decimal(24 * c * tt), w, h); k = CalculateRebate(new Decimal(24 * c * g), y, b); l = CalculatePrice(new Decimal(24 * c * g), y, k); d = CalculateRebate(new Decimal(24 * c * nt), p, b); a = CalculatePrice(new Decimal(24 * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") }tt == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)); g == 0 && u.setValue("CG1TOTAL_AMOUNT", 0); nt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0) } } catch (bt) { this.setCalloutActive(!1); this.log.severe(bt.toString()) } return i = r = u = f = e = o = null, "" }; l.prototype.UOMSelected = function (i, r, u, f, e, o) { var s, l, a, h, k, d, v, et; if (e == null || e.toString() == "" || (et = t.getValueOfInt(e), et = t.getValueOfInt(u.getValue("AUOM_ID")), et == null)) return ""; u.setValue("CG1UOM_ID", et); u.setValue("CG2UOM_ID", et); var ct = u.getValue("AUOM_ID").toString(), p = t.getValueOfDecimal(u.getValue("APRICE")), g = t.getValueOfInt(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), ot = t.getValueOfDateTime(u.getValue("ADATETO")), st = t.getValueOfDateTime(u.getValue("ADATEFROM")), ht = st.compareTo(ot) > 0 ? st.Subtract(ot) : ot.Subtract(st); var c = Utility.timeUtil.getDaysBetween(st, ot), pt = ht.Milliseconds, ut = ht.Seconds, ft = ht.Minutes, rt, it, lt = c / 30, vt = c % 30, at = c / 7, yt = c % 7; if (rt = vt == 0 ? lt : lt + 1, it = yt == 0 ? at : at + 1, t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(ct)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(rt), p, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(it), p, h); l = CalculatePrice(new Decimal(it), y, h); a = CalculatePrice(new Decimal(it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(24 * c), p, h); l = CalculatePrice(new Decimal(24 * c), y, h); a = CalculatePrice(new Decimal(24 * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ut), p, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") } } else switch (int.Parse(ct)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(rt), p, b); s = CalculatePrice(new Decimal(rt), p, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), w, b); a = CalculatePrice(new Decimal(rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(it), p, b); s = CalculatePrice(new Decimal(it), p, h); k = CalculateRebate(new Decimal(it), y, b); l = CalculatePrice(new Decimal(it), y, k); d = CalculateRebate(new Decimal(it), w, b); a = CalculatePrice(new Decimal(it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(24 * c), p, b); s = CalculatePrice(new Decimal(24 * c), p, h); k = CalculateRebate(new Decimal(24 * c), y, b); l = CalculatePrice(new Decimal(24 * c), y, k); d = CalculateRebate(new Decimal(24 * c), w, b); a = CalculatePrice(new Decimal(24 * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ut), p, b); s = CalculatePrice(new Decimal(ut), p, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), w, b); a = CalculatePrice(new Decimal(ut), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; l.prototype.AVALSelected = function (i, r, u, f, e, o) { var s, l, a, h, k, d, v, et; if (e == null || e.toString() == "") return ""; et = null; try { et = u.getValue("AUOM_ID").toString() } catch (yt) { return this.setCalloutActive(!1), "" } var p = t.getValueOfDecimal(u.getValue("APRICE")), b = t.getValueOfDecimal(u.getValue("AREBATE")), g = t.getValueOfInt(u.getValue("ANUM")), st = t.getValueOfDateTime(u.getValue("ADATETO")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), ht = t.getValueOfDateTime(u.getValue("ADATEFROM")), ot = ht.Subtract(st), c = Utility.TimeUtil.getDaysBetween(ht, st), pt = ot.Milliseconds, ut = ot.Seconds, ft = ot.Minutes, rt, it, ct = c / 30, at = c % 30, lt = c / 7, vt = c % 7; if (rt = at == 0 ? ct : ct + 1, it = vt == 0 ? lt : lt + 1, t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(et)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(rt), p, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(it), p, h); l = CalculatePrice(new Decimal(it), y, h); a = CalculatePrice(new Decimal(it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(24 * c), p, h); l = CalculatePrice(new Decimal(24 * c), y, h); a = CalculatePrice(new Decimal(24 * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ut), p, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") } } else switch (int.Parse(et)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(rt), p, b); s = CalculatePrice(new Decimal(rt), p, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), w, b); a = CalculatePrice(new Decimal(rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(it), p, b); s = CalculatePrice(new Decimal(it), p, h); k = CalculateRebate(new Decimal(it), y, b); l = CalculatePrice(new Decimal(it), y, k); d = CalculateRebate(new Decimal(it), w, b); a = CalculatePrice(new Decimal(it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(24 * c), p, b); s = CalculatePrice(new Decimal(24 * c), p, h); k = CalculateRebate(new Decimal(24 * c), y, b); l = CalculatePrice(new Decimal(24 * c), y, k); d = CalculateRebate(new Decimal(24 * c), w, b); a = CalculatePrice(new Decimal(24 * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ut), p, b); s = CalculatePrice(new Decimal(ut), p, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), w, b); a = CalculatePrice(new Decimal(ut), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; n.Model.CalloutOfferServices = l; g.prototype.TypeSelection = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = t.getValueOfBoolean(f); return o == null ? "" : (o == !0 ? r.setValue("flag1", !0) : r.setValue("flag1", !1), n = i = r = u = f = e = null, "") }; g.prototype.RecordSort = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = t.getValueOfBoolean(f); return o == null ? "" : (o == !0 ? r.setValue("flag2", !0) : r.setValue("flag2", !1), n = i = r = u = f = e = null, "") }; g.prototype.EndDate = function (i, r, u, f, e, o) { var s, h, c; if (e == null || e.toString() == "" || (s = t.getValueOfDateTime(e), s == null || s.equals(0))) return ""; h = t.getValueOfDateTime(e); c = t.getValueOfDateTime(u.getValue("DATE_FROM")); try { h = t.getValueOfDateTime(u.getValue("TILL_DATE")); h.compareTo(c) < 0 && (n.ADialog.info("EndAndStartDate"), u.setValue("TILL_DATE", c)) } catch (l) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; g.prototype.StartDate = function (n, i, r, u, f, e) { var s, o, h; if (f == null || f.toString() == "" || (s = t.getValueOfDateTime(f), s == null || s.equals(0))) return ""; o = t.getValueOfDateTime(r.getValue("DATE_FROM")); h = t.getValueOfDateTime(r.getValue("TILL_DATE")); try { o = t.getValueOfDateTime(r.getValue("DATE_FROM")); o.compareTo(h) > 0 && r.setValue("TILL_DATE", o) } catch (c) { this.setCalloutActive(!1) } return n = i = r = u = f = e = null, "" }; n.Model.CalloutCheckInOut = g; n.Utility.inheritPrototype(y, n.CalloutEngine); y.prototype.Product = function (i, r, u, f, e, o) { var l, v, d, g, ut, s, a, y, h, tt, c, it, w, rt, p; if (this.isCalloutActive() || f.getColumnName() != "VAM_ProductContainer_ID" || e != null && e.toString() != "" || (e = 0), this.isCalloutActive() || e == null || e.toString() == "") return ""; l = 0; v = i.getContext(r, "AttrCode"); v != null && v != "" && f.getColumnName() != "VAM_ProductContainer_ID" && (a = e.toString() + "," + v.toString(), l = n.dataContext.getJSONRecord("MVAMInventoryLine/GetProductAttribute", a)); var b = t.getValueOfInt(u.getValue("VAM_InventoryLine_ID")), st = t.getValueOfInt(u.getValue("VAM_Inventory_ID")), k = null, ht = st.toString(); if (k = n.dataContext.getJSONRecord("MVAMInventory/GetMVAMInventory", ht), d = k.MovementDate, g = k.VAF_Org_ID, f.getColumnName() == "VAM_Product_ID" && (ut = n.dataContext.getJSONRecord("MVAMInventoryLine/GetProductUOM", e.toString()), u.setValue("VAB_UOM_ID", t.getValueOfInt(ut))), s = null, a = b.toString(), b != null && b != 0) { y = null; y = n.dataContext.getJSONRecord("MVAMInventoryLine/GetMVAMInventoryLine", a); var h = y.VAM_Product_ID, c = y.VAM_Locator_ID, nt = t.getValueOfInt(u.getValue("VAM_Product_ID")), ft = t.getValueOfInt(u.getValue("VAM_Locator_ID")), p = t.getValueOfInt(u.getValue("VAM_ProductContainer_ID")), et = 0; if (nt != h || ft != c || f.getColumnName() == "VAM_ProductContainer_ID") { this.setCalloutActive(!0); l > 0 && u.setValue("VAM_PFeature_SetInstance_ID", l); nt == h ? et = t.getValueOfInt(u.getValue("VAM_PFeature_SetInstance_ID")) : u.setValue("VAM_PFeature_SetInstance_ID", null); try { s = this.SetQtyBook(g, et, nt, ft, t.getValueOfDate(d), p); u.setValue("QtyBook", s) } catch (ot) { return this.setCalloutActive(!1), this.log.severe(ot.toString()), u.setValue("QtyBook", s) } } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } if ((h = 0, tt = t.getValueOfInt(u.getValue("VAM_Product_ID")), tt != null && (h = tt), h == 0) || (c = 0, it = t.getValueOfInt(u.getValue("VAM_Locator_ID")), it != null && (c = it), c == 0)) return ""; this.setCalloutActive(!0); l > 0 && u.setValue("VAM_PFeature_SetInstance_ID", l); w = 0; rt = t.getValueOfInt(u.getValue("VAM_PFeature_SetInstance_ID")); rt != null && (w = rt); u.setValue("VAM_PFeature_SetInstance_ID", null); p = t.getValueOfInt(u.getValue("VAM_ProductContainer_ID")); try { s = this.SetQtyBook(g, w, h, c, t.getValueOfDate(d), p); u.setValue("QtyBook", s) } catch (ot) { return this.setCalloutActive(!1), this.log.severe(ot.toString()), u.setValue("QtyBook", s) } return this.log.info("VAM_Product_ID=" + h + ", VAM_Locator_ID=" + c + ", VAM_PFeature_SetInstance_ID=" + w + " - QtyBook=" + s), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; y.prototype.AttributeSetInstance = function (i, r, u, f, e, o) { var s, v, l, y, w; if (this.isCalloutActive()) return ""; var tt = t.getValueOfInt(u.getValue("VAM_InventoryLine_ID")), b = t.getValueOfInt(u.getValue("VAM_Inventory_ID")), a = null, k = b.toString(); a = n.dataContext.getJSONRecord("MVAMInventory/GetMVAMInventory", k); var d = a.MovementDate, g = a.VAF_Org_ID, h = null, c = 0, p = t.getValueOfInt(u.getValue("VAM_Product_ID")); if ((p != null && (c = p), c == 0) || (s = 0, v = t.getValueOfInt(u.getValue("VAM_Locator_ID")), v != null && (s = v), s == 0)) return ""; this.setCalloutActive(!0); l = 0; y = t.getValueOfInt(u.getValue("VAM_PFeature_SetInstance_ID")); y != null && (l = y); w = t.getValueOfInt(u.getValue("VAM_ProductContainer_ID")); try { h = this.SetQtyBook(g, l, c, s, t.getValueOfDate(d), w); u.setValue("QtyBook", h) } catch (nt) { return this.setCalloutActive(!1), this.log.severe(nt.toString()), u.setValue("QtyBook", h) } return this.log.info("VAM_Product_ID=" + c + ", VAM_Locator_ID=" + s + ", VAM_PFeature_SetInstance_ID=" + l + " - QtyBook=" + h), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; y.prototype.SetDiff = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = 0, s = 0, h = 0; this.setCalloutActive(!0); try { u.getColumnName().equals("DifferenceQty") ? (s = t.getValueOfDecimal(r.getValue("OpeningStock")), h = t.getValueOfDecimal(r.getValue("DifferenceQty")), o = s - h, r.setValue("AsOnDateCount", o), r.setValue("QtyCount", 0)) : u.getColumnName().equals("AsOnDateCount") && (s = t.getValueOfDecimal(r.getValue("OpeningStock")), o = t.getValueOfDecimal(r.getValue("AsOnDateCount")), h = s - o, r.setValue("DifferenceQty", h), r.setValue("QtyCount", 0)) } catch (c) { return this.setCalloutActive(!1), this.log.severe(c.toString()), c.message } return this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; y.prototype.SetQtyBook = function (i, r, u, f, e, o) { var c = null, l = "", a = "", v = 0, h = !1, s; return (n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"] != undefined && (h = n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y", !0)), s = "TO_DATE( '" + (Number(e.getMonth()) + 1) + "-" + e.getDate() + "-" + e.getFullYear() + "', 'MM-DD-YYYY')", l = h ? "SELECT COUNT(*) FROM VAM_Inv_Trx WHERE movementdate = " + s + " AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + " AND NVL(VAM_ProductContainer_ID, 0) = " + o : "SELECT COUNT(*) FROM VAM_Inv_Trx WHERE movementdate = " + s + " AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r, v = t.getValueOfInt(n.DB.executeScalar(l)), v > 0 ? (a = h ? "SELECT  NVL(ContainerCurrentQty, 0) AS currentqty FROM VAM_Inv_Trx WHERE VAM_Inv_Trx_ID = (SELECT MAX(VAM_Inv_Trx_ID)   FROM VAM_Inv_Trx  WHERE movementdate = (SELECT MAX(movementdate) FROM VAM_Inv_Trx WHERE movementdate <= " + s + "  AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + " AND NVL(VAM_ProductContainer_ID, 0) = " + o + ") AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + " AND NVL(VAM_ProductContainer_ID, 0) = " + o + ")  AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + " AND NVL(VAM_ProductContainer_ID, 0) = " + o : "SELECT currentqty FROM VAM_Inv_Trx WHERE VAM_Inv_Trx_ID = (SELECT MAX(VAM_Inv_Trx_ID)   FROM VAM_Inv_Trx  WHERE movementdate = (SELECT MAX(movementdate) FROM VAM_Inv_Trx WHERE movementdate <= " + s + "  AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + ") AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + ") AND VAF_Org_ID = " + i + " AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r, c = t.getValueOfDecimal(n.DB.executeScalar(a))) : (l = h ? "SELECT COUNT(*) FROM VAM_Inv_Trx WHERE movementdate < " + s + " AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + " AND NVL(VAM_ProductContainer_ID, 0) = " + o : "SELECT COUNT(*) FROM VAM_Inv_Trx WHERE movementdate < " + s + " AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r, v = t.getValueOfInt(n.DB.executeScalar(l)), v > 0 && (a = h ? "SELECT NVL(ContainerCurrentQty, 0) AS currentqty FROM VAM_Inv_Trx WHERE VAM_Inv_Trx_ID = (SELECT MAX(VAM_Inv_Trx_ID)   FROM VAM_Inv_Trx  WHERE movementdate =  (SELECT MAX(movementdate) FROM VAM_Inv_Trx WHERE movementdate < " + s + " AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + " AND NVL(VAM_ProductContainer_ID, 0) = " + o + ") AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + " AND NVL(VAM_ProductContainer_ID, 0) = " + o + ")  AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + " AND NVL(VAM_ProductContainer_ID, 0) = " + o : "SELECT currentqty FROM VAM_Inv_Trx WHERE VAM_Inv_Trx_ID = (SELECT MAX(VAM_Inv_Trx_ID)   FROM VAM_Inv_Trx  WHERE movementdate =  (SELECT MAX(movementdate) FROM VAM_Inv_Trx WHERE movementdate < " + s + " AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + ") AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r + ") AND VAF_Org_ID = " + i + " AND  VAM_Product_ID = " + u + " AND VAM_Locator_ID = " + f + " AND VAM_PFeature_SetInstance_ID = " + r, c = t.getValueOfDecimal(n.DB.executeScalar(a)))), c != null) ? c : 0 }; y.prototype.SetUOMQty = function (i, r, u, f, e, o) { var v, h, l, c, a, y; if (e == null || e.toString() == "" || this.isCalloutActive()) return ""; var p = 0, w = 0, b = 0, s = 0; this.setCalloutActive(!0); try { if (v = t.getValueOfDecimal(u.getValue("VAM_Product_ID")), v == 0) return this.setCalloutActive(!1), ""; u.getValue("IsInternalUse") == !1 || u.getValue("IsInternalUse") == null ? (f.getColumnName() == "VAB_UOM_ID" ? (h = t.getValueOfInt(e), QtyEntered = t.getValueOfDecimal(u.getValue("QtyEntered")), v = t.getValueOfInt(u.getValue("VAM_Product_ID")), paramStr = h.toString().concat(","), l = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr), c = QtyEntered.toFixed(t.getValueOfInt(l)), QtyEntered != c && (this.log.fine("Corrected QtyEntered Scale UOM=" + h + "; QtyEntered=" + QtyEntered + "->" + c), QtyEntered = c, u.setValue("QtyEntered", QtyEntered)), paramStr = v.toString().concat(",").concat(h.toString()).concat(",").concat(QtyEntered.toString()), a = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), s = a, s == null && (s = QtyEntered)) : f.getColumnName() == "QtyEntered" && (h = i.getContextAsInt(r, "VAB_UOM_ID"), QtyEntered = t.getValueOfDecimal(e), paramStr = h.toString().concat(","), l = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr), c = QtyEntered.toFixed(t.getValueOfInt(l)), QtyEntered != c && (this.log.fine("Corrected QtyEntered Scale UOM=" + h + "; QtyEntered=" + QtyEntered + "->" + c), QtyEntered = c, u.setValue("QtyEntered", QtyEntered)), paramStr = v.toString().concat(",", h.toString(), ",", QtyEntered.toString()), a = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), s = a, s == null && (s = QtyEntered), y = QtyEntered != s, this.log.fine("UOM=" + h + ", QtyEntered=" + QtyEntered + " -> " + y + " QtyOrdered=" + s), i.setContext(r, "UOMConversion", y ? "Y" : "N")), u.getValue("AdjustmentType").toString() == "D" ? (w = t.getValueOfDecimal(u.getValue("OpeningStock")), b = s, p = w - b, u.setValue("DifferenceQty", s), u.setValue("AsOnDateCount", p)) : u.getValue("AdjustmentType").toString() == "A" && (w = t.getValueOfDecimal(u.getValue("OpeningStock")), p = s, b = w - p, u.setValue("AsOnDateCount", s), u.setValue("DifferenceQty", b))) : u.getValue("IsInternalUse") == !0 && (f.getColumnName() == "VAB_UOM_ID" ? (h = t.getValueOfInt(e), QtyEntered = t.getValueOfDecimal(u.getValue("QtyEntered")), v = t.getValueOfInt(u.getValue("VAM_Product_ID")), paramStr = h.toString().concat(","), l = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr), c = QtyEntered.toFixed(t.getValueOfInt(l)), QtyEntered != c && (this.log.fine("Corrected QtyEntered Scale UOM=" + h + "; QtyEntered=" + QtyEntered + "->" + c), QtyEntered = c, u.setValue("QtyEntered", QtyEntered)), paramStr = v.toString().concat(",").concat(h.toString()).concat(",").concat(QtyEntered.toString()), a = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), s = a, s == null && (s = QtyEntered), u.setValue("QtyInternalUse", s)) : f.getColumnName() == "QtyEntered" && (h = i.getContextAsInt(r, "VAB_UOM_ID"), QtyEntered = t.getValueOfDecimal(e), paramStr = h.toString().concat(","), l = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr), c = QtyEntered.toFixed(t.getValueOfInt(l)), QtyEntered != c && (this.log.fine("Corrected QtyEntered Scale UOM=" + h + "; QtyEntered=" + QtyEntered + "->" + c), QtyEntered = c, u.setValue("QtyEntered", QtyEntered)), paramStr = v.toString().concat(",", h.toString(), ",", QtyEntered.toString()), a = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), s = a, s == null && (s = QtyEntered), y = QtyEntered != s, this.log.fine("UOM=" + h + ", QtyEntered=" + QtyEntered + " -> " + y + " QtyOrdered=" + s), i.setContext(r, "UOMConversion", y ? "Y" : "N"), u.setValue("QtyInternalUse", s))) } catch (k) { return this.setCalloutActive(!1), this.log.severe(k.toString()), k.message } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutInventory = y; n.Utility.inheritPrototype(o, n.CalloutEngine); o.prototype.DocType = function (r, u, f, e, o, s) { var l, a, h, c; if (o == null || o.toString() == "" || (l = o, l == null || l == 0)) return ""; a = l.toString(); h = n.dataContext.getJSONRecord("MVABDocTypes/GetDocTypeData", a); try { r.setContext(u, "HasCharges", t.getValueOfString(h.HasCharges)); h.IsDocNoControlled == "Y" && f.setValue("DocumentNo", "<" + t.getValueOfString(h.CurrentNext) + ">"); c = t.getValueOfString(h.DocBaseType); r.setContext(u, "DocBaseType", c); c.startsWith("AP") ? f.setValue("PaymentRule", "S") : c.endsWith("C") && f.setValue("PaymentRule", "P"); f.getField("TreatAsDiscount") != null && (c.equals("APC") ? f.setValue("TreatAsDiscount", t.getValueOfBoolean(h.TreatAsDiscount)) : f.setValue("TreatAsDiscount", !1)) } catch (v) { return this.setCalloutActive(!1), h != null && h.close(), this.log.log(i.SEVERE, sql, v), v.message } return r = u = f = e = o = s = null, "" }; o.prototype.BPartner = function (r, u, f, e, o, s) { var p, k, c, tt, l, ht, ct, it, rt, ut, ft, et, lt, g, nt; if (o == null || o.toString() == "") return ""; try { if (p = t.getValueOfInt(o), p == null || p == 0) return ""; var w = "N", ot = "N", d = "SELECT p.VAF_Language,p.VAB_PaymentTerm_ID, COALESCE(p.VAM_PriceList_ID,g.VAM_PriceList_ID) AS VAM_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted,", tt = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")); tt > 0 && (d += " p.VA009_PaymentMethod_ID, p.VA009_PO_PaymentMethod_ID, "); d += "p.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable, l.VAB_BPart_Location_ID,c.VAF_UserContact_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID,  p.SalesRep_ID,p.IsSalesRep, p.VAB_Withholding_ID  FROM VAB_BusinessPartner p INNER JOIN VAB_BPart_Category g ON (p.VAB_BPart_Category_ID=g.VAB_BPart_Category_ID) LEFT OUTER JOIN VAB_BPart_Location l ON (p.VAB_BusinessPartner_ID=l.VAB_BusinessPartner_ID AND l.IsBillTo='Y' AND l.IsActive='Y') LEFT OUTER JOIN VAF_UserContact c ON (p.VAB_BusinessPartner_ID=c.VAB_BusinessPartner_ID) WHERE p.VAB_BusinessPartner_ID=" + p + " AND p.IsActive='Y'"; var b = r.isSOTrx(u), h = null, a = null; try { if (h = n.DB.executeReader(d, null, null), h.read()) { if (k = t.getValueOfInt(h.get(b ? "VAM_PriceList_id" : "po_pricelist_id")), k > 0 && f.setValue("VAM_PriceList_ID", k), c = t.getValueOfString(h.get(b ? "paymentrule" : "paymentrulepo")), c != null && c.length != 0 && (r.getContext("DocBaseType").toString().endsWith("C") ? c = "P" : b && (c.toString().equals("S") || c.toString().equals("U")) && (c = "P"), f.setValue("PaymentRule", c)), tt = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")), tt > 0) { var y = t.getValueOfInt(h.get("VA009_PaymentMethod_ID")), w = "N", v = n.dataContext.getJSONRecord("MBPartner/GetBPDetails", p); v != null && (w = t.getValueOfString(v.IsVendor), ot = t.getValueOfString(v.IsCustomer), b ? w == "Y" ? (y = 0, l = null, ot == "Y" && (y = t.getValueOfInt(v.VA009_PaymentMethod_ID), l = t.getValueOfString(v.VA009_PAYMENTBASETYPE))) : ot == "Y" && (y = t.getValueOfInt(v.VA009_PaymentMethod_ID), l = t.getValueOfString(v.VA009_PAYMENTBASETYPE)) : w == "Y" ? (y = t.getValueOfInt(v.VA009_PO_PaymentMethod_ID), l = t.getValueOfString(v.VA009_PAYMENTBASETYPEPO)) : (y = 0, l = null)); y == 0 ? f.setValue("VA009_PaymentMethod_ID", null) : (f.setValue("VA009_PaymentMethod_ID", y), l = n.DB.executeScalar("SELECT VA009_PaymentBaseType FROM VA009_PaymentMethod WHERE VA009_PaymentMethod_ID=" + y), l != null ? (f.setValue("PaymentMethod", l), w == "N" ? f.setValue("PaymentRule", l) : f.setValue("PaymentRule", l)) : (f.setValue("PaymentMethod", "T"), w == "N" ? f.setValue("PaymentRule", "T") : f.setValue("PaymentRule", "T"))) } ht = t.getValueOfInt(f.getValue("VAB_PaymentTerm_ID")); ct = t.getValueOfDecimal(f.getValue("VAB_Order_Blanket")); ht > 0 && ct > 0 || (k = t.getValueOfInt(h.get(b ? "VAB_Paymentterm_id" : "po_paymentterm_id")), k > 0 && f.setValue("VAB_PaymentTerm_ID", k)); it = t.getValueOfInt(h.get("VAB_BPart_Location_id")); p.toString().equals(r.getContext("VAB_BusinessPartner_ID")) && (rt = r.getContext("VAB_BPart_Location_ID"), rt && rt.toString().length > 0 && (it = parseInt(rt))); it == 0 ? f.setValue("VAB_BPart_Location_ID", null) : f.setValue("VAB_BPart_Location_ID", it); ut = t.getValueOfInt(h.get("VAF_UserContact_id")); p.toString().equals(r.getContext("VAB_BusinessPartner_ID")) && (ft = r.getContext("VAF_UserContact_ID"), ft && ft.toString().length > 0 && (ut = parseInt(ft))); ut == 0 ? f.setValue("VAF_UserContact_ID", null) : f.setValue("VAF_UserContact_ID", ut); b && (et = h.getString("CreditStatusSettingOn"), et == "CH" ? (g = t.getValueOfDouble(h.get("so_creditlimit")), g != 0 && (nt = t.getValueOfDouble(h.get("creditavailable")), h != null && nt <= 0 && n.ADialog.info("CreditOver"))) : (lt = t.getValueOfInt(f.getValue("VAB_BPart_Location_ID")), d = "SELECT bp.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable FROM VAB_BPart_Location p INNER JOIN VAB_BusinessPartner bp ON (bp.VAB_BusinessPartner_ID = p.VAB_BusinessPartner_ID) WHERE p.VAB_BPart_Location_ID = " + lt, a = n.DB.executeReader(d), a.read() && (et = a.getString("CreditStatusSettingOn"), et == "CL" && (g = t.getValueOfDouble(a.get("so_creditlimit")), g != 0 && (nt = t.getValueOfDouble(a.get("creditavailable")), h != null && nt <= 0 && n.ADialog.info("CreditOver")))))); c = t.getValueOfString(h.get("poreference")); c != null && c.length != 0 ? f.setValue("POReference", c) : f.setValue("POReference", null); c = t.getValueOfString(h.get("so_description")); c != null && c.toString().trim().length != 0 && f.setValue("Description", c); c = t.getValueOfString(h.get("isdiscountprinted")); c != null && c.toString().trim().length != 0 ? f.setValue("IsDiscountPrinted", c) : f.setValue("IsDiscountPrinted", "N") } h.close() } catch (st) { return this.setCalloutActive(!1), h != null && h.close(), a != null && a.close(), this.log.log(i.SEVERE, "bPartner", st), st.message } finally { h != null && h.close(); a != null && a.close() } } catch (st) { this.setCalloutActive(!1); this.log.severe(st.toString()) } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; o.prototype.PaymentTerm = function (t, i, r, u, f, e) { var o, h, c, l, s, a; if (f == null || f.toString() == "") return ""; try { if (o = f, h = t.getContextAsInt(i, "VAB_Invoice_ID", !1), o == null || o == 0 || h == 0) return ""; if (l = o.toString().concat(",", h.toString()), s = n.dataContext.getJSONRecord("MPaymentTerm/GetPaymentTerm", l), s != null) { if (c = s.Get_ID, a = s.Apply, c == 0) return "PaymentTerm not found"; r.setValue("IsPayScheduleValid", a ? !0 : !1) } } catch (v) { this.setCalloutActive(!1); this.log.severe(v.toString()) } return t = i = r = u = f = e = null, "" }; o.prototype.Product = function (i, u, f, e, o, s) { var l, b, d, c, rt, lt, nt, p, it, et, w, h; if (this.isCalloutActive() || o == null || o.toString() == "") return f.setValue("VA038_AmortizationTemplate_ID", 0), ""; if (l = o, l == null || l == 0) return ""; this.setCalloutActive(!0); try { f.setValue("VAB_Charge_ID", null); f.setValue("VAM_PFeature_SetInstance_ID", null); b = i.getWindowContext(u, "IsSOTrx", !0) == "Y"; sql = "SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='ED011_'"; r = t.getValueOfInt(n.DB.executeScalar(sql)); d = n.dataContext.getJSONRecord("MVABInvoice/GetInvoice", f.getValue("VAB_Invoice_ID").toString()); c = 0; r > 0 && (sql = "SELECT VAB_UOM_ID FROM VAM_Product_PO WHERE IsActive = 'Y' AND  VAB_BusinessPartner_ID = " + t.getValueOfInt(d.VAB_BusinessPartner_ID) + " AND VAM_Product_ID = " + l, c = t.getValueOfInt(n.DB.executeScalar(sql)), c > 0 && b == !1 ? f.setValue("VAB_UOM_ID", c) : (sql = "SELECT VAB_UOM_ID FROM VAM_Product WHERE IsActive = 'Y' AND VAM_Product_ID = " + l, f.setValue("VAB_UOM_ID", t.getValueOfInt(n.DB.executeScalar(sql))))); f.findColumn("VAB_Rev_Recognition_ID") > -1 && (rt = n.dataContext.getJSONRecord("MVAMProduct/GetRevenuRecognition", l), f.setValue("VAB_Rev_Recognition_ID", rt)); var ut = i.getContextAsInt(u, "VAB_BusinessPartner_ID", !1), ot = f.getValue("QtyInvoiced"), g = i.getContextAsInt(u, "VAM_PriceList_ID", !1), st = i.getContextAsInt(u, "VAM_PriceListVersion_ID"), ht = i.getContextAsInt(u, "VAM_PFeature_SetInstance_ID"), ct = i.getContext("DateInvoiced"), a = t.getValueOfInt(f.getValue("VAB_UOM_ID")), y = l.toString().concat(",", ut.toString(), ",", ot.toString(), ",", b, ",", g.toString(), ",", st.toString(), ",", null, ",", ct.toString(), ",", ht.toString(), ",", a, ",", r), v = null; if (v = n.dataContext.getJSONRecord("MVAMProductPricing/GetProductPricing", y), lt = null, nt = n.dataContext.getJSONRecord("MCurrency/GetCurrency", v.VAB_Currency_ID), f.setValue("PriceList", v.PriceList), f.setValue("PriceLimit", v.PriceLimit), f.setValue("PriceActual", t.getValueOfDecimal(v.PriceActual.toFixed(nt))), f.setValue("PriceEntered", t.getValueOfDecimal(v.PriceEntered.toFixed(nt))), f.setValue("VAB_Currency_ID", t.getValueOfInt(v.VAB_Currency_ID)), r <= 0 && f.setValue("VAB_UOM_ID", t.getValueOfInt(v.VAB_UOM_ID)), r > 0 && c > 0 && b == !1) { var y = l.toString(), a = n.dataContext.getJSONRecord("MVAMProduct/GetVAB_UOM_ID", y), g = t.getValueOfInt(d.VAM_PriceList_ID), tt = n.dataContext.getJSONRecord("MVAMPriceListVersion/GetVAM_PriceListVersion_ID", g.toString()), ft = n.dataContext.getJSONRecord("MUOM/GetPrecision", a.toString()), k = n.dataContext.getJSONRecord("MBPartner/GetBPartner", ut.toString()); sql = "SELECT PriceList , PriceStd , PriceLimit FROM VAM_ProductPrice WHERE Isactive='Y' AND VAM_Product_ID = " + t.getValueOfInt(f.getValue("VAM_Product_ID")) + " AND VAM_PriceListVersion_ID = " + tt + " AND ( VAM_PFeature_SetInstance_ID = 0 OR VAM_PFeature_SetInstance_ID IS NULL ) AND VAB_UOM_ID=" + c; p = n.DB.executeDataSet(sql); p.getTables().length > 0 && (p.getTables()[0].getRows().length > 0 ? (y = l.toString().concat(",", i.getVAF_Client_ID().toString(), ",", p.getTables()[0].getRows()[0].getCell("PriceStd").toString(), ",", k.VAM_DiscountCalculation_ID.toString(), ",", k.FlatDiscount.toString(), ",", f.getValue("QtyEntered").toString()), it = t.getValueOfDecimal(n.dataContext.getJSONRecord("MVABOrderLine/FlatDiscount", y)), f.setValue("PriceList", t.getValueOfDecimal(p.getTables()[0].getRows()[0].getCell("PriceList"))), f.setValue("PriceLimit", t.getValueOfDecimal(p.getTables()[0].getRows()[0].getCell("PriceLimit"))), f.setValue("PriceActual", it), f.setValue("PriceEntered", it), sql = "SELECT con.DivideRate FROM VAB_UOM_Conversion con INNER JOIN VAB_UOM uom ON con.VAB_UOM_ID = uom.VAB_UOM_ID WHERE con.IsActive = 'Y' AND con.VAM_Product_ID = " + t.getValueOfInt(f.getValue("VAM_Product_ID")) + " AND con.VAB_UOM_ID = " + a + " AND con.VAB_UOM_To_ID = " + c, h = t.getValueOfDecimal(n.DB.executeScalar(sql)), h == 0 && (sql = "SELECT con.DivideRate FROM VAB_UOM_Conversion con INNER JOIN VAB_UOM uom ON con.VAB_UOM_ID = uom.VAB_UOM_ID WHERE con.IsActive = 'Y' AND con.VAB_UOM_ID = " + a + " AND con.VAB_UOM_To_ID = " + c, h = t.getValueOfDecimal(n.DB.executeScalar(sql))), a == c && h == 0 && (h = 1), f.setValue("QtyInvoiced", t.getValueOfDecimal(f.getValue("QtyEntered")).toFixed(ft) * h)) : (sql = "SELECT PriceList FROM VAM_ProductPrice WHERE Isactive='Y' AND VAM_Product_ID = " + t.getValueOfInt(f.getValue("VAM_Product_ID")) + " AND VAM_PriceListVersion_ID = " + tt + " AND VAM_PFeature_SetInstance_ID = 0 AND VAB_UOM_ID=" + a, et = t.getValueOfDecimal(n.DB.executeScalar(sql)), sql = "SELECT PriceStd FROM VAM_ProductPrice WHERE Isactive='Y' AND VAM_Product_ID = " + t.getValueOfInt(f.getValue("VAM_Product_ID")) + " AND VAM_PriceListVersion_ID = " + tt + " AND VAM_PFeature_SetInstance_ID = 0 AND VAB_UOM_ID=" + a, w = t.getValueOfDecimal(n.DB.executeScalar(sql)), y = l.toString().concat(",", i.getVAF_Client_ID().toString(), ",", w.toString(), ",", k.VAM_DiscountCalculation_ID.toString(), ",", k.FlatDiscount.toString(), ",", f.getValue("QtyEntered").toString()), w = t.getValueOfDecimal(n.dataContext.getJSONRecord("MVABOrderLine/FlatDiscount", y)), sql = "SELECT con.DivideRate FROM VAB_UOM_Conversion con INNER JOIN VAB_UOM uom ON con.VAB_UOM_ID = uom.VAB_UOM_ID WHERE con.IsActive = 'Y' AND con.VAM_Product_ID = " + t.getValueOfInt(f.getValue("VAM_Product_ID")) + " AND con.VAB_UOM_ID = " + a + " AND con.VAB_UOM_To_ID = " + c, h = t.getValueOfDecimal(n.DB.executeScalar(sql)), h == 0 && (sql = "SELECT con.DivideRate FROM VAB_UOM_Conversion con INNER JOIN VAB_UOM uom ON con.VAB_UOM_ID = uom.VAB_UOM_ID WHERE con.IsActive = 'Y' AND con.VAB_UOM_ID = " + a + " AND con.VAB_UOM_To_ID = " + c, h = t.getValueOfDecimal(n.DB.executeScalar(sql))), f.setValue("PriceList", et * h), f.setValue("PriceActual", w * h), f.setValue("PriceEntered", w * h), h == 0 && (h = 1), f.setValue("QtyInvoiced", t.getValueOfDecimal(f.getValue("QtyEntered")).toFixed(ft) * h))) } i.setContext(u, "EnforcePriceLimit", v.IsEnforcePriceLimit ? "Y" : "N"); i.setContext(u, "DiscountSchema", v.IsDiscountSchema ? "Y" : "N") } catch (at) { this.setCalloutActive(!1); this.log.severe(at.toString()) } return this.setCalloutActive(!1), s = null, this.Tax(i, u, f, e, o) }; o.prototype.Charge = function (i, r, u, f, e, o) { var s, h, c, a, l; if (e == null || e.toString() == "") return u.setValue("VA038_AmortizationTemplate_ID", 0), ""; s = null; try { if (h = e, h == null || h == 0) return ""; if (u.getValue("VAM_Product_ID") != null) return u.setValue("VAB_Charge_ID", null), "ChargeExclusively"; u.setValue("VAM_PFeature_SetInstance_ID", null); u.setValue("VAS_Res_Assignment_ID", null); c = i.getContextAsInt("#VAB_UOM_ID"); c > 0 ? u.setValue("VAB_UOM_ID", c) : u.setValue("VAB_UOM_ID", 100); i.setContext(r, "DiscountSchema", "N"); a = "SELECT ChargeAmt FROM VAB_Charge WHERE VAB_Charge_ID=" + h; l = n.dataContext.getJSONRecord("MVABInvoice/GetPercision", u.getValue("VAB_Invoice_ID").toString()); s = n.DB.executeReader(a, null, null); s.read() && (u.setValue("PriceEntered", t.getValueOfDecimal(s.get("chargeamt").toFixed(l))), u.setValue("PriceActual", t.getValueOfDecimal(s.get("chargeamt").toFixed(l))), u.setValue("PriceLimit", 0), u.setValue("PriceList", 0), u.setValue("Discount", 0)); s.close() } catch (v) { return this.setCalloutActive(!1), s != null && s.close(), v.message } return o = null, this.Tax(i, r, u, f, e) }; o.prototype.Tax = function (i, r, u, f, e, o) { var y, p, l, h, c, w, a, b, k, d, nt, v; if (e == null || e.toString() == "") return ""; y = f.getColumnName(); try { var g = "", tt = t.getValueOfString(u.getValue("VAB_Invoice_ID")).concat(",", t.getValueOfString(u.getValue("VAM_Product_ID")) + "," + t.getValueOfString(u.getValue("VAB_Charge_ID"))), s = n.dataContext.getJSONRecord("MVABInvoice/GetTax", tt), it = t.getValueOfInt(s._CountVATAX), ut = i.getWindowContext(r, "IsSOTrx", !0) == "Y"; if (it > 0 && (g = t.getValueOfString(s.taxRule)), g == "T") if (p = t.getValueOfInt(s.taxId), p > 0) u.setValue("VAB_TaxRate_ID", p); else { if (t.getValueOfInt(u.getValue("VAM_Product_ID")) > 0) return u.setValue("VAM_Product_ID", ""), this.setCalloutActive(!1), s.TaxExempt == "Y" ? n.ADialog.info("TaxNoExemptFound") : n.ADialog.info("VATAX_DefineTax"); if (t.getValueOfInt(u.getValue("VAB_Charge_ID")) > 0) return u.setValue("VAB_Charge_ID", ""), this.setCalloutActive(!1), s.TaxExempt == "Y" ? n.ADialog.info("TaxNoExemptFound") : n.ADialog.info("VATAX_DefineChargeTax") } else { if ((l = 0, l = y.toString() == "VAM_Product_ID" ? e : i.getContextAsInt(r, "VAM_Product_ID"), h = 0, h = y.toString() == "VAB_Charge_ID" ? e : i.getContextAsInt(r, "VAB_Charge_ID"), this.log.fine("Product=" + l + ", VAB_Charge_ID=" + h), l == 0 && h == 0) || (c = i.getContextAsInt(r, "VAB_BPart_Location_ID"), c == 0)) return this.Amt(i, r, u, f, e); this.log.fine("Ship BP_Location=" + c); w = c; this.log.fine("Bill BP_Location=" + w); a = i.getContext("DateInvoiced"); this.log.fine("Bill Date=" + a); b = a; this.log.fine("Ship Date=" + b); k = i.getContextAsInt(r, "VAF_Org_ID"); this.log.fine("Org=" + k); d = i.getContextAsInt("#VAM_Warehouse_ID"); this.log.fine("Warehouse=" + d); nt = h.toString().concat(",", a.toString(), b.toString(), ",", k.toString(), ",", d.toString(), ",", w.toString(), ",", c.toString(), ",", i.getWindowContext(r, "IsSOTrx", !0).equals("Y")); v = t.getValueOfInt(n.dataContext.getJSONRecord("MTax/Get", nt)); this.log.info("Tax ID=" + v); v == 0 || u.setValue("VAB_TaxRate_ID", v) } } catch (rt) { this.setCalloutActive(!1); this.log.severe(rt.toString()) } return o = null, this.Amt(i, r, u, f, e) }; o.prototype.Amt = function (u, f, e, o, s, h) { var g, nt, tt, c, l, b, et, p, ct, it, lt, ot, pt, at, k, a, y, v, w, dt, ft, yt; if (this.isCalloutActive() || s == null || s.toString() == "") return ""; this.setCalloutActive(!0); try { this.log.log(i.WARNING, "amt - init"); var d = u.getContextAsInt(f, "VAB_UOM_ID"), rt = u.getContextAsInt(f, "VAM_Product_ID"), ht = u.getContextAsInt(f, "VAM_PriceList_ID"), y = ht.toString(), a; a = n.dataContext.getJSONRecord("MVAMPriceList/GetPriceList", y); g = a.StdPrecision; ct = t.getValueOfInt(e.getValue("VAB_OrderLine_ID")); nt = e.getValue("QtyEntered"); tt = e.getValue("QtyInvoiced"); this.log.fine("QtyEntered=" + nt + ", Invoiced=" + tt + ", UOM=" + d); c = e.getValue("PriceEntered"); l = e.getValue("PriceActual"); b = e.getValue("PriceLimit"); p = e.getValue("PriceList"); this.log.fine("PriceList=" + p + ", Limit=" + b + ", Precision=" + g); this.log.fine("PriceEntered=" + c + ", Actual=" + l); o.getColumnName() == "QtyEntered" && r > 0 && (it = u.getContextAsInt(f, "VAB_BusinessPartner_ID", !1), ct == 0 && (y = rt.toString().concat(",", e.getValue("VAB_Invoice_ID").toString() + "," + t.getValueOfString(e.getValue("VAM_PFeature_SetInstance_ID")) + "," + d.toString() + "," + u.getVAF_Client_ID().toString() + "," + it.toString() + "," + nt.toString()), v = n.dataContext.getJSONRecord("MVABInvoice/GetPrices", y), v != null && (p = v.PriceList, e.setValue("PriceList", p), c = v.PriceEntered, e.setValue("PriceLimit", v.PriceLimit), l = c, e.setValue("PriceActual", l), e.setValue("PriceEntered", c)))); (o.getColumnName() == "QtyInvoiced" || o.getColumnName() == "QtyEntered" || o.getColumnName() == "VAM_Product_ID") && !1 == u.getContext("DiscountSchema") ? (it = u.getContextAsInt(f, "VAB_BusinessPartner_ID"), o.getColumnName() == "QtyEntered" && (y = rt.toString().concat(",", d.toString(), ",", nt.toString()), tt = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", y)), tt == null && (tt = nt), lt = u.getWindowContext(f, "IsSOTrx", !0) == "Y", ot = e.getValue("DateInvoiced"), r = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='ED011_'")), pt = n.dataContext.getJSONRecord("MVABInvoice/GetInvoice", e.getValue("VAB_Invoice_ID").toString()), at = n.dataContext.getJSONRecord("MVAMPriceListVersion/GetVAM_PriceListVersion_ID", pt.VAM_PriceList_ID.toString()), ct == 0 && (k = ot == null ? rt.toString().concat(",", it.toString(), ",", tt.toString(), ",", lt, ",", ht.toString(), ",", at.toString(), ",", ot, ",", null, ",", d.toString(), ",", r) : rt.toString().concat(",", it.toString(), ",", tt.toString(), ",", lt, ",", ht.toString(), ",", at.toString(), ",", ot.toString(), ",", null, ",", d.toString(), ",", r), a = null, a = n.dataContext.getJSONRecord("MVAMProductPricing/GetProductPricing", k), r <= 0 ? (y = rt.toString().concat(",", d.toString(), ",", l.toString()), c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", y)) : (k = rt.toString().concat(",", e.getValue("VAB_Invoice_ID").toString() + "," + t.getValueOfString(e.getValue("VAM_PFeature_SetInstance_ID")) + "," + d.toString() + "," + u.getVAF_Client_ID().toString() + "," + it.toString() + "," + nt.toString()), v = n.dataContext.getJSONRecord("MVABInvoice/GetPrices", k), v != null && (p = v.PriceList, e.setValue("PriceList", p), c = v.PriceEntered, e.setValue("PriceLimit", v.PriceLimit))), c == null && (c = a.PriceStd), this.log.fine("amt - QtyChanged -> PriceActual=" + a.PriceStd + ", PriceEntered=" + c + ", Discount=" + a.Discount), l = r <= 0 ? a.PriceStd : c, e.setValue("PriceActual", l), e.setValue("PriceEntered", c)), u.setContext(f, "DiscountSchema", a.IsDiscountSchema ? "Y" : "N")) : o.getColumnName() == "PriceActual" ? (l = t.getValueOfDecimal(s.toFixed(g)), c = l, this.log.fine("amt - PriceActual=" + l + " -> PriceEntered=" + c), e.setValue("PriceEntered", c), e.SetValue("PriceActual", l)) : o.getColumnName() == "PriceEntered" && (c = t.getValueOfDecimal(s.toFixed(g)), l = c, l == null && (l = c), this.log.fine("amt - PriceEntered=" + c + " -> PriceActual=" + l), e.setValue("PriceActual", l), e.setValue("PriceEntered", c)); var wt = !1, ut = u.getContext("EnforcePriceLimit"), st = u.isSOTrx() && ut != null && ut == "Y"; if (ut == "") { var k = t.getValueOfInt(e.getValue("VAB_Invoice_ID")).toString(), bt = n.dataContext.getJSONRecord("MVABInvoice/GetInvoice", k), vt = "SELECT EnforcePriceLimit FROM VAM_PriceList WHERE IsActive = 'Y' AND VAM_PriceList_ID = " + bt.VAM_PriceList_ID; ut = n.DB.executeScalar(vt); st = bt.IsSOTrx && ut != null && ut == "Y"; vt = "SELECT OverwritePriceLimit FROM VAF_Role WHERE IsActive = 'Y' AND VAF_Role_ID = " + u.getContext("#VAF_Role_ID"); wt = t.getValueOfBoolean(n.DB.executeScalar(vt)) } if (st && wt && (st = !1), st && t.getValueOfDouble(b) != 0 && l.compareTo(b) < 0 && (l = b, c = l, c == null && (c = b), this.log.fine("amt =(under) PriceEntered=" + c + ", Actual" + b), e.setValue("PriceActual", b), e.setValue("PriceEntered", c), n.ADialog.info("UnderLimitPrice"), t.getValueOfInt(p) != 0 && (et = (p - l) / p * 100, t.scale(et) > 2 && (et = et.toFixed(2)))), c = t.getValueOfDecimal(e.getValue("PriceEntered")), w = nt * c, t.scale(w) > g && (w = t.getValueOfDecimal(w.toFixed(g))), this.log.info("amt = LineNetAmt=" + w), e.setValue("LineNetAmt", w), dt = "Y" == u.getWindowContext(f, "IsSOTrx", !0), ft = n.Env.ZERO, o.getColumnName() == "TaxAmt") ft = e.getValue("TaxAmt"); else if (yt = e.getValue("VAB_TaxRate_ID"), yt != null) { var gt = yt, kt = this.IsTaxIncluded(f, u), k = gt.toString().concat(",", w.toString(), ",", kt, ",", g.toString()), a = null; ft = n.dataContext.getJSONRecord("MTax/CalculateTax", k); e.setValue("TaxAmt", ft); e.getField("SurchargeAmt") != null && e.setValue("SurchargeAmt", 0) } kt ? e.setValue("LineTotalAmt", t.getValueOfDecimal(w)) : e.setValue("LineTotalAmt", t.getValueOfDecimal(w) + ft) } catch (ni) { this.setCalloutActive(!1); this.log.severe(ni.toString()) } return this.setCalloutActive(!1), u = f = e = o = s = h = null, "" }; o.prototype.IsTaxIncluded = function (t, i) { var r = i.getContext("IsTaxIncluded"), u; try { if (r.toString().length == 0) { if (u = i.getContextAsInt(t, "VAM_PriceList_ID"), u == 0) return !1; r = n.DB.executeScalar("SELECT IsTaxIncluded FROM VAM_PriceList WHERE VAM_PriceList_ID=" + u, null, null).toString(); r == null && (r = "N"); i.setContext(t, "IsTaxIncluded", r) } } catch (f) { this.setCalloutActive(!1); this.log.severe(f.toString()) } return i = t = mTab = mField = value = oldValue = null, "Y" == r }; o.prototype.Qty = function (u, f, e, o, s, h) { var p, w, l, c, nt, b, it, ot, k, rt, ut, ft, et, v, d, a, y; if (s == null || s.toString() == "" || this.isCalloutActive() || s == null) return ""; this.setCalloutActive(!0); try { if (p = "", w = u.getContextAsInt(f, "VAM_Product_ID"), this.log.log(i.WARNING, "qty - init - VAM_Product_ID=" + w), w == 0) c = e.getValue("QtyEntered"), e.setValue("QtyInvoiced", c); else if (o.getColumnName().toString().equals("VAB_UOM_ID") || o.getColumnName().toString().equals("VAM_PFeature_SetInstance_ID")) a = t.getValueOfInt(e.getValue("VAB_UOM_ID")), c = e.getValue("QtyEntered"), it = u.getContextAsInt(f, "VAB_BusinessPartner_ID", !1), ot = n.dataContext.getJSONRecord("MBPartner/GetBPartner", it.toString()), p = w.toString().concat(",", e.getValue("VAB_Invoice_ID").toString() + "," + t.getValueOfString(e.getValue("VAM_PFeature_SetInstance_ID")) + "," + a.toString() + "," + u.getVAF_Client_ID().toString() + "," + it.toString() + "," + c.toString()), k = n.dataContext.getJSONRecord("MVABInvoice/GetPrices", p), k != null && (r = k.countEd011, rt = k.countVAPRC, r <= 0 && rt <= 0 ? (v = null, c != null && (p = a.toString(), d = n.dataContext.getJSONRecord("MUOM/GetPrecision", p), v = c.toFixed(d)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + a + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), p = w.toString().concat(",", a.toString(), ",", c.toString()), l = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", p), l == null && (l = c), y = c != l, nt = e.getValue("PriceActual"), p = w.toString().concat(",", a.toString(), ",", nt.toString()), b = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", p), b == null && (b = nt), this.log.fine("qty - UOM=" + a + ", QtyEntered/PriceActual=" + c + "/" + nt + " -> " + y + " QtyInvoiced/PriceEntered=" + l + "/" + b), u.setContext(f, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyInvoiced", l), e.setValue("PriceEntered", b)) : (ut = k.PriceList, e.setValue("PriceList", ut), b = k.PriceEntered, e.setValue("PriceLimit", k.PriceLimit), e.setValue("PriceActual", b), e.setValue("PriceEntered", b), p = a.toString().concat(","), ft = n.dataContext.getJSONRecord("MUOM/GetPrecision", p), v = c.toFixed(t.getValueOfInt(ft)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + a + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), p = w.toString().concat(",", a.toString(), ",", c.toString()), et = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", p), l = et, y = !1, l != null && (y = c != l), l == null && (y = !1, l = 1), y ? e.setValue("QtyInvoiced", l) : e.setValue("QtyInvoiced", l * v))); else if (o.getColumnName().equals("QtyEntered")) a = u.getContextAsInt(f, "VAB_UOM_ID"), c = s, v = null, c != null && (d = n.dataContext.getJSONRecord("MUOM/GetPrecision", a.toString()), v = c.toFixed(d)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + a + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), g = w.toString().concat(",", a.toString(), ",", c.toString()), l = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", g), l == null && (l = c), y = c != l, this.log.fine("qty - UOM=" + a + ", QtyEntered=" + c + " -> " + y + " QtyInvoiced=" + l), u.setContext(f, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyInvoiced", l); else if (o.getColumnName().equals("QtyInvoiced")) { a = u.getContextAsInt(f, "VAB_UOM_ID"); l = s; var g = w.toString(), d = n.dataContext.getJSONRecord("MVAMProduct/GetUOMPrecision", g), tt = null; l != null && (tt = t.getValueOfDecimal(l.toFixed(d))); l != tt && (this.log.fine("Corrected QtyInvoiced Scale " + l + "->" + tt), l = tt, e.setValue("QtyInvoiced", l)); g = w.toString().concat(",", a.toString(), ",", l.toString()); c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", g); c == null && (c = l); y = l != c; this.log.fine("qty - UOM=" + a + ", QtyInvoiced=" + l + " -> " + y + " QtyEntered=" + c); u.setContext(f, "UOMConversion", y ? "Y" : "N"); e.setValue("QtyEntered", c) } } catch (st) { this.setCalloutActive(!1); this.log.severe(st.toString()) } finally { this.setCalloutActive(!1) } return u = f = e = o = s = h = null, "" }; o.prototype.PriceList = function (r, u, f, e, o, s) { var l = "", h = null, c, a, v; try { if (o == null || o.toString() == "" || (c = t.getValueOfInt(o.toString()), c == null || c == 0)) return ""; l = "SELECT pl.IsTaxIncluded,pl.EnforcePriceLimit,pl.VAB_Currency_ID,c.StdPrecision,plv.VAM_PriceListVersion_ID,plv.ValidFrom FROM VAM_PriceList pl,VAB_Currency c,VAM_PriceListVersion plv WHERE pl.VAB_Currency_ID=c.VAB_Currency_ID AND pl.VAM_PriceList_ID=plv.VAM_PriceList_ID AND pl.VAM_PriceList_ID=" + c + "ORDER BY plv.ValidFrom DESC"; h = n.DB.executeReader(l); h.read() && (f.setValue("IsTaxIncluded", Boolean("Y".equals(h.get("istaxincluded")))), r.setContext(u, "EnforcePriceLimit", h.get("enforcepricelimit")), a = t.getValueOfInt(h.get("VAB_Currency_id")), f.setValue("VAB_Currency_ID", a), v = t.getValueOfInt(h.get("VAM_PriceListVersion_id")), r.setContext(u, "VAM_PriceListVersion_ID", v)); h.close() } catch (y) { return this.setCalloutActive(!1), h != null && h.close(), this.log.log(i.severe, l, y), y.message } return r = u = f = e = o = s = null, "" }; n.Model.CalloutInvoice = o; n.Utility.inheritPrototype(a, n.CalloutEngine); a.prototype.Date = function (n, t, i, r, u, f) { return u == null || u.toString() == "" ? "" : (i.setValue("DateAcct", u), this.SetDocumentNo(n, t, i), n = t = i = r = u = f = null, "") }; a.prototype.BPartner = function (r, u, f, e, o, s) { var l, c, p, a, w, v, b, g, nt; if (o == null || o.toString() == "" || (l = t.getValueOfInt(o), l == null || l == 0)) return ""; var k = "SELECT p.VAF_Language,p.VAB_PaymentTerm_ID, COALESCE(p.VAM_PriceList_ID,g.VAM_PriceList_ID) AS VAM_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted, p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable, l.VAB_BPart_Location_ID,c.VAF_UserContact_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID FROM VAB_BusinessPartner p INNER JOIN VAB_BPart_Category g ON (p.VAB_BPart_Category_ID=g.VAB_BPart_Category_ID) LEFT OUTER JOIN VAB_BPart_Location l ON (p.VAB_BusinessPartner_ID=l.VAB_BusinessPartner_ID AND l.IsBillTo='Y' AND l.IsActive='Y') LEFT OUTER JOIN VAF_UserContact c ON (p.VAB_BusinessPartner_ID=c.VAB_BusinessPartner_ID) WHERE p.VAB_BusinessPartner_ID=@Param1 AND p.IsActive='Y'", y = r.isSOTrx(), d = [], h = null; try { d[0] = new n.DB.SqlParam("@Param1", l); h = n.DB.executeReader(k, d, null); h.read() && (c = t.getValueOfString(h.get(y ? "paymentrule" : "paymentrulepo")), c != null && c.length != 0 && (r.getContext("DocBaseType").endsWith("C") ? c = "P" : (this.isSOTrx && c == "S" || c == "U") && (c = "P")), p = t.getValueOfInt(h.get(y ? "VAB_Paymentterm_id" : "po_paymentterm_id")), p > 0 && f.setValue("VAB_PaymentTerm_ID", p), a = t.getValueOfInt(h.get("VAB_BPart_Location_id")), l.toString().equals(r.getContext("VAB_BusinessPartner_ID")) && (w = r.getContext("VAB_BPart_Location_ID"), w.toString().length > 0 && (a = t.getValueOfInt(w))), a == 0 ? f.setValue("VAB_BPart_Location_ID", null) : f.setValue("VAB_BPart_Location_ID", t.getValueOfInt(a)), v = t.getValueOfInt(h.get("VAF_UserContact_id")), l.toString().equals(r.getContext("VAB_BusinessPartner_ID")) && (b = r.getContext("VAF_UserContact_ID"), b.toString().length > 0 && (v = t.getValueOfInt(b))), v == 0 ? f.setValue("VAF_UserContact_ID", null) : f.setValue("VAF_UserContact_ID", t.getValueOfInt(v)), y && (g = t.getValueOfDouble(h.get("so_creditlimit")), g != 0 && (nt = t.getValueOfDouble(h.get("creditavailable")), h == null && nt < 0 && n.ADialog.info("CreditLimitOver")))); h.close() } catch (tt) { return this.setCalloutActive(!1), h != null && h.close(), this.log.log(i.severe, k, tt), tt.message } return this.SetDocumentNo(r, u, f), s = null, this.Tax(r, u, f, e, o) }; a.prototype.DocType = function (n, t, i, r, u, f) { return this.SetDocumentNo(n, t, i), n = t = i = r = u = f = null, "" }; a.prototype.SetDocumentNo = function (i, r, u, f, e, o) { var w = i.getContextAsInt(r, "VAB_BatchInvoice_ID"), b = "SELECT COALESCE(MAX(VAB_BatchInvoiceLine_ID),0) FROM VAB_BatchInvoiceLine WHERE VAB_BatchInvoice_ID=" + w, l = n.DB.executeScalar(b), a, s, v, y, c, h, p; l != 0 && (a = l.toString(), s = null, s = n.dataContext.getJSONRecord("MVABBatchInvoiceLine/GetInvoiceBatchLine", a), v = i.getContextAsInt(r, "VAB_DocTypes_ID"), y = i.getContextAsInt(r, "VAB_BusinessPartner_ID"), v != s.VAB_DocTypes_ID || y != s.VAB_BusinessPartner_ID) && (c = s.DocumentNo, c != null) && (h = 0, h = t.getValueOfInt(c), h != 0) && (p = t.getValueOfString(h + 1), u.setValue("DocumentNo", p), i = r = u = f = e = o = null) }; a.prototype.Charge = function (r, u, f, e, o, s) { var c; if (o == null || o.toString() == "" || (c = t.getValueOfInt(o), c == null || t.getValueOfInt(c) == 0)) return ""; var l = "SELECT ChargeAmt FROM VAB_Charge WHERE VAB_Charge_ID=@Param1", a = [], h = null; try { a[0] = new n.DB.SqlParam("@Param1", c); h = n.DB.executeReader(l, a, null); h.read() && f.setValue("PriceEntered", t.getValueOfDecimal(h.get(0))); h.close() } catch (v) { return this.setCalloutActive(!1), h != null && h.close(), this.log.log(i.severe, l, v), v.message } return s = null, this.Tax(r, u, f, e, o) }; a.prototype.Tax = function (i, r, u, f, e) { var p = f.getColumnName(), o, s, h, c, l, a, y, v; return e == null || e.toString() == "" ? "" : (o = 0, o = p.equals("VAB_Charge_ID") ? t.getValueOfInt(e) : i.getContextAsInt(r, "VAB_Charge_ID"), this.log.fine("VAB_Charge_ID=" + o), o == 0) ? this.Amt(i, r, u, f, e) : (s = i.getContextAsInt(r, "VAB_BPart_Location_ID"), s == 0) ? this.Amt(i, r, u, f, e) : (this.log.fine("BP_Location=" + s), h = t.getValueOfDate(i.getContext("DateInvoiced")), this.log.fine("Bill Date=" + h), c = h, this.log.fine("Ship Date=" + c), l = i.getContextAsInt(r, "VAF_Org_ID"), this.log.fine("Org=" + l), a = i.getContextAsInt("#VAM_Warehouse_ID"), this.log.fine("Warehouse=" + a), y = o.toString().concat(",", h.toString(), c.toString(), ",", l.toString(), ",", a.toString(), ",", s.toString(), ",", s.toString(), ",", i.getWindowContext(r, "IsSOTrx", !0).equals("Y")), v = n.dataContext.getJSONRecord("MTax/Get", y), v == 0 || u.setValue("VAB_TaxRate_ID", t.getValueOfInt(v)), this.Amt(i, r, u, f, e)) }; a.prototype.Amt = function (i, r, u, f, e, o) { var s, v, h, y; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); var a = i.getStdPrecision(), c = t.getValueOfDecimal(u.getValue("QtyEntered")), l = t.getValueOfDecimal(u.getValue("PriceEntered")); if (this.log.fine("QtyEntered=" + c + ", PriceEntered=" + l), c == null && (c = n.Env.ZERO), l == null && (l = n.Env.ZERO), s = c * l, t.scale(s) > a && (s = s.toFixed(a)), v = "Y" == i.getContext("IsTaxIncluded"), h = null, f.getColumnName().equals("TaxAmt")) h = u.getValue("TaxAmt"); else if (y = u.getValue("VAB_TaxRate_ID"), y != null) { var p = t.getValueOfInt(y), w = p.toString().concat(",", s.toString(), ",", v.toString(), ",", a.toString()); h = n.dataContext.getJSONRecord("MTax/CalculateTax", w); u.setValue("TaxAmt", h); u.getField("SurchargeAmt") != null && u.setValue("SurchargeAmt", 0) } return v ? (u.setValue("LineTotalAmt", s), u.setValue("LineNetAmt", t.getValueOfDecimal(s) * t.getValueOfDecimal(h))) : (u.setValue("LineNetAmt", s), u.setValue("LineTotalAmt", t.getValueOfDecimal(s) + t.getValueOfDecimal(h))), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutInvoiceBatch = a; n.Utility.inheritPrototype(si, n.CalloutEngine); si.prototype.Product = function (r, u, f, e, o, s) { var h, c, l, a, y, p, v; if (o == null || o.toString() == "") return t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(*) FROM vaf_column WHERE vaf_tableview_id =  (SELECT vaf_tableview_id   FROM vaf_tableview   WHERE upper(tablename) = upper('VAM_InvTrf_Line')) and upper(columnname) = 'VAB_UOM_ID'", null, null)) > 0 && (f.setValue("MovementQty", 1), f.setValue("QtyEntered", 1)), ""; if (this.isCalloutActive()) return ""; this.setCalloutActive(!0); try { if (h = o, h == null || h == 0) return ""; f.setValue("VAM_PFeature_SetInstance_ID", null); c = "SELECT COUNT(*) FROM vaf_column WHERE vaf_tableview_id =  (SELECT vaf_tableview_id   FROM vaf_tableview   WHERE upper(tablename) = upper('VAM_InvTrf_Line')) and upper(columnname) = 'VAB_UOM_ID'"; t.getValueOfInt(n.DB.executeScalar(c, null, null)) > 0 && (c = "select VAB_UOM_id from VAM_Product where VAM_Product_id=" + h, l = t.getValueOfInt(n.DB.executeScalar(c, null, null)), f.setValue("VAB_UOM_ID", l), o != s && (f.setValue("MovementQty", 1), f.setValue("QtyEntered", 1)), l = t.getValueOfDecimal(f.getValue("VAB_UOM_ID")), a = t.getValueOfDecimal(f.getValue("QtyEntered")), h = t.getValueOfInt(f.getValue("VAM_Product_ID")), y = h.toString().concat(",").concat(l.toString()).concat(",").concat(a.toString()), p = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", y), QtyOrdered = p, v = !1, QtyOrdered != null && (v = a != QtyOrdered), QtyOrdered == null && (v = !1, QtyOrdered = 1), v ? f.setValue("MovementQty", QtyOrdered) : f.setValue("MovementQty", QtyOrdered * a)) } catch (w) { return this.setCalloutActive(!1), this.log.log(i.severe, c, w), w.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; n.Model.CalloutMovement = si; n.Utility.inheritPrototype(hi, n.CalloutEngine); hi.prototype.Objectchk = function (i, r, u, f, o, s) { var y, a, v, c, w, h, p, l; if (o == null || o.toString() == "" || o == null || (y = t.getValueOfInt(u.getValue("FO_OBJECT_DATA_ID")), c = t.getValueOfDateTime(u.getValue("TODAYDATE")), y == null)) return ""; w = "select FO_RES_ACCOMODATION_ID,DATE_FROM,TILL_DATE from FO_RES_ACCOMODATION where FO_OBJECT_DATA_ID=@FO_OBJ_DATA_ID"; h = null; try { for (p = [], p[0] = new n.DB.SqlParam("@FO_OBJ_DATA_ID", y), h = n.DB.executeReader(w, p, null); h.read();) { if ((a = t.getValueOfDateTime(h[1]), v = t.getValueOfDateTime(h[2]), l = a, c.compareTo(v) > 0) || c.compareTo(a) < 0) return u.setValue("RES_STATUS", !1), ""; if (c.compareTo(a) > 0 && c.compareTo(v) < 0) while (!(l.compareTo(v) == 0)) c.compareTo(l) == 0 && u.setValue("RES_STATUS", !0), l = l.AddDays(1) } h.close() } catch (b) { this.setCalloutActive(!1); h != null && h.close(); this.log.severe(e.toString()) } finally { h != null && h.close() } return i = r = u = f = o = s = null, "" }; n.Model.CalloutObjectData = hi; n.Utility.inheritPrototype(lt, n.CalloutEngine); lt.prototype.Datechk = function (i, r, u, f, e, o) { var c, v, y, p, h, w; if (e == null || e.toString() == "" || (c = t.getValueOfDateTime(e), c == null || c == 0)) return ""; var b = u.getValue("VAF_ORG_ID"), l = 0, k = "select  DAYSPAYABLE2 from FO_SETTINGS where VAF_ORG_ID=" + b, s = null; try { for (s = n.DB.executeReader(k, null, null); s.read();)l = t.getValueOfInt(s[0].toString()); s.close() } catch (a) { this.setCalloutActive(!1); s != null && s.close(); this.log.severe(a.toString()) } v = t.getValueOfDateTime(u.getValue("DATE1")); y = v.AddDays(l); u.setValue("DATE2", y); h = 100; w = "select max(OFFERNO)from FO_OFFER"; try { for (s = n.DB.executeReader(w, null, null); s.read();)h = t.getValueOfInt(s[0].toString()); s.close() } catch (a) { this.setCalloutActive(!1); s != null && s.close(); this.log.severe(a.toString()) } finally { s != null && s.close() } return p = h == null | h == 0 ? 100 : h + 1, u.setValue("OFFERNO", p), i = r = u = f = e = o = null, "" }; lt.prototype.guestpricelist = function (i, r, u, f, e, o) { var h; if (e == null || (h = t.getValueOfInt(e), h == null || h == 0)) return ""; var l = "select FO_PRICE_LIST_ID from FO_ADDRESS_PRICE where FO_ADDRESS_ID=" + h, c = 0, s = null; try { for (s = n.DB.executeReader(l, null, null); s.read();)c = t.getValueOfInt(s[0]); s.close() } catch (a) { this.setCalloutActive(!1); s != null && s.close(); this.log.severe(a.toString()) } finally { s != null && s.close() } return u.setValue("FO_PRICE_LIST_ID", c), i = r = u = f = e = o = null, "" }; n.Model.CalloutOffer = lt; n.Utility.inheritPrototype(nt, n.CalloutEngine); nt.prototype.Period = function (i, r, u, f, e, o) { var s, h, a, l; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; s = f.getColumnName(); this.setCalloutActive(!0); var y = i.getContextAsInt(r, "VAF_Client_ID", !1), p = t.getValueOfInt(u.getValue("VAF_Org_ID")), c = new Date; if (c = s == "DateAcct" ? e : u.getValue("DateAcct"), h = 0, s == "VAB_YearPeriod_ID" && (h = t.getValueOfInt(e)), s == "DateDoc") u.setValue("DateAcct", e); else if (s == "DateAcct" || s == "VAF_Org_ID") a = y + "," + c + "," + p, h = t.getValueOfInt(n.dataContext.getJSONRecord("MVABYearPeriod/GetPeriod", a)), h != 0 && u.setValue("VAB_YearPeriod_ID", h); else if (l = n.dataContext.getJSONRecord("MVABYearPeriod/GetPeriodDetail", h.toString()), l != null) { var w = l.PeriodType, b = l.StartDate, v = l.EndDate; w == "S" && (c == null || c < b || c > v) && u.setValue("DateAcct", v) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; nt.prototype.Rate = function (r, u, f, o, s, h) { var a; if (s == null || s.toString() == "") return ""; try { var v = t.getValueOfInt(f.getValue("VAB_Currency_ID")), y = t.getValueOfInt(v), p = t.getValueOfInt(f.getValue("VAB_CurrencyType_ID")), w = t.getValueOfInt(p), l = f.getValue("DateAcct"); l == null && (a = new Date, l = a.toGMTString()); var b = t.getValueOfInt(r.getContextAsInt(u, "VAB_AccountBook_ID", !1)), k = b, d = n.dataContext.getJSONRecord("MAcctSchema/GetAcctSchema", k), g = t.getValueOfInt(r.getContextAsInt(u, "VAF_Client_ID", !1)), nt = t.getValueOfInt(r.getContextAsInt(u, "VAF_Org_ID", !1)), tt = y + "," + d.VAB_Currency_ID + "," + l + "," + w + "," + g + "," + nt, c = n.dataContext.getJSONRecord("MConversionRate/GetRate", tt); this.log.fine("rate = " + c); c == null && (c = 0); f.setValue("CurrencyRate", c) } catch (it) { return this.log.log(i.SEVERE, sql, e), this.setCalloutActive(!1), e.message } return r = u = f = o = s = h = null, "" }; nt.prototype.Amt = function (i, r, u, f, e, o) { var h, c, l, a; if (e == null || e.toString() == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); var y = t.getValueOfInt(i.getContextAsInt(r, "VAB_AccountBook_ID")), p = y.toString(), w = n.dataContext.getJSONRecord("MAcctSchema/GetAcctSchema", p), v = w.StdPrecision, s = u.getValue("CurrencyRate"); return s == null && (s = 1, u.setValue("CurrencyRate", s)), h = u.getValue("AmtSourceDr"), h == null && (h = 0), c = u.getValue("AmtSourceCr"), c == null && (c = 0), l = h * s, l.toFixed(v), u.setValue("AmtAcctDr", l), a = c * s, a.toFixed(v), u.setValue("AmtAcctCr", a), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutGLJournal = nt; n.Utility.inheritPrototype(tt, n.CalloutEngine); tt.prototype.Product = function (n, t, i, r, u, f) { if (u == null || u.toString() == "") return ""; var e = u; return e == null || e == 0 ? "" : (i.setValue("VAM_PFeature_SetInstance_ID", null), n = t = i = r = u = f = null, "") }; tt.prototype.SetAttributeSetInstance = function (t, i, r, u, f, e) { if (f == null || f.toString() == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); try { var o = f.toString(), s = n.dataContext.getJSONRecord("MVAMProductionLine/GetAttributeSetInstance", o); r.setValue("VAM_PFeature_SetInstance_ID", s) } catch (h) { this.setCalloutActive(!1); this.log.severe(h.toString()) } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; tt.prototype.SetBOM = function (t, i, r, u, f, e) { var o, s; if (f == null || f.toString() == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); try { u.getColumnName().equals("VAM_Product_ID") ? (r.setValue("VAM_PFeature_SetInstance_ID", 0), o = f.toString().concat(",", 0)) : u.getColumnName().equals("VAM_PFeature_SetInstance_ID") && (o = r.getValue("VAM_Product_ID").toString().concat(",", f.toString())); s = n.dataContext.getJSONRecord("MVAMProductionLine/GetBOM", o); r.setValue("VAM_BOM_ID", s) } catch (h) { this.setCalloutActive(!1); this.log.severe(h.toString()) } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutProduction = tt; n.Utility.inheritPrototype(it, n.CalloutEngine); it.prototype.CopyMail = function (r, u, f, e, o, s) { var v = e.getColumnName(), c; if (this.log.info(v + "=" + o), o == null || o.toString() == "") return ""; var y = t.getValueOfInt(o), l = "SELECT MailHeader, MailText FROM VAR_MailTemplate WHERE VAR_MailTemplate_ID=@Param1", a = [], h = null; try { a[0] = new n.DB.SqlParam("@Param1", t.getValueOfInt(y)); h = n.DB.executeReader(l, a, null); h.read() && (c = h.get("mailtext"), c = n.Env.parseContext(r, u, c, !1, !0), f.setValue("Result", c)); h.close() } catch (p) { this.setCalloutActive(!1); h != null && h.close(); this.log.log(i.SEVERE, l, p) } return r = u = f = e = o = s = null, "" }; it.prototype.CopyResponse = function (r, u, f, e, o, s) { var v = e.getColumnName(), c; if (this.log.info(v + "=" + o), o == null || o.toString() == "") return ""; var y = t.getValueOfInt(o), l = "SELECT Name, ResponseText FROM VAR_Req_StandardReply WHERE VAR_Req_StandardReply_ID=@Param1", a = [], h = null; try { a[0] = new n.DB.SqlParam("@Param1", t.getValueOfInt(y)); h = n.DB.executeReader(l, a, null); h.read() && (c = h.get("responsetext"), c = n.Env.parseContext(r, u, c, !1, !0), f.setValue("Result", c)); h.close() } catch (p) { this.setCalloutActive(!1); h != null && h.close(); this.log.log(i.SEVERE, l, p) } return r = u = f = e = o = s = null, "" }; it.prototype.Type = function (i, r, u, f, e, o) { var l = f.getColumnName(), s, c, h; return (this.log.info(l + "=" + e), u.setValue("VAR_Req_Status_ID", null), e == null || e.toString() == "") ? "" : (s = t.getValueOfInt(e), s == 0) ? "" : (c = s.toString(), h = n.dataContext.getJSONRecord("MVARRequestType/GetDefaultVAR_Req_Status_ID", c), h != 0 && u.setValue("VAR_Req_Status_ID", t.getValueOfInt(h)), i = r = u = f = e = o = null, "") }; n.Model.CalloutRequest = it; n.Utility.inheritPrototype(rt, n.CalloutEngine); rt.prototype.Product = function (i, r, u, f, e, o) { var s, h, c, l; try { if (e == null || e.toString() == "" || (s = e, s == null || s == 0)) return ""; u.setValue("VAM_PFeature_SetInstance_ID", null); var a = i.getContextAsInt(r, "VAB_BusinessPartner_ID"), v = u.getValue("Qty"), y = !1, p = i.getContextAsInt(r, "VAM_PriceList_ID"), w = i.getContextAsInt(r, "VAM_PriceListVersion_ID"), b = u.getValue("DateRequired"), c = "SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='ED011_'", k = t.getValueOfInt(n.DB.executeScalar(c)), d, g = n.dataContext.getJSONRecord("MVAMProduct/GetVAB_UOM_ID", s); d = k > 0 ? s.toString().concat(",", a, ",", v, ",", y, ",", p, ",", w, ",", b, ",", null, ",", g, ",", k) : s.toString().concat(",", a, ",", v, ",", y, ",", p, ",", w, ",", b, ",", null); h = null; h = n.dataContext.getJSONRecord("MVAMProductPricing/GetProductPricing", d); u.setValue("PriceActual", h.PriceActual); i.setContext(r, "EnforcePriceLimit", h.EnforcePriceLimit ? "Y" : "N"); i.setContext(r, "DiscountSchema", h.DiscountSchema ? "Y" : "N"); u.setValue("VAB_UOM_ID", g); c = "SELECT VAB_OrderLine_ID FROM VAB_OrderLine WHERE VAB_Order_ID = (SELECT VAB_Order_ID  FROM VAB_Order  WHERE DocumentNo= (SELECT DocumentNo FROM VAM_Requisition WHERE VAM_Requisition.VAM_Requisition_id = " + u.getValue("VAM_Requisition_id") + ") AND VAF_Client_ID =" + i.getVAF_Client_ID() + ") AND VAM_Product_ID=" + e; l = t.getValueOfInt(n.DB.executeScalar(c)); l > 0 && u.setValue("VAB_OrderLine_ID", l) } catch (nt) { return this.setCalloutActive(!1), nt.message } return i = r = u = f = e = o = null, "" }; rt.prototype.Amt = function (i, r, u, f, e, o) { var s; if (e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; try { if (this.setCalloutActive(!0), f.getColumnName() == "Qty" && "Y" == i.getContext("DiscountSchema")) { var v = i.getContextAsInt(r, "VAM_Product_ID"), y = i.getContextAsInt(r, "VAB_BusinessPartner_ID"), p = e, w = i.getContextAsInt(r, "VAM_PriceList_ID"), b = i.getContextAsInt(r, "VAM_PriceListVersion_ID"), k = u.getValue("DateInvoiced"), d = v.concat(",", y, ",", p, ",", !1, ",", w, ",", b, ",", k, ",", null), l = null; l = n.dataContext.getJSONRecord("MVAMProductPricing/GetProductPricing", d); u.setValue("PriceActual", l.PriceActual) } var h = i.getStdPrecision(), a = u.getValue("QtyEntered"), c = u.getValue("PriceActual"); this.log.fine("amt - Qty=" + a + ", Price=" + c + ", Precision=" + h); s = a * c; t.scale(s) > h && (s = s.toFixed(h)); u.setValue("LineNetAmt", s); u.setValue("PriceActual", t.getValueOfDecimal(c.toFixed(h))); this.log.info("amt - LineNetAmt=" + s) } catch (g) { this.setCalloutActive(!1); this.log.saveError("CalloutRequisation", g) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; rt.prototype.Qty = function (i, r, u, e, o, s) { var a = "", p, h, c, v, g, w, tt, l, nt, y, b, k, it, d; if (this.isCalloutActive() || o == null || o.toString() == "" || (console.log("Before Charge Or Product"), t.getValueOfInt(u.getValue("VAM_Product_ID")) == 0)) return ""; console.log("After Charge Or Product"); this.setCalloutActive(!0); try { if (p = i.getContextAsInt(r, "VAM_Product_ID"), f && this.log.Warning("init - VAM_Product_ID=" + p + " - "), h = n.Env.ZERO, c = n.Env.ZERO, p == 0) h = t.getValueOfDecimal(u.getValue("QtyEntered")), c = h, u.setValue("Qty", c); else if (e.getColumnName() == "VAB_UOM_ID") { l = t.getValueOfInt(o); h = t.getValueOfDecimal(u.getValue("QtyEntered")); w = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"); tt = 0; w != null && (tt = w.VA009_ ? 1 : 0); var rt = i.getContextAsInt(r, "VAB_BusinessPartner_ID"), ut = i.getContextAsInt(r, "VAM_PFeature_SetInstance_ID"), ft = i.getContextAsInt(r, "VAM_PriceList_ID"), et = i.getContextAsInt(r, "VAM_PriceListVersion_ID"), ot = i.getContext(r, "DateDoc"); a = p.toString().concat(",", rt, ",", h, ",", !1, ",", ft, ",", et, ",", ot, ",", null, ",", ut.toString(), ",", l, ",", tt); w = null; w = n.dataContext.getJSONRecord("MVAMProductPricing/GetProductPricing", a); w != null && (v = w.PriceActual); a = l.toString().concat(","); nt = n.dataContext.getJSONRecord("MUOM/GetPrecision", a); y = h.toFixed(t.getValueOfInt(nt)); h != y && (this.log.fine("Corrected QtyEntered Scale UOM=" + l + "; QtyEntered=" + h + "->" + y), h = y, u.setValue("QtyEntered", h)); a = p.toString().concat(",", l.toString(), ",", h.toString()); b = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a); c = b; c == null && (c = h); k = h != c; v == 0 ? (v = t.getValueOfDecimal(u.getValue("PriceActual")), a = p.toString().concat(",", l.toString(), ",", v.toString()), b = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), g = b, g == null && (g = v), this.log.fine("UOM=" + l + ", QtyEntered/PriceActual=" + h + "/" + v + " -> " + k + " QtyRequired/PriceEntered=" + c + "/" + g), i.setContext(r, "UOMConversion", k ? "Y" : "N"), u.setValue("PriceActual", g)) : u.setValue("PriceActual", v); u.setValue("Qty", c) } else e.getColumnName() == "QtyEntered" && (l = i.getContextAsInt(r, "VAB_UOM_ID"), h = t.getValueOfDecimal(o), a = l.toString().concat(","), nt = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), y = h.toFixed(t.getValueOfInt(nt)), h != y && (this.log.fine("Corrected QtyEntered Scale UOM=" + l + "; QtyEntered=" + h + "->" + y), h = y, u.setValue("QtyEntered", h)), a = p.toString().concat(",", l.toString(), ",", h.toString()), b = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), c = b, c == null && (c = h), k = h != c, this.log.fine("UOM=" + l + ", QtyEntered=" + h + " -> " + k + " Qty=" + c), i.setContext(r, "UOMConversion", k ? "Y" : "N"), u.setValue("Qty", c)); v = t.getValueOfDecimal(u.getValue("PriceActual")); it = i.getStdPrecision(); d = h * v; t.scale(d) > it && (d = d.toFixed(it)); u.setValue("LineNetAmt", d); this.log.info("amt - LineNetAmt=" + d) } catch (st) { return this.setCalloutActive(!1), st } return this.setCalloutActive(!1), i = r = u = e = o = s = null, "" }; n.Model.CalloutRequisition = rt; n.Utility.inheritPrototype(at, n.CalloutEngine); at.prototype.PayAmt = function (n, i, r, u, f, e) { var o, h, s; if (this.isCalloutActive() || f == null || f == "" || (o = t.getValueOfInt(r.getValue("VAB_Invoice_ID")), o == null) || (h = o, h == 0)) return ""; var c = t.getValueOfDecimal(r.getValue("OpenAmt")), l = t.getValueOfDecimal(r.getValue("PayAmt")), a = t.getValueOfDecimal(r.getValue("DiscountAmt")); return this.setCalloutActive(!0), s = c - l - a, this.log.fine(" - OpenAmt=" + c + " - PayAmt=" + l + ", Discount=" + a + ", Difference=" + s), r.setValue("DifferenceAmt", s), this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; at.prototype.Invoice = function (r, u, f, e, o, s) { var c, a, p; if (this.isCalloutActive() || o == null || o == "" || (c = t.getValueOfInt(o), c == 0)) return ""; a = r.getContextAsInt(u, "VAB_Bank_Acct_ID"); p = r.getContext("PayDate"); this.setCalloutActive(!0); var l = n.Env.ZERO, v = n.Env.ZERO, w = "SELECT currencyConvert(invoiceOpen(i.VAB_Invoice_ID, 0), i.VAB_Currency_ID,ba.VAB_Currency_ID, i.DateInvoiced, i.VAB_CurrencyType_ID, i.VAF_Client_ID, i.VAF_Org_ID) as OpenAmt, paymentTermDiscount(i.GrandTotal,i.VAB_Currency_ID,i.VAB_PaymentTerm_ID,i.DateInvoiced,'" + p + "') As DiscountAmt, i.IsSOTrx FROM VAB_Invoice_v i, VAB_Bank_Acct ba WHERE i.VAB_Invoice_ID=@Param2 AND ba.VAB_Bank_Acct_ID=@Param3", y = [], h = null; try { y[0] = new n.DB.SqlParam("@Param2", c); y[1] = new n.DB.SqlParam("@Param3", a); h = n.DB.executeReader(w, y, null); h.read() && (l = h.get("openamt"), v = h.get("discountamt"), IsSOTrx = "Y" == h.get("issotrx")); h.close() } catch (b) { this.setCalloutActive(!1); h != null && h.close(); this.log.log(i.SEVERE, w, b) } return this.log.fine(" - OpenAmt=" + l + " (Invoice=" + c + ",BankAcct=" + a + ")"), f.setValue("OpenAmt", l), f.setValue("PayAmt", l - v), f.setValue("DiscountAmt", v), f.setValue("DifferenceAmt", n.Env.ZERO), f.setValue("IsSOTrx", "N"), this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; n.Model.CalloutPaySelection = at; n.Utility.inheritPrototype(ut, n.CalloutEngine); ut.prototype.EndDate = function (i, r, u, f, e, o) { if (e == null || e.toString() == "") return ""; var h = new Date(u.getValue("StartDate")), c = t.getValueOfInt(u.getValue("VAB_Frequency_ID")), l = "Select NoOfMonths from VAB_Frequency where VAB_Frequency_ID=" + c, v = t.getValueOfInt(n.DB.executeScalar(l, null, null)), a = t.getValueOfInt(u.getValue("NoofCycle")), s = h.getDate() + "/" + (h.getMonth() + months * a) + "/" + h.getFullYear(); return s = s <= 0 ? new Date : new Date(s), s = s.toISOString(), u.setValue("EndDate", s), i = r = u = f = e = o = null, "" }; ut.prototype.Qty = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var s = t.getValueOfDecimal(f), h = t.getValueOfDecimal(r.getValue("QtyPerCycle")), o = s * h; return r.setValue("QtyEntered", o), r.setValue("QtyOrdered", o), n = i = r = u = f = e = null, "" }; ut.prototype.QtyPerCycle = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var s = t.getValueOfDecimal(f), h = t.getValueOfDecimal(r.getValue("NoofCycle")), o = h * s; return r.setValue("QtyEntered", o), r.setValue("QtyOrdered", o), n = i = r = u = f = e = null, "" }; n.Model.CalloutOrderLine = ut; n.Utility.inheritPrototype(ci, n.CalloutEngine); ci.prototype.Orderline = function (i, r, u, f, e, o) { if (e == null || e.toString() == "" || t.getValueOfInt(e) == 0 || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); var h = t.getValueOfInt(e), s = n.dataContext.getJSONRecord("MVABOrderLine/GetOrderLine", h); u.setValue("VAM_Product_ID", s.VAM_Product_ID); u.setValue("Qty", s.Qty); u.setValue("VAB_UOM_ID", s.VAB_UOM_ID); u.setValue("VAB_BusinessPartner_ID", s.VAB_BusinessPartner_ID); u.setValue("PlannedHours", s.PlannedHours); this.setCalloutActive(!1) } catch (c) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutOrderlineRecording = ci; n.Utility.inheritPrototype(li, n.CalloutEngine); li.prototype.Currency = function (i, r, u, f, e, o) { var s, h; if (e == null || e.toString() == "") return ""; s = ""; try { s = "select VAB_Currency_id from VAM_PriceList where VAM_PriceList_ID = " + t.getValueOfInt(e); h = t.getValueOfInt(n.DB.executeScalar(s, null, null)); u.setValue("VAB_Currency_ID", h) } catch (c) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutCurrency = li; n.Utility.inheritPrototype(ai, n.CalloutEngine); ai.prototype.Qty = function (i, r, u, f, e, o) { var c, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; var y = t.getValueOfDecimal(u.getValue("PriceActual")), p = t.getValueOfDecimal(u.getValue("QtyEntered")), l = 0, w = n.Env.ZERO, s = n.Env.ZERO; if (u.setValue("LineNetAmt", y * p), l = t.getValueOfInt(u.getValue("VAB_TaxRate_ID")), u.getField("SurchargeAmt") != null) { var b = 0, a = !1, v = n.dataContext.getJSONRecord("MVAMPriceList/GetPriceListData", u.getValue("VAM_PriceList_ID").toString()); v != null && (b = v.StdPrecision, a = "Y" == v.IsTaxIncluded); h = t.getValueOfDecimal(u.getValue("LineNetAmt")); c = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", l.toString() + "," + h.toString() + "," + b.toString() + "," + a.toString()); s = c.TaxAmt; u.setValue("TaxAmt", s); u.setValue("SurchargeAmt", c.SurchargeAmt); a ? u.setValue("GrandTotal", h) : u.setValue("GrandTotal", h + s + c.SurchargeAmt) } else w = n.dataContext.getJSONRecord("MTax/GetTaxRate", l.toString()), h = t.getValueOfDecimal(u.getValue("LineNetAmt")), s = t.getValueOfDecimal(t.getValueOfDecimal(h) * t.getValueOfDecimal(w) / 100), s = s.toFixed(2), u.setValue("taxamt", s), u.setValue("GrandTotal", y * p + t.getValueOfDecimal(u.getValue("TaxAmt"))); return i = r = u = f = e = o = null, "" }; n.Model.CalloutContractQty = ai; n.Utility.inheritPrototype(vi, n.CalloutEngine); vi.prototype.ContractProduct = function (n, i, r, u, f, e) { if (f == null || f.toString() == "" || t.getValueOfInt(f) == 0) return ""; var o = t.getValueOfInt(r.getValue("M_Proudct_ID")); return o != 0 && t.getValueOfBoolean(f) && (r.setValue("PriceList", 0), r.setValue("PriceLimit", 0), r.setValue("PriceActual", 0), r.setValue("PriceEntered", 0)), n = i = r = u = f = e = null, "" }; n.Model.CalloutContractProduct = vi; n.Utility.inheritPrototype(p, n.CalloutEngine); p.prototype.InvoiceCount = function (i, r, u, f, e, o) { if (e == null || e.toString() == "" || t.getValueOfInt(e) == 0) return ""; var s = t.getValueOfDateTime(u.getValue("StartDate")), h = u.getValue("EndDate"), c = t.getValueOfInt(u.getValue("VAB_Frequency_ID")), l = "Select NoOfDays from VAB_Frequency where VAB_Frequency_ID=" + c, a = t.getValueOfInt(n.DB.executeScalar(l, null, null)), v = (h - s).Days, y = v / a; return u.setValue("TotalInvoice", y), i = r = u = f = e = o = null, "" }; p.prototype.EndDate = function (i, r, u, f, e, o) { var h = new Date(u.getValue("StartDate")), c = new Date(u.getValue("StartDate")), l = n.dataContext.getJSONRecord("MVABOrderLine/GetNoOfMonths", t.getValueOfString(u.getValue("VAB_Frequency_ID"))), a = t.getValueOfInt(u.getValue("TotalInvoice")), s = h.setMonth(h.getMonth() + l * a); return s = new Date(h.setDate(h.getDate() - 1)), u.setValue("EndDate", s), s = new Date(s), s = s.toISOString(), h = c.toISOString(), s < h && u.setValue("EndDate", c), i = r = u = f = e = o = null, "" }; p.prototype.BillStartDate = function (t, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = new Date(r.getValue("StartDate")), s = new Date(r.getValue("BillStartDate")); return s.toISOString() < o.toISOString() && (n.ADialog.info("StartDateShouldBeLessThanBillStartDate"), r.setValue("BillStartDate", r.getValue("StartDate"))), t = i = r = u = f = e = null, "" }; p.prototype.StartDate = function (i, r, u, f, e, o) { if (e == null || e.toString() == "") return ""; var h = new Date(u.getValue("StartDate")), c = t.getValueOfInt(u.getValue("VAB_Frequency_ID")), l = "Select NoOfDays from VAB_Frequency where VAB_Frequency_ID=" + c, a = t.getValueOfInt(n.DB.executeScalar(l, null, null)), v = t.getValueOfInt(u.getValue("TotalInvoice")), y = v * a, s = new Date(h.setDate(h.getDay() + t.getValueOfDouble(y))); return s = s.toISOString(), u.setValue("EndDate", s), i = r = u = f = e = o = null, "" }; p.prototype.StartDateChange = function (i, r, u, f, e, o) { if (e == null || e.toString() == "") return ""; var c = t.getValueOfInt(u.getValue("VAB_Frequency_ID")), l = "Select NoOfMonths from VAB_Frequency where VAB_Frequency_ID=" + c, a = t.getValueOfInt(n.DB.executeScalar(l, null, null)), v = t.getValueOfInt(u.getValue("TotalInvoice")), s = new Date(e), y = new Date(e), h = s.setMonth(s.getMonth() + a * v); return h = new Date(s.setDate(s.getDate() - 1)), u.setValue("EndDate", h.toISOString()), h = h.toISOString(), s = y.toISOString(), h < s && u.setValue("EndDate", s), u.setValue("BillStartDate", u.getValue("StartDate")), i = r = u = f = e = o = null, "" }; n.Model.CalloutContract = p; n.Utility.inheritPrototype(vt, n.CalloutEngine); vt.prototype.product = function (n, t, i, r, u, f) { return i.setValue("Help", i.getValue("Name")), n = t = i = r = u = f = null, "" }; vt.prototype.product2 = function (n, t, i, r, u, f) { return i.setValue("Description", i.getValue("Help")), n = t = i = r = u = f = null, "" }; n.Model.copyname = vt; n.Utility.inheritPrototype(yi, n.CalloutEngine); yi.prototype.IsInternal = function (i, r, u, f, e, o) { if (e == null || e.toString() == "" || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); var h = "select ProfileType from VAS_Resource where VAF_UserContact_ID = " + t.getValueOfInt(e), s = t.getValueOfString(n.DB.executeScalar(h, null, null)); s != "" && (s.toUpper() == "I" ? u.setValue("IsInternal", !0) : s.toUpper() == "E" && u.setValue("IsInternal", !1)); this.setCalloutActive(!1) } catch (c) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutUserTimeRec = yi; n.Utility.inheritPrototype(yt, n.CalloutEngine); yt.prototype.Product = function (r, u, f, o, s, h) { var w = s, v, b, k, a, p; if (w == null || t.getValueOfInt(w) == 0) return ""; this.setCalloutActive(!0); var l = null, d = r.getContext(u, "DateExpense"), y = null, c = null; try { for (v = !0, y = "SELECT bomPriceStd(p.VAM_Product_ID,pv.VAM_PriceListVersion_ID) AS PriceStd,BOMPRICELIST(p.VAM_Product_ID,pv.VAM_PriceListVersion_ID) AS PriceList,bomPriceLimit(p.VAM_Product_ID,pv.VAM_PriceListVersion_ID) AS PriceLimit,p.VAB_UOM_ID,pv.ValidFrom,pl.VAB_Currency_ID FROM VAM_Product p, VAM_ProductPrice pp, VAM_PriceList pl, VAM_PriceListVersion pv WHERE p.VAM_Product_ID=pp.VAM_Product_ID AND pp.VAM_PriceListVersion_ID=pv.VAM_PriceListVersion_ID AND pv.VAM_PriceList_ID=pl.VAM_PriceList_ID AND pv.IsActive='Y' AND p.VAM_Product_ID=@param1 AND pl.VAM_PriceList_ID=@param2 ORDER BY pv.ValidFrom DESC", b = [], b[0] = new n.DB.SqlParam("@param1", t.getValueOfInt(w)), b[1] = new n.DB.SqlParam("@param2", r.getContextAsInt(u, "VAM_PriceList_ID")), c = n.DB.executeReader(y, b, null); c.read() && v;)a = c.get("validfrom"), a != null && d < a || (v = !1, l = t.getValueOfDecimal(c.get("pricestd")), l == null && (l = t.getValueOfDecimal(c.get("pricelist"))), l == null && (l = t.getValueOfDecimal(c.get("pricelimit"))), p = t.getValueOfInt(c.get("VAB_Currency_id")), c == null || f.setValue("VAB_Currency_ID", p)); if (c.close(), v) { for (y = "SELECT bomPriceStd(p.VAM_Product_ID,pv.VAM_PriceListVersion_ID) AS PriceStd,BOMPRICELIST(p.VAM_Product_ID,pv.VAM_PriceListVersion_ID) AS PriceList,bomPriceLimit(p.VAM_Product_ID,pv.VAM_PriceListVersion_ID) AS PriceLimit,p.VAB_UOM_ID,pv.ValidFrom,pl.VAB_Currency_ID FROM VAM_Product p, VAM_ProductPrice pp, VAM_PriceList pl, VAM_PriceList bpl, VAM_PriceListVersion pv WHERE p.VAM_Product_ID=pp.VAM_Product_ID AND pp.VAM_PriceListVersion_ID=pv.VAM_PriceListVersion_ID AND pv.VAM_PriceList_ID=bpl.VAM_PriceList_ID AND pv.IsActive='Y' AND bpl.VAM_PriceList_ID=pl.BasePriceList_ID AND p.VAM_Product_ID=@param1 AND pl.VAM_PriceList_ID=@param2 ORDER BY pv.ValidFrom DESC", k = [], k[0] = new n.DB.SqlParam("@param1", t.getValueOfInt(w)), k[1] = new n.DB.SqlParam("@param2", r.getContextAsInt(u, "VAM_PriceList_ID")), c = n.DB.executeReader(y, k, null); c.read() && v;)a = c.get("validfrom"), a != null && d < a || (v = !1, l = t.getValueOfDecimal(c.get("pricestd")), l == null && (l = t.getValueOfDecimal(c.get("pricelist"))), l == null && (l = t.getValueOfDecimal(c.get("pricelimit"))), p = t.getValueOfInt(c.get("VAB_Currency_id")), c == null || f.setValue("VAB_Currency_ID", p)); c.close() } } catch (g) { return c != null && c.close(), this.log.log(i.SEVERE, y, g), this.setCalloutActive(!1), e.message } return this.setCalloutActive(!1), l == null && (l = n.Env.ZERO), f.setValue("ExpenseAmt", l), r = u = f = o = s = h = null, "" }; yt.prototype.Amount = function (i, r, u, f, e, o) { var a, s; if (this.isCalloutActive()) return ""; this.setCalloutActive(!0); var l = u.getValue("ExpenseAmt"), h = 0, c = u.getValue("VAB_Currency_ID"); if (h = n.dataContext.getJSONRecord("MExpenseReport/GetPriceListCurrency", u.getValue("VAS_ExpenseReport_ID")), a = i.getContext(r, "DateExpense"), this.log.fine("Amt=" + l + ", VAB_Currency_ID=" + c), s = l.toString(), !s.equals(n.Env.ZERO) && h != t.getValueOfInt(c)) { var v = i.getContextAsInt(r, "VAF_Client_ID"), y = i.getContextAsInt(r, "VAF_Org_ID"), p = s.toString() + "," + c.toString() + "," + h.toString() + "," + a + ",0," + v.toString() + "," + y.toString(); s = n.dataContext.getJSONRecord("MConversionRate/CurrencyConvert", p) } return u.setValue("ConvertedAmt", s), this.log.fine("= ConvertedAmt=" + s), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutTimeExpense = yt; n.Utility.inheritPrototype(pt, n.CalloutEngine); pt.prototype.ProductInfo = function (i, r, u, f, e, o) { var c, l, s, a, h; return e == null || e.toString() == "" || t.getValueOfInt(e) == 0 ? "" : (c = e, c == null || c == 0) ? "" : (l = i.getContextAsInt(r, "VAM_PriceList_ID"), l != 0 ? (s = "Select VAM_PriceListVersion_ID from VAM_ProductPrice where VAM_Product_id=" + t.getValueOfInt(e) + " and VAM_PriceListVersion_ID in (select VAM_PriceListVersion_id from VAM_PriceListVersion where VAM_PriceList_id = " + l + " and isactive='Y')", a = t.getValueOfInt(n.DB.executeScalar(s, null, null)), a != 0 && (s = "Select PriceStd from VAM_ProductPrice where VAM_PriceListVersion_ID=" + a + " and VAM_Product_id=" + t.getValueOfInt(e), h = t.getValueOfDecimal(n.DB.executeScalar(s, null, null)), u.setValue("PriceStd", h), u.setValue("UnitPrice", h), u.setValue("PriceStd", h * t.getValueOfDecimal(u.getValue("QtyEntered"))))) : n.ADialog.info("PriceLisetNotFound"), i = r = u = f = e = o = null, "") }; pt.prototype.CalculatePrice = function (n, i, r, u, f, e) { if (f == null || f.toString() == "" || t.getValueOfInt(f) <= 0) return ""; var o = t.getValueOfDecimal(r.getValue("UnitPrice")) * t.getValueOfDecimal(r.getValue("QtyEntered")); return r.setValue("PriceStd", o), n = i = r = u = f = e = null, "" }; n.Model.CalloutTeamForcast = pt; n.Utility.inheritPrototype(wt, n.CalloutEngine); wt.prototype.TaxID = function (i, r, u, f, e, o) { var c, h, s; if (e == null || e.toString() == "" || t.getValueOfInt(e) == 0 || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); c = "select Rate from VAB_TaxRate where VAB_TaxRate_ID = " + t.getValueOfInt(e); h = t.getValueOfDecimal(n.DB.executeScalar(c, null, null)); h != 0 ? (s = t.getValueOfDecimal(u.getValue("ApprovedExpenseAmt")) * h / 100, s = s.toFixed(2), u.setValue("TaxAmt", s)) : u.setValue("TaxAmt", n.Env.ZERO); this.setCalloutActive(!1) } catch (l) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; wt.prototype.ExpenseAmt = function (i, r, u, f, e, o) { var c, h, s; if (e == null || e.toString() == "" || t.getValueOfInt(e) == 0 || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); c = "select Rate from VAB_TaxRate where VAB_TaxRate_ID = " + t.getValueOfInt(u.getValue("VAB_TaxRate_ID")); h = t.getValueOfDecimal(n.DB.executeScalar(c, null, null)); h != 0 ? (s = t.getValueOfDecimal(e) * h / 100, s = s.toFixed(2), u.setValue("TaxAmt", s)) : u.setValue("TaxAmt", n.Env.ZERO); this.setCalloutActive(!1) } catch (l) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutTaxAmt = wt; n.Utility.inheritPrototype(pi, n.CalloutEngine); pi.prototype.Tax = function (i, r, u, f, e, o) { var c, h; if (e == null || e == 0 || e.toString() == "") return ""; var l = 0, y = n.Env.ZERO, s = n.Env.ZERO; if (l = t.getValueOfInt(u.getValue("VAB_TaxRate_ID")), u.getField("SurchargeAmt") != null) { var p = 0, a = !1, v = n.dataContext.getJSONRecord("MVAMPriceList/GetPriceListData", u.getValue("VAM_PriceList_ID").toString()); v != null && (p = v.StdPrecision, a = "Y" == v.IsTaxIncluded); h = t.getValueOfDecimal(u.getValue("LineNetAmt")); c = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", l.toString() + "," + h.toString() + "," + p.toString() + "," + a.toString()); s = c.TaxAmt; u.setValue("TaxAmt", s); u.setValue("SurchargeAmt", c.SurchargeAmt); a ? u.setValue("GrandTotal", h) : u.setValue("GrandTotal", h + s + c.SurchargeAmt) } else y = n.dataContext.getJSONRecord("MTax/GetTaxRate", l.toString()), h = t.getValueOfDecimal(u.getValue("LineNetAmt")), s = t.getValueOfDecimal(h * y / 100), s = t.getValueOfDecimal(s.toFixed(2)), u.setValue("GrandTotal", s + h), u.setValue("taxamt", s); return i = r = u = f = e = o = null, "" }; n.Model.CalloutTax = pi; n.Utility.inheritPrototype(wi, n.CalloutEngine); wi.prototype.SetBP = function (n, i, r, u, f, e) { if (f == null || f.toString() == "" || t.getValueOfInt(f) == 0 || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); r.setValue("VAB_BusinessPartner_ID", t.getValueOfInt(f)); this.setCalloutActive(!1) } catch (o) { this.setCalloutActive(!1) } return n = i = r = u = f = e = null, "" }; n.Model.CalloutSetBP = wi; n.Utility.inheritPrototype(bi, n.CalloutEngine); bi.prototype.Charge = function (t, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = r.getValue("VAB_Charge_ID").toString(), s = n.dataContext.getJSONRecord("MVABCharge/GetCharge", o); return r.setValue("PlannedQty", 1), r.setValue("PlannedPrice", s), t = i = r = u = f = e = null, "" }; n.Model.CalloutProjectLine = bi; n.Utility.inheritPrototype(ki, n.CalloutEngine); ki.prototype.ProductInfo = function (i, r, u, f, e, o) { var h, c, a, l; if (e == null || e.toString() == "") return ""; var v = t.getValueOfInt(u.getValue("VAB_ProjectJob_ID")), y = t.getValueOfInt(u.getValue("VAB_ProjectStage_ID")), p = t.getValueOfInt(u.getValue("VAB_Project_ID")), w = t.getValueOfInt(u.getValue("VAM_Product_ID")), b = v.toString() + "," + y.toString() + "," + p.toString() + "," + w.toString(), s = n.dataContext.getJSONRecord("MProject/GetProjectDetail", b); if (s != null) { h = t.getValueOfDecimal(s.PriceList); u.setValue("PriceList", h); c = t.getValueOfDecimal(s.PriceStd); u.setValue("PlannedPrice", c); u.setValue("PlannedQty", 1); a = t.getValueOfDecimal(s.PriceLimit); try { if (l = (h - c) * 100 / h, isNaN(l)) return this.setCalloutActive(!1), n.Msg.getMsg("PriceNotDefined") } catch (k) { return this.setCalloutActive(!1), "PriceListNotSelected" } u.setValue("Discount", l.toFixed(2)); u.setValue("PlannedMarginAmt", c - a) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutProductToOpportunity = ki; n.Utility.inheritPrototype(di, n.CalloutEngine); di.prototype.PriceList = function (i, r, u, f, e, o) { var s, h, c; if (e == null || e.toString() == "") return ""; s = ""; try { s = "select VAM_PriceList_ID from VAM_PriceListVersion where VAM_PriceListVersion_ID = " + t.getValueOfInt(e); h = t.getValueOfInt(n.DB.executeScalar(s, null, null)); h != 0 && (u.setValue("VAM_PriceList_ID", h), s = "select VAB_Currency_id from VAM_PriceList where VAM_PriceList_ID = " + h, c = t.getValueOfInt(n.DB.executeScalar(s, null, null)), c != 0 ? u.setValue("VAB_Currency_ID", c) : n.ADialog.info("CurrencyNotDefinedForThePriceList")) } catch (l) { this.setCalloutActive(!1); this.log.saveError(s, s) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutPriceListOpp = di; n.Utility.inheritPrototype(s, n.CalloutEngine); s.prototype.Order = function (i, r, u, f, e, o) { var h, c, s, l; if (e == null || e.toString() == "") return ""; try { if ((h = t.getValueOfInt(e.toString()), h == null || h == 0) || this.isCalloutActive()) return ""; c = h.toString(); s = n.dataContext.getJSONRecord("MOrder/GetOrder", c); t.getValueOfInt(s.ID) != 0 && (u.setValue("DateOrdered", s.DateOrdered), u.setValue("POReference", s.POReference), u.setValue("VAF_Org_ID", t.getValueOfInt(s.VAF_Org_ID)), u.setValue("DeliveryRule", s.DeliveryRule), u.setValue("DeliveryViaRule", s.DeliveryViaRule), u.setValue("VAM_ShippingMethod_ID", t.getValueOfInt(s.VAM_ShippingMethod_ID)), u.setValue("FreightCostRule", s.FreightCostRule), u.setValue("FreightAmt", s.FreightAmt), u.setValue("VAB_BusinessPartner_ID", t.getValueOfInt(s.VAB_BusinessPartner_ID)), u.setValue("VAB_BPart_Location_ID", t.getValueOfInt(s.VAB_BPart_Location_ID)), u.setValue("VAF_OrgTrx_ID", t.getValueOfInt(s.VAF_OrgTrx_ID)), u.setValue("VAB_BillingCode_ID", t.getValueOfInt(s.VAB_BillingCode_ID)), u.setValue("VAB_Promotion_ID", t.getValueOfInt(s.VAB_Promotion_ID)), u.setValue("VAB_Project_ID", t.getValueOfInt(s.VAB_Project_ID)), u.setValue("User1_ID", t.getValueOfInt(s.User1_ID)), u.setValue("User2_ID", t.getValueOfInt(s.User2_ID)), u.getField("VAB_IncoTerm_ID") != null && u.setValue("VAB_IncoTerm_ID", t.getValueOfInt(s.VAB_IncoTerm_ID)), l = u.getValue("IsReturnTrx"), l && (u.setValue("Orig_Order_ID", s.Orig_Order_ID), u.setValue("Orig_InOut_ID", s.Orig_InOut_ID), t.getValueOfString(s.IsDropShip) == "Y" ? u.setValue("IsDropShip", !0) : u.setValue("IsDropShip", !1)), u.setValue("VAM_Warehouse_ID", t.getValueOfInt(s.VAM_Warehouse_ID))) } catch (a) { this.setCalloutActive(!1); this.log.severe(a.toString()) } return i = r = u = f = e = o = null, "" }; s.prototype.DocType = function (r, u, f, e, o, s) { var c, v, h, l, a; if (o == null || o.toString() == "" || (c = t.getValueOfInt(o.toString()), c == null || c == 0)) return ""; v = "SELECT d.docBaseType, d.IsDocNoControlled, s.CurrentNext, d.IsReturnTrx FROM VAB_DocTypes d, VAF_Record_Seq s WHERE VAB_DocTypes_ID=" + c + " AND d.DocNoSequence_ID=s.VAF_Record_Seq_ID(+)"; h = null; try { r.setContext(u, "VAB_DocTypesTarget_ID", c); h = n.DB.executeReader(v, null, null); h.read() && (l = h.get("docbasetype"), a = h.get("isreturntrx") == "Y", l.equals("MMS") && !a ? f.setValue("MovementType", "C-") : l.equals("MMS") && a ? f.setValue("MovementType", "C+") : l.equals("MMR") && !a ? f.setValue("MovementType", "V+") : l.equals("MMR") && a && f.setValue("MovementType", "V-"), h.get("isdocnocontrolled") == "Y" && f.setValue("DocumentNo", "<" + h.get("currentnext") + ">")); h.close() } catch (y) { return this.setCalloutActive(!1), h != null && (h.close(), h = null), this.log.log(i.SEVERE, v, y), y.message } return r = u = f = e = o = s = null, "" }; s.prototype.BPartner = function (r, u, f, o, s, h) { var v = "", c = null, l = null, y, b, k, a, p, w, d; if (s == null || s.toString() == "") return ""; try { if (y = t.getValueOfInt(s.toString()), y == null || y == 0) return ""; if (b = f.getValue("IsReturnTrx"), k = f.getValue("VAB_Order_ID"), v = "SELECT p.VAF_Language, p.POReference,p.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable,l.VAB_BPart_Location_ID, c.VAF_UserContact_ID , p.SOCreditStatus FROM VAB_BusinessPartner p LEFT OUTER JOIN VAB_BPart_Location l ON (p.VAB_BusinessPartner_ID=l.VAB_BusinessPartner_ID) LEFT OUTER JOIN VAF_UserContact c ON (p.VAB_BusinessPartner_ID=c.VAB_BusinessPartner_ID) WHERE p.VAB_BusinessPartner_ID=" + y, c = n.DB.executeReader(v, null, null), c.read() && (a = t.getValueOfInt(c.get("VAB_BPart_Location_id")), k == null && (a == 0 ? f.setValue("VAB_BPart_Location_ID", null) : f.setValue("VAB_BPart_Location_ID", a)), a = t.getValueOfInt(c.get("VAF_UserContact_id")), a == 0 ? f.setValue("VAF_UserContact_ID", null) : f.setValue("VAF_UserContact_ID", a), !b)) if (p = c.getString("CreditStatusSettingOn"), w = t.getValueOfDouble(c.get("creditavailable")), p == "CH") c.get("SOCreditStatus") != null && (c.get("SOCreditStatus").equals("X") || w <= 0 && n.ADialog.info("CreditLimitOver")); else if (d = t.getValueOfInt(f.getValue("VAB_BPart_Location_ID")), v = "SELECT bp.CreditStatusSettingOn,p.SOCreditStatus,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable FROM VAB_BPart_Location p INNER JOIN VAB_BusinessPartner bp ON (bp.VAB_BusinessPartner_ID = p.VAB_BusinessPartner_ID) WHERE p.VAB_BPart_Location_ID = " + d, l = n.DB.executeReader(v), l.read() && (p = l.getString("CreditStatusSettingOn"), p == "CL")) { var nt = t.getValueOfDouble(l.get("so_creditlimit")), w = t.getValueOfDouble(l.get("creditavailable")), g = dr.getString("SOCreditStatus"); g != null && (g.equals("X") || w <= 0 && n.ADialog.info("CreditOver")) } c.close() } catch (tt) { return this.setCalloutActive(!1), c != null && (c.close(), c = null), l != null && (l.close(), l = null), this.log.log(i.SEVERE, v, e), e.message } return r = u = f = o = s = h = null, "" }; s.prototype.Warehouse = function (r, u, f, e, o, s) { var l, a, h, c, v; if (o == null || o.toString() == "" || this.isCalloutActive() || (l = t.getValueOfInt(o), l == null || l == 0)) return ""; this.setCalloutActive(!0); a = "SELECT w.VAF_Org_ID, l.VAM_Locator_ID FROM VAM_Warehouse w LEFT OUTER JOIN VAM_Locator l ON (l.VAM_Warehouse_ID=w.VAM_Warehouse_ID AND l.IsDefault='Y') WHERE w.VAM_Warehouse_ID=" + l; h = null; try { h = n.DB.executeReader(a, null, null); h.read() && (c = t.getValueOfInt(h.get("vaf_org_id")), v = r.getContextAsInt(u, "VAF_Org_ID"), v != c && f.setValue("VAF_Org_ID", c), c = t.getValueOfInt(h.get("VAM_Locator_id")), c == 0 ? r.setContext(u, 0, "VAM_Locator_ID", null) : (this.log.config("VAM_Locator_ID=" + c), r.setContext(u, "VAM_Locator_ID", c))); h.close() } catch (y) { return this.setCalloutActive(!1), h != null && (h.close(), h = null), this.log.log(i.SEVERE, a, y), this.setCalloutActive(!1), y.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; s.prototype.OrderLine = function (i, r, u, f, e, o) { var c, s, a, l, h, v; if (e == null || e.toString() == "") return ""; if (this.setCalloutActive(!0), c = t.getValueOfInt(e.toString()), c == null || c == 0) return this.setCalloutActive(!1), ""; try { h = c.toString(); s = n.dataContext.getJSONRecord("MVABOrderLine/GetOrderLine", h); t.getValueOfInt(s.GetID) != 0 && (t.getValueOfInt(s.VAM_Product_ID) > 0 ? u.setValue("VAM_Product_ID", t.getValueOfInt(s.VAM_Product_ID)) : u.setValue("VAB_Charge_ID", t.getValueOfInt(s.VAB_Charge_ID)), u.setValue("VAM_PFeature_SetInstance_ID", t.getValueOfInt(s.VAM_PFeature_SetInstance_ID)), u.setValue("VAB_UOM_ID", t.getValueOfInt(s.VAB_UOM_ID)), a = t.getValueOfDecimal(s.QtyOrdered) - t.getValueOfDecimal(s.QtyDelivered), u.setValue("MovementQty", a), l = a, t.getValueOfDecimal(s.QtyEntered).toString().compareTo(t.getValueOfDecimal(s.QtyOrdered)) != t.getValueOfDecimal(s.QtyOrdered) && (l = l * t.getValueOfDecimal(s.QtyEntered) / t.getValueOfDecimal(s.QtyOrdered).toFixed(12)), u.setValue("QtyEntered", l), u.setValue("VAB_BillingCode_ID", t.getValueOfInt(s.VAB_BillingCode_ID)), u.setValue("VAB_Promotion_ID", t.getValueOfInt(s.VAB_Promotion_ID)), u.setValue("VAB_Project_ID", t.getValueOfInt(s.VAB_Project_ID)), u.setValue("VAB_ProjectStage_ID", t.getValueOfInt(s.VAB_ProjectStage_ID)), u.setValue("VAB_ProjectJob_ID", t.getValueOfInt(s.VAB_ProjectJob_ID)), u.setValue("VAF_OrgTrx_ID", t.getValueOfInt(s.VAF_OrgTrx_ID)), u.setValue("User1_ID", t.getValueOfInt(s.User1_ID)), u.setValue("User2_ID", t.getValueOfInt(s.User2_ID)), t.getValueOfBoolean(s.IsReturnTrx) && (u.setValue("Orig_OrderLine_ID", t.getValueOfInt(s.Orig_OrderLine_ID)), h = s.Orig_InOutLine_ID, v = n.dataContext.getJSONRecord("MVAMInvInOutLine/GetMVAMInvInOutLine", h)), t.getValueOfString(s.IsDropShip) == "Y" ? u.setValue("IsDropShip", !0) : u.setValue("IsDropShip", !1)) } catch (y) { this.setCalloutActive(!1); this.log.severe(y.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; s.prototype.Product = function (i, r, u, f, e, o) { var h, w, a, v, s, y, l, p; if (this.isCalloutActive() || e == null || e.toString() == "" || (h = t.getValueOfInt(e), h == 0)) return ""; this.setCalloutActive(!0); try { if (w = 0, u.setValue("VAM_PFeature_SetInstance_ID", null), a = i.getWindowContext(r, "IsSOTrx", !0) == "Y", a) return this.setCalloutActive(!1), ""; v = h.toString(); s = n.dataContext.getJSONRecord("MVAMProduct/GetVAB_UOM_ID", v); u.setValue("VAB_UOM_ID", s); y = t.getValueOfDecimal(u.getValue("QtyEntered")); u.setValue("MovementQty", y); var b = "SELECT VAB_BusinessPartner_ID FROM VAM_Inv_InOut WHERE VAM_Inv_InOut_ID = " + t.getValueOfInt(u.getValue("VAM_Inv_InOut_ID")), k = t.getValueOfInt(n.DB.executeScalar(b)), d = "SELECT vdr.VAB_UOM_ID FROM VAM_Product p LEFT JOIN VAM_Product_PO vdr ON p.VAM_Product_ID= vdr.VAM_Product_ID WHERE p.VAM_Product_ID=" + h + " AND vdr.VAB_BusinessPartner_ID = " + k, c = t.getValueOfInt(n.DB.executeScalar(d)); s != 0 && (s != c && c != 0 ? (l = t.getValueOfDecimal(n.DB.executeScalar("SELECT trunc(multiplyrate,4) FROM VAB_UOM_Conversion WHERE VAB_UOM_ID = " + s + " AND VAB_UOM_To_ID = " + c + " AND VAM_Product_ID= " + h + " AND IsActive='Y'")), l > 0 ? u.setValue("QtyEntered", t.getValueOfInt(u.getValue("QtyEntered")) * l) : (p = t.getValueOfDecimal(n.DB.executeScalar("SELECT trunc(multiplyrate,4) FROM VAB_UOM_Conversion WHERE VAB_UOM_ID = " + s + " AND VAB_UOM_To_ID = " + c + " AND IsActive='Y'")), p > 0 && u.setValue("QtyEntered", t.getValueOfInt(u.getValue("QtyEntered")) * l)), u.setValue("VAB_UOM_ID", c)) : u.setValue("VAB_UOM_ID", s)) } catch (g) { this.setCalloutActive(!1); this.log.severe(g.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; s.prototype.Qty = function (r, u, f, e, o, s) { var y, c, h, l, w, p, b, v, nt, tt, k, d, a; if (this.isCalloutActive() || o == null || o.toString() == "") return ""; this.setCalloutActive(!0); try { if (y = r.getContextAsInt(u, "VAM_Product_ID"), this.log.log(i.WARNING, "qty - init - VAM_Product_ID=" + y), l = "", w = 0, y == 0 ? (h = t.getValueOfDecimal(f.getValue("QtyEntered")), f.setValue("MovementQty", h)) : e.getColumnName().toString().equals("VAB_UOM_ID") ? (a = o, h = t.getValueOfDecimal(f.getValue("QtyEntered")), l = a.toString(), w = n.dataContext.getJSONRecord("MUOM/GetPrecision", l), p = t.getValueOfDecimal(h.toFixed(w)), h.compareTo(p) != 0 && (this.log.fine("Corrected qtyEntered Scale UOM=" + a + "; qtyEntered=" + h + "->" + p), h = p, f.setValue("QtyEntered", h)), l = y.toString().concat(",", a.toString(), ",", h.toString()), c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", l), c == null && (c = h), v = h.compareTo(c) != 0, this.log.fine("UOM=" + a + ", qtyEntered=" + h + " -> " + v + " movementQty=" + c), r.setContext(u, "UOMConversion", v ? "Y" : "N"), f.setValue("MovementQty", c)) : r.getContextAsInt(u, "VAB_UOM_ID") == 0 ? (h = t.getValueOfDecimal(f.getValue("QtyEntered")), f.setValue("MovementQty", h)) : e.getColumnName().toString().equals("QtyEntered") ? (a = r.getContextAsInt(u, "VAB_UOM_ID"), h = t.getValueOfDecimal(o), l = y.toString(), w = n.dataContext.getJSONRecord("MVAMProduct/GetUOMPrecision", l), p = t.getValueOfDecimal(h.toFixed(w)), h.compareTo(p) != 0 && (this.log.fine("Corrected qtyEntered Scale UOM=" + a + "; qtyEntered=" + h + "->" + p), h = p, f.setValue("QtyEntered", h)), l = y.toString().concat(",", a.toString(), ",", h.toString()), c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", l), c == null && (c = h), v = h.compareTo(c) != 0, this.log.fine("UOM=" + a + ", qtyEntered=" + h + " -> " + v + " movementQty=" + c), r.setContext(u, "UOMConversion", v ? "Y" : "N"), f.setValue("MovementQty", c)) : e.getColumnName().toString().equals("MovementQty") && (a = r.getContextAsInt(u, "VAB_UOM_ID"), c = t.getValueOfDecimal(o), l = y.toString(), w = n.dataContext.getJSONRecord("MVAMProduct/GetUOMPrecision", l), b = t.getValueOfDecimal(c.toFixed(w)), c.compareTo(b) != 0 && (this.log.fine("Corrected movementQty " + c + "->" + b), c = b, f.setValue("MovementQty", c)), l = y.toString().concat(",", a.toString(), ",", c.toString()), h = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", l), h == null && (h = c), v = c.compareTo(h) != 0, this.log.fine("UOM=" + a + ", movementQty=" + c + " -> " + v + " qtyEntered=" + h), r.setContext(u, "UOMConversion", v ? "Y" : "N"), f.setValue("QtyEntered", h)), nt = "Y".equals(r.getContext("IsReturnTrx")), y != 0 && nt && (tt = t.getValueOfInt(f.getValue("VAB_OrderLine_ID")), l = tt.toString(), k = n.dataContext.getJSONRecord("MVABOrderLine/GetOrderLine", l), k.Get_ID() != 0 && (d = k.Orig_InOutLine_ID, d != 0))) { var l = d.toString(), it = n.dataContext.getJSONRecord("MVAMInvInOutLine/GetMVAMInvInOutLine", l), g = it.MovementQty; c = t.getValueOfDecimal(f.getValue("MovementQty")); g.toString().compareTo(c) < 0 && (r.getWindowContext(u, "IsSOTrx", !0) == "Y" ? n.ADialog.info("QtyShippedAndReturned") : n.ADialog.info("QtyRecievedAndReturnd"), f.setValue("MovementQty", g), c = g, a = r.getContextAsInt(u, "VAB_UOM_ID"), l = y.toString().concat(",", a.toString(), ",", c.toString()), h = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", l), h == null && (h = c), f.setValue("QtyEntered", h), f.setValue("MovementQty", c), this.log.fine("qtyEntered : " + h.toString() + "movementQty : " + c.toString())) } } catch (rt) { this.setCalloutActive(!1); this.log.severe(rt.toString()) } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; s.prototype.Asi = function (i, r, u, f, e, o) { var s, a, h; if (this.isCalloutActive() || e == null || e.toString() == "" || (s = t.getValueOfInt(e), s == null || s == 0)) return ""; this.setCalloutActive(!0); try { if (t.getValueOfInt(u.getValue("VAM_Locator_ID")) == 0) { var v = i.getContextAsInt(r, "VAM_Product_ID"), c = i.getContextAsInt(r, "VAM_Warehouse_ID"), y = c.toString(), l = n.dataContext.getJSONRecord("MVAMInvInOut/GetDefaultLocatorID", y); i.setContext(r, "VAM_Locator_ID", l); this.log.fine("VAM_Product_ID=" + v + ", M_ASI_ID=" + s + " - VAM_Warehouse_ID=" + c + ", VAM_Locator_ID=" + l); a = i.getContextAsInt(r, "VAM_PFeature_SetInstance_ID"); s == a && (h = i.getContextAsInt(r, "VAM_Locator_ID"), h != 0 && (this.log.fine("Selected VAM_Locator_ID=" + h), u.setValue("VAM_Locator_ID", h))) } } catch (p) { this.setCalloutActive(!1); this.log.severe(p.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutInOut = s; n.Utility.inheritPrototype(bt, n.CalloutEngine); bt.prototype.Invoice = function (r, u, f, e, o, s) { var h, c, k, p, a, v, y; if (o == null || o.toString() == "" || (h = t.getValueOfInt(o), this.isCalloutActive() || h == null || h == 0)) return ""; var nt = r.getContextAsInt(u, "VAB_Payment_ID"), p = nt.toString(), w = null; if (w = n.dataContext.getJSONRecord("MPayment/GetPayment", p), w.VAB_Charge_ID != 0 || w.VAB_Invoice_ID != 0 || w.VAB_Order_ID != 0) return n.Msg.getMsg("PaymentIsAllocated"); this.setCalloutActive(!0); f.setValue("DiscountAmt", n.Env.ZERO); f.setValue("WriteOffAmt", n.Env.ZERO); f.setValue("OverUnderAmt", n.Env.ZERO); c = 0; r.getContextAsInt(u, "VAB_Invoice_ID") == h && r.getContextAsInt(u, "VAB_sched_InvoicePayment_ID") != 0 && (c = r.getContextAsInt(u, "VAB_sched_InvoicePayment_ID")); var b = 0, g = 0, l = null; try { l = n.dataContext.getJSONRecord("MVABInvoice/GetInvPaySchedDetail", h); l != null && (c = t.getValueOfInt(l.VAB_sched_InvoicePayment_ID), b = t.getValueOfDecimal(l.dueAmount), IsReturnTrx = l.IsReturnTrx, "Y" == IsReturnTrx && (b = b * -1), f.setValue("VAB_sched_InvoicePayment_ID", c), f.setValue("Amount", b), g = 1) } catch (d) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, "PaymentAllocate.Invoice -" + h, d.message), d.toString() } k = t.getValueOfDate(r.getContextAsTime(u, "DateTrx")); k == null && (k = new Date); p = h.toString() + "," + c.toString() + "," + k.toString(); a = null; try { a = n.dataContext.getJSONRecord("MPayment/GetInvoiceData", p); a != null && (v = t.getValueOfDecimal(a.invoiceOpen), v == null && (v = n.Env.ZERO), y = t.getValueOfDecimal(a.invoiceDiscount), y == null && (y = n.Env.ZERO), f.setValue("InvoiceAmt", v), g == 0 && f.setValue("Amount", v - y), f.setValue("DiscountAmt", y), r.setContext(u, "VAB_Invoice_ID", h.toString())) } catch (d) { return this.setCalloutActive(!1), d.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; bt.prototype.Amounts = function (i, r, u, f, e, o) { var d, g, b, k, p, w, it, y; if (this.isCalloutActive() || (d = i.getContextAsInt(r, "VAB_Invoice_ID"), d == 0)) return ""; this.setCalloutActive(!0); g = 0; u.getValue("VAB_sched_InvoicePayment_ID") != null && (g = u.getValue("VAB_sched_InvoicePayment_ID")); var a = n.Env.ZERO, v = "N", tt = 0, nt = !0, h = t.getValueOfDecimal(u.getValue("Amount")), c = t.getValueOfDecimal(u.getValue("DiscountAmt")), l = t.getValueOfDecimal(u.getValue("WriteOffAmt")), s = t.getValueOfDecimal(u.getValue("OverUnderAmt")), rt = t.getValueOfDecimal(u.getValue("InvoiceAmt")); return this.log.fine("Amt=" + h + ", Discount=" + c + ", WriteOff=" + l + ", OverUnder=" + s + ", Invoice=" + rt), b = i.getContext(r, "DateTrx"), b == null && (b = new Date), k = d.toString() + "," + g.toString() + "," + b.toString(), p = n.dataContext.getJSONRecord("MPayment/GetInvoiceData", k), p != null && (tt = t.getValueOfInt(p.VAB_Currency_ID), a = t.getValueOfDecimal(p.invoiceOpen), a == null && (a = n.Env.ZERO), n.Env.ZERO == c && (c = t.getValueOfDecimal(p.invoiceDiscount)), v = p.IsReturnTrx), v == "Y" ? (h > 0 && (h = h * -1, u.setValue("Amount", h)), c > 0 && (c = c * -1), l > 0 && (l = l * -1, u.setValue("WriteOffAmt", l)), s > 0 && (s = s * -1, u.setValue("OverUnderAmt", s)), a > 0 && (a = a * -1)) : (h < 0 && (h = h * -1, u.setValue("Amount", h)), c < 0 && (c = c * -1), l < 0 && (l = l * -1, u.setValue("WriteOffAmt", l)), s < 0 && (s = s * -1, u.setValue("OverUnderAmt", s)), a < 0 && (a = a * -1)), w = f.getColumnName(), k = tt.toString(), it = n.dataContext.getJSONRecord("MCurrency/GetCurrency", k), y = it.StdPrecision, w == "Amount" ? (s = a - h - c - l, (v == "N" && s > 0 || v == "Y" && s < 0) && n.ADialog.info("LessScheduleAmount"), (v == "Y" && s > 0 || v == "N" && s < 0) && (n.ADialog.info("MoreScheduleAmount"), h = a - c - l, s = a - h - c - l, nt ? u.setValue("Amount", h.toFixed(y)) : u.setValue("Amount", h)), nt ? (u.setValue("DiscountAmt", c.toFixed(y)), u.setValue("OverUnderAmt", s.toFixed(y))) : (u.setValue("DiscountAmt", c), u.setValue("OverUnderAmt", s))) : (h = a - c - l - s, (v == "Y" && h > 0 || v == "N" && h < 0) && (n.ADialog.info("MoreScheduleAmount"), w == "OverUnderAmt" && (h = a - c - l, s = a - h - c - l), w == "DiscountAmt" && (h = a - s - l, c = a - h - s - l), w == "WriteOffAmt" && (h = a - c - s, l = a - h - c - s)), nt ? (u.setValue("Amount", h.toFixed(y)), u.setValue("DiscountAmt", c.toFixed(y)), u.setValue("WriteOffAmt", l.toFixed(y)), u.setValue("OverUnderAmt", s.toFixed(y))) : (u.setValue("Amount", h), u.setValue("DiscountAmt", c), u.setValue("WriteOffAmt", l), u.setValue("OverUnderAmt", s)), (v == "N" && s > 0 || v == "Y" && s < 0) && n.ADialog.info("LessScheduleAmount")), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutPaymentAllocate = bt; n.Utility.inheritPrototype(v, n.CalloutEngine); v.prototype.Invoice = function (r, u, f, e, o) { var c, g, p, nt, s, tt, y, l; if (o == null || o.toString() == "" || (c = t.getValueOfInt(o.toString()), this.isCalloutActive() || c == null || c == 0)) return ""; this.setCalloutActive(!0); f.setValue("VAB_Order_ID", null); f.setValue("VAB_Charge_ID", null); f.setValue("IsPrepayment", !1); f.setValue("DiscountAmt", n.Env.ZERO); f.setValue("WriteOffAmt", n.Env.ZERO); f.setValue("IsOverUnderPayment", !1); f.setValue("OverUnderAmt", n.Env.ZERO); var a = 0, b = "", k = !1, it = f.getField("IsInDispute") != null, v = 0, d = 0, h = null; try { h = n.dataContext.getJSONRecord("MVABInvoice/GetInvPaySchedDetail", c.toString()); h != null && (a = t.getValueOfInt(h.VAB_sched_InvoicePayment_ID), v = t.getValueOfDecimal(h.dueAmount), b = t.getValueOfString(h.IsReturnTrx), "Y" == b && (v = v * -1), f.setValue("VAB_sched_InvoicePayment_ID", a), f.setValue("PayAmt", v), f.setValue("PaymentAmount", v), d = 1, g = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), g.VA009_ && (t.getValueOfString(h.VA009_PaymentBaseType) != "B" && t.getValueOfString(h.VA009_PaymentBaseType) != "C" && t.getValueOfString(h.VA009_PaymentBaseType) != "P" ? f.setValue("VA009_PaymentMethod_ID", t.getValueOfInt(h.VA009_PaymentMethod_ID)) : f.setValue("VA009_PaymentMethod_ID", null))) } catch (w) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, "CalloutPayment.Invoice -" + c, w.message), w.toString() } r.getContextAsInt(u, "VAB_Invoice_ID") == c && r.getContextAsInt(u, "VAB_sched_InvoicePayment_ID") != 0 && (a = r.getContextAsInt(u, "VAB_sched_InvoicePayment_ID")); p = new Date(f.getValue("DateTrx")); p == null && (p = new Date); nt = c.toString() + "," + a.toString() + "," + p.toString(); s = null; try { s = n.dataContext.getJSONRecord("MPayment/GetInvoiceData", nt); s != null && (f.setValue("VAB_BusinessPartner_ID", t.getValueOfInt(s.VAB_BusinessPartner_ID)), f.setValue("VAB_BPart_Location_Id", t.getValueOfInt(s.VAB_BPart_Location_Id)), tt = t.getValueOfInt(s.VAB_Currency_ID), f.setValue("VAB_Currency_ID", tt), f.setValue("VAB_CurrencyType_ID", s.VAB_CurrencyType_ID), y = t.getValueOfDecimal(s.invoiceOpen), y == null && (y = n.Env.ZERO), l = t.getValueOfDecimal(s.invoiceDiscount), l == null && (l = n.Env.ZERO), d == 0 && (f.setValue("PayAmt", y - l), f.setValue("PaymentAmount", y - l)), f.setValue("VAB_sched_InvoicePayment_ID", a), f.setValue("DiscountAmt", l), r.setContext(u, "VAB_Invoice_ID", c.toString()), k = t.getValueOfString(s.IsInDispute) == "Y", it && (k ? (f.setValue("IsInDispute", !0), n.ADialog.info("DiscrepancyInvoice")) : f.setValue("IsInDispute", !1))) } catch (w) { return this.setCalloutActive(!1), w.message } return this.setCalloutActive(!1), this.DocType(r, u, f, e, o) }; v.prototype.Order = function (r, u, f, e, o) { var c, l, h, v; if (o == null || o.toString() == "" || (c = o, this.isCalloutActive() || c == null || c == 0)) return ""; this.setCalloutActive(!0); f.setValue("VAB_Invoice_ID", null); f.setValue("VAB_Charge_ID", null); f.setValue("IsPrepayment", !0); f.setValue("DiscountAmt", n.Env.ZERO); f.setValue("WriteOffAmt", n.Env.ZERO); f.setValue("IsOverUnderPayment", !1); f.setValue("OverUnderAmt", n.Env.ZERO); l = f.getValue("DateTrx"); l == null && (l = new Date); var a = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), p = a.VA009_ + "," + c.toString(), s = null; try { s = n.dataContext.getJSONRecord("MPayment/GetOrderData", p); s != null && (f.setValue("VAB_BusinessPartner_ID", t.getValueOfInt(s.VAB_BusinessPartner_ID)), f.setValue("VAB_BPart_Location_Id", t.getValueOfInt(s.VAB_BPart_Location_ID)), f.setValue("VAB_Currency_ID", t.getValueOfInt(s.VAB_Currency_ID)), f.setValue("VAB_CurrencyType_ID", t.getValueOfInt(s.VAB_CurrencyType_ID)), h = t.getValueOfDecimal(s.GrandTotal), h == null && (h = n.Env.ZERO), a.VA009_ && (v = t.getValueOfInt(s.VA009_PaymentMethod_ID), f.setValue("VA009_PaymentMethod_ID", v)), f.setValue("PaymentAmount", h), f.setValue("PayAmt", h), s.IsPrePayOrder == !0 ? f.getField("PaymentAmount").setReadOnly(!0) : f.getField("PaymentAmount").setReadOnly(!1)) } catch (y) { return s != null && (s = null), this.log.log(i.SEVERE, sql, y), this.setCalloutActive(!1), y.message } return this.setCalloutActive(!1), this.DocType(r, u, f, e, o) }; v.prototype.Charge = function (t, i, r, u, f) { if (f == null || f.toString() == "") return "" }; v.prototype.DocType = function (i, r, u, f, e, o) { var c = i.getContextAsInt(r, "VAB_Invoice_ID"), v = i.getContextAsInt(r, "VAB_Order_ID"), l = i.getContextAsInt(r, "VAB_DocTypes_ID"), y, p; this.log.fine("Payment_DocType - VAB_Invoice_ID=" + c + ", VAB_DocTypes_ID=" + l); var s = l.toString(), a = n.dataContext.getJSONRecord("MVABDocTypes/GetDocType", s), h = t.getValueOfBoolean(a.IsSOTrx); return (l != 0 && (i.setWindowContext(r, "IsSOTrx", h ? "Y" : "N"), u.setValue("IsReceipt", h ? "Y" : "N")), c != 0 && (s = c.toString(), y = n.dataContext.getJSONRecord("MVABInvoice/GetInvoice", s), a != null && t.getValueOfBoolean(y.IsSOTrx) != h)) ? n.Msg.getMsg("DocTypeInvInconsistent") : v != 0 && (s = v.toString(), p = n.dataContext.getJSONRecord("MOrder/GetOrder", s), a != null && t.getValueOfBoolean(p.IsSOTrx) != h) ? n.Msg.getMsg("DocTypeOrdInconsistent") : (i = r = u = f = e = o = null, "") }; v.prototype.AmountCurrencyType = function (r, u, f, e, o) { var l, c, h, s, a, y; if (this.isCalloutActive() || o == null || o.toString() == "") return f.setValue("OutStandingAmount", ""), ""; this.setCalloutActive(!0); l = f.getValue("VAB_BusinessPartner_ID"); c = f.getValue("AsOnDate"); c = n.DB.to_date(c, !0); h = "SELECT LTRIM(MAX(SYS_CONNECT_BY_PATH( ConvertPrice, ',')),',') amounts FROM (SELECT ConvertPrice, ROW_NUMBER () OVER (ORDER BY ConvertPrice ) RN, COUNT (*) OVER () CNT FROM (SELECT iso_code || ':' || SUM(OpenAmt) AS ConvertPrice FROM (SELECT c.iso_code,  invoiceOpen (i.VAB_Invoice_ID,i.VAB_sched_InvoicePayment_ID)*MultiplierAP AS OpenAmt  FROM VAB_Invoice_v i LEFT JOIN VAB_Currency C ON C.VAB_Currency_ID=i.VAB_Currency_ID LEFT JOIN VAB_sched_InvoicePayment IPS ON IPS.VAB_Invoice_ID = i.VAB_Invoice_ID WHERE i.docstatus IN ('CO','CL') AND i.IsActive ='Y' AND i.ispaid ='N' AND ips.duedate IS NOT NULL AND NVL(ips.dueamt,0)!=0 AND i.VAB_BusinessPartner_id = " + l + "AND to_date(ips.duedate,'dd-mm-yyyy')<= ( CASE WHEN to_date(" + c + ",'dd-mm-yyyy')>to_date(sysdate,'dd-mm-yyyy') THEN to_date(sysdate,'dd-mm-yyyy') ELSE to_date(" + c + ",'dd-mm-yyyy') END ) UNION SELECT c.iso_code, paymentAvailable(p.VAB_Payment_ID)*p.MultiplierAP*-1 AS OpenAmt FROM VAB_Payment_V p LEFT JOIN VAB_Currency C ON C.VAB_Currency_ID=p.VAB_Currency_ID LEFT JOIN VAB_Payment pay ON (p.VAB_Payment_id   =pay.VAB_Payment_ID) WHERE p.IsAllocated  ='N' AND p.VAB_BUSINESSPARTNER_ID = " + l + " AND p.DocStatus     IN ('CO','CL') AND to_date(pay.DateTrx,'dd-mm-yyyy')<=( CASE WHEN to_date(" + c + ",'dd-mm-yyyy')>to_date(sysdate,'dd-mm-yyyy') THEN to_date(sysdate,'dd-mm-yyyy') ELSE to_date(" + c + ",'dd-mm-yyyy') END ) ) GROUP BY iso_code ) ) WHERE RN = CNT START WITH RN = 1 CONNECT BY RN = PRIOR RN + 1 "; s = null; try { if (s = n.DB.executeReader(h, null, null), s.read()) { if (a = s.get("amounts"), h = "", h = "Select COUNT(VAF_ModuleInfo_ID) From VAF_ModuleInfo Where Prefix='VA027_' AND IsActive='Y'", y = t.getValueOfInt(n.DB.executeScalar(h)), y > 0) { h = ""; h = "SELECT LTRIM(MAX(SYS_CONNECT_BY_PATH( ConvertPrice, ',')),',') amounts                    FROM (SELECT ConvertPrice, ROW_NUMBER () OVER (ORDER BY ConvertPrice ) RN,                    COUNT (*) OVER () CNT FROM                      (SELECT ' PDC-'||iso_code|| ':'|| ROUND(SUM(PdcDue),2) AS ConvertPrice                     FROM (SELECT c.iso_code,                     CASE WHEN (pdc.VA027_MultiCheque = 'Y')                      THEN chk.VA027_ChequeAmount                      ELSE pdc.VA027_PayAmt END AS PdcDue                       FROM VA027_PostDatedCheck pdc LEFT JOIN VA027_ChequeDetails chk                       ON chk.VA027_PostDatedCheck_ID = pdc.VA027_PostDatedCheck_ID                       INNER JOIN VAB_Currency C ON C.VAB_Currency_ID=PDC.VAB_Currency_ID                       INNER JOIN VAB_DocTypes doc ON doc.VAB_DocTypes_ID = pdc.VAB_DocTypes_ID                      WHERE pdc.IsActive ='Y' AND doc.DocBaseType = 'PDR'                      AND pdc.DocStatus = 'CO'                       AND pdc.VA027_PAYMENTGENERATED ='N'                      AND pdc.VA027_PaymentStatus !=3                      AND ( CASE WHEN (pdc.VA027_MultiCheque = 'Y')                       THEN to_date(chk.VA027_CheckDate,'dd-mm-yyyy') ELSE to_date(pdc.VA027_CheckDate,'dd-mm-yyyy') END ) <= to_date(" + c + ", 'dd-mm-yyyy')                        AND PDC.VAB_BusinessPartner_id = " + l + " UNION SELECT c.iso_code,                        CASE WHEN (pdc.VA027_MultiCheque = 'Y')                         THEN chk.VA027_ChequeAmount*-1                         ELSE pdc.VA027_PayAmt*-1 END AS PdcDue                         FROM VA027_PostDatedCheck pdc LEFT JOIN VA027_ChequeDetails chk                         ON chk.VA027_PostDatedCheck_ID = pdc.VA027_PostDatedCheck_ID                         INNER JOIN VAB_Currency C ON C.VAB_Currency_ID=pdc.VAB_Currency_ID                         INNER JOIN VAB_DocTypes doc ON doc.VAB_DocTypes_ID = pdc.VAB_DocTypes_ID                         WHERE pdc.IsActive ='Y' AND doc.DocBaseType = 'PDP'                         AND pdc.VA027_PAYMENTGENERATED ='N'                         AND pdc.VA027_PaymentStatus !=3                         AND ( CASE WHEN (pdc.VA027_MultiCheque = 'Y')                       THEN to_date(chk.VA027_CheckDate,'dd-mm-yyyy') ELSE to_date(pdc.VA027_CheckDate,'dd-mm-yyyy') END ) <= to_date(" + c + ", 'dd-mm-yyyy')                        AND pdc.VAB_BusinessPartner_id = " + l + ") GROUP BY iso_code                       )                     )                     WHERE RN = CNT                    START WITH RN = 1                     CONNECT BY RN = PRIOR RN + 1"; s = null; try { s = n.DB.executeReader(h, null, null); s.read() && s.get("amounts") != null && s.get("amounts").toUpper().indexOf("NULL") == -1 && (a = a + " PDC-" + s.get("amounts")) } catch (v) { return s != null && (s.close(), s = null), this.log.log(i.SEVERE, h, v), this.setCalloutActive(!1), v.message } } f.setValue("OutStandingAmount", a) } s.close() } catch (v) { return s != null && (s.close(), s = null), this.log.log(i.SEVERE, h, v), this.setCalloutActive(!1), v.message } return this.setCalloutActive(!1), "" }; v.prototype.Amounts = function (r, u, f, e, o, s) { var k, ut, p, ft, it, rt, g, at; if (this.isCalloutActive() || (k = r.getContextAsInt(u, "VAB_Invoice_ID"), r.getContextAsInt(u, "VAB_Payment_ID") == 0 && r.getContextAsInt(u, "VAB_BusinessPartner_ID") == 0 && k == 0) || (ut = f.getValue("VAB_Currency_ID"), ut == null)) return ""; if (k != 0) { this.setCalloutActive(!0); p = e.getColumnName(); ft = 0; r.getContextAsInt(u, "VAB_Invoice_ID") == k && f.getValue("VAB_sched_InvoicePayment_ID") != null && (ft = f.getValue("VAB_sched_InvoicePayment_ID")); var a = n.Env.ZERO, l = n.Env.ZERO, d = 0, et = 0, b = "N", ot = !0; k != 0 && (it = f.getValue("DateTrx"), it == null && (it = new Date), rt = k.toString() + "," + ft.toString() + "," + it.toString(), g = n.dataContext.getJSONRecord("MPayment/GetInvoiceData", rt), g != null && (d = t.getValueOfInt(g.VAB_Currency_ID), et = t.getValueOfInt(g.VAB_CurrencyType_ID), a = t.getValueOfDecimal(g.invoiceOpen), a == null && (a = n.Env.ZERO), l = t.getValueOfDecimal(g.invoiceDiscount), b = g.IsReturnTrx)); this.log.fine("Open=" + a + " Discount= " + l + ", VAB_Invoice_ID=" + k + ", VAB_Currency_ID=" + d); p == "PaymentAmount" && f.setValue("PayAmt", f.getValue("PaymentAmount")); var h = t.getValueOfDecimal(f.getValue("PayAmt") == null ? n.Env.ZERO : f.getValue("PayAmt")), v = t.getValueOfDecimal(f.getValue("WriteOffAmt") == null ? n.Env.ZERO : f.getValue("WriteOffAmt")), c = t.getValueOfDecimal(f.getValue("OverUnderAmt") == null ? n.Env.ZERO : f.getValue("OverUnderAmt")), y = t.getValueOfDecimal(f.getValue("DiscountAmt") == null ? n.Env.ZERO : f.getValue("DiscountAmt")); b == "Y" ? (h > 0 ? (h = h * -1, f.setValue("PayAmt", h), f.setValue("PaymentAmount", h)) : f.setValue("PaymentAmount", h), y > 0 && (y = y * -1), l > 0 && (l = l * -1), v > 0 && (v = v * -1, f.setValue("WriteOffAmt", v)), c > 0 && (c = c * -1, f.setValue("OverUnderAmt", c)), a > 0 && (a = a * -1)) : (h < 0 ? (h = h * -1, f.setValue("PayAmt", h), f.setValue("PaymentAmount", h)) : f.setValue("PaymentAmount", h), y < 0 && (y = y * -1), l < 0 && (l = l * -1), v < 0 && (v = v * -1, f.setValue("WriteOffAmt", v)), c < 0 && (c = c * -1, f.setValue("OverUnderAmt", c)), a < 0 && (a = a * -1)); this.log.fine("Pay=" + h + ", Discount=" + y + ", WriteOff=" + v + ", OverUnderAmt=" + c); var tt = t.getValueOfInt(ut), rt = tt.toString(), st = n.dataContext.getJSONRecord("MCurrency/GetCurrency", rt), w = st.StdPrecision, ct = f.getValue("DateAcct"), ht = 0, lt = t.getValueOfInt(f.getValue("VAB_CurrencyType_ID")); lt != null && (ht = lt); var yt = r.getContextAsInt(u, "VAF_Client_ID"), pt = r.getContextAsInt(u, "VAF_Org_ID"), nt = n.Env.ONE; if (tt > 0 && d > 0 && tt != d || p == "VAB_Currency_ID" || p == "VAB_CurrencyType_ID") { if (this.log.fine("InvCurrency=" + d + ", PayCurrency=" + tt + ", Date=" + ct + ", Type=" + ht), at = d + "," + tt + "," + ct + "," + ht + "," + yt + "," + pt, nt = n.dataContext.getJSONRecord("MConversionRate/GetRate", at), nt == null || nt.toString() == 0) { if (this.setCalloutActive(!1), d == 0) return ""; if (f.setValue("VAB_Currency_ID", d), p == "VAB_CurrencyType_ID") { if (et == 0) return ""; f.setValue("VAB_CurrencyType_ID", et) } return "NoCurrencyConversion" } a = t.getValueOfDecimal((a * nt).toFixed(st.StdPrecision)); y != 0 && (l = y); l = t.getValueOfDecimal((l * nt).toFixed(st.StdPrecision)); this.log.fine("Rate=" + nt + ", InvoiceOpenAmt=" + a + ", DiscountAmt=" + l) } p == "VAB_Currency_ID" || p == "VAB_CurrencyType_ID" ? (v = 0, f.setValue("WriteOffAmt", v), c = 0, f.setValue("OverUnderAmt", c), y = 0, f.setValue("DiscountAmt", y), l = y, h = a - l - v - c, f.setValue("PayAmt", t.getValueOfDecimal(h.toFixed(w))), f.setValue("PaymentAmount", t.getValueOfDecimal(h.toFixed(w)))) : k == 0 ? (n.Env.ZERO != l && f.setValue("DiscountAmt", n.Env.ZERO), n.Env.ZERO != v && f.setValue("WriteOffAmt", n.Env.ZERO), n.Env.ZERO != c && f.setValue("OverUnderAmt", n.Env.ZERO)) : p == "PayAmt" || p == "PaymentAmount" ? (y != 0 && (l = y), c = a - h - l - v, (b == "N" && c > 0 || b == "Y" && c < 0) && n.ADialog.info("LessScheduleAmount"), (b == "Y" && c > 0 || b == "N" && c < 0) && (n.ADialog.info("MoreScheduleAmount"), h = a - l - v, c = a - h - l - v, ot ? (f.setValue("PayAmt", t.getValueOfDecimal(h.toFixed(w))), f.setValue("PaymentAmount", t.getValueOfDecimal(h.toFixed(w)))) : (f.setValue("PayAmt", h), f.setValue("PaymentAmount", h))), ot ? (f.setValue("DiscountAmt", t.getValueOfDecimal(l.toFixed(w))), f.setValue("OverUnderAmt", t.getValueOfDecimal(c.toFixed(w)))) : (f.setValue("DiscountAmt", l), f.setValue("OverUnderAmt", c))) : (l = y, h = a - l - v - c, (b == "Y" && h > 0 || b == "N" && h < 0) && (n.ADialog.info("MoreScheduleAmount"), p == "OverUnderAmt" && (h = a - l - v, c = a - h - l - v), p == "DiscountAmt" && (h = a - c - v, l = a - h - c - v), p == "WriteOffAmt" && (h = a - l - c, v = a - h - l - c)), ot ? (f.setValue("PayAmt", t.getValueOfDecimal(h.toFixed(w))), f.setValue("PaymentAmount", t.getValueOfDecimal(h.toFixed(w))), f.setValue("DiscountAmt", t.getValueOfDecimal(l.toFixed(w))), f.setValue("WriteOffAmt", t.getValueOfDecimal(v.toFixed(w))), f.setValue("OverUnderAmt", t.getValueOfDecimal(c.toFixed(w)))) : (f.setValue("PayAmt", h), f.setValue("PaymentAmount", h), f.setValue("DiscountAmt", l), f.setValue("WriteOffAmt", v), f.setValue("OverUnderAmt", c)), (b == "N" && c > 0 || b == "Y" && c < 0) && n.ADialog.info("LessScheduleAmount")); this.setCalloutActive(!1) } else { this.setCalloutActive(!0); try { (t.getValueOfInt(f.getValue("VAB_Order_ID")) > 0 && t.getValueOfInt(f.getValue("VA009_OrderPaySchedule_ID")) == 0 || t.getValueOfInt(f.getValue("VAB_Order_ID")) == 0 && t.getValueOfInt(f.getValue("VA009_OrderPaySchedule_ID")) == 0 && t.getValueOfInt(f.getValue("VAB_Invoice_ID")) == 0 && t.getValueOfInt(f.getValue("VAB_sched_InvoicePayment_ID")) == 0) && f.setValue("PayAmt", t.getValueOfDecimal(f.getValue("PaymentAmount"))); this.setCalloutActive(!1) } catch (vt) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, sql, vt), vt } } return r = u = f = e = o = s = null, "" }; v.prototype.BankAccount = function (i, r, u, f, e, o) { var s, h; if (e == null || e.toString() == "" || (s = e, this.isCalloutActive())) return ""; this.setCalloutActive(!0); try { h = t.getValueOfInt(n.dataContext.getJSONRecord("MPayment/GetBankAcctCurrency", s.toString())); u.setValue("VAB_Currency_ID", h) } catch (c) { return this.setCalloutActive(!1), c.message } return this.setCalloutActive(!1), i = u = f = e = o = null, "" }; n.Model.CalloutPayment = v; n.Utility.inheritPrototype(w, n.CalloutEngine); w.prototype.DocType = function (r, u, f, o, s, h) { var ot = "O", st = "S", ot = "O", st = "S", ut = "F", nt = "PR", b = "WR", y = "", d, g, w, tt, it, a, ft, l, p, c, et; try { if (s == null || s.toString() == "" || (d = s, d == null || d == 0)) return ""; if (g = f.getValue("DocumentNo"), w = g == null, !w && g.toString().startsWith("<") && g.toString().endsWith(">") && (w = !0), tt = f.getValue("VAB_DocTypes_ID"), y = "SELECT d.DocSubTypeSO,d.HasCharges,'N',d.IsDocNoControlled,s.CurrentNext,s.CurrentNextSys,s.VAF_Record_Seq_ID,d.IsSOTrx, d.IsReturnTrx FROM VAB_DocTypes d LEFT OUTER JOIN VAF_Record_Seq s ON (d.DocNoSequence_ID=s.VAF_Record_Seq_ID) WHERE VAB_DocTypes_ID=", it = 0, a = null, w || tt == 0) y = y + d, a = n.DB.executeDataset(y, null); else for (y = y + tt, a = n.DB.executeDataset(y, null), l = 0; l < a.getTables()[0].rows.count; l++)it = t.getValueOfInt(a.getRows()[l].getCell("VAF_Record_Seq_ID")); var v = "", k = !0, rt = !1; for (l = 0; l < a.getTables()[0].rows.count; l++)if (v = t.getValueOfString(a.getRows()[l].getCell("DocSubTypeSO")), v == null && (v = "--"), r.setContext(u, "OrderType", v), v.toString().equals("SO") || f.setValue("IsDropShip", "N"), "N".toString().equals(t.getValueOfString(a.getRows()[l].getCell("IsSOTrx"))) && (k = !1), rt = "Y".toString().equals(t.getValueOfString(a.getRows()[l].getCell("IsReturnTrx"))), rt ? v.toString().equals(b) ? f.setValue("DeliveryRule", ut) : f.setValue("DeliveryRule", "M") : (v.toString().equals(b) ? f.setValue("DeliveryRule", ut) : v.toString().equals(nt) ? f.setValue("DeliveryRule", "R") : f.setValue("DeliveryRule", "A"), v.toString().equals(b) || v.toString().equals(nt) || v.toString().equals("WI") ? f.setValue("InvoiceRule", "I") : f.setValue("InvoiceRule", "D"), v.toString().equals(b) ? f.setValue("PaymentRule", PAYMENTRULE_Cash) : f.setValue("PaymentRule", PAYMENTRULE_OnCredit), r.setContext(u, "HasCharges", t.getValueOfString(a.getRows()[l].getCell("HasCharges")))), p[3].toString().equals("Y") && (w || it == t.getValueOfInt(a.getRows()[l].getCell("VAF_Record_Seq_ID")) || (w = !0), w)) try { f.setValue("DocumentNo", "<" + t.getValueOfString(a.getRows()[l].getCell("CurrentNext")) + ">") } catch (ht) { this.setCalloutActive(!1) } if (rt) return ""; if (!v.toString().equals(b) && !v.toString().equals(nt)) for (ft = r.getContextAsInt(u, "VAB_BusinessPartner_ID"), y = "SELECT PaymentRule,VAB_PaymentTerm_ID,InvoiceRule,DeliveryRule,FreightCostRule,DeliveryViaRule, PaymentRulePO,PO_PaymentTerm_ID FROM VAB_BusinessPartner WHERE VAB_BusinessPartner_ID=" + ft, a = n.DB.executeDataset(y, null), l = 0; l < a.getTables()[0].rows.count; l++)p = a.getTables()[0].rows[l], c = t.getValueOfString(p.get(k ? "paymentrule" : "paymentrulepo")), c != null && c.toString().length != 0 && (k && (c.toString().equals("B") || c.toString().equals("S") || c.toString().equals("U")) && (c = "P"), !k && c.toString().equals("B") && (c = "P"), f.setValue("PaymentRule", c)), et = t.getValueOfInt(p.get(k ? "VAB_Paymentterm_id" : "po_paymentterm_id")), p != null && f.setValue("VAB_PaymentTerm_ID", et), c = p[2].toString(), c != null && c.length != 0 && f.setValue("InvoiceRule", c), c = p[3].toString(), c != null && c.length != 0 && f.setValue("DeliveryRule", c), c = p[4].toString(), c != null && c.length != 0 && f.setValue("FreightCostRule", c), c = p[5].toString(), c != null && c.length != 0 && f.setValue("DeliveryViaRule", c) } catch (ht) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, y, ht), e.message } return r = u = f = o = s = h = null, "" }; w.prototype.BPartner = function (r, u, f, o, s, h) { var et = "O", ot = "S", et = "O", ot = "S", k = "", a, rt, v, d, b, l, y, g, p, nt, w, tt, ut, ft, c, it; try { if (s == null || s == 0 || s.toString() == "" || (a = 0, s != null && (a = t.getValueOfInt(s.toString())), a == 0) || (rt = f.getValue("IsReturnTrx"), rt)) return ""; for (this.setCalloutActive(!0), k = "SELECT p.VAF_Language,p.VAB_PaymentTerm_ID, COALESCE(p.VAM_PriceList_ID,g.VAM_PriceList_ID) AS VAM_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted, p.InvoiceRule,p.DeliveryRule,p.FreightCostRule,DeliveryViaRule, p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable, lship.VAB_BPart_Location_ID,c.VAF_UserContact_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID, lbill.VAB_BPart_Location_ID AS Bill_Location_ID, p.SOCreditStatus, lbill.IsShipTo FROM VAB_BusinessPartner p INNER JOIN VAB_BPart_Category g ON (p.VAB_BPart_Category_ID=g.VAB_BPart_Category_ID) LEFT OUTER JOIN VAB_BPart_Location lbill ON (p.VAB_BusinessPartner_ID=lbill.VAB_BusinessPartner_ID AND lbill.IsBillTo='Y' AND lbill.IsActive='Y') LEFT OUTER JOIN VAB_BPart_Location lship ON (p.VAB_BusinessPartner_ID=lship.VAB_BusinessPartner_ID AND lship.IsShipTo='Y' AND lship.IsActive='Y') LEFT OUTER JOIN VAF_UserContact c ON (p.VAB_BusinessPartner_ID=c.VAB_BusinessPartner_ID) WHERE p.VAB_BusinessPartner_ID=" + a + " AND p.IsActive='Y'", v = r.getWindowContext(u, "IsSOTrx", !0) == "Y", d = n.DB.executeDataset(k, null), b = 0; b < d.getTables()[0].rows.count; b++)l = d.getTables()[0].rows[b], y = t.getValueOfInt(l.get(v ? "VAM_PriceList_id" : "po_pricelist_id")), l != null && y != 0 && f.setValue("VAM_PriceList_ID", y), f.setValue("Bill_BPartner_ID", a), g = t.getValueOfInt(l.get("bill_location_id")), g == 0 ? f.setValue("Bill_Location_ID", null) : f.setValue("Bill_Location_ID", g), p = t.getValueOfInt(l.get("VAB_BPart_Location_id")), a.toString().equals(r.getContext("VAB_BusinessPartner_ID")) && (nt = r.getContext("VAB_BPart_Location_ID"), nt.toString().length > 0 && (p = int.Parse(nt))), p == 0 ? f.setValue("VAB_BPart_Location_ID", null) : (f.setValue("VAB_BPart_Location_ID", p), "Y".toString().equals(t.getValueOfString(l.get("isshipto"))) && f.setValue("Bill_Location_ID", p)), w = t.getValueOfInt(l.get("VAF_UserContact_id").toString()), a.toString().toString().equals(r.getContext("VAB_BusinessPartner_ID")) && (tt = r.getContext("VAF_UserContact_ID"), tt.toString().length > 0 && (w = t.getValueOfInt(tt))), w == 0 ? f.setValue("VAF_UserContact_ID", null) : (f.setValue("VAF_UserContact_ID", w), f.setValue("Bill_User_ID", w)), v && (ut = t.getValueOfDouble(l.get("so_creditlimit")), ut != 0 && (ft = t.getValueOfDouble(l.get("creditavailable")), l != null && ft < 0)), c = l.get("poreference").toString(), c != null && c.toString().length != 0 && f.setValue("POReference", c), c = t.getValueOfString(l.get("so_description")), c != null && c.toString().trim().length != 0 && f.setValue("Description", c), c = t.getValueOfString(l.get("isdiscountprinted")), c != null && c.toString().length != 0 ? f.setValue("IsDiscountPrinted", c) : f.setValue("IsDiscountPrinted", "N"), it = r.getContext("OrderType"), f.setValue("InvoiceRule", "D"), f.setValue("DeliveryRule", "A"), f.setValue("PaymentRule", PAYMENTRULE_OnCredit), it.toString().equals("PR") ? (f.setValue("InvoiceRule", "I"), f.setValue("DeliveryRule", "R")) : it.toString().equals(MOrder.DocSubTypeSO_POS) ? f.setValue("PaymentRule", PAYMENTRULE_Cash) : (c = l[v ? "PaymentRule" : "PaymentRulePO"].toString(), c != null && c.length != 0 && (c.toString().equals("B") && (c = "P"), v && (c.toString().equals("S") || c.toString().equals("U")) && (c = "P"), f.setValue("PaymentRule", c)), y = t.getValueOfInt(l.get(v ? "VAB_Paymentterm_id" : "po_paymentterm_id")), l != null && y != 0 && f.setValue("VAB_PaymentTerm_ID", y), c = t.getValueOfString(l.get("invoicerule")), c != null && c.length != 0 && f.setValue("InvoiceRule", c), c = t.getValueOfString(l.get("deliveryrule")), c != null && c.length != 0 && f.setValue("DeliveryRule", c), c = t.getValueOfString(l.get("freightcostrule")), c != null && c.length != 0 && f.setValue("FreightCostRule", c), c = t.getValueOfString(l.get("deliveryviarule")), c != null && c.length != 0 && f.setValue("DeliveryViaRule", c)) } catch (st) { return this.log.log(i.SEVERE, k, st), this.setCalloutActive(!1), e.message } return this.setCalloutActive(!1), r = u = f = o = s = h = null, "" }; w.prototype.Product = function (i, u, e, o, s) { var c, k, ot, a, p, l, nt, y, w, ut; if (s == null || s == 0 || s.toString() == "") return ""; try { if ((c = s, c == null || c == 0) || (k = "Y".toString().equals(i.getContext("IsReturnTrx")), k)) return ""; this.setCalloutActive(!0); f && this.log.warning("init"); e.setValue("VAB_Charge_ID", null); e.setValue("VAM_PFeature_SetInstance_ID", null); var ft = i.getContextAsInt(u, "VAB_BusinessPartner_ID"), et = t.getValueOfDecimal(e.getValue("QtyEntered")), d = i.getWindowContext(u, "IsSOTrx", !0) == "Y", g = i.getContextAsInt(u, "VAM_PriceList_ID"), b = n.dataContext.getJSONRecord("MVAMPriceListVersion/GetVAM_PriceListVersion_ID", g.toString()); b == 0 && (b = i.getContextAsInt(u, "VAM_PriceListVersion_ID")); ot = e.getValue("DateOrdered"); a = "SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='ED011_'"; r = t.getValueOfInt(n.DB.executeScalar(a)); p = 0; r > 0 && (a = "SELECT VAB_UOM_ID FROM VAM_Product_PO WHERE IsActive = 'Y' AND  VAB_BusinessPartner_ID = " + t.getValueOfInt(e.getValue("VAB_BusinessPartner_ID")) + " AND VAM_Product_ID = " + c, p = t.getValueOfInt(n.DB.executeScalar(a)), p > 0 && d == !1 ? e.setValue("VAB_UOM_ID", p) : (a = "SELECT VAB_UOM_ID FROM VAM_Product WHERE IsActive = 'Y' AND VAM_Product_ID = " + c, e.setValue("VAB_UOM_ID", t.getValueOfInt(n.DB.executeScalar(a))))); var st = t.getValueOfInt(e.getValue("VAB_UOM_ID")), l = c.toString().concat(",", ft.toString(), ",", et.toString(), ",", d, ",", g.toString(), ",", b.toString(), ",", null, ",", null, ",", null, ",", st, ",", r), h = null; if (h = n.dataContext.getJSONRecord("MVAMProductPricing/GetProductPricing", l), e.setValue("PriceList", h.PriceList), e.setValue("PriceLimit", h.PriceLimit), e.setValue("PriceActual", h.PriceActual), e.setValue("PriceEntered", h.PriceEntered), t.getValueOfInt(h.VAB_Currency_ID) > 0 && e.setValue("VAB_Currency_ID", t.getValueOfInt(h.VAB_Currency_ID)), e.setValue("Discount", h.Discount), e.setValue("VAB_UOM_ID", t.getValueOfInt(h.VAB_UOM_ID)), e.setValue("QtyOrdered", e.getValue("QtyEntered")), i.setContext(u, "EnforcePriceLimit", h.IsEnforcePriceLimit ? "Y" : "N"), i.setContext(u, "DiscountSchema", h.IsDiscountSchema ? "Y" : "N"), i.getWindowContext(u, "IsSOTrx", !0) == "Y" && (l = c.toString() + ",0", nt = n.dataContext.getJSONRecord("MVAMProduct/GetProduct", l), nt)) { var tt = t.getValueOfDecimal(e.getValue("QtyEntered")), it = i.getContextAsInt(u, "VAM_Warehouse_ID"), rt = i.getContextAsInt(u, "VAM_PFeature_SetInstance_ID"), l = it + "," + c + "," + rt, v = n.dataContext.getJSONRecord("MVAMStorage/GetQtyAvailable", l); v == null && (v = n.Env.ZERO); v == 0 || v.toString().compareTo(tt) < 0 || (y = 0, e.getValue("VAB_OrderLine_ID") != null && (y = t.getValueOfInt(e.getValue("VAB_OrderLine_ID"))), y == null && (y = 0), l = it.toString() + "," + c.toString() + "," + rt.toString() + "," + y.toString(), w = t.getValueOfDecimal(n.dataContext.getJSONRecord("MVABOrderLine/GetNotReserved", l)), w == null && (w = n.Env.ZERO), ut = v - w, ut.toString().compareTo(tt) < 0) } this.setCalloutActive(!1); f && this.log.warning("fini") } catch (ht) { this.setCalloutActive(!1) } return this.Tax(i, u, e, o, s) }; w.prototype.Tax = function (i, r, u, f, e) { var o = 0, s = n.Env.ZERO, h = n.Env.ZERO, a = "", c, l; return o = t.getValueOfInt(u.getValue("VAB_TaxRate_ID")), c = "select rate from VAB_TaxRate WHERE VAB_TaxRate_id=" + o + "", s = t.getValueOfDecimal(n.DB.executeScalar(c, null, null)), a = this.Amt(i, r, u, f, e), l = t.getValueOfDecimal(u.getValue("LineNetAmt")), h = t.getValueOfDecimal(t.getValueOfDecimal(l) * t.getValueOfDecimal(s) / 100), u.setValue("taxamt", h), this.Amt(i, r, u, f, e) }; w.prototype.Amt = function (i, u, e, o, s, h) { var ot, v, ft, it, nt, rt, g; if (this.isCalloutActive() || s == null || s.toString() == "") return ""; this.setCalloutActive(!0); try { f && this.log.warning("init"); var d = i.getContextAsInt(u, "VAB_UOM_ID"), p = i.getContextAsInt(u, "VAM_Product_ID"), ut = i.getContextAsInt(u, "VAM_PriceList_ID"), ht = ut.toString(), y = n.dataContext.getJSONRecord("MVAMPriceList/GetPriceList", ht), tt = t.getValueOfInt(y.StdPrecision), k, c, l, w, a, b; if (k = t.getValueOfDecimal(e.getValue("QtyEntered")), k = t.getValueOfDecimal(e.getValue("QtyEntered")), this.log.fine("QtyEntered=" + k + ", Ordered=" + k + ", UOM=" + d), c = t.getValueOfDecimal(e.getValue("PriceEntered")), l = t.getValueOfDecimal(e.getValue("PriceActual")), a = t.getValueOfDecimal(e.getValue("Discount")), w = t.getValueOfDecimal(e.getValue("PriceLimit")), b = t.getValueOfDecimal(e.getValue("PriceList")), this.log.fine("PriceList=" + b + ", Limit=" + w + ", Precision=" + tt), this.log.fine("PriceEntered=" + c + ", Actual=" + l + ", Discount=" + a), (o.getColumnName().toString().equals("QtyEntered") || o.getColumnName().toString().equals("QtyEntered") || o.getColumnName().toString().equals("VAM_Product_ID")) && !"N".toString().equals(i.getContext("DiscountSchema"))) { ot = i.getContextAsInt(u, "VAB_BusinessPartner_ID"); o.getColumnName().toString().equals("QtyEntered") && (v = p.toString() + "," + d.toString() + "," + k.toString(), k = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", v))); ft = i.getWindowContext(u, "IsSOTrx", !0) == "Y"; it = n.dataContext.getJSONRecord("MVAMPriceListVersion/GetVAM_PriceListVersion_ID", ut.toString()); it == 0 && (it = i.getContextAsInt(u, "VAM_PriceListVersion_ID")); nt = "SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='ED011_'"; r = t.getValueOfInt(n.DB.executeScalar(nt)); rt = 0; r > 0 && (nt = "SELECT VAB_UOM_ID FROM VAM_Product_PO WHERE IsActive = 'Y' AND  VAB_BusinessPartner_ID = " + t.getValueOfInt(e.getValue("VAB_BusinessPartner_ID")) + " AND VAM_Product_ID = " + p, rt = t.getValueOfInt(n.DB.executeScalar(nt)), rt > 0 && ft == !1 ? e.setValue("VAB_UOM_ID", rt) : (nt = "SELECT VAB_UOM_ID FROM VAM_Product WHERE IsActive = 'Y' AND VAM_Product_ID = " + p, e.setValue("VAB_UOM_ID", t.getValueOfInt(n.DB.executeScalar(nt))))); var ct = t.getValueOfInt(e.getValue("VAB_UOM_ID")), v = p.toString().concat(",", ot.toString(), ",", k.toString(), ",", ft, ",", ut.toString(), ",", it.toString(), ",", null, ",", null, ",", null, ",", ct, ",", r), y = null; y = n.dataContext.getJSONRecord("MVAMProductPricing/GetProductPricing", v); v = p.toString() + "," + d.toString() + "," + y.PriceStd.toString(); c = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", v)); (c == null || c == 0) && (c = y.PriceStd); this.log.fine("QtyChanged -> PriceActual=" + y.PriceStd + ", PriceEntered=" + c + ", Discount=" + y.Discount); l = y.PriceStd; e.setValue("PriceActual", y.PriceActual); e.setValue("Discount", y.Discount); e.setValue("PriceEntered", y.PriceEntered); i.setContext(u, "DiscountSchema", y.DiscountSchema ? "Y" : "N") } else o.getColumnName().toString().equals("PriceActual") ? (l = t.getValueOfDecimal(s), v = p.toString() + "," + d.toString() + "," + l.toString(), c = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", v)), (c == null || c == 0) && (c = l), this.log.fine("PriceActual=" + l + " -> PriceEntered=" + c), e.setValue("PriceEntered", c)) : o.getColumnName().toString().equals("PriceEntered") && (c = t.getValueOfDecimal(s), v = p.toString() + "," + d.toString() + "," + c.toString(), l = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", v)), (l == null || c == 0) && (l = c), this.log.fine("PriceEntered=" + c + " -> PriceActual=" + l), e.setValue("PriceActual", l)); o.getColumnName().toString().equals("Discount") ? (l = t.getValueOfDecimal((100 - t.getValueOfDouble(a)) / 100 * t.getValueOfDouble(b)), t.scale(l) > tt && (l = l.toFixed(tt)), v = p.toString() + "," + d.toString() + "," + l.toString(), c = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", v)), (c == null || c == 0) && (c = l), e.setValue("PriceActual", l), e.setValue("PriceEntered", c)) : (a = b == 0 ? n.Env.ZERO : t.getValueOfDecimal((b - l) / b * 100), t.scale(a) > 2 && (a = a.toFixed(2)), e.setValue("Discount", a)); this.log.fine("PriceEntered=" + c + ", Actual=" + l + ", Discount=" + a); var st = i.getContext("EnforcePriceLimit"), et = i.getWindowContext(u, "IsSOTrx", !0) == "Y" && st != null && st.toString().equals("Y"), lt = "Y".toString().equals(i.getContext("IsReturnTrx")); et && (n.MRole.getDefault().IsOverwritePriceLimit() || lt) && (et = !1); et && t.getValueOfDouble(w) != 0 && l.toString().compare(w) < 0 && (l = w, v = p.toString() + "," + d.toString() + "," + w.toString(), c = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", v)), (c == null || c == 0) && (c = w), this.log.fine("(under) PriceEntered=" + c + ", Actual" + w), e.setValue("PriceActual", w), e.setValue("PriceEntered", c), n.ADialog.info("UnderLimitPrice"), b != 0 && (a = t.getValueOfDecimal((b - l) / b * 100), t.scale(a) > 2 && (a = a.toFixed(2)), e.setValue("Discount", a))); g = k * l; t.scale(g) > tt && (g = g.toFixed(tt)); this.log.info("LineNetAmt=" + g); e.setValue("LineNetAmt", g); e.setValue("GrandTotal", t.getValueOfDecimal(e.getValue("TaxAmt")) + g) } catch (at) { } return this.setCalloutActive(!1), i = u = e = o = s = h = null, "" }; n.Model.CalloutOrderContract = w; n.Utility.inheritPrototype(ft, n.CalloutEngine); ft.prototype.CalculationSelection = function (n, t, i, r, u) { return this.isCalloutActive() || u == null || u.toString() == "" || u == !1 ? "" : (this.setCalloutActive(!0), r.getColumnName() == "IsSum" ? (i.setValue("IsMaximum", !1), i.setValue("IsCount", !1), i.setValue("IsMinimum", !1)) : r.getColumnName() == "IsMaximum" ? (i.setValue("IsSum", !1), i.setValue("IsMinimum", !1), i.setValue("IsCount", !1)) : r.getColumnName() == "IsCount" ? (i.setValue("IsMaximum", !1), i.setValue("IsSum", !1), i.setValue("IsMinimum", !1)) : r.getColumnName() == "IsMinimum" && (i.setValue("IsSum", !1), i.setValue("IsCount", !1), i.setValue("IsMaximum", !1)), this.setCalloutActive(!1), "") }; ft.prototype.UpdateKPITableInContext = function (n, t, i, r, u) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), u == !0 ? (i.setValue("VAF_TableView_ID", -1), i.setValue("VAF_Tab_ID", -1), n.setContext(t, "VAF_TableView_ID", -1), n.setContext(t, "VAF_Tab_ID", -1)) : (i.setValue("TableView_ID", -1), n.setContext(t, "TableView_ID", -1)), this.setCalloutActive(!1), "") }; ft.prototype.UpdateTabIDContext = function (n, t, i, r, u) { return this.isCalloutActive() ? "" : (this.setCalloutActive(!0), u < 1 || u == null || u.toString() == "" ? (i.setValue("VAF_Tab_ID", -1), n.setContext(t, "VAF_Tab_ID", -1)) : n.setContext(t, "VAF_Tab_ID", u), this.setCalloutActive(!1), "") }; n.Model.CalloutKPI = ft; n.Utility.inheritPrototype(b, n.CalloutEngine); b.prototype.UpdateTableInContext = function (n, t, i, r, u) { return this.isCalloutActive() ? "" : (this.setCalloutActive(!0), u == !0 ? (i.setValue("VAF_TableView_ID", -1), i.setValue("VAF_Tab_ID", -1), n.setContext(t, "VAF_TableView_ID", -1), n.setContext(t, "VAF_Tab_ID", -1)) : (i.setValue("TableView_ID", -1), n.setContext(t, "TableView_ID", -1)), this.setCalloutActive(!1), "") }; b.prototype.UpdateTabIDContext = function (n, t, i, r, u) { return this.isCalloutActive() ? "" : (this.setCalloutActive(!0), u < 1 || u == null || u.toString() == "" ? (i.setValue("VAF_Tab_ID", -1), n.setContext(t, "VAF_Tab_ID", -1)) : (n.setContext(t, "VAF_Tab_ID", u), i.setValue("TableView_ID", -1), n.setContext(t, "TableView_ID", -1)), this.setCalloutActive(!1), "") }; b.prototype.UpdateTableViewIDOnTableContext = function (n, t, i, r, u) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), u > 0 && (i.setValue("TableView_ID", -1), n.setContext(t, "TableView_ID", -1)), this.setCalloutActive(!1), "") }; b.prototype.SelectFunctionOnDashboard = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "" || f == !1) return ""; this.setCalloutActive(!0); var e = t.getValueOfBoolean(f); return u.getColumnName() == "IsSum" ? (r.setValue("IsAvg", !1), r.setValue("IsCount", !1), r.setValue("IsNone", !1)) : u.getColumnName() == "IsAvg" ? (r.setValue("IsSum", !1), r.setValue("IsCount", !1), r.setValue("IsNone", !1)) : u.getColumnName() == "IsCount" ? (r.setValue("IsSum", !1), r.setValue("IsAvg", !1), r.setValue("IsNone", !1)) : u.getColumnName() == "IsNone" && (r.setValue("IsSum", !1), r.setValue("IsCount", !1), r.setValue("IsAvg", !1)), this.setCalloutActive(!1), "" }; b.prototype.ValueCheck = function (n, t, i, r, u, f) { if (this.isCalloutActive()) return ""; this.setCalloutActive(!0); var e = i.getValue("LastNValue"); return e > 60 && i.setValue("LastNValue", 1), this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; n.Model.CalloutDashboard = b; n.Utility.inheritPrototype(et, n.CalloutEngine); et.prototype.UpdateTabIDContext = function (n, t, i, r, u) { return this.isCalloutActive() ? "" : (this.setCalloutActive(!0), u < 1 || u == null || u.toString() == "" ? (i.setValue("VAF_Tab_ID", -1), n.setContext(t, "VAF_Tab_ID", -1)) : n.setContext(t, "VAF_Tab_ID", u), this.setCalloutActive(!1), "") }; et.prototype.GroupByChecked = function (t, i, r, u, f) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var e = "UPDATE VARC_ViewColumn SET IsGroupBy='N' WHERE VARC_View_ID=" + r.getValue("VARC_View_ID") + " AND VARC_ViewColumn_ID NOT IN(" + r.getValue("VARC_ViewColumn_ID") + ")", o = n.DB.executeQuery(e); return this.setCalloutActive(!1), "" }; et.prototype.IsViewChecked = function (n, t, i, r, u) { return this.isCalloutActive() || u == null ? "" : (this.setCalloutActive(!0), u ? (i.setValue("VAF_Tab_ID", -1), i.setValue("VAF_TableView_ID", -1), n.setContext(t, "VAF_Tab_ID", -1), n.setContext(t, "VAF_TableView_ID", -1)) : (i.setValue("TableView_ID", -1), n.setContext(t, "TableView_ID", -1)), this.setCalloutActive(!1), "") }; n.Model.CalloutDashboardView = et; n.Utility.inheritPrototype(gi, n.CalloutEngine); gi.prototype.StatisticGroup = function (n, t, i, r, u) { return u == null || u.toString() == "" ? "" : (i.setValue("FO_STATISTICSUBGROUP_ID", 0), "") }; n.Model.CalloutService = gi; n.Utility.inheritPrototype(kt, n.CalloutEngine); kt.prototype.SetReadnly = function (n, i, r, u, f) { return f == null || f.toString() == "" || f.toString() == "E" ? (this.setCalloutActive(!1), f != null && f.toString() == "E" && (r.getField("VSS_PAYMENTTYPE").setReadOnly(!0), r.setValue("VSS_PAYMENTTYPE", "P")), "") : (this.setCalloutActive(!0), t.getValueOfString(r.getValue("CashType")) == "A" || t.getValueOfString(r.getValue("CashType")) == "E" ? (r.setValue("VSS_PAYMENTTYPE", "P"), r.getField("VSS_PAYMENTTYPE").setReadOnly(!0)) : t.getValueOfString(r.getValue("CashType")) == "F" || t.getValueOfString(r.getValue("CashType")) == "R" ? (r.setValue("VSS_PAYMENTTYPE", "R"), r.getField("VSS_PAYMENTTYPE").setReadOnly(!0)) : t.getValueOfString(r.getValue("CashType")) == "I" ? r.getField("VSS_PAYMENTTYPE").setReadOnly(!0) : r.getField("VSS_PAYMENTTYPE").setReadOnly(!1), t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "P" || t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "E" ? t.getValueOfDecimal(r.getValue("amount")) > 0 && r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))) : (t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "R" || t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "A") && t.getValueOfDecimal(r.getValue("amount")) < 0 && r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))), this.setCalloutActive(!1), "") }; kt.prototype.SetAmountValue = function (n, i, r, u, f) { if (f == null || f.toString() == "") return r.getField("VSS_PAYMENTTYPE").setReadOnly(!1), this.setCalloutActive(!1), ""; if (this.setCalloutActive(!0), t.getValueOfString(r.getValue("CashType")) != "B") t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "P" ? t.getValueOfDecimal(r.getValue("amount")) > 0 && r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))) : t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "R" && t.getValueOfDecimal(r.getValue("amount")) < 0 && r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))); else if (t.getValueOfString(r.getValue("CashType")) == "B") { var e = t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")); (e == "P" || e == "E") && t.getValueOfDecimal(r.getValue("amount")) > 0 ? (r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))), r.setValue("ConvertedAmount", 0 - t.getValueOfDecimal(r.getValue("ConvertedAmount")))) : (e == "R" || e == "A") && t.getValueOfDecimal(r.getValue("amount")) < 0 && (r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))), r.setValue("ConvertedAmount", 0 - t.getValueOfDecimal(r.getValue("ConvertedAmount")))) } return this.setCalloutActive(!1), "" }; n.Model.CalloutSetReadOnly = kt; n.Utility.inheritPrototype(nr, n.CalloutEngine); nr.prototype.SetContract = function (t, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); try { var e = t.getContextAsInt(i, "VAM_Product_ID"), o = e.toString().concat(","), s = n.dataContext.getJSONRecord("MVAMProduct/GetProductType", o); s == "S" ? r.getField("IsContract").setReadOnly(!1) : (r.getValue("IsContract", !1), r.getField("IsContract").setReadOnly(!0)) } catch (h) { this.log.severe(h.toString()) } return this.setCalloutActive(!1), "" }; n.Model.CalloutSetContract = nr; n.Utility.inheritPrototype(dt, n.CalloutEngine); dt.prototype.WorkflowType = function (i, r, u, f, e) { var s, o; if (e == null || e.toString() == "") return ""; if (this.setCalloutActive(!0), s = t.getValueOfString(e.toString()), s == "R") { if (o = t.getValueOfInt(n.DB.executeScalar("SELECT VAF_TableView_ID FROM VAF_TableView WHERE IsActive='Y' AND TableName= 'VADMS_MetaData'")), o == 0) return n.ADialog.info("No_VADMS", null, "", ""), n.Msg.getMsg("No_VADMS"); u.setValue("VAF_TableView_ID", o) } return this.setCalloutActive(!1), "" }; dt.prototype.SetSelectedColumn = function (i, r, u, f, e) { return e == null || e.toString() == "" ? "" : (this.setCalloutActive(!0), t.getValueOfString(n.DB.executeScalar("SELECT ColumnName FROM VAF_Column WHERE VAF_Column_ID=" + e)).toLower() == "VAB_GenFeatureSetInstance_ID".toLower() ? i.setContext(r, "IsGenericAttribute", "Y") : i.setContext(r, "IsGenericAttribute", "N"), this.setCalloutActive(!1), "") }; n.Model.CallOutWorkflow = dt; n.Utility.inheritPrototype(tr, n.CalloutEngine); tr.prototype.GetPaymentNote = function (i, r, u, f, e) { if (e == null || e.toString() == "" || e == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); var o = t.getValueOfString(n.DB.executeScalar("select documentnote from VAB_Paymentterm where VAB_Paymentterm_id=" + e)); return o != null && u.setValue("description", o), this.setCalloutActive(!1), "" }; n.Model.CalloutSalesQuotation = tr; n.Utility.inheritPrototype(ir, n.CalloutEngine); ir.prototype.SetDate = function (i, r, u, f, e, o) { var h, s, c; if (e == null || e.toString() == "") return ""; if (u.getValue("StartDate") == null || u.getValue("NoofCycle") == null) return this.setCalloutActive(!1), ""; try { this.setCalloutActive(!0); h = ""; h = n.dataContext.getJSONRecord("MVABOrderLine/GetNoOfMonths", t.getValueOfString(u.getValue("VAB_Frequency_ID"))); s = new Date(u.getValue("StartDate")); c = s.setMonth(s.getMonth() + h * t.getValueOfInt(u.getValue("NoofCycle"))); c = new Date(s.setDate(s.getDate() - 1)); u.setValue("EndDate", c.toISOString()); i = r = u = f = e = o = null; this.setCalloutActive(!1) } catch (l) { } return "" }; n.Model.CalloutSetDate = ir; n.Utility.inheritPrototype(rr, n.CalloutEngine); rr.prototype.DisplayButton = function (i, r, u, f, e) { if (e == null || e.toString() == "") return ""; if (t.getValueOfInt(u.getValue("VAB_DocTypesTarget_ID")) != 0) { var s = "select dc.DocSubTypeSO from VAB_DocTypes dc inner join VAB_MasterDocType db on(dc.DocBaseType=db.DocBaseType)where VAB_DocTypes_id=" + t.getValueOfInt(u.getValue("VAB_DocTypesTarget_ID")) + " and db.DocBaseType='SOO' and dc.DocSubTypeSO in ('WR','WI')", o = t.getValueOfString(n.DB.executeScalar(s, null, null)); o == "WR" || o == "WI" ? u.setValue("InvoicePrint", "Y") : u.setValue("InvoicePrint", "N") } else return this.setCalloutActive(!1), ""; return this.setCalloutActive(!1), "" }; n.Model.CalloutDisplayButton = rr; n.Utility.inheritPrototype(ur, n.CalloutEngine); ur.prototype.SetQty = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; if (this.setCalloutActive(!0), t.getValueOfDecimal(r.getValue("TargetQty")) < t.getValueOfDecimal(r.getValue("ConfirmedQty"))) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; if (u.getColumnName() == "ConfirmedQty") { if (t.getValueOfDecimal(r.getValue("ConfirmedQty")) < 0) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; r.setValue("ScrappedQty", 0); r.setValue("DifferenceQty", t.getValueOfDecimal(r.getValue("TargetQty")) - (t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty")))) } else if (u.getColumnName() == "DifferenceQty") { if (t.getValueOfDecimal(r.getValue("TargetQty")) < t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("DifferenceQty"))) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; r.setValue("ScrappedQty", t.getValueOfDecimal(r.getValue("TargetQty")) - (t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("DifferenceQty")))) } else if (u.getColumnName() == "ScrappedQty") { if (t.getValueOfDecimal(r.getValue("ScrappedQty")) < 0 || t.getValueOfDecimal(r.getValue("TargetQty")) < t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty"))) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; r.setValue("DifferenceQty", t.getValueOfDecimal(r.getValue("TargetQty")) - (t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty")))) } return this.setCalloutActive(!1), "" }; n.Model.CalloutMoveConfirmLine = ur; n.Utility.inheritPrototype(gt, n.CalloutEngine); gt.prototype.SetSalesQuotation = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; try { this.setCalloutActive(!0); t.getValueOfString(r.getValue("DocSubTypeSO")) == "OB" || t.getValueOfString(r.getValue("DocSubTypeSO")) == "ON" ? r.setValue("IsSalesQuotation", !0) : r.setValue("IsSalesQuotation", !1) } catch (e) { return this.setCalloutActive(!1), e } return this.setCalloutActive(!1), "" }; gt.prototype.Organization = function (t, i, r, u, f) { var o, e; if (this.isCalloutActive() || f == null || f.toString() == "") return ""; try { this.setCalloutActive(!0); o = ""; r.getField("VAM_Warehouse_ID") != null && (e = n.dataContext.getJSONRecord("MVABDocTypes/GetWarehouse", f.toString()), e > 0 ? r.getTableName() == "VAM_InventoryTransfer" && r.getField("DTD001_MWarehouseSource_ID") != null ? r.setValue("DTD001_MWarehouseSource_ID", e) : r.setValue("VAM_Warehouse_ID", e) : r.getTableName() == "VAM_InventoryTransfer" && r.getField("DTD001_MWarehouseSource_ID") != null ? r.setValue("DTD001_MWarehouseSource_ID", 0) : r.setValue("VAM_Warehouse_ID", 0)) } catch (s) { return this.setCalloutActive(!1), s } return this.setCalloutActive(!1), "" }; n.Model.CalloutDocumentType = gt; n.Utility.inheritPrototype(fr, n.CalloutEngine); fr.prototype.SetAddress = function (i, r, u, f, e) { var o, s, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { this.setCalloutActive(!0); f.getColumnName() == "VAB_BusinessPartner_ID" ? (u.getField("Ref_BPartner_ID") != null && u.setValue("Ref_BPartner_ID", e), o = null, o = n.dataContext.getJSONRecord("MBPartner/GetBPData", t.getValueOfString(u.getValue("VAB_BusinessPartner_ID"))), o != null && (s = n.Utility.Util.getValueOfInt(o.VAB_BPart_Location_ID), s == 0 ? u.setValue("VAB_BPart_Location_ID", null) : u.setValue("VAB_BPart_Location_ID", s), h = n.Utility.Util.getValueOfInt(o.VAF_UserContact_ID), h == 0 ? u.setValue("VAF_UserContact_ID", null) : u.setValue("VAF_UserContact_ID", h))) : f.getColumnName() == "VAB_BusinessPartnerSR_ID" && (u.getField("Ref_BPartner_ID") != null && u.setValue("Ref_BPartner_ID", e), o = null, o = n.dataContext.getJSONRecord("MBPartner/GetBPData", t.getValueOfString(u.getValue("VAB_BusinessPartnerSR_ID"))), o != null && (s = n.Utility.Util.getValueOfInt(o.VAB_BPart_Location_ID), s == 0 ? u.setValue("VAB_BPart_Location_ID", null) : u.setValue("VAB_BPart_Location_ID", s), h = n.Utility.Util.getValueOfInt(o.VAF_UserContact_ID), h == 0 ? u.setValue("VAF_UserContact_ID", null) : u.setValue("VAF_UserContact_ID", h))) } catch (c) { return this.setCalloutActive(!1), c } return this.setCalloutActive(!1), "" }; n.Model.CalloutProjectCBPartner = fr; n.Utility.inheritPrototype(er, n.CalloutEngine); er.prototype.SetPaymentType = function (n, t, i, r, u) { if (this.isCalloutActive() || u == null || u.toString() == "") return ""; try { if (this.setCalloutActive(!0), r.getColumnName() == "PaymentRule") if (i.getValue("PaymentRule") == null) i.setValue("PaymentMethod", null); else { var f = i.getValue("PaymentRule"); i.setValue("PaymentMethod", f) } } catch (e) { return this.setCalloutActive(!1), e } return this.setCalloutActive(!1), "" }; n.Model.CalloutPaymentTypeSO = er; n.Utility.inheritPrototype(or, n.CalloutEngine); or.prototype.DateRequired = function (t, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); try { var s, o; s = new Date(r.getValue("DateContract")); o = new Date(r.getValue("DateFinish")); o.toISOString() < s.toISOString() && (r.setValue("DateFinish", ""), this.setCalloutActive(!1), n.ADialog.info("DateInvalid", null, "", "")); this.log.fine("DateFinish=" + o) } catch (h) { return n.ADialog.info("DateError" + h, null, "", ""), this.setCalloutActive(!1), h } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutMCampaign = or; n.Utility.inheritPrototype(ni, n.CalloutEngine); ni.prototype.DateRequired = function (t, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); try { var s, o; s = new Date(r.getValue("StartDate")); o = new Date(r.getValue("CloseDate")); o.toISOString() < s.toISOString() && (r.setValue("CloseDate", ""), this.setCalloutActive(!1), n.ADialog.info("CloseDateInvalid", null, "", "")); this.log.fine("CloseDate=" + o) } catch (h) { return n.ADialog.info("error in Date" + h, null, "", ""), this.setCalloutActive(!1), h } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; ni.prototype.PlanDateRequired = function (t, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); try { var s, o; s = new Date(r.getValue("DateStartPlan")); o = new Date(r.getValue("DateCompletePlan")); o.toISOString() < s.toISOString() && (r.setValue("DateCompletePlan", ""), this.setCalloutActive(!1), n.ADialog.info("CmpDateInvalid", null, "", "")); this.log.fine("DateCompletePlan=" + o) } catch (h) { return n.ADialog.info("error in Date" + h, null, "", ""), this.setCalloutActive(!1), h } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutMVARRequest = ni; n.Utility.inheritPrototype(ot, n.CalloutEngine); ot.prototype.GenerateMenuItemExportID = function (n, t, i, r, u) { var f, e, o; return u == null || u.toString() == "" ? "" : (f = n.getContext(t, "Prefix"), i.getValue("MenuItemExport_ID") == null && i.getValue("IsMenuItem").toString() == "true" && (e = new Date, o = f + e.getTime(), i.setValue("MenuItemExport_ID", o)), this.setCalloutActive(!1), "") }; ot.prototype.GenerateVersionID = function (n, t, i, r, u) { if (u == null || u.toString() == "") return ""; var f = n.getContext(t, "VersionNo"), e = f.replace(".", ""); return i.setValue("VersionID", e), this.setCalloutActive(!1), "" }; ot.prototype.CheckBoxValidation = function (n, i, r, u, f) { var o, e; return f == null || f.toString() == "" ? "" : (o = t.getValueOfBoolean(f), o == !0 && (e = u.getColumnName(), e == "IsProfessionalFree" ? (r.setValue("IsProfessionalPaid", !1), r.setValue("IsFree", !1), r.setValue("IsPaid", !1)) : e == "IsProfessionalPaid" ? (r.setValue("IsProfessionalFree", !1), r.setValue("IsFree", !1), r.setValue("IsPaid", !1)) : e == "IsFree" ? (r.setValue("IsProfessionalPaid", !1), r.setValue("IsProfessionalFree", !1), r.setValue("IsPaid", !1)) : e == "IsPaid" && (r.setValue("IsProfessionalPaid", !1), r.setValue("IsFree", !1), r.setValue("IsProfessionalFree", !1))), this.setCalloutActive(!1), "") }; n.Model.CalloutModuleMgmt = ot; n.Utility.inheritPrototype(sr, n.CalloutEngine); sr.prototype.SetUOM = function (i, r, u, f, e, o) { if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); u.getField("VAM_PFeature_SetInstance_ID") != null && u.setValue("VAM_PFeature_SetInstance_ID", null); try { if (t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='ED011_' ")) > 0) { var s = t.getValueOfInt(e), h = t.getValueOfInt(n.DB.executeScalar("SELECT VAB_UOM_ID FROM VAM_Product WHERE IsActive = 'Y' AND VAM_Product_ID = " + s)); u.setValue("VAB_UOM_ID", h) } } catch (c) { this.setCalloutActive(!1); this.log.severe(c.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutPriclistUOM = sr; n.Utility.inheritPrototype(st, n.CalloutEngine); st.prototype.PaymentTaxAmount = function (i, r, u, f, e, o) { var a, l, s, c, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { if (a = n.dataContext.getJSONRecord("MCurrency/GetCurrency", u.getValue("VAB_Currency_ID").toString()), l = a.StdPrecision, f.getColumnName() == "VAB_TaxRate_ID") if (t.getValueOfDecimal(u.getValue("PayAmt")) > 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", e.toString() + "," + u.getValue("PayAmt").toString() + "," + l.toString()), u.setValue("TaxAmount", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", e.toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("PayAmt")) - t.getValueOfDecimal(u.getValue("PayAmt")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmount", h); else return u.setValue("TaxAmount", 0), this.setCalloutActive(!1), "" } else return this.setCalloutActive(!1), ""; else if (t.getValueOfInt(u.getValue("VAB_TaxRate_ID")) > 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", u.getValue("VAB_TaxRate_ID").toString() + "," + u.getValue("PayAmt").toString() + "," + l.toString()), u.setValue("TaxAmount", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", u.getValue("VAB_TaxRate_ID").toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("PayAmt")) - t.getValueOfDecimal(u.getValue("PayAmt")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmount", h); else return u.setValue("TaxAmount", 0), this.setCalloutActive(!1), "" } else return this.setCalloutActive(!1), "" } catch (v) { this.setCalloutActive(!1); this.log.severe(v.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; st.prototype.CashLineTaxAmount = function (i, r, u, f, e, o) { var a, l, s, c, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { if (a = n.dataContext.getJSONRecord("MCurrency/GetCurrency", i.getContext(r, "VAB_Currency_ID").toString()), l = a.StdPrecision, f.getColumnName() == "VAB_TaxRate_ID") if (t.getValueOfDecimal(u.getValue("Amount")) != 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", e.toString() + "," + u.getValue("Amount").toString() + "," + l.toString()), u.setValue("TaxAmt", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", e.toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("Amount")) - t.getValueOfDecimal(u.getValue("Amount")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmt", h); else return u.setValue("TaxAmt", 0), this.setCalloutActive(!1), "" } else return this.setCalloutActive(!1), ""; else if (t.getValueOfInt(u.getValue("VAB_TaxRate_ID")) > 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", u.getValue("VAB_TaxRate_ID").toString() + "," + u.getValue("Amount").toString() + "," + l.toString()), u.setValue("TaxAmt", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", u.getValue("VAB_TaxRate_ID").toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("Amount")) - t.getValueOfDecimal(u.getValue("Amount")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmt", h); else return u.setValue("TaxAmt", 0), this.setCalloutActive(!1), "" } else return this.setCalloutActive(!1), "" } catch (v) { this.setCalloutActive(!1); this.log.severe(v.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; st.prototype.BankStatementLineTaxAmount = function (i, r, u, f, e, o) { var a, v, l, s, c, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); a = ""; try { if (a = u.getValue("VAB_Currency_ID").toString(), v = n.dataContext.getJSONRecord("MCurrency/GetCurrency", a), l = v.StdPrecision, f.getColumnName() == "VAB_TaxRate_ID") if (t.getValueOfDecimal(u.getValue("ChargeAmt")) != 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", e.toString() + "," + u.getValue("ChargeAmt").toString() + "," + l.toString()), u.setValue("TaxAmt", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", e.toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("ChargeAmt")) - t.getValueOfDecimal(u.getValue("ChargeAmt")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmt", h); else return u.setValue("TaxAmt", 0), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } else return this.setCalloutActive(!1), i = r = u = f = e = o = null, ""; else if (t.getValueOfInt(u.getValue("VAB_TaxRate_ID")) > 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", u.getValue("VAB_TaxRate_ID").toString() + "," + u.getValue("ChargeAmt").toString() + "," + l.toString()), u.setValue("TaxAmt", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", u.getValue("VAB_TaxRate_ID").toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("ChargeAmt")) - t.getValueOfDecimal(u.getValue("ChargeAmt")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmt", h); else return u.setValue("TaxAmt", 0), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } else return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } catch (y) { this.setCalloutActive(!1); this.log.severe(y.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutTaxAmount = st; n.Utility.inheritPrototype(hr, n.CalloutEngine); hr.prototype.SetProdCatValues = function (i, r, u, f, e, o) { var s, l, a; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { var h = "SELECT IsActive ", v = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='VA038_' ")), c = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='DTD001_' ")); c > 0 && (h += " , producttype "); c > 0 && (h += " , VAM_PFeature_Set_id, VAB_TaxCategory_id "); h += " FROM VAM_ProductCategory WHERE VAM_ProductCategory_id=" + t.getValueOfInt(e); s = n.DB.executeDataSet(h); s != null && s.tables[0].rows.length > 0 && (t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(VAF_MODULEINFO_ID) FROM VAF_MODULEINFO WHERE PREFIX='DTD001_' ")) > 0 && (s.tables[0].rows[0].cells.producttype != null || t.getValueOfString(s.tables[0].rows[0].cells.producttype) != "" ? u.setValue("PRODUCTTYPE", s.tables[0].rows[0].cells.producttype) : u.setValue("PRODUCTTYPE", "")), c > 0 && (s.tables[0].rows[0].cells.VAM_PFeature_Set_id != null || t.getValueOfString(s.tables[0].rows[0].cells.VAM_PFeature_Set_id) != "" ? u.setValue("VAM_PFeature_Set_ID", t.getValueOfInt(s.tables[0].rows[0].cells.VAM_PFeature_Set_id)) : u.setValue("VAM_PFeature_Set_ID", 0), s.tables[0].rows[0].cells.VAB_TaxCategory_id != null || t.getValueOfString(s.tables[0].rows[0].cells.VAB_TaxCategory_id) != "" ? u.setValue("VAB_TaxCategory_ID", t.getValueOfInt(s.tables[0].rows[0].cells.VAB_TaxCategory_id)) : u.setValue("VAB_TaxCategory_ID", 0))); v > 0 && (t.getValueOfString(s.tables[0].rows[0].cells.producttype) == "E" || t.getValueOfString(s.tables[0].rows[0].cells.producttype) == "S" ? (l = t.getValueOfInt(n.DB.executeScalar("SELECT VAA_AssetGroup_ID FROM VAM_ProductCategory WHERE VAM_ProductCategory_ID=" + t.getValueOfInt(e))), l > 0 ? (a = t.getValueOfInt(n.DB.executeScalar("SELECT VA038_AmortizationTemplate_ID FROM VAA_AssetGroup WHERE VAA_AssetGroup_ID=" + l)), a > 0 ? u.setValue("VA038_AmortizationTemplate_ID", a) : u.setValue("VA038_AmortizationTemplate_ID", 0)) : u.setValue("VA038_AmortizationTemplate_ID", 0)) : u.setValue("VA038_AmortizationTemplate_ID", 0)) } catch (y) { this.setCalloutActive(!1); this.log.severe(y.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutProdCatVal = hr; n.Utility.inheritPrototype(cr, n.CalloutEngine); cr.prototype.SetProdTypeValues = function (n, t, i, r, u, f) { if (this.isCalloutActive() || u == null || u.toString() == "") return ""; this.setCalloutActive(!0); try { u != "I" && i.setValue("IsStocked", !1) } catch (e) { this.setCalloutActive(!1); this.log.severe(e.toString()) } return this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; n.Model.CalloutProdTypeVal = cr; n.Utility.inheritPrototype(lr, n.CalloutEngine); lr.prototype.SetProfitBeforeTax = function (i, r, u, f, e, o) { if (e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; this.setCalloutActive(!0); try { var h = 0, c = 0, l = 0, s = null; s = n.DB.executeDataSet("SELECT ProfitBeforeTax,VAB_Year_ID,VAB_ProfitAndLoss_ID FROM VAB_ProfitLoss WHERE VAB_ProfitLoss_ID=" + e, null, null); s != null && s.tables[0].rows.length > 0 && (h = t.getValueOfDecimal(s.getTables()[0].getRows()[0].getCell("ProfitBeforeTax")), c = t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("VAB_Year_ID")), l = t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("VAB_ProfitAndLoss_ID")), u.setValue("ProfitBeforeTax", h), u.setValue("VAB_Year_ID", c), u.setValue("VAB_ProfitAndLoss_ID", l)) } catch (a) { this.setCalloutActive(!1); this.log.severe(a.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutProfitTax = lr; n.Utility.inheritPrototype(ar, n.CalloutEngine); ar.prototype.BPGroup = function (i, r, u, f, e, o) { if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { var a = "select VAM_ReturnRule_ID, VAM_DiscountCalculation_ID, VAM_PriceList_ID, PO_PriceList_ID,PO_DiscountSchema_ID,PO_ReturnPolicy_ID from VAB_BPart_Category where VAB_BPart_Category_ID=" + t.getValueOfInt(e), s = n.DB.executeDataSet(a), v = u.getValue("IsCustomer"), y = u.getValue("IsVendor"); if (v && s != null && s.tables[0].rows.length > 0) { var h = t.getValueOfInt(s.tables[0].rows[0].cells.VAM_ReturnRule_id), c = t.getValueOfInt(s.tables[0].rows[0].cells.VAM_DiscountCalculation_id), l = t.getValueOfInt(s.tables[0].rows[0].cells.VAM_PriceList_id); u.setValue("VAM_ReturnRule_ID", h); u.setValue("VAM_DiscountCalculation_ID", c); u.setValue("VAM_PriceList_ID", l) } y && s != null && s.tables[0].rows.length > 0 && (h = t.getValueOfInt(s.tables[0].rows[0].cells.po_returnpolicy_id), c = t.getValueOfInt(s.tables[0].rows[0].cells.po_discountschema_id), l = t.getValueOfInt(s.tables[0].rows[0].cells.po_pricelist_id), u.setValue("PO_ReturnPolicy_ID", h), u.setValue("PO_DiscountSchema_ID", c), u.setValue("PO_PriceList_ID", l)) } catch (p) { this.setCalloutActive(!1); this.log.severe(p.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutBPartner = ar; n.Utility.inheritPrototype(vr, n.CalloutEngine); vr.prototype.DocType = function (i, r, u, f, e, o) { var s, h, c, l, a; if (e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; this.setCalloutActive(!0); try { sql = "SELECT VAM_Product_ID , movementqty , VAM_PFeature_SetInstance_ID FROM VAM_Inv_InOutLine WHERE VAM_Inv_InOutLine_ID=" + t.getValueOfInt(e); s = n.DB.executeDataSet(sql); h = 0; s.getTables().length > 0 && s.getTables()[0].getRows().length > 0 && (c = t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("VAM_Product_ID")), h = t.getValueOfDecimal(s.getTables()[0].getRows()[0].getCell("movementqty")), l = t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("VAM_PFeature_SetInstance_ID"))); sql = "SELECT  SUM(ConfirmedQty + scrappedqty) FROM VAM_PackagingLine WHERE  VAM_Packaging_ID=" + u.getValue("VAM_Packaging_ID") + " and VAM_Inv_InOutLine_id =  " + u.getValue("VAM_Inv_InOutLine_ID"); a = t.getValueOfDecimal(n.DB.executeScalar(sql)); u.setValue("VAM_Product_ID", c); u.setValue("Qty", h - a); u.setValue("VAM_PFeature_SetInstance_ID", l); u.setValue("DTD001_IsConfirm", !0) } catch (v) { this.setCalloutActive(!1); this.log.severe(v.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutshipLine = vr; n.Utility.inheritPrototype(yr, n.CalloutEngine); yr.prototype.SetMaxRunZero = function (n, t, i, r, u, f) { if (u == null || u.toString() == "") return ""; this.setCalloutActive(!0); var e = i.getValue("RunsMax"); return e != "" && e > 0 && i.setValue("RunsRemaining", 0), this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; n.Model.CalloutRecurring = yr; n.Utility.inheritPrototype(pr, n.CalloutEngine); pr.prototype.SetChargeAmount = function (t, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; this.setCalloutActive(!0); try { var s = f.toString(), o = n.dataContext.getJSONRecord("MVAMProductionLine/GetChargeAmt", s); o != null && (r.setValue("Amt", o.ChargeAmt), r.setValue("VAM_Product_ID", null)) } catch (h) { this.setCalloutActive(!1); this.log.severe(h.toString()) } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutProductionLine = pr; n.Utility.inheritPrototype(ti, n.CalloutEngine); ti.prototype.SetDateFromAndDateTo = function (i, r, u, f, e, o) { var h, s, c, l; if (e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { h = e.toString() + "," + i.getVAF_Client_ID().toString(); s = n.dataContext.getJSONRecord("Common/GetPeriodFromYear", h); s != null && (c = t.getValueOfDate(s.STARTDATE), l = t.getValueOfDate(s.ENDDATE), u.setValue("DateFrom", c), u.setValue("DateTo", l)) } catch (a) { this.setCalloutActive(!1); this.log.severe(a.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; ti.prototype.SetCurrency = function (i, r, u, f, e, o) { var h, s, c; if (e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { h = e.toString() + "," + i.getVAF_Client_ID().toString(); s = n.dataContext.getJSONRecord("Common/GetCurrencyFroMVABAccountingSchema", h); s != null && (c = t.getValueOfInt(s.CurrencyID), u.setValue("VAB_Currency_ID", c)) } catch (l) { this.setCalloutActive(!1); this.log.severe(l.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutProfitLoss = ti; n.Utility.inheritPrototype(wr, n.CalloutEngine); wr.prototype.SetQty = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; if (this.setCalloutActive(!0), t.getValueOfDecimal(r.getValue("TargetQty")) < t.getValueOfDecimal(r.getValue("ConfirmedQty"))) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; if (u.getColumnName() == "ConfirmedQty") { if (t.getValueOfDecimal(r.getValue("ConfirmedQty")) < 0) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; r.setValue("ScrappedQty", 0); r.setValue("DifferenceQty", t.getValueOfDecimal(r.getValue("TargetQty")) - (t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty")))) } else if (u.getColumnName() == "ScrappedQty") { if (t.getValueOfDecimal(r.getValue("ScrappedQty")) < 0 || t.getValueOfDecimal(r.getValue("TargetQty")) < t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty"))) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; r.setValue("DifferenceQty", t.getValueOfDecimal(r.getValue("TargetQty")) - (t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty")))) } return this.setCalloutActive(!1), "" }; n.Model.CalloutShipReceiptConfirmLine = wr; n.Utility.inheritPrototype(ri, n.CalloutEngine); ri.prototype.SetBPLocation = function (i, r, u, f, e) { var o, c, s, l, h; if (this.isCalloutActive() || e == null || e.toString() == "") return u.setValue("VAB_BPart_Location_ID", null), ""; this.setCalloutActive(!0); try { if (u.getValue("CashType") == "B" || u.getValue("CashType") == "C") { if (o = u.getValue("VAB_BusinessPartner_ID"), o == null || o == "") return u.setValue("VAB_BPart_Location_ID", null), this.setCalloutActive(!1), ""; if (c = o.toString() + "," + i.getVAF_Client_ID().toString(), s = n.dataContext.getJSONRecord("MCashJournal/GetBPLocation", c), s != null) { if (l = t.getValueOfInt(s.CreditStatusSettingOn), h = t.getValueOfInt(s.VAB_BPart_Location_ID), l == "CL" && h == 0) return this.setCalloutActive(!1), n.Msg.getMsg("LocationNew"); u.setValue("VAB_BPart_Location_ID", h) } } } catch (a) { this.setCalloutActive(!1); this.log.severe(a.toString()) } return this.setCalloutActive(!1), "" }; ri.prototype.setAccountNo = function (i, r, u, f, e) { if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { var o = n.dataContext.getJSONRecord("MCashJournal/GetBankAccountData", e); o != null && (u.setValue("RoutingNo", t.getValueOfString(o.RoutingNo)), u.setValue("AccountNo", t.getValueOfString(o.AccountNo))) } catch (s) { this.setCalloutActive(!1); this.log.severe(s.toString()) } return this.setCalloutActive(!1), "" }; n.Model.CalloutCashJournalLine = ri; n.Utility.inheritPrototype(br, n.CalloutEngine); br.prototype.SetMultiplyRate = function (n, t, i, r, u) { if (this.isCalloutActive() || u == null || u.toString() == "") return i.setValue("MultiplyRate", 0), ""; this.setCalloutActive(!0); var f = i.getValue("VAB_UOM_ID"), e = i.getValue("VAB_UOM_To_ID"); return f == e && (i.setValue("DivideRate", 1), i.setValue("MultiplyRate", 1)), this.setCalloutActive(!1), "" }; n.Model.CalloutUOMConversion = br; n.Utility.inheritPrototype(kr, n.CalloutEngine); kr.prototype.CheckIncoTerm = function (i, r, u, f, e) { if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); var s = i.isSOTrx(r), h = 0, o = ""; try { if (u.getTableName().startsWith("VAB_Order") ? s && t.getValueOfInt(u.getValue("VAB_Order_Quotation")) > 0 ? (o = s + "," + u.getTableName() + ",VAB_Order_Quotation," + t.getValueOfInt(u.getValue("VAB_Order_Quotation")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : !s && t.getValueOfInt(u.getValue("Ref_Order_ID")) > 0 ? (o = s + "," + u.getTableName() + ",Ref_Order_ID," + t.getValueOfInt(u.getValue("Ref_Order_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : t.getValueOfInt(u.getValue("VAB_Order_Blanket")) > 0 && (o = s + "," + u.getTableName() + ",VAB_Order_Blanket," + t.getValueOfInt(u.getValue("VAB_Order_Blanket")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : u.getTableName().startsWith("VAB_Invoice") ? s && t.getValueOfInt(u.getValue("VAB_Order_ID")) > 0 ? (o = s + "," + u.getTableName() + ",VAB_Order_ID," + t.getValueOfInt(u.getValue("VAB_Order_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : !s && t.getValueOfInt(u.getValue("VAB_Order_ID")) > 0 ? (o = s + "," + u.getTableName() + ",VAB_Order_ID," + t.getValueOfInt(u.getValue("VAB_Order_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : !s && t.getValueOfInt(u.getValue("VAM_Inv_InOut_ID")) > 0 && (o = s + "," + u.getTableName() + ",VAM_Inv_InOut_ID," + t.getValueOfInt(u.getValue("VAM_Inv_InOut_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : u.getTableName().startsWith("VAM_Inv_InOut") && (s && t.getValueOfInt(u.getValue("VAB_Order_ID")) > 0 ? (o = s + "," + u.getTableName() + ",VAB_Order_ID," + t.getValueOfInt(u.getValue("VAB_Order_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : !s && t.getValueOfInt(u.getValue("VAB_Order_ID")) > 0 ? (o = s + "," + u.getTableName() + ",VAB_Order_ID," + t.getValueOfInt(u.getValue("VAB_Order_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : !s && t.getValueOfInt(u.getValue("VAB_Invoice_ID")) > 0 && (o = s + "," + u.getTableName() + ",VAB_Invoice_ID," + t.getValueOfInt(u.getValue("VAB_Invoice_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o))), h > 0 & h != e) return this.setCalloutActive(!1), n.ADialog.warn("IncoTermChanged"), "" } catch (c) { this.setCalloutActive(!1); this.log.severe(c.toString()) } return this.setCalloutActive(!1), "" }; n.Model.CalloutIncoTerm = kr; n.Utility.inheritPrototype(gr, n.CalloutEngine); gr.prototype.BlanketOrderRef = function (t, i, r, u, f) { var o, s, e; return this.isCalloutActive() || f == null || f.toString() == "" ? "" : (this.setCalloutActive(!0), u.getColumnName() == "Blanket_Ref_Order_ID" && (o = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), s = o.VA009_ ? f.toString() + "," + o.VA009_ : f.toString() + ",false", e = n.dataContext.getJSONRecord("MOrder/GetOrderHeader", s), e != null && (r.setValue("VAF_Client_ID", e.VAF_Client_ID), r.setValue("VAF_Org_ID", e.VAF_Org_ID), r.setValue("Description", e.Description), r.setValue("VAB_DocTypesTarget_ID", e.VAB_DocTypesTarget_ID), r.setValue("DateOrdered", ui(e.DateOrdered)), r.setValue("DatePromised", ui(e.DatePromised)), r.setValue("OrderValidFrom", ui(e.OrderValidFrom)), r.setValue("OrderValidTo", ui(e.OrderValidTo)), r.setValue("VAB_BusinessPartner_ID", e.VAB_BusinessPartner_ID), r.setValue("Bill_BPartner_ID", e.Bill_BPartner_ID), r.setValue("VAB_BPart_Location_ID", e.VAB_BPart_Location_ID), r.setValue("Bill_Location_ID", e.Bill_Location_ID), r.setValue("VAF_UserContact_ID", e.VAF_UserContact_ID), r.setValue("Bill_User_ID", e.Bill_User_ID), r.setValue("VAM_Warehouse_ID", e.VAM_Warehouse_ID), r.setValue("PriorityRule", e.PriorityRule), r.setValue("VAM_PriceList_ID", e.VAM_PriceList_ID), r.setValue("VAB_IncoTerm_ID", e.VAB_IncoTerm_ID), r.setValue("VAB_Currency_ID", e.VAB_Currency_ID), r.setValue("VAB_CurrencyType_ID", e.VAB_CurrencyType_ID), r.setValue("SalesRep_ID", e.SalesRep_ID), o.VA009_ && r.setValue("VA009_PaymentMethod_ID", e.VA009_PaymentMethod_ID), r.setValue("VAB_PaymentTerm_ID", e.VAB_PaymentTerm_ID), r.setValue("VAB_Promotion_ID", e.VAB_Promotion_ID), r.setValue("VAB_BillingCode_ID", e.VAB_BillingCode_ID), r.setValue("VAF_OrgTrx_ID", e.VAF_OrgTrx_ID), r.setValue("User1_ID", e.User1_ID), r.setValue("User2_ID", e.User2_ID), r.setValue("TotalLines", e.TotalLines), r.setValue("GrandTotal", e.GrandTotal))), this.setCalloutActive(!1), "") }; n.Model.CalloutBlanketOrderRef = gr; n.Utility.inheritPrototype(nu, n.CalloutEngine); nu.prototype.SetLocatorPC = function (n, t, i, r, u, f) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), r.getColumnName() == "VAM_Warehouse_ID" ? u != f && (i.setValue("VAM_Locator_ID", ""), i.setValue("Ref_VAM_Container_ID", "")) : r.getColumnName() == "VAM_Locator_ID" && u != f && i.setValue("Ref_VAM_Container_ID", ""), this.setCalloutActive(!1), n = t = i = r = u = f = null, "") }; n.Model.CalloutLocatorPC = nu; n.Utility.inheritPrototype(tu, n.CalloutEngine); tu.prototype.SetDates = function (n, t, i, r, u, f) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), r.getColumnName() == "VAB_Frequency_ID" && u != f && (i.setValue("StartDate", ""), i.setValue("EndDate", "")), this.setCalloutActive(!1), "") }; n.Model.CalloutSetDates = tu; n.Utility.inheritPrototype(iu, n.CalloutEngine); iu.prototype.Product = function (n, t, i, r, u) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), i.getField("VAM_PFeature_SetInstance_ID") != null && i.setValue("VAM_PFeature_SetInstance_ID", null), this.setCalloutActive(!1), "") }; n.Model.CalloutLandedCost = iu; n.Utility.inheritPrototype(ru, n.CalloutEngine); ru.prototype.Comparedates = function (t, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); var e = new Date(r.getValue("DateWorkStart")), o = new Date(r.getValue("DateWorkComplete")); if (u.getColumnName() == "DateWorkStart") { if (e >= o && r.getValue("DateWorkComplete") != null) return r.setValue("DateWorkStart", ""), this.setCalloutActive(!1), n.ADialog.info("DateWorkGreater") } else if (e >= o && r.getValue("DateWorkStart") != null) return r.setValue("DateWorkComplete", ""), this.setCalloutActive(!1), n.ADialog.info("DateWorkGreater"); return this.setCalloutActive(!1), "" }; n.Model.CalloutRFQ = ru }(VIS, jQuery)
