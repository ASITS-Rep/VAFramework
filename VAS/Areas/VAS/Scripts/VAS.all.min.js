(function(n,t){function i(i){var o,s,h,u,f;this.onClose=null;this.dGrid=null;o="SelectDeselectAll";s=!0;this.arrListColumns=[];this.log=n.Logging.VLogger.getVLogger("VCreateFrom");this.divPaging=null;this.ulPaging=null;this.liFirstPage=null;this.liPrevPage=null;this.liCurrPage=null;this.liNextPage=null;this.liLastPage=null;this.cmbPage=null;h=[];this.multiValues=[];this.editedItems=[];this.NonEditableRecord=[];var r=this,e=n.Application.contextUrl,c=e+"JsonData/JDataSet",l=e+"JsonData/ExecuteNonQuer";this.$root=t("<div style='position:relative'>");this.log=n.Logging.VLogger.getVLogger("VCreateFrom");this.$busyDiv=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>");this.topDiv=t("<div class='vis-locatormainwrap'>");this.middelDiv=t("<div class='vis-crtfrm-datawrp'>");this.bottomDiv=t("<div class='vis-ctrfrm-btnwrp'>");this.divPaging=t("<div>");this.record_ID=0;this.windowNo=i.getWindowNo();this.mTab=i;this.initOK=!1;this.isApplied=!1;u="btnOk_"+this.windowNo;this.Okbtn=t("<input id='"+u+"' class='VIS_Pref_btn-2' type='button' value='"+n.Msg.getMsg("OK")+"'>");u="btnCancel_"+this.windowNo;this.cancelbtn=t("<input id='"+u+"' class='VIS_Pref_btn-2' type='button' value='"+n.Msg.getMsg("Cancel")+"'>");u="btnDelete_"+this.windowNo;f=n.Application.contextUrl+"Areas/VIS/Images/base/uncheck-icon.png";this.selectAllButton=t("<button type='button' id='"+u+"' style='margin-bottom:0px;margin-top:0px;display: none;float: left;padding: 0px;border: 0px;' value='Ok' role='button' aria-disabled='false'><img src='"+f+"'><\/button>");u="btnRefresh_"+this.windowNo;f=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";this.btnRefresh=t("<button id='"+u+"' style='margin-bottom: 1px; margin-top: 0px;display: none; float: left; margin-left: 0px;height: 38px; ' class='VIS_Pref_btn-2'><img src='"+f+"'><\/button>");u="btnApply_"+this.windowNo;this.Applybtn=t("<input id='"+u+"' class='VIS_Pref_btn-2' style='display: none;' type='button' value='"+n.Msg.getMsg("Apply")+"'>");this.lblBankAccount=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblOrder=new n.Controls.VLabel;this.lblInvoice=new n.Controls.VLabel;this.lblShipment=new n.Controls.VLabel;this.lblLocator=new n.Controls.VLabel;this.lblDeliveryDate=new n.Controls.VLabel;this.lblProduct=new n.Controls.VLabel;this.lblDocumentNoRef=new n.Controls.VLabel;this.lblDocumentNo=new n.Controls.VLabel;this.lblDate=new n.Controls.VLabel;this.lblAmount=new n.Controls.VLabel;this.lblDepositSlip=new n.Controls.VLabel;this.lblAuthCode=new n.Controls.VLabel;this.lblCheckNo=new n.Controls.VLabel;this.lblContainer=null;f=n.Application.contextUrl+"Areas/VIS/Images/pallet-icon.png";this.ContainerTree=t("<img id='ContainerTree_"+this.windowNo+"' style='height: 27px;' class='pull-left VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled' src='"+f+"'>");this.DocumentNo=null;this.Date=null;this.Amount=null;this.DepositSlip=null;this.AuthCode=null;this.CheckNo=null;this.fromInvoice=!1;this.deliveryDate=null;this.cmbOrder=new n.Controls.VComboBox("",!1,!1,!0);this.cmbInvoice=new n.Controls.VComboBox("",!1,!1,!0);this.cmbShipment=new n.Controls.VComboBox("",!1,!1,!0);this.cmbContainer=null;this.DocumentNoRef=null;this.vProduct=null;this.cmbBankAccount=null;this.vBPartner=null;this.locatorField=null;this.child=null;this.relatedToOrg=new n.Controls.VCheckBox("Related To My Organization",!1,!1,!0,"Related To My Organization",null);this.pattrLookup=new n.MPAttributeLookup(n.context,r.windowNo);this.$productAttribute=new n.Controls.VPAttribute("M_AttributeSetInstance_ID",!1,!1,!0,n.DisplayType.PAttribute,r.pattrLookup,r.windowNo,!1,!1,!1,!0);this.title="";this.vetoablechange=function(t){var f;if(t.propertyName=="M_Product_ID"){r.isApplied=!1;r.setBusy(!0);r.multiValues=[];r.dGrid!=null&&(r.dGrid.destroy(),r.dGrid=null);var u=r.cmbOrder.getControl().find("option:selected").val(),e=r.cmbInvoice.getControl().find("option:selected").val(),o=r.cmbShipment.getControl().find("option:selected").val(),i=r.vProduct.getValue(),s=r.deliveryDate.getValue();u!=null?r.locatorField!=null?r.loadOrders(u,i,s,!1,1):r.loadOrders(u,i,s,!0,1):e!=null?n.VCreateFromShipment.prototype.loadInvoices(e,i,1):o!=null?n.VCreateFromInvoice.prototype.loadShipments(o,i,1):r.setBusy(!1)}else if(t.propertyName=="C_BPartner_ID"){r.setBusy(!0);r.multiValues=[];r.dGrid!=null&&(r.dGrid.destroy(),r.dGrid=null);var h=r.cmbBankAccount.getControl().find("option:selected").val(),c=r.Date.getValue(),l=r.vBPartner.getValue(),a=r.DepositSlip.getValue(),v=r.DocumentNo.getValue(),y=r.AuthCode.getValue(),p=r.CheckNo.getValue(),w=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(h,l,c,v,a,y,p,w,1)}else t.propertyName=="M_Locator_ID"?r.locatorField!=null&&(r.isApplied=!1,f=parseInt(r.locatorField.getValue()),f>0&&n.VCreateFromShipment.prototype.initContainerDetails(f)):this.locatorField.setBackground("")};this.createPageSettings=function(){this.ulPaging=t('<ul class="vis-statusbar-ul">');this.liFirstPage=t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="First Page" style="opacity: 0.6;"><\/i><\/div><\/li>');this.liPrevPage=t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="Page Up" style="opacity: 0.6;"><\/i><\/div><\/li>');this.cmbPage=t("<select>");this.liCurrPage=t("<li>").append(this.cmbPage);this.liNextPage=t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="Page Down" style="opacity: 0.6;"><\/i><\/div><\/li>');this.liLastPage=t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="Last Page" style="opacity: 0.6;"><\/i><\/div><\/li>');this.ulPaging.append(this.liFirstPage).append(this.liPrevPage).append(this.liCurrPage).append(this.liNextPage).append(this.liLastPage);this.pageEvents()};this.pageEvents=function(){this.liFirstPage.on("click",function(){var i,u;if(t(this).css("opacity")=="1"){r.setBusy(!0);var f=r.cmbOrder.getControl().find("option:selected").val(),o=r.cmbInvoice.getControl().find("option:selected").val(),s=r.cmbShipment.getControl().find("option:selected").val(),e=null;if(r.cmbBankAccount!=null&&(e=r.cmbBankAccount.getControl().find("option:selected").val()),i=null,u=null,r.vProduct!=null&&(i=r.vProduct.getValue()),r.deliveryDate!=null&&(u=r.deliveryDate.getValue()),f!=null)r.locatorField!=null?r.loadOrders(f,i,u,!1,1):r.loadOrders(f,i,u,!0,1);else if(o!=null)n.VCreateFromShipment.prototype.loadInvoices(o,i,1);else if(s!=null)n.VCreateFromInvoice.prototype.loadShipments(s,i,1);else if(e!=null){var h=r.Date.getValue(),c=r.vBPartner.getValue(),l=r.DepositSlip.getValue(),a=r.DocumentNo.getValue(),v=r.AuthCode.getValue(),y=r.CheckNo.getValue(),p=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(e,c,h,a,l,v,y,p,1)}}});this.liPrevPage.on("click",function(){var i,u;if(t(this).css("opacity")=="1"){r.setBusy(!0);var f=r.cmbOrder.getControl().find("option:selected").val(),o=r.cmbInvoice.getControl().find("option:selected").val(),s=r.cmbShipment.getControl().find("option:selected").val(),e=null;if(r.cmbBankAccount!=null&&(e=r.cmbBankAccount.getControl().find("option:selected").val()),i=null,u=null,r.vProduct!=null&&(i=r.vProduct.getValue()),r.deliveryDate!=null&&(u=r.deliveryDate.getValue()),f!=null)r.locatorField!=null?r.loadOrders(f,i,u,!1,parseInt(r.cmbPage.val())-1):r.loadOrders(f,i,u,!0,parseInt(r.cmbPage.val())-1);else if(o!=null)n.VCreateFromShipment.prototype.loadInvoices(o,i,parseInt(r.cmbPage.val())-1);else if(s!=null)n.VCreateFromInvoice.prototype.loadShipments(s,i,parseInt(r.cmbPage.val())-1);else if(e!=null){var h=r.Date.getValue(),c=r.vBPartner.getValue(),l=r.DepositSlip.getValue(),a=r.DocumentNo.getValue(),v=r.AuthCode.getValue(),y=r.CheckNo.getValue(),p=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(e,c,h,a,l,v,y,p,parseInt(r.cmbPage.val())-1)}}});this.liNextPage.on("click",function(){var i,u;if(t(this).css("opacity")=="1"){r.setBusy(!0);var f=r.cmbOrder.getControl().find("option:selected").val(),o=r.cmbInvoice.getControl().find("option:selected").val(),s=r.cmbShipment.getControl().find("option:selected").val(),e=null;if(r.cmbBankAccount!=null&&(e=r.cmbBankAccount.getControl().find("option:selected").val()),i=null,u=null,r.vProduct!=null&&(i=r.vProduct.getValue()),r.deliveryDate!=null&&(u=r.deliveryDate.getValue()),f!=null)r.locatorField!=null?r.loadOrders(f,i,u,!1,parseInt(r.cmbPage.val())+1):r.loadOrders(f,i,u,!0,parseInt(r.cmbPage.val())+1);else if(o!=null)n.VCreateFromShipment.prototype.loadInvoices(o,i,parseInt(r.cmbPage.val())+1);else if(s!=null)n.VCreateFromInvoice.prototype.loadShipments(s,i,parseInt(r.cmbPage.val())+1);else if(e!=null){var h=r.Date.getValue(),c=r.vBPartner.getValue(),l=r.DepositSlip.getValue(),a=r.DocumentNo.getValue(),v=r.AuthCode.getValue(),y=r.CheckNo.getValue(),p=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(e,c,h,a,l,v,y,p,parseInt(r.cmbPage.val())+1)}}});this.liLastPage.on("click",function(){var i,u;if(t(this).css("opacity")=="1"){r.setBusy(!0);var f=r.cmbOrder.getControl().find("option:selected").val(),o=r.cmbInvoice.getControl().find("option:selected").val(),s=r.cmbShipment.getControl().find("option:selected").val(),e=null;if(r.cmbBankAccount!=null&&(e=r.cmbBankAccount.getControl().find("option:selected").val()),i=null,u=null,r.vProduct!=null&&(i=r.vProduct.getValue()),r.deliveryDate!=null&&(u=r.deliveryDate.getValue()),f!=null)r.locatorField!=null?r.loadOrders(f,i,u,!1,parseInt(r.cmbPage.find("Option:last").val())):r.loadOrders(f,i,u,!0,parseInt(r.cmbPage.find("Option:last").val()));else if(o!=null)n.VCreateFromShipment.prototype.loadInvoices(o,i,parseInt(r.cmbPage.find("Option:last").val()));else if(s!=null)n.VCreateFromInvoice.prototype.loadShipments(s,i,parseInt(r.cmbPage.find("Option:last").val()));else if(e!=null){var h=r.Date.getValue(),c=r.vBPartner.getValue(),l=r.DepositSlip.getValue(),a=r.DocumentNo.getValue(),v=r.AuthCode.getValue(),y=r.CheckNo.getValue(),p=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(e,c,h,a,l,v,y,p,parseInt(r.cmbPage.find("Option:last").val()))}}});this.cmbPage.on("change",function(){var t,i;r.setBusy(!0);var u=r.cmbOrder.getControl().find("option:selected").val(),e=r.cmbInvoice.getControl().find("option:selected").val(),o=r.cmbShipment.getControl().find("option:selected").val(),f=null;if(r.cmbBankAccount!=null&&(f=r.cmbBankAccount.getControl().find("option:selected").val()),t=null,i=null,r.vProduct!=null&&(t=r.vProduct.getValue()),r.deliveryDate!=null&&(i=r.deliveryDate.getValue()),u!=null)r.locatorField!=null?r.loadOrders(u,t,i,!1,r.cmbPage.val()):r.loadOrders(u,t,i,!0,r.cmbPage.val());else if(e!=null)n.VCreateFromShipment.prototype.loadInvoices(e,t,r.cmbPage.val());else if(o!=null)n.VCreateFromInvoice.prototype.loadShipments(o,t,r.cmbPage.val());else if(f!=null){var s=r.Date.getValue(),h=r.vBPartner.getValue(),c=r.DepositSlip.getValue(),l=r.DocumentNo.getValue(),a=r.AuthCode.getValue(),v=r.CheckNo.getValue(),y=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(f,h,s,l,c,a,v,y,r.cmbPage.val())}})};this.resetPageCtrls=function(n){if(this.cmbPage.empty(),n.TotalPage>0){for(var i=0;i<n.TotalPage;i++)this.cmbPage.append(t("<option value="+(i+1)+">"+(i+1)+"<\/option>"));this.cmbPage.val(n.CurrentPage);n.TotalPage>n.CurrentPage?(this.liNextPage.css("opacity","1"),this.liLastPage.css("opacity","1")):(this.liNextPage.css("opacity","0.6"),this.liLastPage.css("opacity","0.6"));n.CurrentPage>1?(this.liFirstPage.css("opacity","1"),this.liPrevPage.css("opacity","1")):(this.liFirstPage.css("opacity","0.6"),this.liPrevPage.css("opacity","0.6"));n.TotalPage==1&&(this.liFirstPage.css("opacity","0.6"),this.liPrevPage.css("opacity","0.6"),this.liNextPage.css("opacity","0.6"),this.liLastPage.css("opacity","0.6"))}else this.liFirstPage.css("opacity","0.6"),this.liPrevPage.css("opacity","0.6"),this.liNextPage.css("opacity","0.6"),this.liLastPage.css("opacity","0.6")};this.setBusy=function(n){this.$busyDiv.css("display",n?"block":"none")};this.MergeItemsForSave=function(){var f=r.cmbOrder.getControl().find("option:selected").val(),e=r.cmbInvoice.getControl().find("option:selected").val(),o=r.cmbShipment.getControl().find("option:selected").val(),n,i,u;if(r.editedItems.length>0)for(n in r.editedItems)i=r.editedItems[n].M_Product_ID_K,u=t.grep(r.multiValues,function(t){return f!=null?t.M_Product_ID_K==i&&t.C_Order_ID_K==r.editedItems[n].C_Order_ID_K:e!=null?t.M_Product_ID_K==i&&t.C_Invoice_ID_K==r.editedItems[n].C_Invoice_ID_K:o!=null?t.M_Product_ID_K==i&&t.M_InOut_ID_K==r.editedItems[n].M_InOut_ID_K:t.C_Payment_ID_K==r.editedItems[n].C_Payment_ID_K}),u.length>0||r.multiValues.push(r.editedItems[n])};this.showDialog=function(){this.locatorField&&(this.locatorField.setBackground(!1),this.locatorField.addVetoableChangeListener(this));this.vProduct&&this.vProduct.addVetoableChangeListener(this);this.vBPartner&&this.vBPartner.addVetoableChangeListener(this);var n=this;this.$root.append(this.$busyDiv);this.setBusy(!1);this.$root.dialog({modal:!0,title:this.title,width:900,height:600,resizable:!1,position:{at:"center top",of:window},close:function(){n.dispose();n.dGrid!=null&&n.dGrid.destroy();r=null;n.$root.dialog("destroy");n.$root=null}})};this.disposeComponent=function(){r=null;this.Okbtn&&this.Okbtn.off("click");this.cancelbtn&&this.cancelbtn.off("click");this.selectAllButton&&this.selectAllButton.off("click");this.btnRefresh&&this.btnRefresh.off("click");this.Applybtn&&this.Applybtn.off("click");this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};i.prototype.create=function(t){var i=n.Env.getCtx().getContextAsInt(t.getWindowNo(),"BaseTable_ID"),r=null;if(i==392)r=new n.VCreateFromStatement(t);else if(i==318)r=new n.VCreateFromInvoice(t);else if(i==319)r=new n.VCreateFromShipment(t);else return i==426?null:null;return r};i.prototype.initBPDetails=function(n){return n};i.prototype.initBPartner=function(t){var r=n.MLookupFactory.getMLookUp(n.Env.getCtx(),this.windowNo,3499,n.DisplayType.Search),i;return this.vBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,r),i=n.Env.getCtx().getContextAsInt(this.windowNo,"C_BPartner_ID"),this.vBPartner.setValue(i),this.initBPartnerOIS(i,t)};i.prototype.initBPartnerOIS=function(i,r){var e=this.cmbOrder,u,f;return t(e).html(""),u=!1,r?(f=n.dataContext.getJSONRecord("MDocType/GetDocType",n.Env.getCtx().getContextAsInt(this.windowNo,"C_DocTypeTarget_ID").toString()),u=n.Utility.Util.getValueOfBoolean(f.IsReturnTrx)):u="Y".equals(n.Env.getCtx().getWindowContext(this.windowNo,"IsReturnTrx")),this.getOrders(n.Env.getCtx(),i,u,r),this.initBPDetails(i)};i.prototype.getOrders=function(i,r,u,f){var o="o.DocumentNo||' - ' ||".concat(n.DB.to_char("o.DateOrdered",n.DisplayType.Date,n.Env.getVAF_Language(i))).concat("||' - '||").concat(n.DB.to_char("o.GrandTotal",n.DisplayType.Amount,n.Env.getVAF_Language(i))),e="m.M_InOutLine_ID";f&&(e="m.C_InvoiceLine_ID");var s=n.Env.getCtx().getContextAsInt(this.windowNo,"VAF_Org_ID"),h="Y".equals(n.Env.getCtx().getWindowContext(this.windowNo,"IsDropShip")),c="Y".equals(n.Env.getCtx().getWindowContext(this.windowNo,"IsSOTrx")),l=n.context.getWindowContextAsInt(this.windowNo,"C_Invoice_ID",!0);t.ajax({url:n.Application.contextUrl+"VCreateFrom/VCreateGetOrders",type:"POST",data:{displays:o,columns:e,C_BPartner_IDs:r,isReturnTrxs:u,OrgIds:s,IsDrop:h,IsSOTrx:c,forInvoices:f,recordID:l},success:function(t){var r=t.result,u,f,i;if(r&&r.length>0)try{for(i=0;i<r.length;i++)u=n.Utility.Util.getValueOfInt(r[i].key),f=n.Utility.encodeText(r[i].value),i==0&&$self.cmbOrder.getControl().append(" <option value=0> <\/option>"),$self.cmbOrder.getControl().append(" <option value="+u+">"+f+"<\/option>");$self.cmbOrder.getControl().prop("selectedIndex",0)}catch(e){}},error:function(n){$self.log.info(n)}})};i.prototype.jbInit=function(){this.init();this.lblBankAccount.getControl().text(n.Msg.getMsg("BankAcctCurrency"));this.lblBPartner.getControl().text(n.Msg.getMsg("BusinessPartner"));this.lblOrder.getControl().text(n.Msg.getMsg("Order"));this.lblInvoice.getControl().text(n.Msg.getMsg("Invoice"));this.lblShipment.getControl().text(n.Msg.getMsg("Shipment/Receipt"));this.lblLocator.getControl().text(n.Msg.getMsg("M_Locator_ID"));this.lblDeliveryDate.getControl().text(n.Msg.getMsg("DeliveryDate"));this.lblProduct.getControl().text(n.Msg.getMsg("ProductName"));this.lblDocumentNoRef.getControl().text(n.Msg.getMsg("DocumentNo"));this.lblDocumentNo.getControl().text(n.Msg.getMsg("DocumentNo"));this.lblDate.getControl().text(n.Msg.getMsg("DateAcct"));this.lblAmount.getControl().text(n.Msg.getMsg("Amount"));this.lblDepositSlip.getControl().text(n.Msg.getMsg("DepositSlipNo"));this.lblAuthCode.getControl().text(n.Msg.getMsg("AuthCode"));this.lblCheckNo.getControl().text(n.Msg.getMsg("CheckNo"));var e=t("<div class='VIS_Pref_show'>"),u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"),f=t("<div class='input-group-append'>");this.topDiv.append(e);e.append(u);u.append(r);r.append(i);r.append(f);this.vBPartner!=null&&(this.cmbBankAccount!=null?(i.append(this.vBPartner.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," ")),f.append(this.vBPartner.getBtn(0)),f.append(this.vBPartner.getBtn(1))):(i.append(this.vBPartner.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," ")),f.append(this.vBPartner.getBtn(0))),i.append(this.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")));u=t("<div class='VIS_Pref_dd'>");r=t("<div class='input-group vis-input-wrap'><\/div>");i=t("<div class='vis-control-wrap'><\/div>");f=t("<div class='input-group-append'>");e.append(u);u.append(r);r.append(i);r.append(f);n.Application.isRTL?this.vBPartner!=null&&(this.cmbBankAccount!=null?(i.append(this.vBPartner.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," ")),f.append(this.vBPartner.getBtn(0)),f.append(this.vBPartner.getBtn(1))):(i.append(this.vBPartner.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," ")),f.append(this.vBPartner.getBtn(0))),i.append(this.lblBPartner.getControl().addClass("VIS_Pref_Label_Font"))):this.cmbBankAccount!=null?(i.append(this.cmbBankAccount.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblBankAccount.getControl().addClass("VIS_Pref_Label_Font"))):this.DocumentNoRef!=null&&(i.append(this.DocumentNoRef.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblDocumentNoRef.getControl().addClass("VIS_Pref_Label_Font")));e=t("<div class='VIS_Pref_show'>");this.Amount!=null?(u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>")):(u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"));this.topDiv.append(e);e.append(u);u.append(r);r.append(i);n.Application.isRTL?this.Date!=null&&(u.append(r),i.append(this.Date.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblDate.getControl().addClass("VIS_Pref_Label_Font"))):this.DocumentNo!=null&&(u.append(r),i.append(this.DocumentNo.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblDocumentNo.getControl().addClass("VIS_Pref_Label_Font")));n.Application.isRTL?(this.cmbInvoice!=null&&(u.append(r),i.append(this.cmbInvoice.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblInvoice.getControl().addClass("VIS_Pref_Label_Font"))),this.cmbShipment!=null&&(u.append(r),i.append(this.cmbShipment.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblShipment.getControl().addClass("VIS_Pref_Label_Font")))):this.cmbOrder!=null&&(u.append(r),i.append(this.cmbOrder.getControl()),i.append(this.lblOrder.getControl().addClass("VIS_Pref_Label_Font")));this.Amount!=null&&(u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"),e.append(u),u.append(r),r.append(i),i.append(this.Amount.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblAmount.getControl().addClass("VIS_Pref_Label_Font")));this.Amount!=null?(u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>")):(u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"));e.append(u);u.append(r);r.append(i);n.Application.isRTL?this.cmbOrder!=null&&(i.append(this.cmbOrder.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblOrder.getControl().addClass("VIS_Pref_Label_Font"))):(this.cmbInvoice!=null&&(i.append(this.cmbInvoice.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblInvoice.getControl().addClass("VIS_Pref_Label_Font"))),this.cmbShipment!=null&&(i.append(this.cmbShipment.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblShipment.getControl().addClass("VIS_Pref_Label_Font"))));n.Application.isRTL?this.DocumentNo!=null&&(i.append(this.DocumentNo.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblDocumentNo.getControl().addClass("VIS_Pref_Label_Font"))):this.Date!=null&&(i.append(this.Date.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblDate.getControl().addClass("VIS_Pref_Label_Font")));(this.locatorField!=null||this.cmbContainer!=null)&&(this.middelDiv.css("height","48.5%"),e=t("<div class='VIS_Pref_show'>"),u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"),f=t("<div class='input-group-append'>"),this.topDiv.append(e),e.append(u),u.append(r),r.append(i),r.append(f),n.Application.isRTL?this.cmbContainer!=null&&(u.css("visibility","hidden"),n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"]!=undefined&&n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y",!0)&&(u.css("visibility","visible"),this.ContainerTree.removeClass("VIS_Tree-Container-disabled")),i.append(this.cmbContainer.getControl().attr("disabled",!0).attr("data-placeholder","").attr("placeholder"," ")),f.append(this.ContainerTree),i.append(this.lblContainer.getControl().addClass("VIS_Pref_Label_Font"))):this.locatorField!=null&&(i.append(this.locatorField.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," ")),f.append(this.locatorField.getBtn(0)),i.append(this.lblLocator.getControl().addClass("VIS_Pref_Label_Font"))),u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"),f=t("<div class='input-group-append'>"),e.append(u),u.append(r),r.append(i),r.append(f),n.Application.isRTL?this.locatorField!=null&&(i.append(this.locatorField.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," ")),f.append(this.locatorField.getBtn(0)),i.append(this.lblLocator.getControl().addClass("VIS_Pref_Label_Font"))):this.cmbContainer!=null&&(u.css("visibility","hidden"),n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"]!=undefined&&n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y",!0)&&(u.css("visibility","visible"),this.ContainerTree.removeClass("VIS_Tree-Container-disabled")),i.append(this.cmbContainer.getControl().attr("disabled",!0).attr("data-placeholder","").attr("placeholder"," ")),f.append(this.ContainerTree),i.append(this.lblContainer.getControl().addClass("VIS_Pref_Label_Font"))));e=t("<div class='VIS_Pref_show'>");this.CheckNo!=null?(u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"),f=t("<div class='input-group-append'>")):(u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"),f=t("<div class='input-group-append'>"));this.topDiv.append(e);e.append(u);u.append(r);r.append(i);r.append(f);n.Application.isRTL?this.AuthCode!=null&&(i.append(this.AuthCode.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblAuthCode.getControl().addClass("VIS_Pref_Label_Font"))):this.DepositSlip!=null&&(i.append(this.DepositSlip.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblDepositSlip.getControl().addClass("VIS_Pref_Label_Font")));n.Application.isRTL?this.vProduct!=null&&(i.append(this.vProduct.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," ")),f.append(this.vProduct.getBtn(0)),f.append(this.vProduct.getBtn(1)),i.append(this.lblProduct.getControl().addClass("VIS_Pref_Label_Font"))):this.deliveryDate!=null&&(i.append(this.deliveryDate.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblDeliveryDate.getControl().addClass("VIS_Pref_Label_Font")));this.CheckNo!=null&&(u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"),e.append(u),u.append(r),r.append(i),i.append(this.CheckNo.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblCheckNo.getControl().addClass("VIS_Pref_Label_Font")));this.CheckNo!=null?(u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>")):(u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"),f=t("<div class='input-group-append'>"));e.append(u);u.append(r);r.append(i);r.append(f);n.Application.isRTL?this.deliveryDate!=null&&(i.append(this.deliveryDate.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblDeliveryDate.getControl().addClass("VIS_Pref_Label_Font"))):this.vProduct!=null&&(i.append(this.vProduct.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," ")),f.append(this.vProduct.getBtn(0)),f.append(this.vProduct.getBtn(1)),i.append(this.lblProduct.getControl().addClass("VIS_Pref_Label_Font")));n.Application.isRTL?this.DepositSlip!=null&&(i.append(this.DepositSlip.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblDepositSlip.getControl().addClass("VIS_Pref_Label_Font"))):this.AuthCode!=null&&(i.append(this.AuthCode.getControl().attr("data-placeholder","").attr("placeholder"," ")),i.append(this.lblAuthCode.getControl().addClass("VIS_Pref_Label_Font")));this.relatedToOrg!=null&&(e=t("<div class='VIS_Pref_show'>"),u=t("<div class='VIS_Pref_dd'>"),r=t("<div class='input-group vis-input-wrap'><\/div>"),i=t("<div class='vis-control-wrap'><\/div>"),this.topDiv.append(e),e.append(u),u.append(r),r.append(i),i.append(this.relatedToOrg.getControl()))};i.prototype.init=function(){this.createPageSettings();this.divPaging.append(this.ulPaging);this.$root.append(this.topDiv).append(this.middelDiv).append(this.divPaging).append(this.bottomDiv);this.bottomDiv.append(this.selectAllButton);this.bottomDiv.append(this.btnRefresh);this.bottomDiv.append(this.cancelbtn);this.bottomDiv.append(this.Applybtn);this.bottomDiv.append(this.Okbtn);this.bottomDiv.append(this.divPaging);this.middelDiv.append(this.dGrid);$self=this;this.Okbtn.on("click",function(){var r;if($self.isApplied){$self.$root.dialog("close");return}$self.setBusy(!0);var u=$self.cmbOrder.getControl().find("option:selected").val(),f=$self.cmbInvoice.getControl().find("option:selected").val(),e=$self.cmbShipment.getControl().find("option:selected").val(),i=null;if($self.dGrid!=null&&(i=$self.dGrid.getSelection()),i==null||i.length==0){n.ADialog.info("RecordSelectionRequired");$self.setBusy(!1);return}if($self.locatorField!=null){if($self.dGrid!=null&&u!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.get(i[item]).C_Order_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));else if($self.dGrid!=null&&f!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Invoice_ID_K==$self.dGrid.get(i[item]).C_Invoice_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));$self.MergeItemsForSave();n.VCreateFromShipment.prototype.saveMInOut(!1)}else if($self.cmbBankAccount!=null){if($self.dGrid!=null)for(item in i){if($self.dGrid.get(i[item]).Date=="")return n.ADialog.error("VIS_PLAccountDate"),!1;r=t.grep($self.multiValues,function(n){return n.C_Payment_ID_K==$self.dGrid.get(i[item]).C_Payment_ID_K});r.length>0||$self.multiValues.push($self.dGrid.get(i[item]))}n.VCreateFromStatement.prototype.saveStatment();$self.middelDiv.css("height","61%")}else{if($self.dGrid!=null&&u!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.get(i[item]).C_Order_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));if($self.dGrid!=null&&e!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_InOut_ID_K&&n.M_InOut_ID_K==$self.dGrid.get(i[item]).M_InOut_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));n.VCreateFromInvoice.prototype.saveInvoice()}});this.Applybtn.on("click",function(){var r;$self.setBusy(!0);var u=$self.cmbOrder.getControl().find("option:selected").val(),f=$self.cmbInvoice.getControl().find("option:selected").val(),e=$self.cmbShipment.getControl().find("option:selected").val(),i=null;if($self.dGrid!=null&&(i=$self.dGrid.getSelection()),i==null||i.length==0){n.ADialog.info("RecordSelectionRequired");$self.setBusy(!1);return}if($self.locatorField!=null){if($self.dGrid!=null&&u!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.get(i[item]).C_Order_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));else if($self.dGrid!=null&&f!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Invoice_ID_K==$self.dGrid.get(i[item]).C_Invoice_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));$self.MergeItemsForSave();n.VCreateFromShipment.prototype.saveMInOut(!0)}else if($self.cmbBankAccount!=null){if($self.dGrid!=null)for(item in i){if($self.dGrid.get(i[item]).Date=="")return n.ADialog.error("VIS_PLAccountDate"),!1;r=t.grep($self.multiValues,function(n){return n.C_Payment_ID_K==$self.dGrid.get(i[item]).C_Payment_ID_K});r.length>0||$self.multiValues.push($self.dGrid.get(i[item]))}n.VCreateFromStatement.prototype.saveStatment();$self.middelDiv.css("height","61%")}else{if($self.dGrid!=null&&u!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.get(i[item]).C_Order_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));if($self.dGrid!=null&&e!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_InOut_ID_K&&n.M_InOut_ID_K==$self.dGrid.get(i[item]).M_InOut_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));n.VCreateFromInvoice.prototype.saveInvoice()}});i.prototype.callBackSave=function(t){if(t==!1)$self.setBusy(!1);else{$self.isApplied=!0;n.ADialog.info("VIS_SuccessFullyInserted",null,null,null);var i=$self.cmbOrder.getControl().find("option:selected").val(),r=$self.cmbInvoice.getControl().find("option:selected").val(),e=$self.cmbShipment.getControl().find("option:selected").val(),u=$self.vProduct.getValue(),f=$self.deliveryDate.getValue();(i>0||r>0)&&($self.locatorField!=null?($self.dGrid.selectNone(),i>0&&($self.multiValues=[],$self.loadOrders(i,u,f,!1,1)),r>0&&($self.multiValues=[],n.VCreateFromShipment.prototype.loadInvoices(r,u,1)),$self.dGrid.selectNone(),$self.editedItems=[]):($self.dGrid.selectNone(),i>0&&($self.multiValues=[],$self.loadOrders(i,u,f,!0,1)),r>0&&($self.multiValues=[],n.VCreateFromShipment.prototype.loadInvoices(r,u,1)),$self.dGrid.selectNone(),$self.editedItems=[]))}};this.cancelbtn.on("click",function(){$self.setBusy(!1);$self.$root.dialog("close")});this.selectAllButton.on("click",function(){});if(this.relatedToOrg)this.relatedToOrg.getControl().on("click",function(){var n,t,i;$self.isApplied=!1;$self.setBusy(!0);$self.multiValues=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);n=$self.cmbOrder.getControl().find("option:selected").val();n!=null?($self.cmbInvoice.getControl().prop("selectedIndex",-1),$self.cmbShipment.getControl().prop("selectedIndex",-1),t=$self.vProduct.getValue(),i=$self.deliveryDate.getValue(),$self.loadOrders(n,t,i,!1,1)):$self.setBusy(!1)});if(this.btnRefresh)this.btnRefresh.on("click",function(){var t;if($self.cmbBankAccount!=null&&($self.setBusy(!0),t=$self.cmbBankAccount.getControl().find("option:selected").val(),t)){var i=$self.Date.getValue(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(t,r,i,f,u,e,o,s,$self.cmbPage.val())}});if(this.cmbOrder&&this.cmbOrder.getControl().change(function(){var n,t,i;$self.isApplied=!1;$self.setBusy(!0);$self.editedItems=[];$self.multiValues=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);n=$self.cmbOrder.getControl().find("option:selected").val();$self.cmbInvoice.getControl().prop("selectedIndex",-1);$self.cmbShipment.getControl().prop("selectedIndex",-1);$self.lblDeliveryDate.setVisible(!0);$self.deliveryDate.setVisible(!0);t=$self.vProduct.getValue();i=$self.deliveryDate.getValue();$self.locatorField!=null?$self.loadOrders(n,t,i,!1,1):$self.loadOrders(n,t,i,!0,1)}),this.cmbBankAccount&&this.cmbBankAccount.getControl().change(function(){var t;if($self.editedItems=[],$self.setBusy(!0),t=$self.cmbBankAccount.getControl().find("option:selected").val(),t){n.VCreateFromStatement.prototype.initBPartner(t);$self.Date.setValue("");$self.DepositSlip.setValue("");$self.DocumentNo.setValue("");$self.AuthCode.setValue("");var i=$self.vBPartner.getValue(),r=$self.Date.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(t,i,r,f,u,e,o,s,1)}}),this.Date&&this.Date.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.DocumentNo&&this.DocumentNo.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.DepositSlip&&this.DepositSlip.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.AuthCode&&this.AuthCode.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.CheckNo&&this.CheckNo.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.Amount&&this.Amount.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.cmbInvoice&&this.cmbInvoice.getControl().change(function(){$self.isApplied=!1;$self.setBusy(!0);$self.editedItems=[];$self.multiValues=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.cmbInvoice.getControl().find("option:selected").val(),i=$self.vProduct.getValue();$self.cmbOrder.getControl().prop("selectedIndex",-1);$self.cmbShipment.getControl().prop("selectedIndex",-1);$self.lblDeliveryDate.setVisible(!1);$self.deliveryDate.setVisible(!1);n.VCreateFromShipment.prototype.loadInvoices(t,i,1)}),this.cmbShipment&&this.cmbShipment.getControl().change(function(){$self.setBusy(!0);$self.editedItems=[];$self.multiValues=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.cmbShipment.getControl().find("option:selected").val(),i=$self.vProduct.getValue();$self.cmbOrder.getControl().prop("selectedIndex",-1);$self.cmbInvoice.getControl().prop("selectedIndex",-1);$self.lblDeliveryDate.setVisible(!1);$self.deliveryDate.setVisible(!1);n.VCreateFromInvoice.prototype.loadShipments(t,i,1)}),this.deliveryDate&&this.deliveryDate.getControl().change(function(){$self.isApplied=!1;$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var n=$self.cmbOrder.getControl().find("option:selected").val(),t=$self.vProduct.getValue(),i=$self.deliveryDate.getValue();$self.locatorField!=null?$self.loadOrders(n,t,i,!1,1):$self.loadOrders(n,t,i,!0,1)}),this.ContainerTree)this.ContainerTree.on("click",function(){var i,t;(n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"]==undefined||n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y",!0))&&(i=$self.locatorField.getValue(),i>0&&(t=new n.productContainerTree(0,i,0),t!=null&&(t.showDialog(),t.onClosing=function(n,t){$self.cmbContainer.getControl().empty();$self.cmbContainer.getControl().append(" <option value="+n+">"+t+"<\/option>")}),t=null),i=null)})};i.prototype.isInitOK=function(){return this.initOK};i.prototype.loadOrders=function(t,i,r,u,f){var e=this.getOrdersData(n.Env.getCtx(),t,i,r,u,f)};i.prototype.getOrdersData=function(i,r,u,f,e,o){var h,v,p,s;if($self.dGrid!=null){h=$self.dGrid.getSelection();for(item in h)v=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(h[item]).M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.get(h[item]).C_Order_ID_K}),v.length>0||$self.multiValues.push($self.dGrid.get(h[item]))}if($self.mTab.keyColumnName=="M_InOut_ID"?$self.record_ID=$self.mTab.getValue("M_InOut_ID"):$self.mTab.keyColumnName=="C_Invoice_ID"&&($self.record_ID=$self.mTab.getValue("C_Invoice_ID")),$self.relatedToOrg.getValue()){var c="",l="",a="",y="";o||(o=1);c=n.Env.isBaseLanguage(i,"C_UOM")?" LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)":" LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.VAF_Language='"+n.Env.getVAF_Language(i).concat("')");u!=null&&(l=" AND l.M_Product_ID="+u);f!=null&&(s=n.DB.to_date(f,!0),y=s,a=" AND l.DatePromised <= "+s);p=$self.mTab.getValue("VAF_Org_ID");t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetOrdersDataCommon",dataType:"json",type:"POST",data:{keyColumnName:$self.mTab.keyColumnName,tableName:"C_OrderLine",recordID:$self.record_ID,pageNo:o,forInvoicees:e,C_Ord_IDs:r,isBaseLangess:c,MProductIDss:l,DelivDates:a,adOrgIDSs:p},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));$self.setBusy(!1);$self.log.info(t);return},success:function(t){var i=JSON.parse(t);if(i.Error){n.ADialog.error(i.Error);$self.setBusy(!1);return}$self.resetPageCtrls(i.pSetting);$self.loadGrid(i.data);$self.setBusy(!1)}})}else{var c="",l="",a="",y="";c=n.Env.isBaseLanguage(i,"C_UOM")?" LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)":" LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.VAF_Language='"+n.Env.getVAF_Language(i)+"') INNER JOIN C_UOM uom1 ON uom1.C_UOM_ID = uom.C_UOM_ID ";u>0&&(l=" AND l.M_Product_ID="+u);f!=null&&(s=n.DB.to_date(f,!0),a=" AND l.DatePromised <= "+s);o||(o=1);t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetOrdersDataCommonOrg",dataType:"json",type:"POST",data:{keyColumnName:$self.mTab.keyColumnName,tableName:"C_OrderLine",recordID:$self.record_ID,pageNo:o,forInvoicees:e,C_Ord_IDs:r,isBaseLangess:c,MProductIDss:l,DelivDates:a},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));$self.setBusy(!1);$self.log.info(t);return},success:function(t){var i=JSON.parse(t);if(i.Error){n.ADialog.error(i.Error);$self.setBusy(!1);return}$self.resetPageCtrls(i.pSetting);$self.loadGrid(i.data);$self.setBusy(!1)}})}return[]};i.prototype.loadOrder=function(t,i){var r=null;r=this.getOrderData(n.Env.getCtx(),t,i);this.loadGrid(r)};i.prototype.getOrderData=function(i,r,u){var o=[],s,f,e;return $self.relatedToOrg.getValue()?(f="",f=n.Env.isBaseLanguage(i,"C_UOM")?" LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)":" LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.VAF_Language='"+n.Env.getVAF_Language(i)+"')",s=$self.mTab.getValue($self.windowNo,"VAF_Org_ID"),e=n.Env.getVAF_Language(i),t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetOrderDataCommons",dataType:"json",type:"POST",async:!1,data:{forInvoices:u,isBaseLangs:f,C_OrderID:r,orggetVals:s,langs:e},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));$self.setBusy(!1);$self.log.info(t);return},success:function(n){var i=JSON.parse(n),u,r,t;if(i&&i!=null&&i.length>0)for(u=1,r=0;r<i.length;r++)t={},t.Quantity=i[r].quantity,t.QuantityEntered=i[r].quantityentered,t.C_UOM_ID=i[r].c_uom_id,t.M_Product_ID=i[r].m_product_id,t.M_AttributeSetInstance_ID=i[r].m_attributesetinstance_id,t.C_Order_ID=i[r].c_order_id,t.M_InOut_ID=null,t.C_Invoice_ID=null,t.C_UOM_ID_K=i[r].c_uom_id_k,t.M_Product_ID_K=i[r].m_product_id_k,t.M_AttributeSetInstance_ID_K=i[r].m_attributesetinstance_id_k,t.C_Order_ID_K=i[r].c_order_id_k,t.M_InOut_ID_K=null,t.C_Invoice_ID_K=null,t.C_PaymentTerm_ID=i[r].C_PaymentTerm_ID,t.PaymentTermName=i[r].PaymentTermName,t.IsAdvance=i[r].IsAdvance,t.C_InvoicePaymentTerm_ID=i[r].C_InvoicePaymentTerm_ID,t.IsInvoicePTAdvance=i[r].IsInvoicePTAdvance,t.recid=u,o.push(t);$self.setBusy(!1)}}),o):(f="",f=n.Env.isBaseLanguage(i,"C_UOM")?" LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)":" LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.VAF_Language='"+n.Env.getVAF_Language(i)+"')",e=n.Env.getVAF_Language(i),t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetOrderDataCommonsNotOrg",dataType:"json",type:"POST",async:!1,data:{forInvoices:u,isBaseLangs:f,C_OrderID:r,langs:e},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));$self.setBusy(!1);$self.log.info(t);return},success:function(n){var i=JSON.parse(n),u,r,t;if(i&&i!=null&&i.length>0)for(u=1,r=0;r<i.length;r++)t={},t.Quantity=i[r].quantity,t.QuantityEntered=i[r].quantityentered,t.C_UOM_ID=i[r].c_uom_id,t.M_Product_ID=i[r].m_product_id,t.M_AttributeSetInstance_ID=i[r].m_attributesetinstance_id,t.C_Order_ID=i[r].c_order_id,t.M_InOut_ID=null,t.C_Invoice_ID=null,t.C_UOM_ID_K=i[r].c_uom_id_k,t.M_Product_ID_K=i[r].m_product_id_k,t.M_AttributeSetInstance_ID_K=i[r].m_attributesetinstance_id_k,t.C_Order_ID_K=i[r].c_order_id_k,t.M_InOut_ID_K=null,t.C_Invoice_ID_K=null,t.C_PaymentTerm_ID=i[r].C_PaymentTerm_ID,t.PaymentTermName=i[r].PaymentTermName,t.IsAdvance=i[r].IsAdvance,t.C_InvoicePaymentTerm_ID=i[r].C_InvoicePaymentTerm_ID,t.IsInvoicePTAdvance=i[r].IsInvoicePTAdvance,t.recid=u,o.push(t);$self.setBusy(!1)}}),o)};i.prototype.loadGrid=function(i){function s(){for(var n=0;n<$self.dGrid.records.length;n++)$self.NonEditableRecord.indexOf(n+1)>=0&&($self.dGrid.unselect(n+1),t("#grid_"+$self.dGrid.name+"_rec_"+(n+1)+"  input").attr("disabled",!0))}function h(n,i){var r=$self.dGrid.records[i].M_Product_ID_K,e=t.grep($self.editedItems,function(n){return u!=null?n.M_Product_ID_K==r&&n.C_Order_ID_K==$self.dGrid.records[i].C_Order_ID_K:f!=null?n.M_Product_ID_K==r&&n.C_Invoice_ID_K==$self.dGrid.records[i].C_Invoice_ID_K:o!=null?n.M_Product_ID_K==r&&n.M_InOut_ID_K==$self.dGrid.records[i].M_InOut_ID_K:n.C_Payment_ID_K==$self.dGrid.records[item].C_Payment_ID_K});e.length>0?($self.editedItems.splice($self.editedItems.indexOf(e[0]),1),$self.editedItems.push($self.dGrid.records[i])):$self.editedItems.push($self.dGrid.records[i])}function v(n,i,r){var u=null;return t.ajax({url:a,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}var e,c,r;this.dGrid!=null&&(this.dGrid.destroy(),this.dGrid=null);this.arrListColumns.length==0&&(this.arrListColumns.push({field:"Select",caption:n.Msg.getMsg("Select"),sortable:!1,size:"50px",hidden:!1,render:function(){return'<div><input type=checkbox disabled="true"><\/div>'}}),this.arrListColumns.push({field:"Quantity",caption:n.Msg.getMsg("QtyPending"),sortable:!1,size:"150px",render:"number:4",hidden:!1}),this.arrListColumns.push({field:"QuantityPending",caption:n.Msg.getMsg("Quantity"),sortable:!1,size:"150px",render:"number:4",hidden:!0}),this.arrListColumns.push({field:"QuantityEntered",caption:n.Msg.getMsg("QtyEntered"),editable:{type:"float"},render:"number:4",sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"C_UOM_ID",caption:n.Msg.getMsg("UomName"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"M_Product_SearchKey",caption:n.Msg.getMsg("ProductSearchKey"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"M_Product_ID",caption:n.Msg.getMsg("ProductName"),sortable:!0,size:"150px",hidden:!1}),this.arrListColumns.push({field:"M_AttributeSetInstance_ID",caption:n.Msg.getMsg("ASI"),sortable:!1,size:"150px",editable:{type:"custom",ctrl:$self.$productAttribute,showAll:!0},render:function(n){var t=$self.pattrLookup,i=n.M_AttributeSetInstance_ID,r;return n.changes&&typeof n.changes.M_AttributeSetInstance_ID!="undefined"&&(i=n.changes.M_AttributeSetInstance_ID),t&&(r=t.getDisplay(i,!0)),r}}),this.arrListColumns.push({field:"C_PaymentTerm_ID",caption:n.Msg.getMsg("C_PaymentTerm_ID"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"PaymentTermName",caption:n.Msg.getMsg("PaymentTermName"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"IsAdvance",caption:n.Msg.getMsg("IsAdvance"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"C_InvoicePaymentTerm_ID",caption:n.Msg.getMsg("C_InvoicePaymentTerm_ID"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"IsInvoicePTAdvance",caption:n.Msg.getMsg("IsInvoicePTAdvance"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"C_Order_ID",caption:n.Msg.getMsg("OrderLine"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"M_InOut_ID",caption:n.Msg.getMsg("Shipment/Receipt"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"C_Invoice_ID",caption:n.Msg.getMsg("Invoice"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"C_UOM_ID_K",caption:n.Msg.getMsg("UomName"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"M_Product_ID_K",caption:n.Msg.getMsg("ProductName"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"C_Order_ID_K",caption:n.Msg.getMsg("Order"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"M_InOut_ID_K",caption:n.Msg.getMsg("Shipment/Receipt"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"C_Invoice_ID_K",caption:n.Msg.getMsg("Invoice"),sortable:!1,size:"150px",hidden:!0}));w2utils.encodeTags(i);e="gridCreateForm"+this.windowNo;e=e.replace(".","");this.dGrid=t(this.middelDiv).w2grid({name:e,recordHeight:30,show:{selectColumn:!0},multiSelect:!0,columns:this.arrListColumns,records:i,onSelect:function(n){n.onComplete=function(){s()}}});this.dGrid.selectNone();var u=$self.cmbOrder.getControl().find("option:selected").val(),f=$self.cmbInvoice.getControl().find("option:selected").val(),o=$self.cmbShipment.getControl().find("option:selected").val();for(itm in $self.multiValues)for(item in $self.dGrid.records)c=t.grep($self.multiValues,function(n){return u!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.records[item].C_Order_ID_K:f!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.C_Invoice_ID_K==$self.dGrid.records[item].C_Invoice_ID_K:o!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.M_InOut_ID_K==$self.dGrid.records[item].M_InOut_ID_K:n.C_Payment_ID_K==$self.dGrid.records[item].C_Payment_ID_K}),c.length>0&&$self.dGrid.select(parseInt(item)+1);if(this.dGrid.records.length>0)for($self.NonEditableRecord=[],r=0;r<$self.dGrid.records.length;r++)t(t("#grid_"+$self.dGrid.name+"_rec_"+(r+1)).find("input[type=checkbox]")[1]).prop("checked",i[r].Select),$self.dGrid.records[r].C_InvoicePaymentTerm_ID==$self.dGrid.records[r].C_PaymentTerm_ID||$self.dGrid.records[r].C_InvoicePaymentTerm_ID==0||$self.dGrid.records[r].C_InvoicePaymentTerm_ID!=$self.dGrid.records[r].C_PaymentTerm_ID&&$self.dGrid.records[r].IsAdvance==!1&&$self.dGrid.records[r].IsInvoicePTAdvance==!1||(t("#grid_"+$self.dGrid.name+"_rec_"+(r+1)+"  input").attr("disabled",!0),$self.NonEditableRecord.push(r+1));this.dGrid.on("change",function(t){if(s(),$self.dGrid.columns[t.column].field=="QuantityEntered"){if($self.fromInvoice){if($self.dGrid.records[t.index].QuantityPending<parseFloat(t.value_new).toFixed(4)){n.ADialog.error("InvoiceQtyGreater");t.value_new=t.value_original;return}}else if($self.dGrid.records[t.index].QuantityPending<parseFloat(t.value_new).toFixed(4)){n.ADialog.error("QtyCanNotbeGreater");t.value_new=t.value_original;return}$self.dGrid.records[t.index].QuantityEntered=parseFloat(t.value_new).toFixed(4);(u>0||f>0)&&h("QuantityEntered",t.index,parseFloat(t.value_new).toFixed(4))}else $self.dGrid.columns[t.column].field=="M_AttributeSetInstance_ID"?($self.dGrid.records[t.index].M_AttributeSetInstance_ID=t.value_new,(u>0||f>0)&&h("M_AttributeSetInstance_ID",t.index,t.value_new)):$self.dGrid.columns[t.column].field=="Date"&&($self.dGrid.records[t.index].Date=t.value_new,$self.dGrid.records[t.index].Date!=""&&h("Date",t.index,t.value_new))});this.dGrid.on("click",function(t){t.preventDefault;s();n.Env.getCtx().setContext($self.windowNo,"M_Product_ID",n.Utility.Util.getValueOfInt($self.dGrid.records[t.recid-1].M_Product_ID_K))});var y=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u=null;return v(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u},l=n.Application.contextUrl,a=l+"JsonData/JDataSet",p=l+"JsonData/ExecuteNonQuer";this.dGrid.on("unselect",function(n){if(n.all)n.onComplete=function(){for(item in $self.dGrid.records){var n=t.grep($self.multiValues,function(n){return u!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.records[item].C_Order_ID_K:f!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.C_Invoice_ID_K==$self.dGrid.records[item].C_Invoice_ID_K:o!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.M_InOut_ID_K==$self.dGrid.records[item].M_InOut_ID_K:n.C_Payment_ID_K==$self.dGrid.records[item].C_Payment_ID_K});n.length>0&&$self.multiValues.splice($self.multiValues.indexOf(n[0]),1)}};else{var i=w2ui[n.target].records[n.index].M_Product_ID_K,r=t.grep($self.multiValues,function(t){return u!=null?t.M_Product_ID_K==i&&t.C_Order_ID_K==w2ui[n.target].records[n.index].C_Order_ID_K:f!=null?t.M_Product_ID_K==i&&t.C_Invoice_ID_K==w2ui[n.target].records[n.index].C_Invoice_ID_K:o!=null?t.M_Product_ID_K==i&&t.M_InOut_ID_K==w2ui[n.target].records[n.index].M_InOut_ID_K:t.C_Payment_ID_K==$self.dGrid.records[item].C_Payment_ID_K});r.length>0&&$self.multiValues.splice($self.multiValues.indexOf(r[0]),1)}})};n.VCreateFrom=i})(VIS,jQuery),function(n,t){function i(i){function e(){var t,i;return r.title=n.Msg.getMsg("Invoice")+" .. "+n.Msg.getMsg("CreateFrom"),r.lblInvoice!=null&&r.lblInvoice.getControl().css("display","none"),r.cmbInvoice!=null&&r.cmbInvoice.getControl().css("display","none"),r.lblLocator!=null&&r.lblLocator.getControl().css("display","none"),r.locatorField!=null&&r.locatorField.getControl().css("display","none"),r.deliveryDate=new n.Controls.VDate("DeliveryDate",!1,!1,!0,n.DisplayType.Date,"DeliveryDate"),t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),r.windowNo,2221,n.DisplayType.Search),r.vProduct=new n.Controls.VTextBoxButton("M_Product_ID",!0,!1,!0,n.DisplayType.Search,t),i=r.initBPartner(!0),r.vBPartner.setReadOnly(!0),s(i),r.fromInvoice=!0,!0}function o(i,f){var e="s.DocumentNo||' - '||".concat(n.DB.to_char("s.MovementDate",n.DisplayType.Date,n.Env.getVAF_Language(n.Env.getCtx()))),o="Y".equals(n.Env.getCtx().getWindowContext(u.windowNo,"IsDropShip")),s="Y".equals(n.Env.getCtx().getWindowContext(u.windowNo,"IsSOTrx"));t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetShipments",type:"POST",data:{displays:e,CBPartnerIDs:f,IsDrop:o,IsSOTrx:s},success:function(t){var u=JSON.parse(t),f,e,i;if(u&&u.length>0){for(i=0;i<u.length;i++)f=n.Utility.Util.getValueOfInt(u[i].key),e=n.Utility.encodeText(u[i].value),i==0&&r.cmbShipment.getControl().append(" <option value=0> <\/option>"),r.cmbShipment.getControl().append(" <option value="+f+">"+e+"<\/option>");r.cmbShipment.getControl().prop("selectedIndex",0)}},error:function(n){u.log.info(n)}})}function s(t){r.cmbShipment.getControl().html("");o(n.Env.getCtx(),t)}var r=this.$super,u,f;r.constructor(i);u=this;e();r.jbInit();r.initOK=!0;f=i.getWindowNo();this.log=n.Logging.VLogger.getVLogger("VCreateFromInvoice");this.disposeComponent=function(){r=null;u=null;this.disposeComponent=null}}n.Utility.inheritPrototype(i,n.VCreateFrom);i.prototype.saveInvoice=function(){var i,n,t;if(this.$super.dGrid==null||(i={},n=this.$super.multiValues,n==null)||n.length<=0)return!1;for(t=0;t<n.length;t++)i[t]=n[t];var r=this.$super.mTab.getValue("C_Invoice_ID"),u=this.$super.cmbOrder.getControl().find("option:selected").val(),f=this.$super.cmbShipment.getControl().find("option:selected").val();return this.saveData(i,"",u,f,r)};i.prototype.loadShipments=function(t,i,r){var u=this.getShipmentsData(n.Env.getCtx(),t,i,r)};i.prototype.getShipmentsData=function(i,r,u,f){var e=this,o,c,s,h;if(this.$super.record_ID=$self.mTab.getValue("C_Invoice_ID"),e.$super.dGrid!=null){o=e.$super.dGrid.getSelection();for(item in o)c=t.grep(e.$super.multiValues,function(n){return n.M_Product_ID_K==e.$super.dGrid.get(o[item]).M_Product_ID_K&&n.M_InOut_ID_K==e.$super.dGrid.get(o[item]).M_InOut_ID_K}),c.length>0||e.$super.multiValues.push(e.$super.dGrid.get(o[item]))}return s="",h="",s=n.Env.isBaseLanguage(i,"C_UOM")?"FROM C_UOM uom INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID) ":"FROM C_UOM_Trl uom Left join C_UOM uom1 on (uom1.C_UOM_ID=uom.C_UOM_ID)  INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.VAF_Language='"+n.Env.getVAF_Language(i)+"') ",u!=null&&(h=" AND l.M_Product_ID="+u),f||(f=1),t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetDataVCreateFrom",dataType:"json",type:"POST",data:{keyColumnName:e.$super.mTab.keyColumnName,tableName:"M_InOutLine",recordID:e.$super.record_ID,pageNo:f,mInOutId:r,isBaseLanguages:s,mProductIDD:h},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));e.$super.setBusy(!1);selfChild.log.info(t);return},success:function(t){var i=JSON.parse(t);if(i.Error){n.ADialog.error(i.Error);e.$super.setBusy(!1);return}e.$super.resetPageCtrls(i.pSetting);e.$super.loadGrid(i.data);e.$super.setBusy(!1)}}),[]};i.prototype.loadShipment=function(t){var i=this.getShipmentData(n.Env.getCtx(),t);this.$super.loadGrid(i)};i.prototype.getShipmentData=function(i,r){var u="";return u=n.Env.isBaseLanguage(i,"C_UOM")?"FROM C_UOM uom INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID) ":"FROM C_UOM_Trl uom INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.VAF_Language='"+n.Env.getVAF_Language(i)+"') ",t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetShipmentDatas",type:"POST",async:!1,data:{MInOutIDs:r,isBaseLanguageUmos:u},success:function(n){var i=JSON.parse(n),r,u;if(i&&i.length>0)for(r=1,u=0;u<i.length;u++){var t={},f=dr.getDecimal(0),e=dr.getDecimal(1);t.Quantity=f;t.QuantityEntered=e;t.C_UOM_ID=dr.getString(3);t.M_Product_ID=dr.getString(5);t.C_Order_ID=".";t.M_InOut_ID=dr.getString(7);t.C_Invoice_ID=null;t.C_UOM_ID_K=dr.getString(2);t.M_Product_ID_K=dr.getInt(4);t.C_Order_ID_K=dr.getInt(8);t.M_InOut_ID_K=dr.getInt(6);t.C_Invoice_ID_K=null;t.recid=r;r++;n.push(t)}},error:function(){}}),[]};i.prototype.saveData=function(i,r,u,f,e){var o=this;t.ajax({type:"POST",url:n.Application.contextUrl+"Common/SaveInvoice",dataType:"json",data:{model:i,selectedItems:r,C_Order_ID:u,C_Invoice_ID:e,M_inout_id:f},success:function(n){if(returnValue=n.result,returnValue){o.dispose();o.$super.$root.dialog("close");o.$super.setBusy(!1);return}o.$super.setBusy(!1);alert(returnValue)},error:function(n,t,i){console.log(t);o.$super.setBusy(!1);alert(i)}})};i.prototype.dispose=function(){this.disposeComponent!=null&&this.disposeComponent()};n.VCreateFromInvoice=i}(VIS,jQuery),function(n,t){function i(i){function f(){var e,t,i,u,f;r.title=n.Msg.getElement(n.Env.getCtx(),"M_InOut_ID",!1)+" .. "+n.Msg.translate(n.Env.getCtx(),"CreateFrom");r.lblShipment!=null&&r.lblShipment.getControl().css("display","none");r.cmbShipment!=null&&r.cmbShipment.getControl().css("display","none");r.Applybtn&&r.Applybtn.css("display","block");e=3537;t=new n.MLocatorLookup(n.Env.getCtx(),r.windowNo);r.locatorField=new n.Controls.VLocator("M_Locator_ID",!0,!1,!0,n.DisplayType.Locator,t);r.deliveryDate=new n.Controls.VDate("DeliveryDate",!1,!1,!0,n.DisplayType.Date,"DeliveryDate");i=n.MLookupFactory.getMLookUp(n.Env.getCtx(),r.windowNo,2221,n.DisplayType.Search);r.vProduct=new n.Controls.VTextBoxButton("M_Product_ID",!0,!1,!0,n.DisplayType.Search,i);r.DocumentNoRef=new n.Controls.VTextBox("DocumentNo",!1,!0,!0,50,100,null,null,!1);r.lblContainer=new n.Controls.VLabel;r.cmbContainer=new n.Controls.VComboBox("",!1,!1,!0);r.lblContainer.getControl().text(n.Msg.getMsg("VIS_Container"));r.lblContainer!=null&&r.lblContainer.getControl().css("display","block");r.cmbContainer!=null&&r.cmbContainer.getControl().css("display","block");u=n.Env.getCtx().getContext(r.windowNo,"DocumentNo");r.DocumentNoRef.setValue(u);f=r.initBPartner(!1);r.vBPartner.setReadOnly(!0);o(f)}function e(i,f,e){var o="i.DocumentNo||' - '||".concat(n.DB.to_char("DateInvoiced",n.DisplayType.Date,n.Env.getVAF_Language(i))).concat("|| ' - ' ||").concat(n.DB.to_char("GrandTotal",n.DisplayType.Amount,n.Env.getVAF_Language(i))),s="Y".equals(n.Env.getCtx().getWindowContext(u.windowNo,"IsDropShip"));t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetInvoicesVCreate",type:"POST",data:{displays:o,cBPartnerId:f,isReturnTrxs:e,IsDrops:s},success:function(t){var u=JSON.parse(t),f,e,i;if(u&&u.length>0)try{for(i=0;i<u.length;i++)f=n.Utility.Util.getValueOfInt(u[i].key),e=n.Utility.encodeText(u[i].value),i==0&&r.cmbInvoice.getControl().append(" <option value=0> <\/option>"),r.cmbInvoice.getControl().append(" <option value="+f+">"+e+"<\/option>");r.cmbInvoice.getControl().prop("selectedIndex",0)}catch(o){}},error:function(n){u.log.info(n)}})}function o(t){r.cmbInvoice.getControl().html("");var i="Y".equals(n.Env.getCtx().getWindowContext(r.windowNo,"IsReturnTrx"));e(n.Env.getCtx(),t,i)}var r=this.$super,u;r.constructor(i);u=this;f();r.jbInit();r.initOK=!0;this.log=n.Logging.VLogger.getVLogger("VCreateFromShipment");this.disposeComponent=function(){r=null;u=null;this.disposeComponent=null}}n.Utility.inheritPrototype(i,n.VCreateFrom);i.prototype.saveMInOut=function(t){var u,i,r,f,e;if(this.$super.dGrid==null||(u={},i=this.$super.multiValues,i==null)||i.length<=0)return this.$super.setBusy(!1),!1;for(r=0;r<i.length;r++)u[r]=i[r];if(f=this.$super.locatorField.getValue(),f==null||f==0)return n.ADialog.info("Error",!0,n.Msg.translate(n.Env.getCtx(),"VIS_locfieldMandatory"),""),this.$super.setBusy(!1),!1;if(u.length==0)return this.$super.setBusy(!1),!1;e=this.$super.cmbContainer.getValue();e===undefined&&(e=0);var o=f,s=this.$super.mTab.getValue("M_InOut_ID"),h=this.$super.cmbInvoice.getControl().find("option:selected").val(),c=this.$super.cmbOrder.getControl().find("option:selected").val();return this.saveData(u,"",c,h,o,s,e,t)};i.prototype.loadInvoices=function(t,i,r){var u=this.getInvoicesData(n.Env.getCtx(),t,i,r)};i.prototype.getInvoicesData=function(i,r,u,f){var e=this,o,c,s,h;if(this.$super.record_ID=$self.mTab.getValue("M_InOut_ID"),e.$super.dGrid!=null){o=e.$super.dGrid.getSelection();for(item in o)c=t.grep(e.$super.multiValues,function(n){return n.M_Product_ID_K==e.$super.dGrid.get(o[item]).M_Product_ID_K&&n.C_Invoice_ID_K==e.$super.dGrid.get(o[item]).C_Invoice_ID_K}),c.length>0||e.$super.multiValues.push(e.$super.dGrid.get(o[item]))}return s="",h="",s=n.Env.isBaseLanguage(i,"C_UOM")?"FROM C_UOM uom INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID) ":"FROM C_UOM_Trl uom Left join C_UOM uom1 on (uom1.C_UOM_ID=uom.C_UOM_ID) INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.VAF_Language='"+n.Env.getVAF_Language(i)+"') ",u!=null&&(h=" AND l.M_Product_ID = "+u),f||(f=1),t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetInvoicesDataVCreate",dataType:"json",type:"POST",data:{keyColumnName:e.$super.mTab.keyColumnName,tableName:"C_InvoiceLine",recordID:e.$super.record_ID,pageNo:f,isBaseLangss:s,cInvoiceID:r,mProductIDs:h},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));selfChild.log.info(t);e.$super.setBusy(!1);return},success:function(t){var i=JSON.parse(t);if(i.Error){n.ADialog.error(i.Error);e.$super.setBusy(!1);return}e.$super.resetPageCtrls(i.pSetting);e.$super.loadGrid(i.data);e.$super.setBusy(!1)}}),[]};i.prototype.initContainerDetails=function(){this.$super.cmbContainer.getControl().html("")};i.prototype.loadInvoice=function(t){var i=this.getInvoiceData(n.Env.getCtx(),t);this.$super.loadGrid(i)};i.prototype.getInvoiceData=function(t,i){var o=[],f="SELECT round((l.QtyInvoiced-SUM(COALESCE(mi.Qty,0))) * (CASE WHEN l.QtyInvoiced=0 THEN 0 ELSE l.QtyEntered/l.QtyInvoiced END ),2) as QUANTITY,round((l.QtyInvoiced-SUM(COALESCE(mi.Qty,0))) * (CASE WHEN l.QtyInvoiced=0 THEN 0 ELSE l.QtyEntered/l.QtyInvoiced END ),2) as QTYENTER, l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name), l.M_Product_ID,p.Name, l.C_InvoiceLine_ID,l.Line, l.C_OrderLine_ID ",u,e;f=n.Env.isBaseLanguage(t,"C_UOM")?f.concat("FROM C_UOM uom ").concat("INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID) "):f.concat("FROM C_UOM_Trl uom ").concat("INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.VAF_Language='").concat(n.Env.getVAF_Language(t)).concat("') ");f=f.concat("INNER JOIN M_Product p ON (l.M_Product_ID=p.M_Product_ID) ").concat("LEFT OUTER JOIN M_MatchInv mi ON (l.C_InvoiceLine_ID=mi.C_InvoiceLine_ID) ").concat("WHERE l.C_Invoice_ID="+i+" GROUP BY l.QtyInvoiced,l.QtyEntered,l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name),l.M_Product_ID,p.Name, l.C_InvoiceLine_ID,l.Line,l.C_OrderLine_ID ORDER BY l.Line");u=null;try{for(u=n.DB.executeReader(f.toString(),null,null),e=1;u.read();){var r={},s=u.getDecimal(0),h=u.getDecimal(1);r.Quantity=s;r.QuantityEntered=h;r.C_UOM_ID=u.getString(3);r.M_Product_ID=u.getString(5);r.C_Order_ID=".";r.M_InOut_ID=null;r.C_Invoice_ID=u.getString(7);r.C_UOM_ID_K=u.getString(2);r.M_Product_ID_K=u.getInt(4);r.C_Order_ID_K=u.getInt(8);r.M_InOut_ID_K=null;r.C_Invoice_ID_K=u.getInt(6);r.recid=e;e++;o.push(r)}u.close()}catch(c){}return o};i.prototype.saveData=function(i,r,u,f,e,o,s,h){var c=this;console.log(e);t.ajax({type:"POST",url:n.Application.contextUrl+"Common/SaveShipment",dataType:"json",data:{model:i,selectedItems:r,C_Order_ID:u,C_Invoice_ID:f,M_Locator_ID:e,M_InOut_ID:o,Container_ID:s},success:function(n){if(returnValue=n.result,returnValue){h?c.$super.callBackSave(returnValue):(c.dispose(),c.$super.setBusy(!1),c.$super.$root.dialog("close"));return}},error:function(n,t,i){console.log(t);c.$super.setBusy(!1);alert(i)}})};i.prototype.dispose=function(){this.disposeComponent!=null&&this.disposeComponent()};n.VCreateFromShipment=i}(VIS,jQuery),function(n,t){function i(t){function f(){var f,e,t;return i.mTab.getValue("C_BankStatement_ID")==null?(n.ADialog.error(n.Msg.getMsg("SaveErrorRowNotFound",!0)),!1):(i.title=n.Msg.getElement(n.Env.getCtx(),"C_BankStatement_ID",!1)+" .. "+n.Msg.getMsg("CreateFrom"),i.relatedToOrg=null,i.lblOrder!=null&&i.lblOrder.getControl().css("display","none"),i.cmbOrder!=null&&i.cmbOrder.getControl().css("display","none"),i.lblShipment!=null&&i.lblShipment.getControl().css("display","none"),i.cmbShipment!=null&&i.cmbShipment.getControl().css("display","none"),i.lblInvoice!=null&&i.lblInvoice.getControl().css("display","none"),i.cmbInvoice!=null&&i.cmbInvoice.getControl().css("display","none"),f=4917,e=n.MLookupFactory.getMLookUp(n.Env.getCtx(),u,f,n.DisplayType.TableDir),i.cmbBankAccount=new n.Controls.VComboBox("C_BankAccount_ID",!0,!0,!0,e,150,n.DisplayType.TableDir,0),i.Date=new n.Controls.VDate("Date",!1,!1,!0,n.DisplayType.Date,"Date"),i.DocumentNo=new n.Controls.VTextBox("DocumentNo",!1,!1,!0,50,100,null,null,!1),i.Amount=new n.Controls.VAmountTextBox("Amount",!1,!1,!0,50,100,n.DisplayType.Amount,n.Msg.getMsg("Amount")),i.DepositSlip=new n.Controls.VTextBox("DepositSlip",!1,!1,!0,50,100,null,null,!1),i.AuthCode=new n.Controls.VTextBox("AuthCode",!1,!1,!0,50,100,null,null,!1),i.CheckNo=new n.Controls.VTextBox("CheckNo",!1,!1,!0,50,100,null,null,!1),i.cmbBankAccount.getControl().prop("selectedIndex",0),t=n.Env.getCtx().getContextAsInt(u,"C_BankAccount_ID"),i.cmbBankAccount.setValue(t),r.initBPartner(t),r.loadBankAccounts(t,0,"","","","","","0",1),i.btnRefresh&&i.btnRefresh.css("display","black"),!0)}var i=this.$super,r,u;i.constructor(t);r=this;u=t.getWindowNo();f();i.jbInit();i.initOK=!0;i.middelDiv.css("height","61%");this.disposeComponent=function(){this.disposeComponent=null}}function u(n,i,r){var u=null;return t.ajax({url:e,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}var f,o;n.Utility.inheritPrototype(i,n.VCreateFrom);i.prototype.initBPartner=function(t){var i=this.$super,r=" C_BPartner.C_BPartner_ID IN (SELECT  p.C_BPartner_ID as C_BPartner_ID FROM C_Payment p WHERE p.Processed='Y' AND p.IsReconciled='N' AND p.DocStatus IN ('CO','CL','RE','VO') AND p.PayAmt<>0 AND p.C_BankAccount_ID = "+t+" AND NOT EXISTS (SELECT * FROM C_BankStatementLine l WHERE p.C_Payment_ID=l.C_Payment_ID AND l.StmtAmt <> 0) )",u=n.MLookupFactory.get(n.Env.getCtx(),this.windowNo,5398,n.DisplayType.Search,"C_BPartner_ID",0,!1,r);i.vBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,u)};i.prototype.getTableFieldVOs=function(){var t=this.$super,i;t.arrListColumns=[];t.arrListColumns.push({field:"Date",caption:n.Msg.getMsg("DateAcct"),sortable:!0,size:"100px",hidden:!1,editable:{type:"date"},render:function(n){var t=n.Date;return new Date(t).toLocaleDateString()}});t.arrListColumns.push({field:"C_Payment_ID",caption:n.Msg.getMsg("Payment"),sortable:!0,size:"100px",hidden:!1});t.arrListColumns.push({field:"C_Currency_ID",caption:n.Msg.getMsg("Currency"),sortable:!0,size:"80px",hidden:!1});i=n.Utility.Util.getValueOfInt(f("VIS_145"));i>0&&t.arrListColumns.push({field:"VA034_DepositSlipNo",caption:n.Msg.getMsg("DepositSlipNo"),sortable:!0,size:"100px",hidden:!1});t.arrListColumns.push({field:"AuthCode",caption:n.Msg.getMsg("AuthCode"),sortable:!0,size:"100px",hidden:!1});t.arrListColumns.push({field:"CheckNo",caption:n.Msg.getMsg("CheckNo"),sortable:!0,size:"80px",hidden:!1});t.arrListColumns.push({field:"Amount",caption:n.Msg.getMsg("Amount"),sortable:!0,size:"80px",hidden:!1,render:function(t){var i=n.Utility.Util.getValueOfDecimal(t.Amount);return i.toLocaleString()}});t.arrListColumns.push({field:"ConvertedAmount",caption:n.Msg.getMsg("ConvertedAmount"),sortable:!0,size:"80px",hidden:!1,render:function(t){var i=n.Utility.Util.getValueOfDecimal(t.ConvertedAmount);return i.toLocaleString()}});t.arrListColumns.push({field:"Description",caption:n.Msg.getMsg("Description"),sortable:!0,size:"250px",hidden:!1});t.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.getMsg("BusinessPartner"),sortable:!0,size:"150px",hidden:!1});t.arrListColumns.push({field:"Type",caption:n.Msg.getMsg("Type"),sortable:!0,size:"80px",hidden:!0});t.arrListColumns.push({field:"C_Payment_ID_K",caption:n.Msg.getMsg("Payment"),sortable:!0,size:"150px",hidden:!0});t.arrListColumns.push({field:"C_Currency_ID_K",caption:n.Msg.getMsg("Currency"),sortable:!0,size:"150px",hidden:!0})};i.prototype.loadBankAccounts=function(t,i,r,u,f,e,o,s,h){var c=this.$super,l=c.mTab.getValue("StatementDate"),a=this.getBankAccountsData(n.Env.getCtx(),t,i,r,l,u,f,e,o,s,h);this.getTableFieldVOs()};i.prototype.getBankAccountsData=function(i,r,u,f,e,o,s,h,c,l,a){var v=this,y,p,nt,tt;if(v.$super.dGrid!=null){y=v.$super.dGrid.getSelection();for(item in y)p=t.grep(v.$super.multiValues,function(n){return n.C_Payment_ID_K==v.$super.dGrid.get(y[item]).C_Payment_ID_K}),p.length>0||v.$super.multiValues.push(v.$super.dGrid.get(y[item]))}e==null&&(e=DateTime.Today.Date);var it=n.DB.to_date(e,!0),w="",b="",k="0",d="",g="";return u>0&&(k=" AND p.C_BPartner_ID = "+u),o!=""&&(d=" AND p.DocumentNo LIKE '"+o+"'"),f!=""&&f!=null&&(nt=n.DB.to_date(f,!0),w=" AND p.DateAcct = "+nt),o!=""&&(g=" AND cs.DocumentNo LIKE '"+o+"'"),f!=""&&f!=null&&(tt=n.DB.to_date(f,!0),b=" AND cs.DateAcct = "+tt),a||(a=1),t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetBankAccountsData",dataType:"json",type:"POST",data:{pageNo:a,dates:it,trxDatess:w,trxDatesUnions:b,cBPartnerIDs:k,DocumentNos:d,DocumentNoUnions:g,DepositSlips:s,AuthCodes:h,CheckNos:c,Amounts:l,cBankAccountId:r},error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));v.$super.setBusy(!1);return},success:function(t){var i=JSON.parse(t);if(i.Error){n.ADialog.error(i.Error);v.$super.setBusy(!1);return}v.$super.resetPageCtrls(i.pSetting);v.$super.loadGrid(i.data);v.$super.setBusy(!1)}}),[]};i.prototype.loadBankAccount=function(t){var i=this.$super,r=i.mTab.getValue("StatementDate"),u=this.getBankAccountData(n.Env.getCtx(),t,r);this.getTableFieldVOs();setTimeout(function(){i.loadGrid(u)},10)};i.prototype.getBankAccountData=function(i,r,u){var s=[],f,o,e;try{for(u==null&&(u=DateTime.Today.Date),f=null,t.ajax({url:n.Application.contextUrl+"Form/GetBankAccontData",async:!1,data:{C_BankAccount_ID:r,ts:u}}).done(function(t){f=(new n.DB.DataReader).toJson(t)}),o=1;f.read();)e={},e.Date=f.getString(0),e.C_Payment_ID=f.getString(2),e.C_Currency_ID=f.getString(4),e.Amount=f.getDecimal(5),e.ConvertedAmount=f.getDecimal(6),e.C_BPartner_ID=f.getString(7),e.Type=f.getString(8),e.C_Payment_ID_K=f.getString(1),e.C_Currency_ID_K=f.getInt(3),e.recid=o,o++,s.push(e)}catch(h){}return s};var r=n.Application.contextUrl,e=r+"JsonData/JDataSetWithCode",s=r+"JsonData/ExecuteNonQuer";f=function(t,i,r){var e=r?!0:!1,o={sql:t,page:1,pageSize:0},f=null;return u(o,e,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);f=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;e&&r(f)}),f};o=function(t,i,r){var o=r?!0:!1,e={sql:t,page:1,pageSize:0},f;return i&&(e.param=i),f=null,u(e,o,function(t){f=(new n.DB.DataReader).toJson(t);r&&r(f)}),f};i.prototype.saveStatment=function(){var n;if(this.$super.dGrid==null)return!1;var r=this.$super.mTab.getValue("C_BankStatement_ID"),i={},t=this.$super.multiValues;if(t==null||t.length<=0)return!1;for(n=0;n<t.length;n++)i[n]=t[n];return this.saveData(i,"",r)};i.prototype.saveData=function(i,r,u){var f=this;t.ajax({type:"POST",url:n.Application.contextUrl+"Common/SaveStatment",dataType:"json",data:{model:i,selectedItems:r,C_BankStatement_ID:u},success:function(n){if(returnValue=n.result,returnValue){f.dispose();f.$super.$root.dialog("close");f.$super.setBusy(!1);return}f.$super.setBusy(!1);alert(returnValue)},error:function(n,t,i){console.log(t);f.$super.setBusy(!1);alert(i)}})};i.prototype.dispose=function(){this.disposeComponent!=null&&this.disposeComponent()};n.VCreateFromStatement=i}(VIS,jQuery),function(n,t){function i(i,r,u){this.windowNo=i;this.VAF_Client_ID=r;this.VAF_Org_ID=0;this.DateFrom=null;this.DateTo=null;var f=this;this.ASchemas=[];this.ASchema=[];this.log=n.Logging.VLogger.getVLogger("AccountViewer");this.dataByData=null;this._elements=[];this.documentQuery=!1;this.C_AcctSchema_ID=0;this.PostingType="";this.VAF_TableView_ID=u;this.Record_ID=0;this.whereInfo=[];this.tableInfo=[];this.displayQty=!1;this.displaySourceAmt=!1;this.displayDocumentInfo=!1;this.sortBy1="";this.sortBy2="";this.sortBy3="";this.sortBy4="";this.group1=!1;this.group2=!1;this.group3=!1;this.group4=!1;this._leadingColumns=0;this._ref1=null;this._ref2=null;this.TABLE_ALIAS="zz";this.FUNCTION_COUNT="Count";this.FUNCTION_SUM="Sum";this.onLoaded=null;this.HasOrgUnit=null;this.VAF_Client_ID==0&&(this.VAF_Client_ID=n.Env.getCtx().getContextAsInt(this.windowNo,"VAF_Client_ID"));this.VAF_Client_ID==0&&(this.VAF_Client_ID=n.Env.getCtx().ctx.VAF_Client_ID);this.VAF_Org_ID==0&&(this.VAF_Org_ID=Number(n.context.getWindowTabContext(this.windowNo,0,"VAF_Org_ID")));this.ELEMENTTYPE_VAF_Control_Ref_ID=181;this.ELEMENTTYPE_Account="AC";this.ELEMENTTYPE_Activity="AY";this.ELEMENTTYPE_BPartner="BP";this.ELEMENTTYPE_LocationFrom="LF";this.ELEMENTTYPE_LocationTo="LT";this.ELEMENTTYPE_Campaign="MC";this.ELEMENTTYPE_Organization="OO";this.ELEMENTTYPE_OrgTrx="OT";this.ELEMENTTYPE_Project="PJ";this.ELEMENTTYPE_Product="PR";this.ELEMENTTYPE_SubAccount="SA";this.ELEMENTTYPE_SalesRegion="SR";this.ELEMENTTYPE_UserList1="U1";this.ELEMENTTYPE_UserList2="U2";this.ELEMENTTYPE_UserElement1="X1";this.ELEMENTTYPE_UserElement2="X2";this.getClientAcctSchema=function(i,r){var e=[],u=this;return t.ajax({url:n.Application.contextUrl+"AcctViewerData/GetClientAcctSchema",type:"POST",async:!0,data:{vaf_client_id:i,vaf_org_id:r},success:function(t){var r,f,o,i,s;if(t.result&&t.result.AcctSchemas)for(r=t.result.AcctSchemas,i=0;i<r.length;i++)f={},c_acctschema_id=r[i].Key,f.Key=c_acctschema_id,f.Name=n.Utility.encodeText(r[i].Name),e.push(f);if(t.result&&t.result.OtherAcctSchemas)for(o=t.result.OtherAcctSchemas,i=0;i<o.length;i++)s={},s.Key=o[i].Key,s.Name=n.Utility.encodeText(o[i].Name),e.push(s);u.ASchemas=e;u.ASchema=e[0];u.onLoaded&&u.onLoaded()},error:function(n){f.log.info(n);u.onLoaded&&u.onLoaded()}}),e};this.getClientAcctSchema(this.VAF_Client_ID,this.VAF_Org_ID)}function r(r,u,f,e,o){function yf(){nf.getControl().text(n.Msg.getMsg("Selection"));vr.getControl().text(n.Msg.translate(n.Env.getCtx(),or));hi.getControl().text(n.Msg.translate(n.Env.getCtx(),or));yr.getControl().text(n.Msg.translate(n.Env.getCtx(),lu));ut.find("label").text(n.Msg.getMsg(au));br.getControl().text(n.Msg.translate(n.Env.getCtx(),sr));kr.getControl().text(n.Msg.translate(n.Env.getCtx(),yi));pr.getControl().text(n.Msg.translate(n.Env.getCtx(),vu));wr.getControl().text(n.Msg.translate(n.Env.getCtx(),"AcctDateTo"));dr.getControl().text(n.Msg.translate(n.Env.getCtx(),cr));gr.getControl().text(n.Msg.translate(n.Env.getCtx(),lr));nu.getControl().text(n.Msg.translate(n.Env.getCtx(),"Project"));pu.getControl().text(n.Msg.translate(n.Env.getCtx(),ar));gu.getControl().text(n.Msg.translate(n.Env.getCtx(),"OrganizationUnit"));tf.getControl().text(n.Msg.getMsg("Display"));gi.find("label").text(n.Msg.getMsg("DisplayQty"));tr.find("label").text(n.Msg.getMsg("DisplaySourceInfo"));nr.find("label").text(n.Msg.getMsg("DisplayDocumentInfo"));tu.getControl().text(n.Msg.getMsg("SortBy"));iu.getControl().text(n.Msg.getMsg("GroupBy"));ni.getControl().css("color","rgba(var(--v-c-primary), 1)");d.text(n.Msg.getMsg("RePost"));d.show();vt.find("label").text(n.Msg.getMsg("Force"));vt.show()}function ou(){oi.css("color","rgba(var(--v-c-on-secondary), 1)");ei.css("font-size","1rem").css("color","rgba(var(--v-c-primary), 1)");yt.show();p.show();ii.css("display","none");d.hide();vt.hide();hi.getControl().hide();g.getControl().hide();p.find("#btnSelctDoc_"+h).attr("name",p.find("#btnSelctDoc_"+h).parent().find("select").val()+"_ID");p.find("#btnSelctDocClear_"+h).attr("name",p.find("#btnSelctDocClear_"+h).parent().find("select").val()+"_ID")}function ur(){ei.css("color","rgba(var(--v-c-on-secondary), 1)");oi.css("font-size","1rem").css("color","rgba(var(--v-c-primary), 1)");yt.hide();p.hide();ii.css("display","block");d.show();vt.show();hi.getControl().show();g.getControl().show()}function nt(n){er.css("display",n?"block":"none")}function pf(i){var e,s,o,u,f,r,l;for(c.dGrid!=null&&(c.dGrid.destroy(),c.dGrid=null),c.arrListColumns=[],e=[],s=1,o=0;o<i.Data.length;o++){for(u=i.Data[o],f={},r=0;r<i.Columns.length;r++)c.arrListColumns.length!=i.Columns.length&&c.arrListColumns.push({field:i.Columns[r],caption:n.Msg.translate(n.Env.getCtx(),i.Columns[r]),sortable:!0,size:"16%",hidden:!1}),u[r]!=null&&typeof u[r]=="object"?f[i.Columns[r]]=u[r].Name:u[r]!=null&&i.Columns[r].indexOf("Date")>0?u[r]!=""&&(l=new Date(parseInt(u[r].substr(6))),e!=null&&(f[i.Columns[r]]=l.toLocaleDateString())):f[i.Columns[r]]=u[r]!=null&&typeof u[r]=="number"&&(n.Msg.translate(n.Env.getCtx(),"AmtAcctCr")==i.Columns[r]||n.Msg.translate(n.Env.getCtx(),"AmtAcctDr")==i.Columns[r])?parseFloat(u[r]).toLocaleString():u[r];f.recid=s;s++;e.push(f)}setTimeout(10);w2utils.encodeTags(e);c.dGrid=t(ii).w2grid({name:"gridAccViewer"+h,recordHeight:40,columns:c.arrListColumns,records:e})}function ht(n){var i=n.attr("name"),t;return n.find("span").text(" "),s.whereInfo.length>0&&(t=s.whereInfo.map(function(n){return n.Key==i}).indexOf(!0),s.whereInfo.splice(t,1)),n.width=44,0}function wf(){if(ei!=null)ei.on(n.Events.onTouchStartOrClick,function(){ou()});if(oi!=null)oi.on(n.Events.onTouchStartOrClick,function(){c.dGrid.refresh();ur()});if(lt!=null&&lt.getControl().change(function(){rf()}),g!=null&&g.getControl().change(function(){nt(!0);s.C_AcctSchema_ID=g.getControl().find("option:selected").val();setTimeout(function(){s.Query(r,uf)},2)}),ct!=null)ct.on("click",function(){nt(!0);g.setValue(lt.getControl().find("option:selected").val());fr();nt(!1)});if(ut!=null&&ut.change(function(){ff()}),at!=null&&at.getControl().change(function(){ef();s.Record_ID=f;s.VAF_TableView_ID}),d!=null)d.on("click",function(){nt(!0);var n=gf();setTimeout(function(){n?bf(s.Record_ID):nt(!1)},5)});if(l!=null)l.on("click",function(){ri(l)});if(w!=null)w.on("click",function(){ri(w)});if(a!=null)a.on("click",function(){ri(a)});if(v!=null)v.on("click",function(){ri(v)});if(y!=null)y.on("click",function(){ri(y)});if(b!=null)b.on("click",function(){ri(b)});if(k!=null)k.on("click",function(){ri(k)});if(ft!=null)ft.on("click",function(){ht(l)});if(et!=null)et.on("click",function(){ht(w)});if(tt!=null)tt.on("click",function(){ht(a)});if(it!=null)it.on("click",function(){ht(v)});if(rt!=null)rt.on("click",function(){ht(y)});if(ot!=null)ot.on("click",function(){ht(b)});if(st!=null)st.on("click",function(){ht(k)})}function bf(i){t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerRePost",type:"POST",async:!0,data:{dataRecID:i},success:function(){},error:function(n){$selfObj.log.info(n);nt(!1)}})}function kf(){var u,f;ir=t("<div id='topDiv_"+h+"' style='float: left; width: 100%;'><div id='queryDiv_"+h+"'style='display: inline-block; margin-right: 15px; margin-top: 5px' ><label id='lblquery_"+h+"' class='VIS_Pref_Label_Font' style='cursor: pointer;font-size: 1rem;color: rgba(var(--v-c-primary), 1);'>"+n.Msg.getMsg("ViewerQuery")+"<\/label><\/div><div id='resulttopDiv_"+h+"' style='display: inline-block; width: 160px;'><label id='lblresult_"+h+"' class='VIS_Pref_Label_Font' style='vertical-align: middle; cursor: pointer;'>"+n.Msg.getMsg("ViewerResult")+"<\/label><\/div><\/div>");var b=t("<div id='resultTopFilterDiv_"+h+"' style='float: right;width: 50%;'>"),nt=t('<div class="input-group vis-input-wrap">'),ot=t('<div class="vis-control-wrap">');b.append(nt);nt.append(ot);ot.append(g.getControl()).append(hi.getControl());ir.append(b);p=t("<div class='vis-leftsidebarouterwrap' id='leftSideDiv_"+h+"' style='float: left;background-color: rgba(var(--v-c-secondary), 1);overflow: auto;padding: 10px;'>");n.Application.isRTL&&p.css("float","right");p.css("width","50%");p.css("height",rr);ti=t("<div style='float: left;width: 100%;height: 100%;' id='parameterLeftDiv_"+h+"'>");p.append(ti);var e=t("<table style='width: 100%;height: 100%;'>"),r=t("<tr>"),i=t("<td>"),u=t('<div class="input-group vis-input-wrap">'),f=t('<div class="vis-control-wrap">');ti.append(e);e.append(r);r.append(i);i.append(u);u.append(f);f.append(lt.getControl()).append(vr.getControl());r=t("<tr>");u=t('<div class="input-group vis-input-wrap">');f=t('<div class="vis-control-wrap">');e.append(r);i=t("<td>");r.append(i);i.append(u);u.append(f);f.append(pi.getControl()).append(yr.getControl());r=t("<tr>");i=t("<td>");u=t('<div class="input-group vis-input-wrap">');f=t('<div class="vis-control-wrap">');e.append(r);r.append(i);i.append(u);u.append(f);f.append(ut);r=t("<tr>");i=t("<td>");var u=t('<div class="input-group vis-input-wrap">'),f=t('<div class="vis-control-wrap">'),o=t('<div class="input-group-append">');e.append(r);r.append(i);i.append(u);u.append(f);u.append(o);f.append(at.getControl().attr("placeholder"," ").attr("data-placeholder","").attr("data-hasbtn"," "));o.append(l).append(ft);r=t("<tr>");u=t('<div class="input-group vis-input-wrap">');f=t('<div class="vis-control-wrap">');e.append(r);i=t("<td>");r.append(i);i.append(u);u.append(f);f.append(ci).append(pr.getControl());r=t("<tr>");u=t('<div class="input-group vis-input-wrap">');f=t('<div class="vis-control-wrap">');e.append(r);i=t("<td>");r.append(i);i.append(u);u.append(f);f.append(li).append(wr.getControl());r=t("<tr>");u=t('<div class="input-group vis-input-wrap">');f=t('<div class="vis-control-wrap">');e.append(r);i=t("<td>");r.append(i);i.append(u);u.append(f);f.append(fi.getControl()).append(br.getControl());r=t("<tr>");var u=t('<div class="input-group vis-input-wrap">'),f=t('<div class="vis-control-wrap">'),o=t('<div class="input-group-append">'),s=t('<input type="text" readonly data-hasbtn=" ">');e.append(r);i=t("<td>");r.append(i);i.append(u);u.append(f);u.append(o);f.append(s).append(kr.getControl());o.append(w).append(et);r=t("<tr>");var u=t('<div class="input-group vis-input-wrap">'),f=t('<div class="vis-control-wrap">'),o=t('<div class="input-group-append">'),s=t('<input type="text" readonly data-hasbtn=" ">');e.append(r);i=t("<td>");r.append(i);i.append(u);u.append(f);u.append(o);f.append(s).append(gu.getControl());o.append(k).append(st);r=t("<tr>");var u=t('<div class="input-group vis-input-wrap">'),f=t('<div class="vis-control-wrap">'),o=t('<div class="input-group-append">'),s=t('<input type="text" readonly data-hasbtn=" ">');e.append(r);i=t("<td>");r.append(i);i.append(u);u.append(f);u.append(o);f.append(s).append(dr.getControl());o.append(a).append(tt);r=t("<tr>");var u=t('<div class="input-group vis-input-wrap">'),f=t('<div class="vis-control-wrap">'),o=t('<div class="input-group-append">'),s=t('<input type="text" readonly data-hasbtn=" ">');e.append(r);i=t("<td>");r.append(i);i.append(u);u.append(f);u.append(o);f.append(s).append(gr.getControl());o.append(v).append(it);r=t("<tr>");var u=t('<div class="input-group vis-input-wrap">'),f=t('<div class="vis-control-wrap">'),o=t('<div class="input-group-append">'),s=t('<input type="text" readonly data-hasbtn=" ">');e.append(r);i=t("<td>");r.append(i);i.append(u);u.append(f);u.append(o);f.append(s).append(nu.getControl());o.append(y).append(rt);yt=t("<div id='rightSideDiv_"+h+"' style='float: right;margin-bottom: 3px; margin-right: 0px; '>");yt.css("width","50%");yt.css("height",rr);ti=t("<div style='float: left;width: 100%;height: 100%;' id='parameterRightDiv_"+h+"'>");yt.append(ti);e=t("<table style='width: 100%;height: 100%;'>");r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");ti.append(e);e.append(r);r.append(i);i.append(nr);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");e.append(r);r.append(i);i.append(tr);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");e.append(r);r.append(i);i.append(gi);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");e.append(r);r.append(i);i.append(tu.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(iu.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");e.append(r);r.append(i);i.append(bt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(ru);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");e.append(r);r.append(i);i.append(kt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(uu);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");e.append(r);r.append(i);i.append(dt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(fu);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");e.append(r);r.append(i);i.append(gt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(eu);pt=t("<div class='vis-acctviewerbottdiv'>");c.getIsMenu()||(pt.append(d),pt.append(vt));pt.append(ni.getControl().addClass("VIS_Pref_Label_Font"));pt.append(ct);pt.append(si);ii=t("<div id='resultDiv_"+h+"' style='float: left; width: 100%; display: none;'>");ii.css("height",rr);wt.append(ir).append(p).append(yt).append(ii).append(pt);wt.append(er)}function df(t,u){s=new i(h,r,t);s.onLoaded=function(){vi(lt.getControl(),s.getAcctSchema());g.getControl().append("<option value='-1' ><\/option>");vi(g.getControl(),s.getAcctSchema());rf();vi(at.getControl(),s.getTable());vi(pi.getControl(),s.getPostingType());vi(fi.getControl(),s.getOrg());l.find("span").text("");w.attr("Name",yi);et.attr("Name",yi);w.find("span").text("");a.attr("Name",cr);tt.attr("Name",cr);a.find("span").text("");v.attr("Name",lr);it.attr("Name",lr);v.find("span").text("");y.attr("Name",yu);rt.attr("Name",yu);y.find("span").text("");b.attr("Name",ar);ot.attr("Name",ar);b.find("span").text("");k.attr("Name",hr);st.attr("Name",hr);k.find("span").text("");var i=t!=0&&u!=0;i&&ut.find("input").prop("checked",!0);ff();ef();ni.getControl().text(n.Msg.getMsg("VIS_EnterSelctionAndDisplayToQueryFind"));ni.getControl().css("color","rgba(var(--v-c-primary), 1)");i&&(s.VAF_TableView_ID=t,s.Record_ID=u);fr()}}function rf(){var o=lt.getControl().find("option:selected").val(),e,r,t,i,u;if(o!=null){for(s.C_AcctSchema_ID=o,e=s.getAcctSchemaElements(s.C_AcctSchema_ID),bt.getControl().empty(),kt.getControl().empty(),dt.getControl().empty(),gt.getControl().empty(),ai({Key:"",Name:""}),ai({Key:"DateAcct",Name:n.Msg.translate(n.Env.getCtx(),"DateAcct")}),ai({Key:"DateTrx",Name:n.Msg.translate(n.Env.getCtx(),"DateTrx")}),ai({Key:"C_Period_ID",Name:n.Msg.translate(n.Env.getCtx(),"C_Period_ID")}),r=[],r.push(wu),r.push(bu),r.push(ku),r.push(du),t=[],t.push(a),t.push(v),t.push(y),t.push(b),t.push(tt),t.push(it),t.push(rt),t.push(ot),t.push(wi),t.push(bi),t.push(ki),t.push(di),t.push(k),t.push(st),i=0,u=0;u<e.length&&i<r.length;u++){var f=e[u][0],h=s.getColumnName(f.elementtype),c=s.getColumnName(f.elementtype);ai({Key:h,Name:n.Msg.translate(n.Env.getCtx(),c)});f.elementtype=="OO"||f.elementtype=="AC"||(r[i].getControl().text(n.Msg.translate(n.Env.getCtx(),c)),r[i].getControl().show(),t[i].attr("Name",h),t[i].find("span").text(""),t[i].show(),i++)}while(i<r.length)r[i].getControl().hide(),i++;bt.getControl().prop("selectedIndex",0);kt.getControl().prop("selectedIndex",0);dt.getControl().prop("selectedIndex",0);gt.getControl().prop("selectedIndex",0)}}function ai(n){bt.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>");kt.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>");dt.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>");gt.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>")}function fr(){var t="",i,u,f;if(s.C_AcctSchema_ID=0,s.VAF_Org_ID=0,i=lt.getControl().find("option:selected").val(),i!=null&&(s.C_AcctSchema_ID=i),t=t.concat("C_AcctSchema_ID=").concat(s.C_AcctSchema_ID),i=pi.getControl().find("option:selected").val(),i!=null&&i!="0"&&(s.PostingType=i),t=t.concat(", PostingType=").concat(s.PostingType),s.documentQuery=ut.find("input").prop("checked"),t=t.concat(", DocumentQuery=").concat(s.documentQuery),ut.find("input").prop("checked")){if(s.VAF_TableView_ID==0||s.Record_ID==0)return;t=t.concat(", VAF_TableView_ID=").concat(s.VAF_TableView_ID).concat(", Record_ID=").concat(s.Record_ID)}else if(s.DateFrom=ci.val(),s.DateFrom!=""&&(t=t.concat(", DateFrom=").concat(s.DateFrom)),s.DateTo=li.val(),s.DateTo!=""&&(t=t.concat(", DateTo=").concat(s.DateTo)),i=fi.getControl().find("option:selected").val(),i!=null&&(s.VAF_Org_ID=i),t=t.concat(", VAF_Org_ID=").concat(s.VAF_Org_ID),u=s.whereInfo,u!=null)for(f=0;f<u.length;f++)t=t.concat(", ").concat(u[f].Value);s.displayQty=gi.prop("checked");t=t.concat(", - Display Qty=").concat(s.displayQty);s.displaySourceAmt=tr.prop("checked");t=t.concat(", Source=").concat(s.displaySourceAmt);s.displayDocumentInfo=nr.prop("checked");t=t.concat(", Doc=").concat(s.displayDocumentInfo);bt.getControl().find("option:selected").val()!=null&&(s.sortBy1=bt.getControl().find("option:selected").val());s.group1=ru.prop("checked");t=t.concat(" - Sorting: ").concat(s.sortBy1).concat("/").concat(s.group1);kt.getControl().find("option:selected").val()!=null&&(s.sortBy2=kt.getControl().find("option:selected").val());s.group2=uu.prop("checked");t=t.concat(", ").concat(s.sortBy2).concat("/").concat(s.group2);dt.getControl().find("option:selected").val()!=null&&(s.sortBy3=dt.getControl().find("option:selected").val());s.group3=fu.prop("checked");t=t.concat(", ").concat(s.sortBy3).concat("/").concat(s.group3);gt.getControl().find("option:selected").val()!=null&&(s.sortBy4=gt.getControl().find("option:selected").val());s.group4=eu.prop("checked");t=t.concat(", ").concat(s.sortBy4).concat("/").concat(s.group4);ct.Enabled=!1;ni.getControl().text(n.Msg.translate(n.Env.getCtx(),"Processing"));c.getIsMenu()?cu?(c.dGrid.refresh(),ur()):ou():ur();cu=!0;s.Query(r,uf);s.C_AcctSchema_ID>0&&g.setValue(s.C_AcctSchema_ID);ct.Enabled=!0;ni.getControl().text(n.Msg.getMsg("VIS_EnterSelctionAndDisplayToQueryFind"))}function uf(n){n!=null&&pf(n);nt(!1)}function ff(){var n=ut.find("input").prop("checked");n?(at.getControl().removeAttr("disabled"),l.removeAttr("disabled"),ft.removeAttr("disabled"),ci.attr("disabled","disabled"),li.attr("disabled","disabled"),fi.getControl().attr("disabled","disabled"),w.attr("disabled","disabled"),a.attr("disabled","disabled"),v.attr("disabled","disabled"),y.attr("disabled","disabled"),b.attr("disabled","disabled"),k.attr("disabled","disabled"),et.attr("disabled","disabled"),tt.attr("disabled","disabled"),it.attr("disabled","disabled"),rt.attr("disabled","disabled"),ot.attr("disabled","disabled"),st.attr("disabled","disabled"),wi.attr("disabled","disabled"),bi.attr("disabled","disabled"),ki.attr("disabled","disabled"),di.attr("disabled","disabled")):(at.getControl().attr("disabled","disabled"),l.attr("disabled","disabled"),ft.attr("disabled","disabled"),ci.removeAttr("disabled"),li.removeAttr("disabled"),fi.getControl().removeAttr("disabled"),w.removeAttr("disabled"),a.removeAttr("disabled"),v.removeAttr("disabled"),y.removeAttr("disabled"),b.removeAttr("disabled"),k.removeAttr("disabled"),et.removeAttr("disabled"),tt.removeAttr("disabled"),it.removeAttr("disabled"),rt.removeAttr("disabled"),ot.removeAttr("disabled"),st.removeAttr("disabled"),wi.removeAttr("disabled"),bi.removeAttr("disabled"),ki.removeAttr("disabled"),di.removeAttr("disabled"))}function ef(){var n=at.getControl().find("option:selected").val();n!=null&&jQuery.grep(s.tableInfo,function(t){return t.Name==n})[0]!=null&&(s.VAF_TableView_ID=jQuery.grep(s.tableInfo,function(t){return t.Name==n})[0].Key);l.find("span").text("");l.attr("Name",n+"_ID");ft.attr("Name",n+"_ID")}function ri(t){var r,o,f;s.HasOrgUnit==null&&te();var u=t.attr("name"),e="IsSummary='N'",i=u;u.equals("Account_ID")?(i="C_ElementValue_ID",r=s.getAcctSchemaElement("AC"),r!=null&&(e+=" AND C_Element_ID="+r.c_element_id)):u.equals("User1_ID")?(i="C_ElementValue_ID",r=s.getAcctSchemaElement("U1"),r!=null&&(e+=" AND C_Element_ID="+r.c_element_id)):u.equals("User2_ID")?(i="C_ElementValue_ID",r=s.getAcctSchemaElement("U2"),r!=null&&(e+=" AND C_Element_ID="+r.c_element_id)):ut.find("input").prop("checked")&&(e="");o=i.substring(0,i.length-3);u=="M_Product_ID"?f=new n.InfoWindow(101,"",s.windowNo,"",!1):u=="C_BPartner_ID"?f=new n.InfoWindow(100,"",s.windowNo,"",!1):u==hr?(i=sr,o=i.substring(0,i.length-3),s.HasOrgUnit&&(e+=" AND (IsCostCenter='Y' OR IsProfitCenter='Y')"),f=new n.infoGeneral(!0,s.windowNo,"",o,i,!1,e)):f=new n.infoGeneral(!0,s.windowNo,"",o,i,!1,e);f.onClose=function(){var r=null,n=f.getSelectedValues();return(n!=null&&n.length>0&&(r=i+"="+n.toString()),f=null,r==null||r.length==0||n.length==0)?(ht(t),0):(t==l?s.Record_ID=n:(ht(t),s.whereInfo.push({Key:u,Value:u+"="+n})),t.find("span").text(s.getButtonText(o,i,r)),t.find("span").text()!=""?t.AutoSize=!0:t.Width=44,n)};f.show()}function gf(){if(n.ADialog.ask("PostImmediate?")){if(s.documentQuery&&s.VAF_TableView_ID!=0&&s.Record_ID!=0){var i=vt.prop("checked");ne(function(r){var u=!1,f,e;r=="Yes"&&(u=!0);window.FRPT&&u?(f=Number(n.context.getWindowTabContext(h,0,"VAF_Org_ID")),e=Number(n.context.getWindowTabContext(h,0,"C_DocType_ID")),t.ajax({url:n.Application.contextUrl+"FRPT/PostingLogicFRPT/PostImediateFRPT",dataType:"json",async:!0,data:{VAF_Client_ID:s.VAF_Client_ID,VAF_TableView_ID:s.VAF_TableView_ID,Record_ID:s.Record_ID,force:i,OrgID:f,AD_Window_ID:sf,DocTypeID:e},error:function(){nt(!1);n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer"))},success:function(n){n.result&&fr()}})):t.ajax({url:n.Application.contextUrl+"Posting/PostImmediate",dataType:"json",data:{VAF_Client_ID:s.VAF_Client_ID,VAF_TableView_ID:s.VAF_TableView_ID,Record_ID:s.Record_ID,force:i},error:function(){nt(!1);n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer"))},success:function(n){n.result=="OK"&&fr()}})})}return!0}return nt(!1),!1}function ne(i){t.ajax({url:n.Application.contextUrl+"Posting/PostByNewLogic",dataType:"json",async:!0,data:{VAF_Client_ID:n.context.getVAF_Client_ID()},error:function(){alert(n.Msg.getMsg("ERRORGettingPostingServer"))},success:function(n){i&&i(n.result)}})}function te(){t.ajax({url:n.Application.contextUrl+"AcctViewerData/HasOrganizationUnit",dataType:"json",async:!1,error:function(){alert(n.Msg.getMsg("ERROR"))},success:function(n){n!=null&&(s.HasOrgUnit=n.result)}})}function vi(t,i){for(var r=0;r<i.length;r++)t.append(" <option selected value='"+i[r].Key+"' >"+n.Utility.decodeText(i[r].Name)+"<\/option>");t.prop("selectedIndex",0)}var wt=t("<div style='position:relative;'>"),er=t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'),c=this,of=r,su=u,hu=f,h=e,sf=o;this.arrListColumns=[];this.dGrid=null;this.menuForm=!1;var cu=!1,or="C_AcctSchema_ID",hf="DocumentType",lu="PostingType",sr="VAF_Org_ID",hr="VAF_OrgTrx_ID",yi="Account_ID",au="SelectDocument",vu="AcctDateFrom",cr="M_Product_ID",lr="C_BPartner_ID",yu="C_Project_ID",ar="C_Campaign_ID",ui=n.Application.contextUrl+"Areas/VIS/Images/base/Find24.gif",ie=n.Application.contextUrl+"Areas/VIS/Images/cancel-18.png",cf=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png",lf=n.Application.contextUrl+"Areas/VIS/Images/base/Print24.PNG",ct=t("<button id='btnRefresh_"+h+"'style='margin-top: 0;' class='VIS_Pref_btn-2'><i class='vis vis-refresh'><\/i><\/button>"),si=t("<button class='VIS_Pref_btn-2' id='btnPrint_"+h+"' style='margin-top: 0px; margin-left: 10px;'><i class='vis vis-print'><\/button>"),d=t("<button class='VIS_Pref_btn-2' id='btnRePost_"+h+"' style='margin-top: 0px;'><img src='"+ui+"'/><\/button>"),l=t("<button class='input-group-text' Name='btnSelctDoc' id='btnSelctDoc_"+h+"'><i class='vis vis-find'><\/i><\/button>"),w=t("<button class='input-group-text' Name='btnAccount' id='btnAccount_"+h+"'><i class='vis vis-find'><\/i><\/button>"),a=t("<button class='input-group-text' Name='btnProduct' id='btnProduct_"+h+"'><i class='vis vis-find'><\/i><\/button>"),v=t("<button class='input-group-text' Name='btnBPartner' id='btnBPartner_"+h+"'><i class='vis vis-find'><\/i><\/button>"),y=t("<button class='input-group-text'Name='btnProject' id='btnProject_"+h+"'><i class='vis vis-find'><\/i><\/button>"),b=t("<button class='input-group-text' Name='btnCampaning' id='btnCampaning_"+h+"'><i class='vis vis-find'><\/i><\/button>"),k=t("<button class='input-group-text' Name='btnOrgUnit' id='btnOrgUnit_"+h+"'><i class='vis vis-find'><\/i><\/button>"),ft=t("<button Name='btnSelctDocClear' id='btnSelctDocClear_"+h+"' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"),et=t("<button  Name='btnAccountClear' id='btnAccountClear_"+h+"'   class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"),tt=t("<button  Name='btnProductClear' id='btnProductClear_"+h+"'   class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"),it=t("<button Name='btnBPartnerClear' id='btnBPartnerClear_"+h+"' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"),rt=t("<button  Name='btnProjectClear' id='btnProjectClear_"+h+"'   class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"),ot=t("<button Name='btnCampaningClear' id='btnCampaningClear_"+h+"' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"),st=t("<button Name='btnOrgUnitClear' id='btnOrgUnitClear_"+h+"' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"),lt=new n.Controls.VComboBox("",!1,!1,!0),g=new n.Controls.VComboBox("",!1,!1,!0),pi=new n.Controls.VComboBox("",!1,!1,!0),fi=new n.Controls.VComboBox("",!1,!1,!0),at=new n.Controls.VComboBox("",!1,!1,!0),bt=new n.Controls.VComboBox("",!1,!1,!0),kt=new n.Controls.VComboBox("",!1,!1,!0),dt=new n.Controls.VComboBox("",!1,!1,!0),gt=new n.Controls.VComboBox("",!1,!1,!0),vr=new n.Controls.VLabel,hi=new n.Controls.VLabel,yr=new n.Controls.VLabel,pr=new n.Controls.VLabel,wr=new n.Controls.VLabel,br=new n.Controls.VLabel,kr=new n.Controls.VLabel,dr=new n.Controls.VLabel,gr=new n.Controls.VLabel,nu=new n.Controls.VLabel,pu=new n.Controls.VLabel,tu=new n.Controls.VLabel,iu=new n.Controls.VLabel,wu=new n.Controls.VLabel,bu=new n.Controls.VLabel,ku=new n.Controls.VLabel,du=new n.Controls.VLabel,gu=new n.Controls.VLabel,wi=t("<button id='btnSel5_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+ui+"' /><span><\/span><\/button>"),bi=t("<button id='btnSel6_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+ui+"' /><span><\/span><\/button>"),ki=t("<button id='btnSel7_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+ui+"' /><span><\/span><\/button>"),di=t("<button id='btnSel8_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+ui+"' /><span><\/span><\/button>"),ni=new n.Controls.VLabel,nf=new n.Controls.VLabel,tf=new n.Controls.VLabel,ei=null,oi=null,ut=t("<label id='lblSelectDoc_"+h+"' class='VIS_Pref_Label_Font vis-ec-col-lblchkbox'><input id='chkSelectDoc_"+h+"' type='checkbox' checked class='VIS_Pref_automatic'>SelectDoc<\/label>"),gi=t("<input id='chkQty_"+h+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblQty_"+h+"' class='VIS_Pref_Label_Font'>chkQty<\/label><\/span>"),vt=t("<input id='chkforcePost_"+h+"' type='checkbox' class='VIS_Pref_automatic' style='display: inline-block;margin-left: 20px; margin-top: 0;'><span><label id='lblforcePost_"+h+"' class='VIS_Pref_Label_Font'>chkforcePost<\/label><\/span>"),nr=t("<input id='chkDisDocinfo_"+h+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblDisDocinfo_"+h+"' class='VIS_Pref_Label_Font'>chkDisDocinfo<\/label><\/span>"),tr=t("<input id='chkDisSouce_"+h+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblDisSouce_"+h+"' class='VIS_Pref_Label_Font'>chkDisSouce<\/label><\/span>"),ru=t("<input id='chkSumriz1_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),uu=t("<input id='chkSumriz2_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),fu=t("<input id='chkSumriz3_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),eu=t("<input id='chkSumriz4_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),ci=t("<input id='vdtpkAccDateFrom_"+h+"' type='date' name='DateOrdered'>"),li=t("<input id='vdtpkAccDateTo_"+h+"' type='date' name='DateOrdered'>"),ir=null,p=null,yt=null,ti=null,pt=null,ii=null,af=t(window).width()/2,vf=t(window).width()/2,rr=t(window).height()-200,s=null;this.showDialog=function(){kf();nt(!0);ei=wt.find("#lblquery_"+h);oi=wt.find("#lblresult_"+h);c.getIsMenu()?ou():ur();d.hide();vt.hide();si.hide();yf();wf();df(su,hu);wt.dialog({modal:!0,resizable:!1,title:n.Msg.getMsg("AcctViewer"),width:t(window).width()/2+t(window).width()/4,position:{at:"center top",of:window},close:function(){c.dGrid!=null&&(c.dGrid.destroy(),c.dGrid=null);c.dispose();c=null;wt.dialog("destroy");wt=null}})};this.disposeComponent=function(){ct&&ct.off("click");si&&si.off("click");d&&d.off("click");l&&l.off("click");w&&w.off("click");a&&a.off("click");v&&v.off("click");y&&y.off("click");b&&b.off("click");ft&&ft.off("click");et&&et.off("click");tt&&tt.off("click");it&&it.off("click");rt&&rt.off("click");ot&&ot.off("click");st&&st.off("click");k&&k.off("click");of=null;su=null;hu=null;h=null;this.arrListColumns=null;this.dGrid=null;or=null;hf=null;lu=null;sr=null;yi=null;au=null;vu=null;ui=null;cf=null;lf=null;ct=null;si=null;d=null;l=null;w=null;a=null;v=null;y=null;b=null;ft=null;et=null;tt=null;it=null;rt=null;ot=null;lt=null;g=null;pi=null;fi=null;at=null;bt=null;kt=null;dt=null;gt=null;vr=null;hi=null;yr=null;pr=null;wr=null;br=null;kr=null;dr=null;gr=null;nu=null;pu=null;tu=null;iu=null;wu=null;bu=null;ku=null;du=null;wi=null;bi=null;ki=null;di=null;ni=null;nf=null;tf=null;ei=null;oi=null;ut=null;gi=null;vt=null;nr=null;tr=null;ru=null;uu=null;fu=null;eu=null;ci=null;li=null;ir=null;p=null;yt=null;ti=null;pt=null;ii=null;af=null;vf=null;rr=null;s=null;er=null;this.disposeComponent=null}}i.prototype.getAcctSchema=function(){return this.ASchemas};i.prototype.getTable=function(){var i=[],r=null,u=this;return t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerGetTabelData",type:"POST",async:!1,success:function(t){var o,f;if((this.tableInfo==undefined||this.tableInfo==null)&&(this.tableInfo=[]),t.result)for(i.push({Key:"",Name:""}),o=t.result,f=0;f<o.length;f++){var s=o[f].VAF_TableView_ID,e=n.Utility.encodeText(o[f].TableName),h="";h=e=="C_Order"?n.Msg.getMsg("Order"):n.Msg.translate(n.Env.getCtx(),e+"_ID");i.push({Key:e,Name:h});u.tableInfo.push({Key:s,Name:e});s==this.VAF_TableView_ID&&(r=e)}},error:function(n){$selfObj.log.info(n)}}),i};i.prototype.getOrg=function(){var i=[],r=this.VAF_Client_ID;return t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerGetOrgData",type:"POST",async:!1,data:{client_id:r},success:function(t){var u=t.result,r;if(u)for(i.push({Key:0,Name:""}),r=0;r<u.length;r++)i.push({Key:u[r].VAF_Org_ID,Name:n.Utility.encodeText(u[r].OrgName)})},error:function(n){$selfObj.log.info(n)}}),i};i.prototype.getPostingType=function(){var i=[];return t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerGetPostingType",type:"POST",async:!1,data:{reference_id:125},success:function(t){var u=t.result,r;if(u)for(i.push({Key:0,Name:""}),r=0;r<u.length;r++)i.push({Key:u[r].PostingValue,Name:n.Utility.encodeText(u[r].PostingName)})},error:function(n){$selfObj.log.info(n)}}),i};i.prototype.getAcctSchemaElements=function(i){this._elements=[];var r=this._elements;return t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerGetAcctSchElements",type:"POST",async:!0,data:{keys:i},success:function(t){var u=t.result,i,f;if(u)for(i=0;i<u.length;i++)f=[],f.push({c_acctschema_element_id:u[i].C_AcctSchema_Element_ID,name:n.Utility.encodeText(u[i].ElementName),elementtype:u[i].ElementType,c_elementvalue_id:u[i].C_ElementValue_ID,seqno:u[i].SeqNo,detail:u[i].Detail,c_element_id:u[i].C_Element_ID}),r.push(f)},error:function(n){$selfObj.log.info(n)}}),r};i.prototype.getAcctSchemaElement=function(n){var t,i;for(this._elements==null&&this.getAcctSchemaElements(),t=0;t<this._elements.length;t++)if(i=this._elements[t][0],i.elementtype.equals(n))return i;return null};i.prototype.getColumnName=function(n){return n.equals(this.ELEMENTTYPE_Organization)?"VAF_Org_ID":n.equals(this.ELEMENTTYPE_Account)?"Account_ID":n.equals(this.ELEMENTTYPE_BPartner)?"C_BPartner_ID":n.equals(this.ELEMENTTYPE_Product)?"M_Product_ID":n.equals(this.ELEMENTTYPE_Activity)?"C_Activity_ID":n.equals(this.ELEMENTTYPE_LocationFrom)?"C_LocFrom_ID":n.equals(this.ELEMENTTYPE_LocationTo)?"C_LocTo_ID":n.equals(this.ELEMENTTYPE_Campaign)?"C_Campaign_ID":n.equals(this.ELEMENTTYPE_OrgTrx)?"VAF_OrgTrx_ID":n.equals(this.ELEMENTTYPE_Project)?"C_Project_ID":n.equals(this.ELEMENTTYPE_SalesRegion)?"C_SalesRegion_ID":n.equals(this.ELEMENTTYPE_UserList1)?"User1_ID":n.equals(this.ELEMENTTYPE_UserList2)?"User2_ID":n.equals(this.ELEMENTTYPE_UserElement1)?"UserElement1_ID":n.equals(this.ELEMENTTYPE_UserElement2)?"UserElement2_ID":""};i.prototype.getButtonText=function(i,r,u){var e=n.Env.getVAF_Language(n.Env.getCtx()),o=n.MLookupFactory.getLookup_TableDirEmbed(e,r,"avd",r),f="<"+u+">";return t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerGetButtonText",type:"POST",async:!1,data:{lookupDirEmbeded:o,tName:i,wheres:" avd WHERE avd.",selectSQLs:u},success:function(n){var t=n.result;t!=""&&(f=t)},error:function(n){$selfObj.log.info(n)}}),f};i.prototype.Query=function(t,i){var r="",f,e,o,u;if(this.C_AcctSchema_ID!=0&&(r=r.concat(this.TABLE_ALIAS).concat(".C_AcctSchema_ID=").concat(this.C_AcctSchema_ID)),this.PostingType!=null&&this.PostingType.length>0&&(r.length>0&&(r=r.concat(" AND ")),r=r.concat(this.TABLE_ALIAS).concat(".PostingType='").concat(this.PostingType).concat("'")),this.documentQuery)r.length>0&&(r=r.concat(" AND ")),r=r.concat(this.TABLE_ALIAS).concat(".VAF_TableView_ID=").concat(this.VAF_TableView_ID).concat(" AND ").concat(this.TABLE_ALIAS).concat(".Record_ID=").concat(this.Record_ID);else{if(f=this.whereInfo,f!=null)for(e=0;e<f.length;e++)o=f[e].Value,o!=null&&o.length>0&&(r.length>0&&(r=r.concat(" AND ")),r=r.concat(this.TABLE_ALIAS).concat(".").concat(o));(!this.DateFrom!=null||this.DateTo!=null)&&(r.length>0&&(this.DateFrom!=""||this.DateTo!="")&&(r=r.concat(" AND ")),this.DateFrom!=""&&this.DateTo!=""?r=r.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') BETWEEN ").concat(n.DB.to_date(this.DateFrom)).concat(" AND ").concat(n.DB.to_date(this.DateTo)):this.DateFrom!=""?r=r.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') >= ").concat(n.DB.to_date(this.DateFrom)):this.DateTo!=""&&(r=r.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') <= ").concat(n.DB.to_date(this.DateTo))));this.VAF_Org_ID!=0&&(r.length>0&&(r=r.concat(" AND ")),r=r.concat(this.TABLE_ALIAS).concat(".VAF_Org_ID=").concat(this.VAF_Org_ID))}u="";this.sortBy1.length>0&&(u=u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy1));this.sortBy2.length>0&&(u.length>0&&(u=u.concat(",")),u=u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy2));this.sortBy3.length>0&&(u.length>0&&(u=u.concat(",")),u=u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy3));this.sortBy4.length>0&&(u.length>0&&(u=u.concat(",")),u=u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy4));u.length==0&&(u=u.concat(this.TABLE_ALIAS).concat(".Fact_Acct_ID"));this.getDataModel(t,r,u,this.group1,this.group2,this.group3,this.group4,this.sortBy1,this.sortBy2,this.sortBy3,this.sortBy4,this.displayDocumentInfo,this.displaySourceAmt,this.displayQty,i)};i.prototype.getDataModel=function(i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){var b=this;t.ajax({url:n.Application.contextUrl+"Common/GetDataQuery",async:!0,dataType:"json",type:"POST",data:{VAF_Client_ID:i,whereClause:r,orderClause:u,gr1:f,gr2:e,gr3:o,gr4:s,sort1:h,sort2:c,sort3:l,sort4:a,displayDocInfo:v,displaySrcAmt:y,displayqty:p},success:function(n){b.dataByData=n.result;w(n.result)}})};r.prototype.dispose=function(){this.disposeComponent()};r.prototype.setIsMenu=function(n){n!=null&&n!=undefined&&(this.menuForm=n)};r.prototype.getIsMenu=function(){return this.menuForm};n.AcctViewer=r}(VIS,jQuery);VIS=window.VIS||{},function(n,t){n.AcctViewerMenu=function(){function e(){r.on("click",function(){i.frame.dispose()})}this.frame;this.windowNo;var f,i=this,r="",u=t("<div>");this.initalize=function(){u.append('<a id="VIS_btnResult_'+i.windowNo+'">button<\/a>');r=u.find("#VIS_btnResult_"+i.windowNo);e()};this.openAccountViewer=function(){var t=new n.AcctViewer(n.context.getVAF_Client_ID(),1,1,this.windowNo,1);t!=null&&(t.setIsMenu(!0),t.showDialog());r.trigger("click")};this.getRoot=function(){return u}};n.AcctViewerMenu.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.initalize();this.openAccountViewer();this.frame.getContentGrid().append(this.getRoot())};n.AcctViewerMenu.prototype.dispose=function(){this.disposeComponent();this.frame=null}}(VIS,jQuery),function(n,t){function i(){function g(){var rt="topDiv_"+i.windowNo,p="btnSpaceDiv_"+i.windowNo,ut="btnSpace_"+i.windowNo,ft="spnSelect_"+i.windowNo,et="spnGenerate_"+i.windowNo,w="lblGenerate_"+i.windowNo,b="lblSelect_"+i.windowNo,k,d,u,f,g,nt,tt,a,it,v,y;o=t('<div class="input-group-append"><button id = "btnClearBP_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" tabindex="-1" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/i><\/button><\/div>');s=t('<div class="input-group-append"><button id = "btnClearOrd_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" tabindex="-1" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/i><\/button><\/div>');i.topDiv=t("<div id='"+rt+"' class='vis-archive-l-s-head vis-frm-ls-top' style='padding: 0;'><div id='"+p+"' class='vis-l-s-headwrp'><button id='"+ut+"'  class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><div id='"+ft+"'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='"+b+"' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 28px;color: rgba(var(--v-c-primary), 1);'>"+n.Msg.translate(n.Env.getCtx(),"Select")+"<\/label><\/div><div id='"+et+"' style='display: inline-block; width: 160px;'><label id='"+w+"' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 17px;'>"+n.Msg.translate(n.Env.getCtx(),"Generate")+"<\/label><\/div><\/div>");k="sideDiv_"+i.windowNo;d="parameterDiv_"+i.windowNo;i.btnSpaceDiv=i.topDiv.find("#"+p);this.lblGenrate=i.topDiv.find("#"+w);this.lblSelect=i.topDiv.find("#"+b);i.sideDiv=t("<div id='"+k+"' class='vis-archive-l-s-content vis-leftsidebarouterwrap'>");i.sideDiv.css("width",r);i.sideDiv.css("height","calc(100% - 103px)");i.div=t("<div class='vis-archive-l-s-content-inner' id='"+d+"'>");i.sideDiv.append(i.div);var l=t("<table style='width: 100%;'>"),e=t("<tr>"),h=t("<td style='padding: 10px 10px 0px;'>");i.div.append(l);u=t('<div class="input-group vis-input-wrap">');f=t('<div class="vis-control-wrap">');l.append(e);e.append(h);h.append(u);u.append(f);f.append(i.cmbWarehouse.getControl());f.append(i.lblWarehouse.getControl().addClass("VIS_Pref_Label_Font"));e=t("<tr>");h=t("<td style='padding: 0px 10px 0px;'>");var u=t('<div class="input-group vis-input-wrap">'),f=t('<div class="vis-control-wrap">'),c=t('<div class="input-group-append">');l.append(e);e.append(h);h.append(u);u.append(f);f.append(i.vSearchBPartner.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," "));f.append(i.lblBPartner.getControl().addClass("VIS_Pref_Label_Font"));u.append(c);c.append(i.vSearchBPartner.getBtn(0));u.append(o);g=n.Msg.translate(n.Env.getCtx(),"SalesOrder_No");e=t("<tr>");h=t("<td style='padding: 0px 10px 0px;'>");var u=t('<div class="input-group vis-input-wrap">'),f=t('<div class="vis-control-wrap">'),c=t('<div class="input-group-append">');l.append(e);e.append(h);h.append(u);u.append(f);f.append(i.vSearchOrder.getControl(0).attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," "));f.append("<label>"+g+"<\/label>");u.append(c);c.append(i.vSearchOrder.getBtn(0));u.append(s);nt="gridSelectDiv_"+i.windowNo;tt="gridGenerateDiv_"+i.windowNo;i.gridSelectDiv=t("<div id='"+nt+"' class='vis-frm-grid-outerwrp'>");i.gridGenerateDiv=t("<div id='"+tt+"' style='height: 85%; float: right; display: none; background-color: rgba(var(--v-c-secondary), .8); margin-left: 15px;margin-right: 15px;'>");i.gridGenerateDiv.css("width",t(window).width()-30);a="btnOk_"+i.windowNo;i.okBtn=t("<input id='"+a+"' class='VIS_Pref_btn-2' style='margin-top: 0px;width: 70px;height: 38px;' type='button' value='Ok'>");a="btnRefresh_"+i.windowNo;i.btnRefresh=t("<button id='"+a+"' style='margin-top: 0px;' class='VIS_Pref_btn-2'><i class='vis vis-refresh'><\/i><\/button>");it="discriptionDiv_"+i.windowNo;i.bottumDiv=t("<div class='vis-info-btmcnt-wrap vis-p-t-10'>");v=t("<div id='"+it+"' style='flex: 1;padding: 0 10px;'>");v.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font"));y=t("<div>");y.append(i.okBtn);i.bottumDiv.append(i.btnRefresh).append(v).append(y);i.$root.append(i.$busyDiv);i.$busyDiv[0].style.visibility="hidden";i.$root.append(i.topDiv).append(i.sideDiv).append(i.gridSelectDiv).append(i.gridGenerateDiv).append(i.bottumDiv)}function nt(){i.lblWarehouse.getControl().text(n.Msg.translate(n.Env.getCtx(),"M_Warehouse_ID"));i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));i.tabSelect.getControl().text(n.Msg.getMsg("Select",!1,!1));i.tabGenrate.getControl().text(n.Msg.getMsg("Generate",!1,!1));i.lblStatusInfo.getControl().text(n.Msg.getMsg("VIS_OrderGenShip",!1,!1))}function tt(){var u=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,2223,n.DisplayType.TableDir,"M_Warehouse_ID",0,!1,"M_Warehouse.IsActive='Y'"),t,r;i.cmbWarehouse=new n.Controls.VComboBox("M_Warehouse_ID",!0,!1,!0,u,150,n.DisplayType.TableDir,0);t=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,2762,n.DisplayType.Search,"C_BPartner_ID",0,!1,"C_BPartner.IsActive ='Y' And C_Bpartner.Issummary ='N'");i.vSearchBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,t);r=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,2161,n.DisplayType.Search,"C_Order_ID",0,!1,"DocStatus='CO'");i.vSearchOrder=new n.Controls.VTextBoxButton("C_Order_ID",!0,!1,!0,n.DisplayType.Search,r)}function p(r){i.dGrid!=null&&(i.dGrid.destroy(),i.dGrid=null);i.arrListColumns.length==0&&(i.arrListColumns.push({field:"VAF_Org_ID",caption:n.Msg.translate(n.Env.getCtx(),"VAF_Org_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_DocType_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_DocType_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DocumentNo",caption:n.Msg.getElement(n.Env.getCtx(),"DocumentNo"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.getElement(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DateOrdered",caption:n.Msg.getElement(n.Env.getCtx(),"DateOrdered"),sortable:!0,size:"16%",min:150,hidden:!1,render:function(n){var t;return t=n.changes==undefined||n.changes.DateOrdered==undefined?n.DateOrdered:n.changes.DateOrdered,new Date(t).toLocaleDateString()}}),i.arrListColumns.push({field:"C_Order_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_UOM_ID"),sortable:!0,size:"150px",hidden:!0}));setTimeout(10);w2utils.encodeTags(r);i.dGrid=t(i.gridSelectDiv).w2grid({name:"gridGenShipForm"+i.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:i.arrListColumns,records:r})}function y(){var r=[],s=n.Env.getCtx().getVAF_Client_ID(),u="",f="",o="";e!=null&&e.toString()!="-1"&&(u=" AND ic.M_Warehouse_ID="+e);l!=null&&(f=" AND ic.C_BPartner_ID="+l);v!=null&&(o=" AND C_Order_ID="+v);t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv");i.$busyDiv[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"VCreateFrom/ExecuteQueryVinoutgen",type:"POST",data:{adClientID:s,mWarehouseIDs:u,cBPartnerIDs:f,cOrderIDSearchs:o},success:function(u){var f=JSON.parse(u),s,e,o;if(f&&f.length>0)try{for(s=1,e=0;e<f.length;e++)o={},o.C_Order_ID=f[e].c_order_id,o.VAF_Org_ID=f[e].ord,o.C_DocType_ID=f[e].doctype,o.DocumentNo=n.Utility.encodeText(f[e].documentno),o.C_BPartner_ID=f[e].bpname,o.DateOrdered=f[e].dateordered,o.recid=s,s++,r.push(o)}catch(h){}else n.ADialog.info("NoDataFound"),i.okBtn.attr("disabled","disabled");p(r);t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv");i.$busyDiv[0].style.visibility="hidden"},error:function(){t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv");i.$busyDiv[0].style.visibility="hidden"}})}function it(){var r,u,f,e,t,n;if(i.dGrid==null)return!1;if((r=[],u=i.dGrid.getSelection(),u!=null)&&!(u.length<=0)){for(f=u.toString().split(","),n=0;n<f.length;n++)r[n]=i.dGrid.get(f[n]).C_Order_ID;if(r.length==0)return"";for(e="C_Order_ID",t=e,t=r.length>1?t.concat(" IN ("):t.concat("="),n=0;n<r.length;n++)n>0&&(t=t.concat(",")),t=e.endsWith("_ID")?t.concat(r[n].toString()):t.concat("'").concat(r[n].toString());return r.length>1&&(t=t.concat(")")),t.toString()}}function rt(r){var u=i;i.$busyDiv[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Common/GenerateShipments",dataType:"json",data:{whereClause:r,M_Warehouse_ID:e},success:function(r){r.DocumentText!=null&&(ut(!0),u.gridGenerateDiv.html(r.DocumentText),u.lblStatusInfo.getControl().text(r.lblStatusInfo));r.ErrorMsg!=null&&n.ADialog.info("",null,r.ErrorMsg,null);u.$busyDiv[0].style.visibility="hidden";t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")},error:function(){u.$busyDiv[0].style.visibility="hidden";t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")}})}function ut(n){n&&(i.btnRefresh.hide(),i.okBtn.hide(),i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),n=!1,i.gridSelectDiv.animate({width:f},"fast"),i.sideDiv.animate({width:"toggle",height:"toggle"},"slow"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","rgba(var(--v-c-on-secondary), 1)");lblGenrate.css("font-size","28px").css("color","rgba(var(--v-c-primary), 1)")}var i;this.frame;this.windowNo;i=this;this.arrListColumns=[];this.dGrid=null;var c=null,e=null,l=null,w=!1,b=!1,u=!1,v=null;this.lblWarehouse=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblStatusInfo=new n.Controls.VLabel;this.tabSelect=new n.Controls.VLabel;this.tabGenrate=new n.Controls.VLabel;this.cmbWarehouse=new n.Controls.VComboBox("",!1,!1,!0);this.vSearchBPartner=null;this.vSearchOrder=null;this.$root=t("<div style='width: 100%; height: 100%; background-color: white;'>");this.$busyDiv=t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>');this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.div=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;this.btnSpaceDiv=null;this.lblGenrate=null;this.lblSelect=null;var o=null,s=null,r=260,h=50,f=t(window).width()-(r+20),a=t(window).width()-(20+h),k=f+r+5,d=t(window).height()-210;this.vetoablechange=function(){l=i.vSearchBPartner.getValue();v=i.vSearchOrder.getValue();i.okBtn.removeAttr("disabled");y()};this.sizeChanged=function(n,t){f=t-(r+20);a=t-(20+h);u==!0?(i.btnSpaceDiv.animate({width:h},"slow"),i.sideDiv.animate({width:h},"slow"),i.div.css("display","none"),i.gridSelectDiv.animate({width:a},"slow",null,function(){i.dGrid.resize()})):(i.btnSpaceDiv.animate({width:r},"slow"),i.gridSelectDiv.animate({width:f},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:r},"slow",null,function(){i.dGrid.resize()}))};this.Initialize=function(){if(tt(),nt(),g(),this.btnToggel=this.$root.find("#btnSpace_"+i.windowNo),this.spnSelect=this.$root.find("#spnSelect_"+i.windowNo),this.spnGenerate=this.$root.find("#spnGenerate_"+i.windowNo),this.okBtn!=null)this.okBtn.on(n.Events.onTouchStartOrClick,function(){var r=i;if(i.cmbWarehouse.getControl().find("option:selected").val()==undefined){n.ADialog.error("SelectWarehouseFirst");return}i.$busyDiv[0].style.visibility="visible";t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv");i.okBtn.attr("disabled","disabled");c=it();c!=null&&c.length>0?rt(c):(n.ADialog.error("PlzSelectatLeast1Inv"),i.$busyDiv[0].style.visibility="hidden");i.okBtn.removeAttr("disabled")});if(this.cancelBtn!=null)this.cancelBtn.on(n.Events.onTouchStartOrClick,function(){i.$root.dialog("close")});if(this.btnRefresh!=null)this.btnRefresh.on(n.Events.onTouchStartOrClick,function(){i.okBtn.removeAttr("disabled");e=i.cmbWarehouse.getControl().find("option:selected").val();l=i.vSearchBPartner.getValue();y()});if(this.btnToggel!=null)this.btnToggel.on(n.Events.onTouchStartOrClick,function(){u?(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!1,i.btnSpaceDiv.animate({width:r},"slow"),i.gridSelectDiv.animate({width:f},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:r},"slow",null,function(){i.dGrid.resize()})):(i.btnToggel.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!0,i.btnSpaceDiv.animate({width:h},"slow"),i.sideDiv.animate({width:h},"slow"),i.div.css("display","none"),i.gridSelectDiv.animate({width:a},"slow",null,function(){i.dGrid.resize()}))});if(this.spnGenerate!=null)this.spnGenerate.on(n.Events.onTouchStartOrClick,function(){i.btnRefresh.hide();i.okBtn.hide();u&&(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!1,i.gridSelectDiv.animate({width:f},"fast"),i.sideDiv.animate({width:r},"fast"),i.btnSpaceDiv.animate({width:r},"fast"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","rgba(var(--v-c-on-secondary), 1)");lblGenrate.css("font-size","28px").css("color","rgba(var(--v-c-primary), 1)")});if(this.spnSelect!=null)this.spnSelect.on(n.Events.onTouchStartOrClick,function(){u||(i.btnRefresh.show(),i.okBtn.show(),i.gridGenerateDiv.css("display","none"),i.gridSelectDiv.css("display","block"),i.sideDiv.css("display","block"),i.div.css("display","block"),i.gridSelectDiv.animate({width:f},"fast"),i.btnToggel.show(),lblSelect.css("font-size","28px").css("color","rgba(var(--v-c-primary), 1)"),lblGenrate.css("font-size","17px").css("color","rgba(var(--v-c-on-secondary), 1)"))});if(this.cmbWarehouse!=null&&this.cmbWarehouse.getControl().change(function(){i.okBtn.removeAttr("disabled");e=i.cmbWarehouse.getControl().find("option:selected").val();y()}),this.vSearchBPartner!=null&&this.vSearchBPartner.addVetoableChangeListener(this),this.vSearchOrder!=null&&this.vSearchOrder.addVetoableChangeListener(this),o!=null)o.on(n.Events.onTouchStartOrClick,function(){i.vSearchBPartner.isReadOnly||i.vSearchBPartner.setValue(null,!1,!0)});if(s!=null)s.on(n.Events.onTouchStartOrClick,function(){i.vSearchOrder.isReadOnly||i.vSearchOrder.setValue(null,!1,!0)})};this.display=function(){p(null)};this.getRoot=function(){return this.$root};this.disposeComponent=function(){this.okBtn&&this.okBtn.off(n.Events.onTouchStartOrClick);this.cancelBtn&&this.cancelBtn.off(n.Events.onTouchStartOrClick);o&&o.off(n.Events.onTouchStartOrClick);s&&s.off(n.Events.onTouchStartOrClick);i=null;this.frame=null;this.windowNo=null;this.arrListColumns=null;this.dGrid=null;c=null;e=null;l=null;w=null;b=null;u=null;this.lblWarehouse=null;this.lblBPartner=null;this.lblStatusInfo=null;this.tabSelect=null;this.tabGenrate=null;this.cmbWarehouse=null;this.vSearchBPartner=null;this.$root=null;this.$busyDiv=null;this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;r=null;f=null;a=null;k=null;d=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(t,i){this.frame=i;this.windowNo=t;n.Env.getCtx().setContext(this.windowNo,"IsSOTrx","Y");try{var r=this.Initialize()}catch(u){}this.frame.getContentGrid().append(this.getRoot());this.display();this.cmbWarehouse.getControl().focus()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VInOutGen=i}(VIS,jQuery),function(n,t){function i(){function g(){var it="topDiv_"+i.windowNo,y="btnSpaceDiv_"+i.windowNo,rt="btnSpace_"+i.windowNo,ut="spnSelect_"+i.windowNo,ft="spnGenerate_"+i.windowNo,p="lblGenerate_"+i.windowNo,w="lblSelect_"+i.windowNo,b,k,h,f,u,d,g,nt,c,l,tt,a,v;o=t('<button id = "btnClearBP_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/i><\/button>');s=t('<button id = "btnClearOrd_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/i><\/button>');l=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";i.topDiv=t("<div id='"+it+"' class='vis-archive-l-s-head vis-frm-ls-top' style='padding: 0;'><div id='"+y+"' class='vis-l-s-headwrp'><button id='"+rt+"' class='vis-archive-sb-t-button' ><i class='vis vis-arrow-left'><\/i><\/button><\/div><div id='"+ut+"'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='"+w+"' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 28px;color: rgba(var(--v-c-primary), 1);'>"+n.Msg.translate(n.Env.getCtx(),"Select")+"<\/label><\/div><div id='"+ft+"' style='display: inline-block; width: 160px;'><label id='"+p+"' class='VIS_Pref_Label_Font' style='vertical-align: middle; font-size: 17px;'>"+n.Msg.translate(n.Env.getCtx(),"Generate")+"<\/label><\/div><\/div>");b="sideDiv_"+i.windowNo;k="parameterDiv_"+i.windowNo;i.btnSpaceDiv=i.topDiv.find("#"+y);this.lblGenrate=i.topDiv.find("#"+p);this.lblSelect=i.topDiv.find("#"+w);i.sideDiv=t("<div id='"+b+"' class='vis-archive-l-s-content vis-leftsidebarouterwrap'>");i.sideDiv.css("width",r);i.sideDiv.css("height","calc(100% - 103px)");i.div=t("<div class='vis-archive-l-s-content-inner' id='"+k+"'>");i.sideDiv.append(i.div);h=t("<table style='width: 100%;'>");i.div.append(h);tr=t("<tr>");td=t("<td style='padding: 10px 10px 0px;'>");f=t('<div class="input-group vis-input-wrap">');u=t('<div class="vis-control-wrap">');h.append(tr);tr.append(td);td.append(f);f.append(u);u.append(i.cmbOrg.getControl());u.append(i.lblOrg.getControl().addClass("VIS_Pref_Label_Font"));tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;'>");var f=t('<div class="input-group vis-input-wrap">'),u=t('<div class="vis-control-wrap">'),e=t('<div class="input-group-append">');h.append(tr);tr.append(td);td.append(f);f.append(u);u.append(i.vSearchBPartner.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," "));e.append(i.vSearchBPartner.getBtn(0));e.append(o);u.append(i.lblBPartner.getControl().addClass("VIS_Pref_Label_Font"));f.append(e);d=n.Msg.translate(n.Env.getCtx(),"DocumentNo");tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;'>");var f=t('<div class="input-group vis-input-wrap">'),u=t('<div class="vis-control-wrap">'),e=t('<div class="input-group-append">');h.append(tr);tr.append(td);td.append(f);f.append(u);u.append(i.vSearchOrderShipment.getControl(0).attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," "));e.append(i.vSearchOrderShipment.getBtn(0));e.append(s);u.append("<label>"+d+"<\/label>");f.append(e);tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;font-size:12px;'>");h.append(tr);tr.append(td);td.append("("+n.Msg.getMsg("SalesOrderNo",!1,!1)+")");g="gridSelectDiv_"+i.windowNo;nt="gridGenerateDiv_"+i.windowNo;i.gridSelectDiv=t("<div id='"+g+"' class='vis-frm-grid-outerwrp'>");i.gridGenerateDiv=t("<div id='"+nt+"' style='height: 85%; float: right; display: none; background-color: #F1F1F1; margin-left: 15px;;margin-right: 15px;'>");i.gridGenerateDiv.css("width",t(window).width()-30);c="btnOk_"+i.windowNo;i.okBtn=t("<input id='"+c+"' class='VIS_Pref_btn-2' style='margin-top: 0px; float: right;width: 70px;height: 38px;' type='button' value='Ok'>");c="btnRefresh_"+i.windowNo;l=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";i.btnRefresh=t("<button id='"+c+"' style='margin-top: 0px; float: left;height: 38px; ' class='VIS_Pref_btn-2'><i class='vis vis-refresh'><\/i><\/button>");tt="discriptionDiv_"+i.windowNo;i.bottumDiv=t("<div class='vis-info-btmcnt-wrap vis-p-t-10'>");a=t("<div id='"+tt+"' style='flex: 1;padding: 0 10px;'>");a.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font"));v=t("<div>");v.append(i.okBtn);i.bottumDiv.append(i.btnRefresh).append(a).append(v);i.$root.append(i.$busyDiv);i.$busyDiv[0].style.visibility="hidden";i.$root.append(i.topDiv).append(i.sideDiv).append(i.gridSelectDiv).append(i.gridGenerateDiv).append(i.bottumDiv)}function nt(){i.lblOrg.getControl().text(n.Msg.translate(n.Env.getCtx(),"VAF_Org_ID"));i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));i.tabSelect.getControl().text(n.Msg.getMsg("Select",!1,!1));i.tabGenrate.getControl().text(n.Msg.getMsg("Generate",!1,!1));i.lblStatusInfo.getControl().text(n.Msg.getMsg("VIS_OrderGenInv",!1,!1))}function tt(){var u=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,2163,n.DisplayType.TableDir,"VAF_Org_ID",0,!1,"VAF_Org.VAF_Org_ID <> 0  AND VAF_Org.IsSummary='N' AND VAF_Org.IsActive='Y'"),t,r;i.cmbOrg=new n.Controls.VComboBox("VAF_Org_ID",!0,!1,!0,u,150,n.DisplayType.TableDir,0);t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,2762,n.DisplayType.Search);i.vSearchBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,t,0);r=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,2161,n.DisplayType.Search,"C_Order_ID",0,!1,"DocStatus='CO'");i.vSearchOrderShipment=new n.Controls.VTextBoxButton("C_Order_ID",!0,!1,!0,n.DisplayType.Search,r,0)}function p(r){i.dGrid!=null&&(i.dGrid.destroy(),i.dGrid=null);i.arrListColumns.length==0&&(i.arrListColumns.push({field:"VAF_Org_ID",caption:n.Msg.translate(n.Env.getCtx(),"VAF_Org_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_DocType_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_DocType_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DocumentNo",caption:n.Msg.getElement(n.Env.getCtx(),"DocumentNo"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.getElement(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DateOrdered",caption:n.Msg.getElement(n.Env.getCtx(),"DateOrdered"),sortable:!0,size:"16%",min:150,hidden:!1,render:function(n){var t;return t=n.changes==undefined||n.changes.DateOrdered==undefined?n.DateOrdered:n.changes.DateOrdered,new Date(t).toLocaleDateString()}}),i.arrListColumns.push({field:"TotalLines",caption:n.Msg.getElement(n.Env.getCtx(),"TotalLines"),sortable:!0,size:"20%",min:150,hidden:!1,align:"right",render:function(n){var t=n.TotalLines;return parseFloat(t).toLocaleString()}}),i.arrListColumns.push({field:"C_Order_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_UOM_ID"),sortable:!0,size:"150px",hidden:!0}));w2utils.encodeTags(r);i.dGrid=t(i.gridSelectDiv).w2grid({name:"gridGenForm"+i.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:i.arrListColumns,records:r})}function y(){var r=[],s=n.Env.getCtx().getVAF_Client_ID(),u="",f="",o="";e!=null&&e.toString()!="-1"&&(u=" AND ic.VAF_Org_ID="+e);l!=null&&(f=" AND ic.C_BPartner_ID="+l);a!=null&&(o=" AND C_Order_ID="+a);t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv");i.$busyDiv[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"VCreateFrom/ExecuteQueryVInvoiceGen",type:"POST",data:{adClientID:s,adOrgIDs:u,cBPartnerIDs:f,ordShipmentids:o},success:function(u){var f=JSON.parse(u),s,e,o;if(f&&f.length>0)try{for(s=1,e=0;e<f.length;e++)o={},o.C_Order_ID=f[e].c_order_id,o.VAF_Org_ID=f[e].ord,o.C_DocType_ID=f[e].doctype,o.DocumentNo=f[e].documentno,o.C_BPartner_ID=f[e].bpname,o.DateOrdered=f[e].dateordered,o.TotalLines=f[e].tLines,o.recid=s,s++,r.push(o)}catch(h){}else n.ADialog.info("NoDataFound"),i.okBtn.attr("disabled","disabled");p(r);t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv");i.$busyDiv[0].style.visibility="hidden"},error:function(){t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv");i.$busyDiv[0].style.visibility="hidden"}})}function it(){var r,u,f,t,n;if(i.dGrid==null)return!1;if((r=[],u=i.dGrid.getSelection(),u!=null)&&!(u.length<=0)){for(f=u.toString().split(","),n=0;n<f.length;n++)r[n]=i.dGrid.get(f[n]).C_Order_ID;if(r.length==0)return"";for(t="",n=0;n<r.length;n++)n>0&&(t=t.concat(",")),t=t.concat(r[n].toString());return t.toString()}}function rt(r){var u=i;i.$busyDiv[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Common/GenerateInvoices",dataType:"json",data:{whereClause:r},success:function(r){r.DocumentText!=null&&(ut(!0),u.gridGenerateDiv.html(r.DocumentText),u.lblStatusInfo.getControl().text(r.lblStatusInfo));r.ErrorMsg!=null&&n.ADialog.info("",null,r.ErrorMsg,null);u.$busyDiv[0].style.visibility="hidden";t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")},error:function(){u.$busyDiv[0].style.visibility="hidden";t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")}})}function ut(n){n&&(i.btnRefresh.hide(),i.okBtn.hide(),i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),n=!1,i.gridSelectDiv.animate({width:f},"fast"),i.sideDiv.animate({width:"toggle",height:"toggle"},"slow"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","rgba(var(--v-c-on-secondary),1)");lblGenrate.css("font-size","28px").css("color","rgba(var(--v-c-primary), 1)")}var i,a;this.frame;this.windowNo;i=this;this.arrListColumns=[];this.dGrid=null;var c=null,e=null,l=null,w=!1,b=!1,u=!1;this.lblOrg=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblStatusInfo=new n.Controls.VLabel;this.tabSelect=new n.Controls.VLabel;this.tabGenrate=new n.Controls.VLabel;this.cmbOrg=new n.Controls.VComboBox("",!1,!1,!0);this.vSearchBPartner=null;this.vSearchOrderShipment=null;a=null;this.$root=t("<div style='width: 100%; height: 100%; background-color: white;'>");this.$busyDiv=t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>');this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.div=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;this.btnSpaceDiv=null;this.lblGenrate=null;this.lblSelect=null;var o=null,s=null,r=260,h=50,f=t(window).width()-(r+20+5),v=t(window).width()-(20+h),k=f+r+5,d=t(window).height()-210;this.vetoablechange=function(){l=i.vSearchBPartner.getValue();a=i.vSearchOrderShipment.getValue();i.okBtn.removeAttr("disabled");y()};this.sizeChanged=function(n,t){f=t-(r+20);v=t-(20+h);u==!0?(i.btnSpaceDiv.animate({width:h},"slow"),i.sideDiv.animate({width:h},"slow"),i.div.css("display","none"),i.gridSelectDiv.animate({width:v},"slow",null,function(){i.dGrid.resize()})):(i.btnSpaceDiv.animate({width:r},"slow"),i.gridSelectDiv.animate({width:f},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:r},"slow",null,function(){i.dGrid.resize()}))};this.Initialize=function(){if(tt(),nt(),g(),this.btnToggel=this.$root.find("#btnSpace_"+i.windowNo),this.spnSelect=this.$root.find("#spnSelect_"+i.windowNo),this.spnGenerate=this.$root.find("#spnGenerate_"+i.windowNo),this.okBtn!=null)this.okBtn.on(n.Events.onTouchStartOrClick,function(){i.$busyDiv[0].style.visibility="visible";t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv");i.okBtn.attr("disabled","disabled");c=it();c!=null&&c.length>0?rt(c):(i.$busyDiv[0].style.visibility="hidden",n.ADialog.error("PlzSelectatLeast1Inv"));i.okBtn.removeAttr("disabled")});if(this.cancelBtn!=null)this.cancelBtn.on(n.Events.onTouchStartOrClick,function(){i.$root.dialog("close")});if(this.btnRefresh!=null)this.btnRefresh.on(n.Events.onTouchStartOrClick,function(){i.okBtn.removeAttr("disabled");e=i.cmbOrg.getControl().find("option:selected").val();l=i.vSearchBPartner.getValue();y()});if(this.btnToggel!=null)this.btnToggel.on(n.Events.onTouchStartOrClick,function(){u?(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!1,i.btnSpaceDiv.animate({width:r},"slow"),i.gridSelectDiv.animate({width:f},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:r},"slow",null,function(){i.dGrid.resize()})):(i.btnToggel.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!0,i.btnSpaceDiv.animate({width:h},"slow"),i.sideDiv.animate({width:h},"slow"),i.div.css("display","none"),i.gridSelectDiv.animate({width:v},"slow",null,function(){i.dGrid.resize()}))});if(this.spnGenerate!=null)this.spnGenerate.on(n.Events.onTouchStartOrClick,function(){i.btnRefresh.hide();i.okBtn.hide();u&&(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!1,i.gridSelectDiv.animate({width:f},"fast"),i.sideDiv.animate({width:r},"fast"),i.btnSpaceDiv.animate({width:r},"fast"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","rgba(var(--v-c-on-secondary),1)");lblGenrate.css("font-size","28px").css("color","rgba(var(--v-c-primary), 1)")});if(this.spnSelect!=null)this.spnSelect.on(n.Events.onTouchStartOrClick,function(){u||(i.btnRefresh.show(),i.okBtn.show(),i.gridGenerateDiv.css("display","none"),i.gridSelectDiv.css("display","block"),i.sideDiv.css("display","block"),i.div.css("display","block"),i.gridSelectDiv.animate({width:f},"fast"),i.btnToggel.show(),lblSelect.css("font-size","28px").css("color","rgba(var(--v-c-primary), 1)"),lblGenrate.css("font-size","17px").css("color","rgba(var(--v-c-on-secondary),1)"))});if(this.cmbOrg!=null&&this.cmbOrg.getControl().change(function(){i.okBtn.removeAttr("disabled");e=i.cmbOrg.getControl().find("option:selected").val();y()}),this.vSearchBPartner!=null&&this.vSearchBPartner.addVetoableChangeListener(this),this.vSearchOrderShipment!=null&&this.vSearchOrderShipment.addVetoableChangeListener(this),o!=null)o.on(n.Events.onTouchStartOrClick,function(){i.vSearchBPartner.isReadOnly||i.vSearchBPartner.setValue(null,!1,!0)});if(s!=null)s.on(n.Events.onTouchStartOrClick,function(){i.vSearchOrderShipment.isReadOnly||i.vSearchOrderShipment.setValue(null,!1,!0)})};this.display=function(){p(null)};this.getRoot=function(){return this.$root};this.disposeComponent=function(){this.okBtn&&this.okBtn.off(n.Events.onTouchStartOrClick);this.cancelBtn&&this.cancelBtn.off(n.Events.onTouchStartOrClick);o&&o.off(n.Events.onTouchStartOrClick);s&&s.off(n.Events.onTouchStartOrClick);i=null;this.frame=null;this.windowNo=null;this.arrListColumns=null;this.dGrid=null;c=null;e=null;l=null;w=null;b=null;u=null;this.lblOrg=null;this.lblBPartner=null;this.lblStatusInfo=null;this.tabSelect=null;this.tabGenrate=null;this.cmbOrg=null;this.vSearchBPartner=null;this.$root=null;this.$busyDiv=null;this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;r=null;f=null;v=null;k=null;d=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(t,i){this.frame=i;this.windowNo=t;n.Env.getCtx().setContext(this.windowNo,"IsSOTrx","Y");try{var r=this.Initialize()}catch(u){}this.frame.getContentGrid().append(this.getRoot());this.display();this.cmbOrg.getControl().focus()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VInvoiceGen=i}(VIS,jQuery),function(n,t){function i(){function ci(){var tt=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png",e,f,u,r,h;d=t('<button id = "btnClearBP_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/i><\/button>');g=t('<button id = "btnClearOrd_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/i><\/button>');i.topDiv=t("<div id='topDiv_"+i.windowNo+"'  class='vis-archive-l-s-head vis-frm-ls-top' style='padding: 0;'><div id='btnSpaceDiv_"+i.windowNo+"' class='vis-l-s-headwrp'><button id='btnToggelDiv_"+i.windowNo+"' class='vis-archive-sb-t-button' ><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>");e=t("<div class='vis-frm-contenthead'>");e.append(i.lblInvoice.getControl().addClass("VIS_Pref_Label_Font"));e.append(chkSameBPartnerDiv);e.append(chkSameProductDiv);e.append(chkSameQtyDiv);i.topDiv.append(e);i.invoiceTopDiv=e;i.btnSpaceDiv=i.topDiv.find("#btnSpaceDiv_"+i.windowNo);i.sideDiv=t("<div id='sideDiv_"+i.windowNo+"' class='vis-archive-l-s-content vis-mi-ls-wrp vis-leftsidebarouterwrap'>");i.sideDiv.css("width",v);i.div=t("<div class='vis-archive-l-s-content-inner' id='parameterDiv_"+i.windowNo+"'>");i.sideDiv.append(i.div);f=t("<table style='width: 100%;height: 100%;'>");i.div.append(f);tr=t("<tr>");td=t("<td style='padding: 10px 10px 0px;'>");u=t('<div class="input-group vis-input-wrap">');r=t('<div class="vis-control-wrap">');f.append(tr);tr.append(td);td.append(u);u.append(r);r.append(i.cmbMatchFrom.getControl());r.append(i.lblMatchFrom.getControl().addClass("VIS_Pref_Label_Font"));tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;'>");u=t('<div class="input-group vis-input-wrap">');r=t('<div class="vis-control-wrap">');f.append(tr);tr.append(td);td.append(u);u.append(r);r.append(i.cmbMatchTo.getControl());r.append(i.lblMatchTo.getControl().addClass("VIS_Pref_Label_Font"));tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;'>");u=t('<div class="input-group vis-input-wrap">');r=t('<div class="vis-control-wrap">');f.append(tr);tr.append(td);td.append(u);u.append(r);r.append(i.cmbMatchMode.getControl());r.append(i.lblMatchMode.getControl().addClass("VIS_Pref_Label_Font"));tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;'>");var u=t('<div class="input-group vis-input-wrap">'),r=t('<div class="vis-control-wrap">'),o=t('<div class="input-group-append">');f.append(tr);tr.append(td);td.append(u);u.append(r);r.append(i.onlyVendor.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," "));r.append(i.lblBPartner.getControl().addClass("VIS_Pref_Label_Font"));o.append(i.onlyVendor.getBtn(0));o.append(d);u.append(o);tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;'>");var u=t('<div class="input-group vis-input-wrap">'),r=t('<div class="vis-control-wrap">'),o=t('<div class="input-group-append">');f.append(tr);tr.append(td);td.append(u);u.append(r);r.append(i.onlyProduct.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," "));r.append(i.lblProduct.getControl().addClass("VIS_Pref_Label_Font"));o.append(i.onlyProduct.getBtn(0));o.append(g);u.append(o);tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;'>");u=t('<div class="input-group vis-input-wrap">');r=t('<div class="vis-control-wrap">');f.append(tr);tr.append(td);td.append(u);u.append(r);r.append(i.dtpFrom);r.append(i.lblDateFrom.getControl().addClass("VIS_Pref_Label_Font"));tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;'>");u=t('<div class="input-group vis-input-wrap">');r=t('<div class="vis-control-wrap">');f.append(tr);tr.append(td);td.append(u);u.append(r);r.append(i.dtpTo);r.append(i.lblDateTo.getControl().addClass("VIS_Pref_Label_Font"));tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;'>");f.append(tr);tr.append(td);td.append(chkIsReturnTrxDiv);i.divForGrid=t("<div id='divForGrid_"+i.windowNo+"' class='vis-mi-main-contntwrp'>");i.gridInvoiceDiv=t("<div id='gridInvoiceDiv_"+i.windowNo+"' style='width: 100%;flex: 1; '>");i.invoicegrd=t("<div style='float: left; width: 100%;height: 100%;'>");i.gridInvoiceDiv.append(i.invoicegrd);i.gridReciptDiv=t("<div id='gridReciptDiv_"+i.windowNo+"' style='width: 100%;flex: 1;'>");h=t("<div style='float: left; width: 100%; margin-top: 0px;'>");h.append(i.lblReceipt.getControl().css("display","inline-block").css("font-size","24px").css("color","rgba(var(--v-c-primary), 1)").addClass("VIS_Pref_Label_Font"));i.reciptgrd=t("<div style='float: left; width: 100%;height: 100%;'>");i.gridReciptDiv.append(i.reciptgrd);var s=t("<div class='vis-info-btnfileds-wrap'>"),y=t("<div class='vis-info-botdatafield'>"),p=t("<div class='input-group vis-input-wrap'>"),c=t("<div class='vis-control-wrap'>");y.append(p);p.append(c);c.append(i.txtMatched.getControl());c.append(i.lblMatched.getControl().addClass("VIS_Pref_Label_Font"));s.append(y);var w=t("<div class='vis-info-botdatafield' style='padding-left: 15px;'>"),b=t("<div class='input-group vis-input-wrap'>"),l=t("<div class='vis-control-wrap'>");w.append(b);b.append(l);l.append(i.txtMatchedTo.getControl());l.append(i.lblMatchedTo.getControl().addClass("VIS_Pref_Label_Font"));s.append(w);var k=t("<div class='vis-info-botdatafield' style='padding-left: 15px;'>"),nt=t("<div class='input-group vis-input-wrap'>"),a=t("<div class='vis-control-wrap'>");k.append(nt);nt.append(a);a.append(i.txtDifference.getControl());a.append(i.lblDifference.getControl().addClass("VIS_Pref_Label_Font"));s.append(k);i.bottumButtonDiv=t("<div class='vis-info-btmcnt-wrap'>");i.searchBtnWrap=t("<div class='vis-info-searchbtn-wrap'>");i.bottumButtonDiv.append(i.searchBtnWrap);i.searchBtnWrap.append(i.btnSearch);i.bottumButtonDiv.append(s);i.bottumButtonDiv.append(i.btnProcess);i.bottumDiv=t("<div class='vis-mi-bot-div'>");i.bottumDiv.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font"));i.bottumDiv.append(i.lblStatusCount.getControl().css("float","right").addClass("VIS_Pref_Label_Font"));i.divForGrid.append(i.gridInvoiceDiv).append(h).append(i.gridReciptDiv);i.$root.append(i.topDiv).append(i.sideDiv).append(i.divForGrid).append(i.bottumButtonDiv).append(i.bottumDiv);i.$root.append(i.$busyDiv)}function li(){var r=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";i.dtpFrom=t("<input id='dateFrom_"+i.windowNo+"' type='date' name='DateOrdered'>");i.dtpTo=t("<input id='dateTo_"+i.windowNo+"' type='date' name='DateOrdered'>");this.chkIsReturnTrxDiv=t("<div>");i.chkIsReturnTrx=t("<input id='chkIsReturnTrx_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblIsReturnTrx_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Return Transaction<\/label><\/span>");this.chkIsReturnTrxDiv.append(i.chkIsReturnTrx);this.chkSameBPartnerDiv=t("<div class='vis-matchpoTopcheckwrap'>");i.chkSameBPartner=t("<input id='chkSameBPartner_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameBPartner_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Same BPartner<\/label><\/span>");this.chkSameBPartnerDiv.append(i.chkSameBPartner);this.chkSameProductDiv=t("<div class='vis-matchpoTopcheckwrap'>");i.chkSameProduct=t("<input id='chkSameProduct_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameProduct_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Same Product<\/label><\/span>");this.chkSameProductDiv.append(i.chkSameProduct);this.chkSameQtyDiv=t("<div class='vis-matchpoTopcheckwrap'>");i.chkSameQty=t("<input id='chkSameQty_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameQty_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Same Quantity<\/label><\/span>");this.chkSameQtyDiv.append(i.chkSameQty);i.btnSearch=t("<input id='btnSearch_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-top: 0px;' type='button' value='Search'>");i.btnProcess=t("<Button id='btnProcess_"+i.windowNo+"' style='margin-top: 0px;' class='VIS_Pref_btn-2'>"+n.Msg.getMsg("Match")+"<\/Button>");i.lblInvoice.getControl().text(n.Msg.translate(n.Env.getCtx(),"Invoice"));i.lblReceipt.getControl().text(n.Msg.translate(n.Env.getCtx(),"Receipt"));i.lblMatchFrom.getControl().text(n.Msg.translate(n.Env.getCtx(),"MatchFrom"));i.lblMatchTo.getControl().text(n.Msg.translate(n.Env.getCtx(),"MatchTo"));i.lblMatchMode.getControl().text(n.Msg.translate(n.Env.getCtx(),"MatchMode"));i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));i.lblProduct.getControl().text(n.Msg.translate(n.Env.getCtx(),"M_Product_ID"));i.lblDateFrom.getControl().text(n.Msg.translate(n.Env.getCtx(),"DateFrom"));i.lblDateTo.getControl().text(n.Msg.translate(n.Env.getCtx(),"DateTo"));i.lblMatched.getControl().text(n.Msg.translate(n.Env.getCtx(),"ToBeMatched"));i.lblMatchedTo.getControl().text(n.Msg.translate(n.Env.getCtx(),"Matching"));i.lblDifference.getControl().text(n.Msg.translate(n.Env.getCtx(),"Difference"));i.chkIsReturnTrx.prop("checked",!1);i.btnProcess.attr("disabled","disabled");i.chkSameProduct.prop("checked",!0);i.chkSameBPartner.prop("checked",!0);i.chkSameQty.prop("checked",!1);i.chkIsReturnTrx.next("label").text(n.Msg.translate(n.Env.getCtx(),"isReturnTrx"));i.chkSameProduct.next("label").text(n.Msg.translate(n.Env.getCtx(),"SameProduct"));i.chkSameBPartner.next("label").text(n.Msg.translate(n.Env.getCtx(),"SameBPartner"));i.chkSameQty.next("label").text(n.Msg.translate(n.Env.getCtx(),"SameQty"));i.lblSearch.getControl().text(n.Msg.translate(n.Env.getCtx(),"Search"));i.btnSearch.text(n.Msg.translate(n.Env.getCtx(),"Search"))}function wt(){ri();bt();i.lblStatusInfo.getControl().text("");i.lblStatusCount.getControl().text(0)}function ai(){var t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,3499,n.DisplayType.Search);i.onlyVendor=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,t);t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,3840,n.DisplayType.Search);i.onlyProduct=new n.Controls.VTextBoxButton("M_Product_ID",!0,!1,!0,n.DisplayType.Search,t)}function bt(){i.cmbMatchTo.getControl().empty();var n=null;i.cmbMatchFrom.getControl().find("option").length>0&&(n=i.cmbMatchFrom.getControl().find("option:selected").val(),n.equals(r[o])?i.cmbMatchTo.getControl().append(" <option value='"+r[f]+"'>"+r[f]+"<\/option>"):n.equals(r[u])?i.cmbMatchTo.getControl().append(" <option value='"+r[f]+"'>"+r[f]+"<\/option>"):(i.cmbMatchTo.getControl().append(" <option value='"+r[o]+"'>"+r[o]+"<\/option>"),i.cmbMatchTo.getControl().append(" <option value='"+r[u]+"'>"+r[u]+"<\/option>")),i.cmbMatchTo.getControl().prop("selectedIndex",0),i.lblInvoice.getControl().text(n));kt()}function kt(){selection=i.cmbMatchTo.getControl().find("option:selected").val();i.lblReceipt.getControl().text(selection)}function et(){var v=i.cmbMatchFrom.getControl()[0].selectedIndex,c=i.cmbMatchTo.getControl().find("option:selected").val(),h=o,l,a,t,e;c.equals(r[f])?h=f:c.equals(r[u])&&(h=u);yt=h;ti(v,h);ft="";i.vdgvReceipt!=null&&i.vdgvReceipt.clear();i.onlyProduct.getValue()!=null&&(l=i.onlyProduct.getValue(),at=" AND lin.M_Product_ID="+l);i.onlyVendor.getValue()!=null&&(a=i.onlyVendor.getValue(),vt=" AND hdr.C_BPartner_ID="+a);t=i.dtpFrom.val();e=i.dtpTo.val();t!=""&&e!=""?ht=" AND "+s+" BETWEEN "+n.DB.to_date(t)+" AND "+n.DB.to_date(e):t!=""?ct=" AND "+s+" >= "+n.DB.to_date(t):e!=""&&(lt=" AND "+s+" <= "+n.DB.to_date(e));ii(i.vdgvInvoice);i.txtMatched.getControl().val(0);i.lblStatusInfo.getControl().text(i.cmbMatchFrom.getControl().find("option:selected").val()+"# = "+i.vdgvInvoice.records.length+" -"+i.cmbMatchTo.getControl().find("option:selected").val()+"# = "+i.vdgvReceipt.records.length);i.lblStatusCount.getControl().text(0)}function c(n){var t,s,h,e,c,v,p,a,w;nt="";tt="";it="";t=-1;n!=null?t=n:i.vdgvInvoice.getSelection().length>0&&(t=Number(i.vdgvInvoice.getSelection().toString()));s=0;t<0?i.$busyDiv[0].style.visibility="hidden":(h=i.cmbMatchTo.getControl().find("option:selected").val(),e=o,h.equals(r[f])?e=f:h.equals(r[u])&&(e=u),c=i.cmbMatchFrom.getControl()[0].selectedIndex,yt=c,ti(e,c),v={key:i.vdgvInvoice.get(t).C_BPartner_ID_K,value:i.vdgvInvoice.get(t).C_BPartner_ID},p={key:i.vdgvInvoice.get(t).M_Product_ID_K,value:i.vdgvInvoice.get(t).M_Product_ID},i.chkSameBPartner.prop("checked")&&(nt=" AND hdr.C_BPartner_ID="+v.key),i.chkSameProduct.prop("checked")&&(tt=" AND lin.M_Product_ID="+p.key),a=i.vdgvInvoice.get(t).Qty,w=i.vdgvInvoice.get(t).Matched,s=a-w,i.chkSameQty.prop("checked")&&(it=" AND "+y+"="+a),ft=i.vdgvInvoice.get(t).Line_K,ii(i.vdgvReceipt));l=s;i.txtMatched.setValue(l);i.txtMatchedTo.setValue(0);i.txtDifference.setValue(l);i.lblStatusInfo.getControl().text(i.cmbMatchFrom.getControl().find("option:selected").val()+"# = "+i.vdgvInvoice.records.length+" -"+i.cmbMatchTo.getControl().find("option:selected").val()+"# = "+i.vdgvReceipt.records.length);i.lblStatusCount.getControl().text(0)}function vi(){var n=-1,o,h,c;if(i.vdgvInvoice.getSelection().length>0&&(n=Number(i.vdgvInvoice.getSelection().toString())),n<0){e=!1;i.$busyDiv[0].style.visibility="hidden";return}var b={key:i.vdgvInvoice.get(n).C_BPartner_ID_K,value:i.vdgvInvoice.get(n).C_BPartner_ID},a={key:i.vdgvInvoice.get(n).Line_K,value:i.vdgvInvoice.get(n).Line},v={key:i.vdgvInvoice.get(n).M_Product_ID_K,value:i.vdgvInvoice.get(n).M_Product_ID},y=l,k=i.vdgvInvoice.get(n).Matched,f=i.vdgvReceipt.getSelection().toString();if(f==null){e=!1;i.$busyDiv[0].style.visibility="hidden";return}if(f.length<=0){e=!1;i.$busyDiv[0].style.visibility="hidden";return}o=!0;(i.cmbMatchFrom.getControl().find("option:selected").val().equals(r[u])||i.cmbMatchTo.getControl().find("option:selected").val().equals(r[u]))&&(o=!1);var p=i.cmbMatchMode.getControl()[0].selectedIndex,w=i.cmbMatchFrom.getControl()[0].selectedIndex,s=[],t=f.toString().split(",");for(n=0;n<t.length;n++)if(h=i.vdgvReceipt.get(t[n])._ID,h!=null){if(c={key:i.vdgvReceipt.get(t[n]).M_Product_ID_K,value:i.vdgvReceipt.get(t[n]).M_Product_ID},v.key!=c.key)continue;s.push(i.vdgvReceipt.get(t[n]))}else continue;if(s.length>0)yi(o,p,w,a.key,y,s);else{e=!1;i.$busyDiv[0].style.visibility="hidden";return}}function ti(n){nt="";tt="";it="";ht="";ct="";lt="";at="";vt="";ni=i.cmbMatchMode.getControl()[0].selectedIndex==pt;ot="";dt=i.chkIsReturnTrx.prop("checked");st="";gt=!1;matchToTypeMATCH_ORDER="matchToTypeMATCH_ORDER";n==o?(ot="displayMATCH_INVOICE",s="hdr.DateInvoiced",y="lin.QtyInvoiced"):n==u?(st="displayMATCH_ORDER",s="hdr.DateOrdered",y="lin.QtyOrdered"):(s="hdr.MovementDate",y="lin.MovementQty")}function ii(r){var e=[],o={displayMATCH_INVOICEs:ot,chkIsReturnTrxProps:dt,displayMATCH_ORDERs:st,matchToTypeMATCH_SHIPMENTs:gt,matchedsss:ni,chkSameBPartnerss:nt,chkSameProductss:tt,chkSameQtyss:it,from_ss:ht,fromIfs:ct,to_Dats:lt,matchToTypes:yt,MATCH_SHIPMENTs:f,MATCH_ORDERs:u,onlyProduct_ss:at,onlyVendor_ss:vt,MatchToID:ft};t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetTableLoadVmatch",dataType:"json",data:o,success:function(n){var t=JSON.parse(n),o,u,f,s,h;if(t&&t!=null)for(o=1,u=0;u<t.length;u++)f={},f._ID=t[u]._ID,f.DocumentNo=t[u].DocNo,s=t[u].Date,h=new Date(s),t[u].Date=h.toLocaleDateString(),f.Date=t[u].Date,f.C_BPartner_ID=t[u].CBPartnerIDK,f.C_BPartner_ID_K=t[u].CBPartnerID,f.Line=t[u].Line,f.Line_K=t[u].Line_K,f.M_Product_ID=t[u].MProductIDK,f.M_Product_ID_K=t[u].MProductID,f.Qty=t[u].Qty,f.Matched=t[u].Matched,f.recid=o,o++,e.push(f);e.length<1?(ri(r.name.contains("vdgvReceipt")),i.$busyDiv[0].style.visibility="hidden"):r.name.contains("vdgvReceipt")?(wi(i.arrListColumns,e),i.$busyDiv[0].style.visibility="hidden"):r.name.contains("vdgvInvoice")&&(pi(i.arrListColumns,e),c())},error:function(n){console.log(n);i.$busyDiv[0].style.visibility="hidden"}})}function yi(r,u,f,o,s,h){var c=i;t.ajax({url:n.Application.contextUrl+"Common/CreateMatchRecord",dataType:"json",data:{invoice:r,MatchMode:u,MatchFrom:f,LineMatched:o,ToMatchQty:s,SelectedItems:JSON.stringify(h)},success:function(t){et();i.vdgvReceipt.delete(!0);var r=JSON.parse(t);r.Msg!=""?n.ADialog.info("",null,r.Msg,null):r.MatchedPO_ID>0?n.ADialog.info("Matched",null,n.Msg.getMsg("PurchaseOrder")+" - "+r.MatchedPO_ID,null):r.MatchedInv_ID>0&&n.ADialog.info("Matched",null,n.Msg.getMsg("Invoice")+" - "+r.MatchedInv_ID,null);e=!1;i.$busyDiv[0].style.visibility="hidden"},error:function(n,t){console.log(t);e=!1;i.$busyDiv[0].style.visibility="hidden"}})}function ri(r){i.arrListColumns.length==0&&(i.arrListColumns.push({field:"_ID",caption:"_ID",sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"DocumentNo",caption:n.Msg.translate(n.Env.getCtx(),"DocumentNo"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"Date",caption:n.Msg.translate(n.Env.getCtx(),"Date"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"C_BPartner_ID_K",caption:n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"Line",caption:n.Msg.translate(n.Env.getCtx(),"Line"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"Line_K",caption:n.Msg.translate(n.Env.getCtx(),"Line"),sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"M_Product_ID",caption:n.Msg.translate(n.Env.getCtx(),"M_Product_ID"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"M_Product_ID_K",caption:n.Msg.translate(n.Env.getCtx(),"M_Product_ID"),sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"Qty",caption:n.Msg.translate(n.Env.getCtx(),"Qty"),sortable:!0,size:"11%",hidden:!1,render:function(t){var i=n.Utility.Util.getValueOfDecimal(t.Qty);return i.toLocaleString()}}),i.arrListColumns.push({field:"Matched",caption:n.Msg.translate(n.Env.getCtx(),"Matched"),sortable:!0,size:"11%",hidden:!1}));r==null?(i.vdgvInvoice!=null&&(i.vdgvInvoice.destroy(),i.vdgvInvoice=null),i.vdgvInvoice=t(i.invoicegrd).w2grid({name:"vdgvInvoice"+i.windowNo,recordHeight:30,show:{selectColumn:!1},onSelect:function(n){c(n.recid)},multiSelect:!1,columns:i.arrListColumns,records:null}),i.vdgvReceipt!=null&&(i.vdgvReceipt.destroy(),i.vdgvReceipt=null),i.vdgvReceipt=t(i.reciptgrd).w2grid({name:"vdgvReceipt"+i.windowNo,recordHeight:30,show:{selectColumn:!0},onSelect:function(n){this.multiSelect=!0;a(n.recid,!0)},onUnselect:function(n){a(n.recid,!1)},multiSelect:!1,columns:i.arrListColumns,records:null})):r?r&&(i.vdgvReceipt!=null&&(i.vdgvReceipt.destroy(),i.vdgvReceipt=null),i.vdgvReceipt=t(i.reciptgrd).w2grid({name:"vdgvReceipt"+i.windowNo,recordHeight:30,show:{selectColumn:!0},onSelect:function(n){this.multiSelect=!0;a(n.recid,!0)},onUnselect:function(n){a(n.recid,!1)},multiSelect:!1,columns:i.arrListColumns,records:null})):(i.vdgvInvoice!=null&&(i.vdgvInvoice.destroy(),i.vdgvInvoice=null),i.vdgvInvoice=t(i.invoicegrd).w2grid({name:"vdgvInvoice"+i.windowNo,recordHeight:30,show:{selectColumn:!1},onSelect:function(n){c(n.recid)},multiSelect:!1,columns:i.arrListColumns,records:null}))}function pi(n,r){i.vdgvInvoice!=null&&(i.vdgvInvoice.destroy(),i.vdgvInvoice=null);w2utils.encodeTags(r);i.vdgvInvoice=t(i.invoicegrd).w2grid({name:"vdgvInvoice"+i.windowNo,recordHeight:30,show:{selectColumn:!1},onSelect:function(n){c(n.recid)},multiSelect:!1,columns:n,records:r})}function wi(n,r){i.vdgvReceipt!=null&&(i.vdgvReceipt.destroy(),i.vdgvReceipt=null);w2utils.encodeTags(r);i.vdgvReceipt=t(i.reciptgrd).w2grid({name:"vdgvReceipt"+i.windowNo,recordHeight:30,show:{selectColumn:!0},onSelect:function(n){this.multiSelect=!0;a(n.recid,!0)},onUnselect:function(n){a(n.recid,!1)},multiSelect:!1,columns:n,records:r})}function a(n,t){var o,s,r,u,c,a;if(!(i.vdgvInvoice.records.length<1)){if(!i.chkSameProduct.prop("checked")){setTimeout(function(){i.vdgvReceipt.unselect(Number(n))},10);return}o=-1;s=null;i.vdgvInvoice.getSelection().length>0&&(o=Number(i.vdgvInvoice.getSelection().toString()),s={key:i.vdgvInvoice.get(o).M_Product_ID_K,value:i.vdgvInvoice.get(o).M_Product_ID});var f=0,h=0,e=n+","+i.vdgvReceipt.getSelection().toString().replace(n,"");if(t&&e!=null&&e.length>0)for(e=e.replace(/,$/,""),r=e.toString().split(","),u=0;u<r.length;u++)if(c=i.vdgvReceipt.get(r[0])._ID,c!=null){if(a={key:i.vdgvReceipt.get(r[u]).M_Product_ID_K,value:i.vdgvReceipt.get(r[u]).M_Product_ID},s.key!=a.key){setTimeout(function(){i.vdgvReceipt.unselect(Number(n))},10);return}i.cmbMatchMode.getControl()[0].selectedIndex==b&&(f=f+Number(i.vdgvReceipt.get(r[u]).Qty));f=f-Number(i.vdgvReceipt.get(r[u]).Matched);h++}k=f;i.txtMatchedTo.setValue(k.toString());i.txtDifference.setValue(l-k);h<=0&&i.btnProcess.removeAttr("disabled");i.lblStatusCount.getControl().text(h)}}var i,h;this.frame;this.windowNo;i=this;this.arrListColumns=[];this.vdgvInvoice=null;this.vdgvReceipt=null;this.lblMatchFrom=new n.Controls.VLabel;this.lblMatchTo=new n.Controls.VLabel;this.lblMatchMode=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblProduct=new n.Controls.VLabel;this.lblDateFrom=new n.Controls.VLabel;this.lblDateTo=new n.Controls.VLabel;this.lblInvoice=new n.Controls.VLabel;this.lblReceipt=new n.Controls.VLabel;this.lblMatched=new n.Controls.VLabel;this.lblMatchedTo=new n.Controls.VLabel;this.lblDifference=new n.Controls.VLabel;this.lblStatusInfo=new n.Controls.VLabel;this.lblStatusCount=new n.Controls.VLabel;this.lblSearch=new n.Controls.VLabel;this.cmbMatchFrom=new n.Controls.VComboBox("",!1,!1,!0);this.cmbMatchTo=new n.Controls.VComboBox("",!1,!1,!0);this.cmbMatchMode=new n.Controls.VComboBox("",!1,!1,!0);this.chkIsReturnTrx=null;this.chkSameBPartner=null;this.chkSameProduct=null;this.chkSameQty=null;this.onlyVendor=null;this.onlyProduct=null;this.dtpFrom=null;this.dtpTo=null;this.btnSearch=null;this.btnProcess=null;this.btnToggel=null;this.txtMatched=new n.Controls.VTextBox("",!1,!0,!1);this.txtMatchedTo=new n.Controls.VTextBox("",!1,!0,!1);this.txtDifference=new n.Controls.VTextBox("",!1,!0,!1);this.$root=t("<div style='width: 100%; height: 100%; background-color: white;'>");this.$busyDiv=t("<div id='testBesy' class='vis-busyindicatorouterwrap'><div class='vis-busyindicatorinnerwrap'><i class='vis-busyindicatordiv'><\/i><\/div><\/div>");this.sideDiv=null;this.gridSelectDiv=null;this.gridInvoiceDiv=null;this.gridReciptDiv=null;this.processlDiv=null;this.bottumDiv=null;this.bottumButtonDiv=null;this.btnSpaceDiv=null;this.topDiv=null;this.div=null;this.divForGrid=null;this.invoicegrd=null;this.reciptgrd=null;this.invoiceTopDiv=null;var p=!1,v=260,w=50,rt=t(window).width()-v,ut=t(window).width()-w,ui=t(window).height()-240,fi=n.Env.getCtx().getVAF_Client_ID(),ei=n.Env.getCtx().getVAF_Org_ID(),oi=n.Env.getCtx().getAD_User_ID(),o=0,f=1,u=2,b=0,pt=1,si=null,s="",y="",hi="",l=0,k=0,ft="",d=null,g=null,e=!1,r=[];r.push(n.Msg.getElement3(n.Env.getVAF_Language(n.Env.getCtx()),"C_Invoice_ID",!1));r.push(n.Msg.getElement3(n.Env.getVAF_Language(n.Env.getCtx()),"M_InOut_ID",!1));r.push(n.Msg.getElement3(n.Env.getVAF_Language(n.Env.getCtx()),"C_Order_ID",!1));h=[];h.push(n.Msg.getMsg("NotMatched"));h.push(n.Msg.getMsg("Matched"));var ot="",dt="",st="",gt=!1,ni="",nt="",tt="",it="",ht="",ct="",lt="",at="",vt="",yt="";this.Initialize=function(){for(var u=0;u<r.length;u++)this.cmbMatchFrom.getControl().append(" <option value='"+r[u]+"'>"+r[u]+"<\/option>");for(u=0;u<h.length;u++)this.cmbMatchMode.getControl().append(" <option value='"+h[u]+"'>"+h[u]+"<\/option>");if(this.cmbMatchFrom.getControl().prop("selectedIndex",0),this.cmbMatchMode.getControl().prop("selectedIndex",0),ai(),li(),ci(),this.btnToggel=this.$root.find("#btnToggelDiv_"+i.windowNo),this.gridSelectDiv=this.$root.find("#divForGrid_"+i.windowNo),this.cmbMatchFrom.getControl()!=null&&this.cmbMatchFrom.getControl().change(function(){i.$busyDiv[0].style.visibility="visible";wt();bt();i.$busyDiv[0].style.visibility="hidden"}),this.cmbMatchTo.getControl()!=null&&this.cmbMatchTo.getControl().change(function(){i.$busyDiv[0].style.visibility="visible";kt();i.$busyDiv[0].style.visibility="hidden"}),this.cmbMatchMode.getControl()!=null&&this.cmbMatchMode.getControl().change(function(){i.cmbMatchMode.getControl()[0].selectedIndex==b?i.btnProcess.text(n.Msg.getMsg("Match")):i.btnProcess.text(n.Msg.getMsg("Unmatch"))}),this.btnSearch!=null)this.btnSearch.on(n.Events.onTouchStartOrClick,function(){i.$busyDiv[0].style.visibility="visible";et()});if(this.btnProcess!=null)this.btnProcess.on(n.Events.onTouchStartOrClick,function(){e||(i.$busyDiv[0].style.visibility="visible",e=!0,vi())});if(this.btnToggel!=null)this.btnToggel.on(n.Events.onTouchStartOrClick,function(){p?(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),p=!1,i.btnSpaceDiv.animate({width:v},"slow"),i.gridSelectDiv.animate({width:rt},"slow"),i.invoiceTopDiv.animate({width:rt},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:v},"slow",null,function(){i.vdgvInvoice.resize();i.vdgvReceipt.resize()})):(i.btnToggel.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),p=!0,i.btnSpaceDiv.animate({width:w},"slow"),i.sideDiv.animate({width:w},"slow"),i.div.css("display","none"),i.invoiceTopDiv.animate({width:ut},"slow"),i.gridSelectDiv.animate({width:ut},"slow",null,function(){i.vdgvInvoice.resize();i.vdgvReceipt.resize()}))});if(this.chkSameBPartner.change(function(){i.$busyDiv[0].style.visibility="visible";c()}),this.chkSameQty.change(function(){i.$busyDiv[0].style.visibility="visible";c()}),this.chkSameProduct.change(function(){i.$busyDiv[0].style.visibility="visible";c()}),d!=null)d.on(n.Events.onTouchStartOrClick,function(){i.onlyVendor.isReadOnly||i.onlyVendor.setValue(null,!1,!0)});if(g!=null)g.on(n.Events.onTouchStartOrClick,function(){i.onlyProduct.isReadOnly||i.onlyProduct.setValue(null,!1,!0)});i.$busyDiv[0].style.visibility="hidden"};this.display=function(){wt()};this.getRoot=function(){return this.$root};this.callConsolidate=function(){t.ajax({url:n.Application.contextUrl+"Common/Consolidate",dataType:"json",async:!0,success:function(){}});i.vdgvReceipt.multiSelect=!0;var r="vdgvReceipt"+i.windowNo;w2ui[r].multiSelect=!0};this.disposeComponent=function(){this.btnSearch&&this.btnSearch.off(n.Events.onTouchStartOrClick);this.btnProcess&&this.btnProcess.off(n.Events.onTouchStartOrClick);this.btnToggel&&this.btnToggel.off(n.Events.onTouchStartOrClick);this.frame=null;this.windowNo=null;this.arrListColumns=null;this.vdgvInvoice=null;this.vdgvReceipt=null;this.lblMatchFrom=null;this.lblMatchTo=null;this.lblMatchMode=null;this.lblBPartner=null;this.lblProduct=null;this.lblDateFrom=null;this.lblDateTo=null;this.lblInvoice=null;this.lblReceipt=null;this.lblMatched=null;this.lblMatchedTo=null;this.lblDifference=null;this.lblStatusInfo=null;this.lblStatusCount=null;this.lblSearch=null;this.cmbMatchFrom=null;this.cmbMatchTo=null;this.cmbMatchMode=null;this.chkIsReturnTrx=null;this.chkSameBPartner=null;this.chkSameProduct=null;this.chkSameQty=null;this.onlyVendor=null;this.onlyProduct=null;this.dtpFrom=null;this.dtpTo=null;this.btnSearch=null;this.btnProcess=null;this.btnToggel=null;this.txtMatched=null;this.txtMatchedTo=null;this.txtDifference=null;this.$root=null;this.$busyDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridInvoiceDiv=null;this.gridReciptDiv=null;this.processlDiv=null;this.bottumDiv=null;this.btnSpaceDiv=null;p=null;v=null;w=null;rt=null;ut=null;ui=null;fi=null;ei=null;oi=null;o=null;f=null;u=null;b=null;pt=null;si=null;s=null;y=null;hi=null;l=null;k=null;i=null;r=null;h=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(t,i){this.frame=i;this.windowNo=t;n.Env.getCtx().setContext(this.windowNo,"IsSOTrx","Y");try{var r=this.Initialize()}catch(u){}this.frame.getContentGrid().append(this.getRoot());this.display();this.callConsolidate()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VMatch=i}(VIS,jQuery),function(n,t){function i(){function dt(){var d,p,s,k;setBusy(!0);v.setValue(!0);d=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";u=t("<div id='sideDiv_"+i.windowNo+"' class='vis-archive-left-sidebar vis-leftsidebarouterwrap'>");ht=t("<div id='btnSpaceDiv_"+i.windowNo+"' class='vis-archive-l-s-head'><button id='btnSpace_"+i.windowNo+"' class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>");it=t("<div class='vis-archive-l-s-content' id='parameterDiv_"+i.windowNo+"'>");u.append(ht).append(it);d=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";e=t("<button id='btnRefresh_"+i.windowNo+"' style='margin-left: 12px;' class='VIS_Pref_btn-2 vis-frm-button vis-pull-left'><i class='vis vis-refresh'><\/i><\/button>");y=t("<input id='btnCreateCharge_"+i.windowNo+"' class='VIS_Pref_btn-2 vis-frm-button' type='button' value='"+n.Msg.getMsg("CreateNew",!1,!1)+"'>");a=t("<input id='btnCancel_"+i.windowNo+"' class='VIS_Pref_btn-2 vis-frm-button' type='button' value='"+n.Msg.getMsg("Cancel",!1,!1)+"'>");l=t("<input id='btnAccount_"+i.windowNo+"' class='VIS_Pref_btn-2 vis-frm-button' type='button' value='"+n.Msg.getMsg("ChargeFromAccount",!1,!1)+"'>");var w=t("<table style='width: 100%;'>"),r=t("<tr>"),o=t("<td style='padding: 0px 10px 0px;'>");it.append(w);r=t("<tr>");o=t("<td style='padding: 0px 10px 0px;'>");p=t('<div class="input-group vis-input-wrap">');s=t('<div class="vis-control-wrap">');w.append(r);r.append(o);o.append(p);p.append(s);s.append(h.getControl().attr("data-placeholder","").attr("placeholder"," "));s.append(nt.getControl().addClass("VIS_Pref_Label_Font"));r=t("<tr>");o=t("<td style='padding: 0px 10px 0px;'>");p=t('<div class="input-group vis-input-wrap">');s=t('<div class="vis-control-wrap">');w.append(r);r.append(o);o.append(p);p.append(s);s.append(c.getControl().attr("data-placeholder","").attr("placeholder"," "));s.append(tt.getControl().addClass("VIS_Pref_Label_Font"));r=t("<tr>");o=t("<td style='padding: 0px 10px 0px;'>");w.append(r);r.append(o);o.append(v.getControl());ut=t("<div class='vis-frm-bot-btn-wrp'>");k=t("<div class='vis-frm-bttsec'>");k.append(l).append(a);ut.append(y).append(e);f=t("<div id='rightSideGridDiv_"+i.windowNo+"' class='vis-frm-grid-wrap'>");rt=t("<div id='gridDiv_"+i.windowNo+"' class='vis-frm-grid-inn'>");f.append(rt);f.append(k);u.append(ut);b.append(st);b.append(u).append(f)}function gt(u){r!=null&&(r.destroy(),r=null);s.length==0&&(s.push({field:"C_ElementValue_ID",caption:n.Msg.getMsg("C_ELEMENTVALUE_ID"),sortable:!0,size:"16%",min:150,hidden:!0}),s.push({field:"Value",caption:n.Msg.getMsg("SearchKey"),sortable:!0,size:"25%",min:150,hidden:!1}),s.push({field:"Name",caption:n.Msg.getMsg("Name"),sortable:!0,size:"25%",min:150,hidden:!1}),s.push({field:"Expense",caption:n.Msg.getMsg("Expense"),sortable:!0,size:"25%",min:150,hidden:!1,editable:{type:"checkbox"}}));w2utils.encodeTags(u);r=t(rt).w2grid({name:"gridAccountElement"+i.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:s,records:u})}function at(){var r=[];g=n.Env.getCtx().getContextAsInt("$C_AcctSchema_ID");ct=n.Env.getCtx().getVAF_Client_ID();lt=n.Env.getCtx().getVAF_Org_ID();t.ajax({url:n.Application.contextUrl+"VCharge/VChargeLodGrideData",dataType:"json",data:{mcAcctSchemaID:g,mADClientId:ct},success:function(n){var e,u,f,t,i;if(n.result.meID!=0){if(n.result&&n.result.VchargeMCElemTaxCatID){if(e=n.result.VchargeMCElemTaxCatID,et=n.result.VchargeMCElemTaxCatID[0].mCElementID,et==0)return;ot=n.result.VchargeMCElemTaxCatID[0].mCTaxCategoryID}if(n.result&&n.result.VchargeCElementValue){for(u=n.result.VchargeCElementValue,f=1,t=0;t<u.length;t++)i={},i.C_ElementValue_ID=u[t].C_ElementValue_ID,i.Value=u[t].Value,i.Name=u[t].Name,i.Expense=u[t].Expense=="false"?!1:!0,i.recid=f,f++,r.push(i);gt(r);setBusy(!1)}}},error:function(n){setBusy(!1);i.log.info(n)}})}function ni(i,r,u,f,e){t.ajax({url:n.Application.contextUrl+"VCharge/CreateCharge",dataType:"json",data:{m_C_AcctSchema_ID:i,m_C_TaxCategory_ID:r,name:u,C_ElementValue_ID:f,expense:e},success:function(t){if(t.ID==0){n.ADialog.info("ChargeNotCreated",!0,null);setBusy(!1);return}h.ctrl.val("");c.ctrl.val("");var i=t.ID;n.ADialog.info("ChargeCreated",!0,null);at()}})}function ti(i,r,u,f,e){t.ajax({url:n.Application.contextUrl+"VCharge/CreateChargeByList",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({AcctSchemaID:i,TaxCategoryID:r,namepara:u,ElementValuID:f,expense:e}),success:function(t){t.listCreatedP&&n.ADialog.info("ChargeCreated",!0,null);t.listRejectedP&&n.ADialog.info("ChargeNotCreated",!0,null);setBusy(!1)}})}this.frame;this.windowNo;var i=this,s=[],r=null;this.log=n.Logging.VLogger.getVLogger("VCharge");var vt=!1,yt=!1,w=!1,nt=new n.Controls.VLabel(n.Msg.getMsg("SearchKey",!1,!1),"SearchKey",!1,!0),tt=new n.Controls.VLabel(n.Msg.getMsg("Name",!1,!1),"Name",!1,!0),h=new n.Controls.VTextBox("SearchKey",!0,!1,!0,50,100,null,null,!1),c=new n.Controls.VTextBox("Name",!1,!1,!0,50,100,null,null,!1),v=new n.Controls.VCheckBox("Expense",!1,!1,!0,n.Msg.getMsg("Expense",!1,!1),null),pt=new n.Controls.VCheckBox("SelectAll",!1,!1,!0,n.Msg.getMsg("SelectAll",!1,!1),null),y=null,l=null,wt=new n.Controls.VLabel;this.log=n.Logging.VLogger.getVLogger("VCharge");var b=t("<div style='width: 100%; height: 100%; background-color: white; '>"),st=t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'),u=null,f=null,ht=null,it=null,rt=null,ut=null,a=null,e=null,o=null,p=260,k=50,d=t(window).width()-p,ft=t(window).width()-k,bt=d+p,kt=t(window).height()-210,et=0,g=0,ot=0,ct=0,lt=0;setBusy=function(n){st.css("display",n?"block":"none")};this.Initialize=function(){if(dt(),o=b.find("#btnSpace_"+i.windowNo),a!=null)a.on(n.Events.onTouchStartOrClick,function(){i.dispose()});if(e!=null)e.on(n.Events.onTouchStartOrClick,function(){h.ctrl.val("");c.ctrl.val("");setBusy(!0);at()});if(o!=null)o.on(n.Events.onTouchStartOrClick,function(){w?(y.show(),e.show(),nt.getControl().show(),tt.getControl().show(),h.getControl().show(),c.getControl().show(),v.getControl().show(),o.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),w=!1,f.animate({width:d},"slow"),u.animate({width:p},"slow",null,function(){r.resize()})):(y.hide(),e.hide(),nt.getControl().hide(),tt.getControl().hide(),h.getControl().hide(),c.getControl().hide(),v.getControl().hide(),o.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),w=!0,u.animate({width:k},"slow"),f.animate({width:ft},"slow",null,function(){r.resize()}))});if(this.sizeChanged=function(n,t){d=t-(p+1);ft=t-(k+1);w==!0?(u.animate({width:k},"slow"),f.animate({width:ft},"slow",null,function(){r.resize()})):(f.animate({width:d},"slow"),u.animate({width:p},"slow",null,function(){r.resize()}))},l!=null)l.on(n.Events.onTouchStartOrClick,function(){var i,t,n;setBusy(!0);var u=[],f=[],e=[];if(r){if(i=r.getSelection(),!i){setBusy(!1);return}if(i.length<=0){setBusy(!1);return}for(t=i.toString().split(","),n=0;n<t.length;n++)u[n]=r.get(t[n]).C_ElementValue_ID,f[n]=r.get(t[n]).Name,e[n]=r.get(t[n]).Expense;if(u.length==0)return setBusy(!1),"";ti(g,ot,f,u,e)}});if(y!=null)y.on(n.Events.onTouchStartOrClick,function(){var u,f,r;if(setBusy(!0),u=v.getValue(),f=h.getValue().trim(),f.length==0){n.ADialog.warn("SearchKeyMandatory",!0,null);setBusy(!1);return}if(r=c.getValue().trim(),r.length==0){n.ADialog.warn("NameMandatory",!0,null);setBusy(!1);return}t.ajax({url:n.Application.contextUrl+"VCharge/CreateElementValue",dataType:"json",data:{m_VAF_Org_ID:lt,value:f,name:r,expense:u,m_C_Element_ID:et},success:function(t){if(t.ID==0){i.log.saveError("ChargeNotCreated",t.Msg);n.ADialog.warn(t.Msg,!0,null);setBusy(!1);return}ni(g,ot,r,t.ID,u)}})})};this.display=function(){setTimeout(at(),5)};this.getRoot=function(){return b};this.disposeComponent=function(){a&&a.off(n.Events.onTouchStartOrClick);e&&e.off(n.Events.onTouchStartOrClick);o&&o.off(n.Events.onTouchStartOrClick);l&&l.off(n.Events.onTouchStartOrClick);i.windowNo=null;s=null;r=null;vt=null;yt=null;w=null;nt=null;tt=null;h=null;c=null;v=null;pt=null;btnCreateCharg=null;l=null;wt=null;i.log=null;b=null;st=null;u=null;f=null;ht=null;it=null;rt=null;ut=null;a=null;e=null;o=null;p=null;k=null;d=null;ft=null;bt=null;kt=null;et=null;g=null;ot=null;ct=null;lt=null;i=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.display()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VCharge=i}(VIS,jQuery),function(n,t){function i(){function ti(){var k,y,o,u,p;setBusy(!0);k=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";s=t("<div id='sideDiv_"+i.windowNo+"' class='vis-archive-left-sidebar'>");v=t("<div id='btnSpaceDiv_"+i.windowNo+"'  class='vis-archive-l-s-head'><button id='btnSpace_"+i.windowNo+"' class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>");l=t("<div class='vis-archive-l-s-content vis-leftsidebarouterwrap' id='parameterDiv_"+i.windowNo+"'>");s.append(v).append(l);k=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";f=t("<button id='btnRefresh_"+i.windowNo+"' class='VIS_Pref_btn-2 vis-frm-button'><i class='vis vis-refresh'><\/i><\/button>");c=t("<input id='btnOk_"+i.windowNo+"' class='VIS_Pref_btn-2 vis-frm-button' style='min-width: 70px;' type='button' value='"+n.Msg.getMsg("OK",!1,!1)+"'>");y=t("<table style='width: 100%;'>");l.append(y);tr=t("<tr>");td=t("<td style='padding: 10px 10px 0px'>");o=t('<div class="input-group vis-input-wrap">');u=t('<div class="vis-control-wrap">');y.append(tr);tr.append(td);td.append(o);o.append(u);u.append(b.getControl().css("display","inline-block"));u.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px;'>");o=t('<div class="input-group vis-input-wrap">');u=t('<div class="vis-control-wrap">');y.append(tr);tr.append(td);td.append(o);o.append(u);u.append(it.getControl().css("display","inline-block"));u.append(w.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px'>");o=t('<div class="input-group vis-input-wrap">');u=t('<div class="vis-control-wrap">');y.append(tr);tr.append(td);td.append(o);o.append(u);u.append(rt.getControl().css("display","inline-block"));u.append(kt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));tr=t("<tr>");td=t("<td style='padding: 0px 10px 0px'>");o=t('<div class="input-group vis-input-wrap">');u=t('<div class="vis-control-wrap">');y.append(tr);tr.append(td);td.append(o);o.append(u);u.append(ut.getControl().css("display","inline-block"));u.append(dt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));g=t("<div class='vis-frm-bot-btn-wrp'>");p=t("<div class='vis-frm-bot-btn-wrp'>");p.append(c);g.append(f);h=t("<div id='rightSideGridDiv_"+i.windowNo+"' class='vis-frm-grid-wrap'>");d=t("<div id='gridDiv_"+i.windowNo+"' class='vis-frm-grid-inn'>");d.append(e);h.append(d);h.append(p);s.append(g);a.append(ft);a.append(s).append(h)}function ii(){st.push({Key:"0",Name:n.Msg.getMsg("ModeView",!1,!1)});ui();ri()}function ri(){t.ajax({url:n.Application.contextUrl+"Common/GetDataQueryAttribute",type:"GET",dataType:"json",async:!1,success:function(n){if(n.lst){u=n.lst;for(var t=0;t<u.length;t++)at(b.getControl(),u[t].GetKeyNamePair,t),at(it.getControl(),u[t].GetKeyNamePair,t)}n.priceList&&ot(rt.getControl(),n.priceList);n.whList&&ot(ut.getControl(),n.whList);setBusy(!1)}})}function ui(){ot(k.getControl(),st)}function ot(n,t){for(var i=0;i<t.length;i++)n.append(" <option selected value='"+t[i].Key+"' >"+t[i].Name+"<\/option>");n.prop("selectedIndex",0)}function at(n,t,i){i==0&&n.append(" <option selected value='0' ><\/option>");n.append(" <option selected value='"+t.Key+"' >"+t.Name+"<\/option>");n.prop("selectedIndex",0)}function fi(i,r){var s,h,o,f,u;for(r=r<2?2:r,i+=1,row=0;row<i;row++)for(s=t("<tr id='row_"+row+"' >"),e.append(s),col=0;col<r;col++)h=t("<td id='col_"+col+"'  style='padding: 4px 15px 2px;'>"),s.append(h);o=new n.Controls.VLabel;o.getControl().text("Mode");f=e.find("#row_0");r==2?(u=f.find("#col_"+(r-1)),u.append(k.getControl().css("display","inline-block").css("width","236px").css("height","30px")),u=f.find("#col_"+(r-2)),u.append(o.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))):(u=f.find("#col_2"),u.append(k.getControl().css("display","inline-block").css("width","236px").css("height","30px")),u=f.find("#col_1"),u.append(o.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font")))}function ei(r,u){var f=0,e=0,o=0,s=0;r&&(f=r.GetM_Attribute_ID,e=r.GetM_AttributeValue_ID);u&&(o=u.GetM_Attribute_ID,s=u.GetM_AttributeValue_ID);t.ajax({url:n.Application.contextUrl+"Common/GetGridElement",dataType:"json",data:{xM_Attribute_ID:f,xM_AttributeValue_ID:e,yM_Attribute_ID:o,yM_AttributeValue_ID:s,M_PriceList_Version_ID:ht,M_Warehouse_ID:ct,windowNo:i.windowNo},async:!1,success:function(){setBusy(!1)}})}function oi(){var h,c,a,t,f,p,w;if(b!=null&&!tt){if(h=b.getControl()[0].selectedIndex,c=it.getControl()[0].selectedIndex,h==c){i.log.warning("Same Attribute Selected");return}tt=!0;ht=rt.getControl().find("option:selected").val();ct=ut.getControl().find("option:selected").val();var v=2,o=[],s=[],l=null,y=null;for(h>0&&(o=u[h-1].GetMAttributeValues),o!=null&&(v=o.length+1,i.log.info("X - "+u[h-1].GetName+" #"+o.length)),a=2,c>0&&(s=u[c-1].GetMAttributeValues),s.length>0&&(a=s.length+1,i.log.info("Y - "+u[c-1].GetName+" #"+s.length)),i.log.info("Rows="+a+" - Cols="+v),fi(a,v),t=null,f=null,row=0;row<a;row++)for(col=0;col<v;col++)o!=null&&(l=o[col]),s!=null&&(y=s[row]),row==0&&col==0?(p=new n.Controls.VLabel,w=new n.Controls.VLabel,o!=null&&(p.getControl().text(u[h-1].GetName),t=e.find("#row_1"),f=t.find("#col_"+col),f.append(p.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))),s.length>0&&(w.getControl().text(u[c-1].GetName),t=e.find("#row_1"),f=t.find("#col_"+col),f.append(w.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))),l!=null&&(r=new n.Controls.VLabel,r.getControl().text(l.Name),t=e.find("#row_1"),f=t.find("#col_"+(col+1)),f.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font")))):row==0?l!=null&&(r=new n.Controls.VLabel,r.getControl().text(l.Name),t=e.find("#row_1"),f=t.find("#col_"+(col+1)),f.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))):col==0?y!=null&&(r=new n.Controls.VLabel,r.getControl().text(y.Name),t=e.find("#row_"+row+1),f=t.find("#col_"+col),f.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))):ei(l,y,col,row+1);tt=!1}}function si(){var n=k.getControl().find("option:selected").val();n!=wt&&n!=bt&&n==pt}this.frame;this.windowNo;var i=this,vt=!1,yt=!1,p=!1,tt=!1,st=[],pt=0,wt=0,bt=0,ht=0,ct=0,u=[],r=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_Attribute_ID"),"M_Attribute_ID",!1,!0),w=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_Attribute_ID"),"M_Attribute_ID",!1,!0),kt=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_PriceList_ID"),"M_PriceList_ID",!1,!0),dt=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_Warehouse_ID"),"M_Warehouse_ID",!1,!0),hi=new n.Controls.VLabel(n.Msg.getMsg("Mode",!1,!1),"Mode",!1,!0),b=new n.Controls.VComboBox("",!1,!1,!0),it=new n.Controls.VComboBox("",!1,!1,!0),rt=new n.Controls.VComboBox("",!1,!1,!0),ut=new n.Controls.VComboBox("",!1,!1,!0),k=new n.Controls.VComboBox("",!1,!1,!0);this.log=n.Logging.VLogger.getVLogger("VAttributeGrid");var a=t("<div class='vis-forms-container' style='width: 100%; height: 100%; background-color: white; '>"),ft=t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'),s=null,h=null,v=null,l=null,d=null,g=null,c=null,f=null,o=null,y=260,nt=50,et=t(window).width()-y,lt=t(window).width()-nt,gt=et+y+5,ni=t(window).height()-210,e=t("<table style='width: 100%;'>");setBusy=function(n){ft.css("display",n?"block":"none")};this.Initialize=function(){if(ti(),o=a.find("#btnSpace_"+i.windowNo),c!=null)c.on(n.Events.onTouchStartOrClick,function(){si();i.dispose()});if(f!=null)f.on(n.Events.onTouchStartOrClick,function(){setBusy(!0);e.empty();oi();setBusy(!1)});if(o!=null)o.on(n.Events.onTouchStartOrClick,function(){p?(f.show(),r.getControl().show(),w.getControl().show(),o.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),p=!1,h.animate({width:et},"slow"),l.css("display","block"),v.animate({width:y},"slow"),s.animate({width:y},"slow")):(f.hide(),r.getControl().hide(),w.getControl().hide(),o.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),p=!0,h.animate({width:lt},"slow"),s.animate({width:nt},"slow"),v.animate({width:nt},"slow"),l.css("display","none"))})};this.display=function(){setTimeout(ii(),5)};this.getRoot=function(){return a};this.disposeComponent=function(){c&&c.off(n.Events.onTouchStartOrClick);f&&f.off(n.Events.onTouchStartOrClick);o&&o.off(n.Events.onTouchStartOrClick);i.windowNo=null;vt=null;yt=null;p=null;r=null;w=null;i.log=null;a=null;ft=null;s=null;h=null;v=null;l=null;d=null;g=null;c=null;f=null;o=null;y=null;nt=null;et=null;lt=null;gt=null;ni=null;i=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.display()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VAttributeGrid=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function r(){function dt(){w=t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>');w[0].style.visibility="hidden";b.append(w)}function o(n){w[0].style.visibility=n?"visible":"hidden"}function gt(){var f=t(window).height()*(94/100),i,u;k=t("<div class='vis-mainContainer'>");i=" <div class='vis-pSelectInfo vis-leftsidebarouterwrap'><div class='vis-pSelectInner'> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <select id='VIS_cmbBankAccount_"+r.windowNo+"'><\/select> <label>"+n.Msg.translate(n.Env.getCtx(),"C_BankAccount_ID")+" <\/label><\/div><\/div> <\/div> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrentBal_"+r.windowNo+"' MaxLength='50' data-placeholder='' placeholder=' '> <label>"+n.Msg.getMsg("CurrentBalance")+' <\/label><\/div><\/div>  <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbbusinessPartner_'+r.windowNo+"'><\/select> <label>"+n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID")+' <\/label><\/div><\/div>  <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <input  id=\'VIS_cmbPayDate_'+r.windowNo+"'type='date' data-placeholder='' placeholder=' '> <label>"+n.Msg.translate(n.Env.getCtx(),"PayDate")+' <\/label><\/div><\/div>  <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbPaymentMethod_'+r.windowNo+"'><\/select> <label>"+n.Msg.translate(n.Env.getCtx(),"PaymentRule")+" <\/label><\/div><\/div>  <\/div> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='number' id='VIS_txtPaymentAmount_"+r.windowNo+"' disabled MaxLength='50' data-placeholder='' placeholder=' '> <label>"+n.Msg.getMsg("PaymentAmount")+" <\/label><\/div><\/div>  <\/div> <div class='vis-paymentselect-field'> <input type='checkbox' id='VIS_chkOnlyDue_"+r.windowNo+"' data-placeholder='' placeholder=' '> <label for='VIS_chkOnlyDue_"+r.windowNo+"'>"+n.Msg.getMsg("OnlyDue")+" <\/label>  <\/div> <div class='vis-paymentselect-field'> <label for='VIS_lblShowDetail_"+r.windowNo+"'><\/label> <\/div> <\/div> <div class='vis-paymentselect-field'> <button class='VIS_Pref_btn-2' disabled id='VIS_btnRefresh_"+r.windowNo+"' style='margin-top: 0px;'><i class='vis vis-refresh'><\/i><\/button> <\/div> <\/div>";d=t("<div class='vis-pSelectIionGrid'>");u=" <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_"+r.windowNo+"' class='vis-frm-btn' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnOK_"+r.windowNo+"' disabled class='vis-frm-btn' type='submit' value='"+n.Msg.getMsg("OK")+"' ><\/input> <\/div> <\/div>";k.append(t(i)).append(d).append(t(u));b.append(k);ni()}function ni(){f=t("#VIS_cmbBankAccount_"+r.windowNo);s=t("#VIS_cmbbusinessPartner_"+r.windowNo);h=t("#VIS_cmbPaymentMethod_"+r.windowNo);tt=t("#VIS_txtCurrentBal_"+r.windowNo);y=t("#VIS_chkOnlyDue_"+r.windowNo);a=t("#VIS_txtPaymentAmount_"+r.windowNo);ut=t("#VIS_lblShowDetail_"+r.windowNo);p=t("#VIS_btnRefresh_"+r.windowNo);v=t("#VIS_cmbPayDate_"+r.windowNo);g=t("#VIS_btnOK_"+r.windowNo);it=t("#VIS_btnCancel_"+r.windowNo);var n=new Date,i=("0"+n.getDate()).slice(-2),u=("0"+(n.getMonth()+1)).slice(-2),e=n.getFullYear()+"-"+u+"-"+i;v.val(e);ft();ti();ri();l.BankAccount.length>0&&et()}function ti(){p.on("click",function(){o(!0);ei()&&window.setTimeout(function(){ii();o(!1)},20)});g.on("click",function(){var t,i;if(e.getSelection().length<=0)return n.ADialog.info("PleaseSelectRecord"),!1;if(t=e.getSelection(),t.length>0){for(i=0;i<t.length;i++)rt[t[i]].SELECT=!0;o(!0);window.setTimeout(function(){oi()},20)}});it.on("click",function(){r.dispose()});f.on("change",function(){o(!0);window.setTimeout(function(){fi();et();o(!1)},20)});y.on("click",function(){p.trigger("click")})}function ft(){try{e!=null&&(e.destroy(),e=null)}catch(t){}u.length==0&&(u.push({field:"SELECT",caption:n.Msg.getMsg("SELECT"),sortable:!0,size:"100px",hidden:!0}),u.push({field:"C_INVOICE_ID",caption:n.Msg.getMsg("Invoice"),sortable:!0,size:"100px"}),u.push({field:"DUEDATE",caption:n.Msg.getMsg("DueDate"),sortable:!0,size:"100px",render:function(n){var t;return t=n.changes==undefined||n.changes.DUEDATE==undefined?n.DUEDATE:n.changes.DUEDATE,new Date(t).toLocaleDateString()}}),u.push({field:"BUSINESSPARTNER",caption:n.Msg.getMsg("BusinessPartner"),sortable:!0,size:"100px"}),u.push({field:"DOCUMENTNO",caption:n.Msg.getMsg("Document_No"),sortable:!0,size:"100px"}),u.push({field:"CURRENCY",caption:n.Msg.getMsg("Currency"),sortable:!0,size:"100px"}),u.push({field:"GRANDTOTAL",caption:n.Msg.getMsg("GrandTotal"),sortable:!0,size:"100px",render:function(n){var t=n.GRANDTOTAL;return parseFloat(t).toLocaleString()}}),u.push({field:"DISCOUNTAMOUNT",caption:n.Msg.getMsg("DiscountAmt"),sortable:!0,size:"100px",render:function(n){var t=n.DISCOUNTAMOUNT;return parseFloat(t).toLocaleString()}}),u.push({field:"DISCOUNTDATE",caption:n.Msg.getMsg("DiscountDate"),sortable:!0,size:"100px",render:function(n){var t;return t=n.changes==undefined||n.changes.DISCOUNTDATE==undefined?n.DISCOUNTDATE:n.changes.DISCOUNTDATE,new Date(t).toLocaleDateString()}}),u.push({field:"AMOUNTDUE",caption:n.Msg.getMsg("AmountDue"),sortable:!0,size:"100px",render:function(n){var t=n.AMOUNTDUE;return parseFloat(t).toLocaleString()}}),u.push({field:"PAYMENTAMOUNT",caption:n.Msg.getMsg("PaymentAmount"),sortable:!0,size:"100px",render:function(n){var t=n.PAYMENTAMOUNT;return parseFloat(t).toLocaleString()}}));e=d.w2grid({name:"gridPaymentSelection_"+r.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:u,records:c});e.on("select",function(t){nt+=n.Utility.Util.getValueOfDecimal(c[t.index].PAYMENTAMOUNT);a.val(nt);var i=e.getSelection();g.removeAttr("disabled")});e.on("unselect",function(t){nt-=n.Utility.Util.getValueOfDecimal(c[t.index].PAYMENTAMOUNT);a.val(nt);var i=e.getSelection()})}function ii(){var u,r,e;c=[];u=0;r=[];r.push(f.val());l!=null?(e=jQuery.grep(l.BankAccount,function(t){return t.ID==n.Utility.Util.getValueOfInt(f.val())}),e.length>0?r.push(e[0].Currency_ID):r.push(0)):r.push(0);r.push(s.val());r.push(v.val());r.push(h.val());r.push(a.val());r.push(y.prop("checked"));t.ajax({url:n.Application.contextUrl+"VPaySelect/GetGridRecords",async:!1,datatype:"Json",type:"POST",cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(r),success:function(n){var t=JSON.parse(n),r;if(c=[],t!=null||t!=undefined)for(rt=t,i=0;i<t.length;i++)r={},r.SELECT=t[i].SELECT,r.C_INVOICE_ID=t[i].C_INVOICE_ID,r.DUEDATE=t[i].DUEDATE,r.BUSINESSPARTNER=t[i].BUSINESSPARTNER,r.DOCUMENTNO=t[i].DOCUMENTNO,r.CURRENCY=t[i].CURRENCY,r.GRANDTOTAL=t[i].GRANDTOTAL,r.DISCOUNTAMOUNT=t[i].DISCOUNTAMOUNT,r.DISCOUNTDATE=t[i].DISCOUNTDATE,r.AMOUNTDUE=t[i].AMOUNTDUE,r.PAYMENTAMOUNT=t[i].PAYMENTAMOUNT,r.recid=u,u++,c.push(r)},error:function(n){console.log(n)}});ft()}function ri(){t.ajax({url:n.Application.contextUrl+"VPaySelect/GetDetail",async:!1,datatype:"Json",type:"GET",cache:!1,success:function(n){var t=JSON.parse(n);l=t;(t!=null||t!=undefined)&&t.BankAccount.length>0&&(p.removeAttr("disabled"),ui(t));o(!1)},error:function(n){console.log(n);o(!1)}})}function ui(n){var i;if(n.BankAccount!=null||n.BankAccount.length>0){f.empty();for(i in n.BankAccount)f.append(t('<Option value="'+n.BankAccount[i].ID+'">'+n.BankAccount[i].Value+"<\/option>"))}if(n.BusinessPartner!=null||n.BusinessPartner.length>0){s.empty();s.append(t('<Option value="-1"><\/option>'));for(i in n.BusinessPartner)s.append(t('<Option value="'+n.BusinessPartner[i].ID+'">'+n.BusinessPartner[i].Value+"<\/option>"))}if(n.PaymentMethod!=null||n.PaymentMethod.length>0){h.empty();for(i in n.PaymentMethod)h.append(t('<Option value="'+n.PaymentMethod[i].ID+'">'+n.PaymentMethod[i].Value+"<\/option>"))}o(!1)}function fi(){t.ajax({url:n.Application.contextUrl+"VPaySelect/GetPaymentMethod",async:!1,datatype:"Json",type:"GET",cache:!1,data:{C_BankAccount_ID:parseInt(f.val())},success:function(n){var i=JSON.parse(n),r;if((i!=null||i!=undefined)&&(i!=null||i.length>0)){h.empty();for(r in i)h.append(t('<Option value="'+i[r].ID+'">'+i[r].Value+"<\/option>"))}},error:function(n){console.log(n)}})}function et(){var t=jQuery.grep(l.BankAccount,function(t){return t.ID==n.Utility.Util.getValueOfInt(f.val())});t.length>0&&tt.val(t[0].CurrentBalance+" "+t[0].ISOCode)}function ei(){return s!=null&&s.val()<=0?(n.ADialog.info("SelectBusinessPartnerFirst"),o(!1),!1):!0}function oi(){var i=[],u;i.push(f.val());l!=null?(u=jQuery.grep(l.BankAccount,function(t){return t.ID==n.Utility.Util.getValueOfInt(f.val())}),i.push(u[0].Currency_ID)):i.push(0);i.push(s.val());i.push(v.val());i.push(h.val());i.push(a.val());i.push(y.prop("checked"));i.push(JSON.stringify(rt));t.ajax({url:n.Application.contextUrl+"VPaySelect/GeneratePaymentSelection",async:!1,datatype:"Json",type:"POST",cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(t){var f=JSON.parse(t),i,u;(f!=null||f!=undefined)&&(r.dispose(),i=new n.CFrame,u=new n.Apps.AForms.VPayPrint,i.setName(n.Msg.getMsg("Payment Print/Export")),i.setTitle(n.Msg.getMsg("Payment Print/Export")),i.hideHeader(!1),i.setContent(u),i.show(),u.initialize())},error:function(n){console.log(n)}})}this.windowNo;var b=t("<div style='width: 100%; height: 100%; background-color: white;'>"),r=this,k=null,ot=null,st=null,ht=null,ct=null,lt=null,at=null,vt=null,d=null,yt=null,pt=null,wt=null,bt=null,f=null,s=null,h=null,v=null,kt=null,y=null,tt=null,ut=null,a=null,u=[],e=null,p=null,g=null,it=null,c=[],rt=null,l=null,nt=0,w=null;this.initialize=function(){dt();o(!0);window.setTimeout(function(){gt()},20)};this.getRoot=function(){return b};this.disposeComponent=function(){windowNo=null;b=null;r=this;k=null;ot=null;st=null;ht=null;ct=null;lt=null;at=null;vt=null;d=null;yt=null;pt=null;wt=null;bt=null;f=null;s=null;h=null;v=null;kt=null;y=null;tt=null;ut=null;a=null;u=null;e=null;p=null;g=null;it=null;c=null}}n.Apps.AForms=n.Apps.AForms||{};r.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};r.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VPaySelect=r}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(){function ut(){s=t("<div>");s.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1","z-index":"9999999"});s[0].style.visibility="hidden";c.append(s)}function r(n){s[0].style.visibility=n?"visible":"hidden"}function ft(){a=t("<div class='vis-mainContainer'>");var r=" <div class='vis-pPrintInfo'> <div class='vis-paymentselect-field' style='margin-top: 8px;'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <div class='vis-paymentPrintChk-field'> <input type='checkbox' id='VIS_chkShowPrintPayment_"+i.windowNo+"' data-placeholder='' placeholder=' '> <label for='VIS_chkOnlyDue_"+i.windowNo+"'>"+n.Msg.getMsg("ShowPrintedPayments")+" <\/label> <\/div> <select id='VIS_PaySelection_"+i.windowNo+"'><\/select> <label style='top: 11px;'>"+n.Msg.translate(n.Env.getCtx(),"C_PaySelection_ID")+" <\/label><\/div><\/div> <\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' name='vis-name vis-fieldreadonly' class='vis-fieldreadonly' disabled id='VIS_txtBankAccount_"+i.windowNo+"' MaxLength='50' data-placeholder='' placeholder=' '> <label>"+n.Msg.translate(n.Env.getCtx(),"C_BankAccount_ID")+" <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrentBal_"+i.windowNo+"' MaxLength='50' data-placeholder='' placeholder=' '> <label>"+n.Msg.getMsg("CurrentBalance")+" <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <select name='vis-name' id='VIS_cmbPaymentMethod_"+i.windowNo+"'><\/select> <label>"+n.Msg.translate(n.Env.getCtx(),"PaymentRule")+" <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrency_"+i.windowNo+"' MaxLength='50' data-placeholder='' placeholder=' '> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Currency_ID")+" <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='number' name='vis-name'  id='VIS_txtCheckNo_"+i.windowNo+"' MaxLength='50' data-placeholder='' placeholder=' '> <label>"+n.Msg.getMsg("CheckNo")+" <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtNoOfPayments_"+i.windowNo+"' MaxLength='50' data-placeholder='' placeholder=' '> <label>"+n.Msg.getMsg("NoOfPayments")+" <\/label> <\/div><\/div><\/div> <\/div>",u=" <div class='vis-pPrintProcess'> <div class='vis-paymentPrint-field'> <input id='VIS_btnCancel_"+i.windowNo+"' class='vis-frm-btn' type='submit' value='"+n.Msg.getMsg("Cancel")+"' > <input id='VIS_btnPrint_"+i.windowNo+"' class='vis-frm-btn' type='submit' value='"+n.Msg.getMsg("Print")+"' ><\/input> <\/div> <\/div>";a.append(t(r)).append(t(u));c.append(a);ut();et()}function et(){u=t("#VIS_PaySelection_"+i.windowNo);p=t("#VIS_txtBankAccount_"+i.windowNo);w=t("#VIS_txtCurrentBal_"+i.windowNo);f=t("#VIS_cmbPaymentMethod_"+i.windowNo);b=t("#VIS_txtCurrency_"+i.windowNo);e=t("#VIS_txtCheckNo_"+i.windowNo);v=t("#VIS_txtNoOfPayments_"+i.windowNo);l=t("#VIS_chkShowPrintPayment_"+i.windowNo);l.attr("disabled",!0);k=t("#VIS_btnPrint_"+i.windowNo);d=t("#VIS_btnExport_"+i.windowNo);g=t("#VIS_btnCancel_"+i.windowNo);y(!0);st()}function y(i){var f=null;f=i?0:u.val();r(!0);t.ajax({url:n.Application.contextUrl+"VPayPrint/GetDetail",async:!1,datatype:"Json",type:"GET",cache:!1,data:{showPrintedPayment:l.prop("checked"),C_PaymentSelect_ID:f,isFirstTime:i},success:function(n){var t=JSON.parse(n);controlsData=t;(t!=null||t!=undefined)&&(ot(t),nt(),r(!1))},error:function(n){r(!1);console.log(n)}})}function nt(){t.ajax({url:n.Application.contextUrl+"VPayPrint/LoadPaymentRuleInfo",async:!1,datatype:"Json",type:"GET",cache:!1,data:{paymentMethod_ID:f.val(),C_PaySelection_ID:u.val(),m_C_BankAccount_ID:o,PaymentRule:f.text()},success:function(n){var t=JSON.parse(n);r(!1);(t!=null||t!=undefined)&&(e.val(t.CheckNo),v.val(t.NoOfPayments))},error:function(n){console.log(n)}})}function ot(i){var c,l,y,a,s;try{if(c=u.val(),l=0,i.PaymentSelection!=null||i.PaymentSelection.length>0){u.empty();for(s in i.PaymentSelection)u.append(t('<Option value="'+i.PaymentSelection[s].ID+'">'+i.PaymentSelection[s].Value+"<\/option>"))}if(c>0&&(u.val(c),y="VIS_135",a=[],a[0]=new n.DB.SqlParam("@pSelectID",c),l=n.Utility.Util.getValueOfInt(h(y,a))),i.PaymentMethod!=null||i.PaymentMethod.length>0){f.empty();for(s in i.PaymentMethod)f.append(t('<Option value="'+i.PaymentMethod[s].ID+'">'+i.PaymentMethod[s].Value+"<\/option>"))}l>0&&f.val(l);(i.PSelectInfo!=null||i.PSelectInfo.length>0)&&(p.val(i.PSelectInfo[0].BankAccount),e.val(i.PSelectInfo[0].CheckNo),w.val(parseFloat(i.PSelectInfo[0].CurrentBalance).toLocaleString()),b.val(i.PSelectInfo[0].Currency),v.val(i.PSelectInfo[0].NoOfPayments),o=i.PSelectInfo[0].BankAccount_ID)}catch(k){return n.ADialog.info("VPayPrintNoRecords"),r(!1),!1}if(u.val()==null)return n.ADialog.info("VPayPrintNoRecords"),!1}function st(){k.on("click",function(){tt()&&ht()});d.on("click",function(){tt()&&at()});g.on("click",function(){i.dispose()});u.on("change",function(){r(!0);window.setTimeout(function(){y(!1);r(!1)},20)});f.on("change",function(){r(!0);window.setTimeout(function(){nt();r(!1)},20)});l.on("click",function(){r(!0);window.setTimeout(function(){y(!1);r(!1)},20)})}function tt(){try{if(u==null||u.val()<=-1||o<=-1||f.val()<=-1||e.val().length<=0)return n.ADialog.info("VPayPrintNoRecords"),!1}catch(t){return n.ADialog.info("VPayPrintNoRecords"),!1}return!0}function ht(){r(!0);t.ajax({url:n.Application.contextUrl+"VPayPrint/Cmd_Print",async:!1,datatype:"Json",type:"GET",cache:!1,data:{paymentMethod_ID:f.val(),C_PaySelection_ID:u.val(),m_C_BankAccount_ID:o,PaymentRule:f.text(),checkNo:e.val()},success:function(t){r(!1);var u=JSON.parse(t);if(u!=null||u!=undefined)n.ADialog.confirm("ContinueCheckPrint?",!0,"","Confirm",function(n){n?(r(!0),window.setTimeout(function(){ct(u)},20)):i.dispose()});else return n.ADialog.info("VPayPrintNoRecords"),!1},error:function(n){console.log(n)}})}function ct(s){var l=s.check_ID[0],c=[];c.push(f.val());c.push(u.val());c.push(o);c.push(f.text());c.push(e.val());c.push(JSON.stringify(s.check_ID));c.push(JSON.stringify(s.m_batch));c.push(JSON.stringify(s.m_checks));t.ajax({url:n.Application.contextUrl+"VPayPrint/ContinueCheckPrint",async:!1,datatype:"Json",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(t){var f="VIS_152",s=[],c,l,a,e;s[0]=new n.DB.SqlParam("@BankAcct_ID",o);c=h(f,s);f="VIS_150";l=h(f);a=new n.APrint(c,l,parseInt(u.val()),i.windowNo);a.startPdf(null);r(!1);e=JSON.parse(t);(e!=null||e!=undefined)&&n.ADialog.confirm("VPayPrintPrintRemittance?",!0,"","Confirm",function(n){n?(r(!0),window.setTimeout(function(){lt(t)},20)):i.dispose()})},error:function(n){r(!1);console.log(n)}})}function lt(f){var e=JSON.parse(f);t.ajax({url:n.Application.contextUrl+"VPayPrint/VPayPrintRemittance",async:!1,datatype:"Json",type:"POST",contentType:"application/json; charset=utf-8",data:f,success:function(t){var l,f,o,s,c;r(!1);l=JSON.parse(t);e!=null||e!=undefined?(f="VIS_151",o=h(f),f="VIS_150",s=h(f),c=new n.APrint(o,s,parseInt(u.val()),i.windowNo),c.startPdf(null),i.dispose()):n.ADialog.info("PaymentNotProcessed")},error:function(n){console.log(n)}})}function at(){r(!0);t.ajax({url:n.Application.contextUrl+"VPayPrint/Cmd_Export",async:!1,datatype:"Json",type:"POST",cache:!1,data:{paymentMethod_ID:f.val(),C_PaySelection_ID:u.val(),m_C_BankAccount_ID:o,PaymentRule:f.text(),checkNo:e.val()},success:function(t){r(!1);var i=JSON.parse(t);if(i!=null||i!=undefined)n.ADialog.confirm("VPayPrintSuccess?",!0,"","Confirm",function(t){if(t){r(!0);window.setTimeout(function(){vt(i)},20);var u=n.Application.contextUrl+"TempDownload/"+i.filepath;window.open(u,"_blank")}});else return n.ADialog.info("VPayPrintNoRecords"),!1},error:function(n){console.log(n)}})}function vt(i){var u=[];u.push(JSON.stringify(i.check_ID));u.push(JSON.stringify(i.m_batch));u.push(JSON.stringify(i.m_checks));t.ajax({url:n.Application.contextUrl+"VPayPrint/VPayPrintSuccess",async:!1,datatype:"Json",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(u),success:function(n){r(!1);var t=JSON.parse(n);t!=null||t!=undefined},error:function(n){console.log(n)}})}function yt(n,i,r){var u=null;return t.ajax({url:rt,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}var h;this.windowNo=n.Env.getWindowNo();var c=t("<div style='width: 100%; height: 100%; background-color: white;'>"),i=this,a=null,u=null,p=null,w=null,f=null,b=null,e=null,v=null,l=null,k=null,d=null,g=null,o=null,s=null,it=n.Application.contextUrl,rt=it+"JsonData/JDataSetWithCode";this.initialize=function(){ft()};this.getRoot=function(){return c};h=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u=null;return i&&(e.param=i),yt(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u};this.lockUI=function(){};this.unlockUI=function(){};this.disposeComponent=function(){windowNo=null;c=null;i=this}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VPayPrint=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(){function ut(){l=t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>');l[0].style.visibility="hidden";v.append(l)}function h(n){l[0].style.visibility=n?"visible":"hidden"}function ft(){var e=t(window).height()*(92/100),u,f;y=t("<div class='vis-mainContainer'>");u=" <div class='vis-pSelectInfo vis-leftsidebarouterwrap'><div class='vis-pSelectInner'> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <select id='VIS_cmbProduct_"+i.windowNo+"'><\/select> <label>"+n.Msg.translate(n.Env.getCtx(),"M_Product_ID")+' <\/label><\/div><\/div> <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbinvoice_'+i.windowNo+"'><\/select> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Invoice_ID")+' <\/label><\/div><\/div> <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbOrder_'+i.windowNo+"'><\/select> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Order_ID")+' <\/label><\/div><\/div> <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbOpportunity_'+i.windowNo+"'><\/select> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Project_ID")+" <\/label><\/div><\/div> <\/div> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input data-placeholder='' placeholder=' ' type='number' id='VIS_txtQuantity_"+i.windowNo+"' min='0' MaxLength='50'> <label>"+n.Msg.translate(n.Env.getCtx(),"Qty")+"<\/label><\/div><\/div> <\/div> <\/div> <div class='vis-paymentselect-field'> <button class='VIS_Pref_btn-2'  id='VIS_btnRefresh_"+i.windowNo+"' style='margin-top: 0px;'><i class='vis vis-refresh'><\/i><\/button> <\/div> <\/div>";r=t("<div class='vis-pSelectIionGrid'>");f=" <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_"+i.windowNo+"' class='vis-frm-btn' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnOK_"+i.windowNo+"' disabled class='vis-frm-btn' type='submit' value='"+n.Msg.getMsg("OK")+"' ><\/input> <\/div> <\/div>";y.append(t(u)).append(r).append(t(f));v.append(y);et()}function et(){u=t("#VIS_cmbProduct_"+i.windowNo);f=t("#VIS_cmbinvoice_"+i.windowNo);e=t("#VIS_cmbOrder_"+i.windowNo);o=t("#VIS_cmbOpportunity_"+i.windowNo);a=t("#VIS_txtQuantity_"+i.windowNo);p=t("#VIS_btnCancel_"+i.windowNo);s=t("#VIS_btnOK_"+i.windowNo);w=t("#VIS_btnRefresh_"+i.windowNo);b();ot()}function ot(){w.on("click",function(){h(!0);r.empty();window.setTimeout(function(){b();h(!1)},20)});s.on("click",function(){lt()});p.on("click",function(){i.dispose()});u.on("change",function(){u.val()>0?s.removeAttr("disabled"):s.attr("disabled",!0);h(!0);window.setTimeout(function(){ht()},20)});f.on("change",function(){f.val()>0?(u.val()>0&&s.removeAttr("disabled"),e.attr("disabled",!0),o.attr("disabled",!0)):(s.attr("disabled",!0),e.removeAttr("disabled"),o.removeAttr("disabled"))});e.on("change",function(){e.val()>0?(u.val()>0&&s.removeAttr("disabled"),f.attr("disabled",!0),o.attr("disabled",!0)):(s.attr("disabled",!0),f.removeAttr("disabled"),o.removeAttr("disabled"))});o.on("change",function(){o.val()>0?(u.val()>0&&s.removeAttr("disabled"),e.attr("disabled",!0),f.attr("disabled",!0)):(s.attr("disabled",!0),e.removeAttr("disabled"),f.removeAttr("disabled"))});a.on("change",function(){for(var i,n=0;n<t(r[0]).children().length;n++)i=c[n].BOMQty,t(t(t(t(r[0]).children()[n]).children()[0]).children()[1]).attr("Value",i*a.val())})}function b(){t.ajax({url:n.Application.contextUrl+"VBOMDrop/GetDetail",async:!1,datatype:"Json",type:"GET",cache:!1,success:function(n){var t=JSON.parse(n);controlsData=t;(t!=null||t!=undefined)&&st(t);h(!1)},error:function(n){console.log(n);h(!1)}})}function st(n){var i;if(n.Product!=null||n.Product.length>0){u.empty();u.append(t('<Option value="-1"><\/option>'));for(i in n.Product)u.append(t('<Option value="'+n.Product[i].ID+'">'+n.Product[i].Value+"<\/option>"))}if(n.Invoice!=null||n.Invoice.length>0){f.empty();f.append(t('<Option value="-1"><\/option>'));for(i in n.Invoice)f.append(t('<Option value="'+n.Invoice[i].ID+'">'+n.Invoice[i].Value+"<\/option>"))}if(n.Order!=null||n.Order.length>0){e.empty();e.append(t('<Option value="-1"><\/option>'));for(i in n.Order)e.append(t('<Option value="'+n.Order[i].ID+'">'+n.Order[i].Value+"<\/option>"))}if(n.Opportunity!=null||n.Opportunity.length>0){o.empty();o.append(t('<Option value="-1"><\/option>'));for(i in n.Opportunity)o.append(t('<Option value="'+n.Opportunity[i].ID+'">'+n.Opportunity[i].Value+"<\/option>"))}h(!1)}function ht(){a.val("");t.ajax({url:n.Application.contextUrl+"VBOMDrop/GetBOMLines",async:!1,datatype:"Json",type:"GET",cache:!1,data:{productID:parseInt(u.val())},success:function(n){var t=JSON.parse(n);controlsData=t;t!=null||t!=undefined?ct(t):r.empty();h(!1)},error:function(n){console.log(n);h(!1)}})}function ct(n){var e="",i;r.empty();var u="",f="";for(c=n,i=0;i<n.length;i++){e="";n[i].BOMType=="P"?(u="<input type='checkbox' checked disabled id='VIS_chkBOMLine_"+i+"' style='height: 15px;width: auto;'><\/input>",f="<input type='number' id='VIS_qtyBOMLine_"+i+"' style='background: pink;width:200%;' min='0' value='"+n[i].BOMQty+"'><\/input>"):n[i].BOMType=="O"?(u="<input type='checkbox' id='VIS_chkBOMLine_"+i+"' style='height: 15px;width: auto;'><\/input>",f="<input type='number' disabled id='VIS_qtyBOMLine_"+i+"' style='background: #FFF5FF;width:200%;'  min='0' value='"+n[i].BOMQty+"'><\/input>"):(u=" <input type='radio' name='vis-radiolist' checked id='VIS_chkBOMLine_"+i+"' style='height: 15px;width: auto;'><\/input>",f="<input type='number' id='VIS_qtyBOMLine_"+i+"' style='background: pink;width:200%;' min='0' value='"+n[i].BOMQty+"'><\/input>");e+="<div class='vis-bomlinesdata'> <div style='float:left;width: 50%;'> <label style='margin: 5px;width:100%;'>"+n[i].ProductName+"<\/label>"+f+" <\/div> <div style='float:right;'>"+u+" <label style='margin-right:5px;'>"+n[i].BOMTypeName+"<\/label> <\/div> <\/div>";r.append(t(e));t("#VIS_chkBOMLine_"+i).on("click",function(){var n=t(t(t(t(this).parent()).parent().children()[0]).children()[1]);t(this).prop("checked")?(n.css("background","pink"),n.removeAttr("disabled")):(n.css("background","#FFF5FF"),n.attr("disabled",!0))})}}function lt(){var l=[],s,a;for(l.push(u.val()),l.push(f.val()),l.push(e.val()),l.push(o.val()),s=0;s<t(r[0]).children().length;s++)a=t(t(t(t(r[0]).children()[s]).children()[1]).children()[0]).prop("checked"),a?(c[s].IsSelected=!0,c[s].BOMQty=t(t(t(t(r[0]).children()[s]).children()[0]).children()[1]).val()):c[s].IsSelected=!1;l.push(JSON.stringify(c));t.ajax({url:n.Application.contextUrl+"VBOMDrop/SaveRecord",async:!1,datatype:"Json",type:"POST",cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(l),success:function(t){JSON.parse(t)?i.dispose():n.ADialog.info("RecordNotSaved")},error:function(n){console.log(n);h(!1)}})}this.windowNo=null;var v=t("<div style='width: 100%; height: 100%; background-color: white;'>"),i=this,y=null,k=null,r=null,d=null,g=null,nt=null,tt=null,it=null,rt=null,u=null,f=null,e=null,o=null,a=null,s=null,p=null,l=null,c=[],w=null;this.initialize=function(){ut();h(!0);window.setTimeout(function(){ft()},20)};this.getRoot=function(){return v};this.disposeComponent=function(){v=null;i=null;y=null;k=null;r=null;d=null;g=null;nt=null;tt=null;it=null;rt=null;u=null;f=null;e=null;o=null;a=null;s=null;p=null;l=null;c=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VBOMDrop=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(){function at(){e=t('<div class="vis-busyindicatorouterwrap" style="visibility: hidden;"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>');e[0].style.visibility="hidden";o.append(e)}function l(n){e[0].style.visibility=n?"visible":"hidden"}function vt(){var ti=t(window).height()*(96/100),dt=n.MLookupFactory.get(n.Env.getCtx(),0,0,n.DisplayType.TableDir,"VAF_Org_ID",0,!1,null),et,e,r,nt,tt,ut,ft,kt;a=new n.Controls.VComboBox("VAF_Org_ID",!1,!1,!0,dt,50);et=n.MLookupFactory.get(n.Env.getCtx(),0,0,n.DisplayType.List,"MovementType",189,!1,null);v=new n.Controls.VComboBox("MovementType",!1,!1,!0,et,29);var c=t("<div class='input-group vis-input-wrap'>"),y=t("<div class='vis-control-wrap'>"),p=t("<div class='input-group-append'>"),gt=n.MLookupFactory.get(n.context,0,0,n.DisplayType.Search,"M_Locator_ID",0,!1,"");u=new n.Controls.VTextBoxButton("M_Locator_ID",!1,!1,!0,n.DisplayType.Search,gt);c.append(y);y.append(u.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," "));c.append(p);p.append(u.getBtn(0));p.append(u.getBtn(1));u.getBtn(0).addClass("vis-lookupButtons");u.getBtn(1).addClass("vis-lookupButtons");var w=t("<div class='input-group vis-input-wrap'>"),b=t("<div class='vis-control-wrap'>"),k=t("<div class='input-group-append'>"),ni=n.MLookupFactory.get(n.context,0,0,n.DisplayType.Search,"M_Product_ID",0,!1,"");f=new n.Controls.VTextBoxButton("M_Product_ID",!1,!1,!0,n.DisplayType.Search,ni);w.append(b);b.append(f.getControl().attr("data-placeholder","").attr("placeholder"," ").attr("data-hasbtn"," "));w.append(k);k.append(f.getBtn(0));k.append(f.getBtn(1));f.getBtn(0).addClass("vis-lookupButtons");f.getBtn(1).addClass("vis-lookupButtons");s=t("<div class='vis-mainContainer'>");e=t("<div class='vis-pSelectInfo vis-leftsidebarouterwrap'>");r=t("<div class='vis-pSelectInner'>");e.append(r);var ot=t("<div class='vis-paymentselect-field'>"),st=t("<div class='input-group vis-input-wrap'>"),d=t("<div class='vis-control-wrap'>");ot.append(st);st.append(d);d.append(a.getControl());d.append(t("<label>"+n.Msg.translate(n.Env.getCtx(),"VAF_Org_ID")+" <\/label>"));r.append(ot);var ht=t("<div class='vis-paymentselect-field'>"),ct=t("<div class='input-group vis-input-wrap'>"),g=t("<div class='vis-control-wrap'>");ht.append(ct);ct.append(g);g.append(v.getControl());g.append(t("<label>"+n.Msg.translate(n.Env.getCtx(),"MovementType")+" <\/label>"));r.append(ht);nt=t("<div class='vis-paymentselect-field'>");nt.append(c);y.append(t("<label>"+n.Msg.translate(n.Env.getCtx(),"M_Locator_ID")+" <\/label>"));r.append(nt);tt=t("<div class='vis-paymentselect-field'>");tt.append(w);b.append(t("<label>"+n.Msg.translate(n.Env.getCtx(),"Product")+" <\/label>"));r.append(tt);var lt=t("<div class='vis-paymentselect-field'>"),at=t("<div class='input-group vis-input-wrap'>"),it=t("<div class='vis-control-wrap'>");it.append(t("<input  id='VIS_dtpFromDate"+i.windowNo+"'type='date'>"));it.append(t("<label>"+n.Msg.translate(n.Env.getCtx(),"DateFrom")+" <\/label>"));lt.append(at);at.append(it);r.append(lt);var vt=t("<div class='vis-paymentselect-field'>"),bt=t("<div class='input-group vis-input-wrap'>"),rt=t("<div class='vis-control-wrap'>");rt.append(t("<input  id='VIS_dtpToDate"+i.windowNo+"'type='date'>"));rt.append(t("<label>"+n.Msg.translate(n.Env.getCtx(),"DateTo")+" <\/label>"));vt.append(bt);bt.append(rt);r.append(vt);ut=t("<div class='vis-paymentselect-field'>");ut.append(t("<button class='VIS_Pref_btn-2' id='VIS_btnRefresh_"+i.windowNo+"' style='margin-top: 0px;'><i class='vis vis-refresh'><\/i><\/button>"));e.append(ut);ft=t("<div class='vis-paymentselect-field'>");ft.append(t("<button class='VIS_Pref_btn-2' id='VIS_btnZoom_"+i.windowNo+"' style='margin-top: 0px;'><i class='vis vis-find'><\/i><\/button>"));e.append(ft);h=t("<div class='vis-pSelectIionGrid'>");kt=" <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_"+i.windowNo+"' class='vis-frm-btn' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnOK_"+i.windowNo+"' class='vis-frm-btn' type='submit' value='"+n.Msg.getMsg("OK")+"' ><\/input> <\/div> <\/div>";s.append(e).append(h).append(t(kt));o.append(s);yt();window.setTimeout(function(){wt()},20);pt();l(!0)}function yt(){k=t("#VIS_dtpFromDate"+i.windowNo);d=t("#VIS_dtpToDate"+i.windowNo);y=t("#VIS_btnRefresh_"+i.windowNo);g=t("#VIS_btnZoom_"+i.windowNo);p=t("#VIS_btnOK_"+i.windowNo);w=t("#VIS_btnCancel_"+i.windowNo);var n=new Date,r=("0"+n.getDate()).slice(-2),u=("0"+(n.getMonth()+1)).slice(-2),f=n.getFullYear()+"-"+u+"-"+r}function pt(){y.on("click",function(){nt()});g.on("click",function(){bt()});p.on("click",function(){nt()});w.on("click",function(){i.dispose()})}function wt(){n.AEnv.getGridWindow(i.windowNo,223,function(u){var e,f;if(u.error!=null){n.ADialog.error(u.error);self.dispose();self=null;return}(e=t.parseJSON(u.result),n.context.setContextOfWindow(t.parseJSON(u.wCtx),i.windowNo),f=new n.GridWindow(e),f!=null)&&(b=f.getTabs()[0],r=new n.GridController(!1),r.initGrid(!0,i.windowNo,i,b),r.setVisible(!0),window.innerHeight>700?r.sizeChanged(window.innerHeight-230,window.innerWidth):r.sizeChanged(window.innerHeight-215,window.innerWidth),h.append(r.getRoot()),r.activate(),c=new n.Query,c.addRestriction("VAF_Client_ID",n.Query.prototype.EQUAL,n.context.getVAF_Client_ID()))})}function nt(){var e=null,t,i;e=c!=null?jQuery.extend(!0,{},c):new n.Query;t=a.getValue();(t==null||t.toString()=="-1"||t.toString().trim().length==0)&&(t=null);t!=null&&t.toString().length>0&&e.addRestriction("VAF_Org_ID",n.Query.prototype.EQUAL,t);t=u.getValue();t!=null&&t.toString().length>0&&e.addRestriction("M_Locator_ID",n.Query.prototype.EQUAL,t);t=f.getValue();t!=null&&t.toString().length>0&&e.addRestriction("M_Product_ID",n.Query.prototype.EQUAL,t);t=v.getValue();(t==null||t.toString()=="-1"||t.toString().trim().length==0)&&(t=null);t!=null&&t.toString().length>0&&e.addRestriction("MovementType",n.Query.prototype.EQUAL,t);i=k.val().toString();i!=null&&i.length>0&&(i=new Date(i),e.addRestriction("TRUNC(MovementDate,'DD')",n.Query.prototype.GREATER_EQUAL,i));i=d.val().toString();i!=null&&i.length>0&&(i=new Date(i),e.addRestriction("TRUNC(MovementDate,'DD')",n.Query.prototype.LESS_EQUAL,i));b.setQuery(e);r.query(0,0,!1)}function bt(){var u=0,f=null,e=null,o=[],t=n.context.getContextAsInt(i.windowNo,"M_InOutLine_ID"),s,h;if(t!=0?(n.context.getContext(i.windowNo,"MovementType").equals("C-")?u=169:n.context.getContext(i.windowNo,"MovementType").equals("C+")?u=409:n.context.getContext(i.windowNo,"MovementType").equals("V+")?u=184:n.context.getContext(i.windowNo,"MovementType").equals("V-")&&(u=411),f="M_InOut_ID",e="VIS_140",o[0]=new n.DB.SqlParam("@lineID",t)):(t=n.context.getContextAsInt(i.windowNo,"M_InventoryLine_ID"),t!=0?(u=168,f="M_Inventory_ID",e="VIS_141",o[0]=new n.DB.SqlParam("@lineID",t)):(t=n.context.getContextAsInt(i.windowNo,"M_MovementLine_ID"),t!=0?(u=170,f="M_Movement_ID",e="VIS_142",o[0]=new n.DB.SqlParam("@lineID",t)):(t=n.context.getContextAsInt(i.windowNo,"M_ProductionLine_ID"),t!=0&&(u=191,f="M_Production_ID",e="VIS_143",o[0]=new n.DB.SqlParam("@lineID",t))))),u!=0)if(s=0,h=0,h=r.getSelectedRows(),h.length>0)s=n.Utility.Util.getValueOfInt(tt(e,null,null)),dt(f,t,u,s);else return alert(n.Msg.getMsg("NoRecordSelected"))}function kt(n,i,r){var u=null;return t.ajax({url:lt,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function dt(t,i,r,u){var f=new n.Query;f.addRestriction(t,n.Query.prototype.EQUAL,u);n.viewManager.startWindow(r,f)}var tt;this.windowNo=null;var o=t("<div style='width: 100%; height: 100%; background-color: white;'>"),i=this,s=null,it=null,h=null,rt=null,ut=null,ft=null,et=null,a=null,v=null,k=null,d=null,ot=[],st=null,y=null,g=null,p=null,w=null,ht=[],e=null,u=null,f=null,r=null,c=null,b=null,ct=n.Application.contextUrl,lt=ct+"JsonData/JDataSetWithCode";this.initialize=function(){at();l(!0);window.setTimeout(function(){vt();l(!1)},20)};tt=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u=null;return kt(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u};this.getRoot=function(){return o};this.dataStatusChanged=function(){};this.setBusy=function(n){l(n)};this.disposeComponent=function(){windowNo=null;o=null;i=this;s=null;it=null;$divBankAccount=null;$divCurrentBalance=null;$divBusinessPartner=null;$divOnlyDueInvoice=null;$divPaymentDate=null;$divPaymentMethod=null;h=null;rt=null;ut=null;ft=null;et=null;$cmbBankAccount=null;$cmbBusinessPartner=null;$cmbPaymentMethod=null;$cmbPaymentDate=null;$lblCurrentBal=null;$chkOnlyDueInvoice=null;$txtCurrentBal=null;$lblMsg=null;$txtPaymentAmount=null;ot=null;st=null;y=null;p=null;w=null;ht=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VTrxMaterial=i}(VIS,jQuery)
