/*1.0.1.1*/var Market = window.Market || {}; Market.KeyStatus = {}; Market.KeyHeader = {}; Market.KeyStatus.NotRegisterd = "N"; Market.KeyStatus.Renew = "R"; Market.KeyStatus.Upgrade = "U"; Market.KeyHeader.Expired = "E"; Market.KeyHeader.MExpired = "M"; Market.KeyHeader.Community = "C"; Market.KeyHeader.Professional = "P", function (n, t) { function i(i, r) { function k() { Market.KeyHeader.Professional == i ? (h = n.Msg.getMsg("ProfessionalHeader"), s = n.Msg.getMsg("GetProfessionalKey"), o = n.Msg.getMsg("EnterProfessionalKey")) : Market.KeyHeader.Expired == i ? (h = n.Msg.getMsg("KeyExpiredHeader"), s = n.Msg.getMsg("RenewKey"), o = n.Msg.getMsg("EnterProfessionalKey")) : Market.KeyHeader.MExpired == i ? (h = n.Msg.getMsg("MarketExpiredHeader"), s = n.Msg.getMsg("RenewKey"), o = n.Msg.getMsg("EnterProfessionalKey")) : (h = n.Msg.getMsg("CommunityHeader"), s = n.Msg.getMsg("GetCommunityKey"), o = n.Msg.getMsg("EnterCommunityKey")); r && (o = n.Msg.getMsg("CloudProfessionalText")); var u = '<div style="max-width:500px;"> <div  style="position:relative" style="width:100%;float:left;"><div class="vis-pull-left"><p class="market-kd-title">' + h + '<\/p><\/div><div class="vis-pull-right"><img src="' + n.Application.contextUrl + 'Areas/VIS/Images/logo.jpg"><\/div><\/div><div class="market-app-description" style="margin-top: 0;float:left;padding-top:30px;padding-bottom:0px;"><div class="comm-data"><div class="col50 vis-pull-left" style="width:40%"><a class="market-community-key">' + s + '<\/a><\/div><div style="width: 20px; margin-right: 5%;margin-left:5%" class="vis-pull-left" ><div class="market-divide"><\/div><span class="market-span-or">' + n.Msg.getMsg("or") + '<\/span><div class="market-divide"><\/div><\/div><div class="col50 vis-pull-right" style="width:40%"><label class="market-enter-key" ' + (r ? 'style="min-width:200px"' : " ") + ">" + o + '<\/label><input type="text" class="market-input-key" style="width:100%;' + (r ? "display:none" : "") + '"><a class="market-validate" ' + (r ? 'style="display:none"' : " ") + ">" + n.Msg.getMsg("Validate") + '<\/a><\/div><\/div><\/div><div class="vis-apanel-busy" style="height:90%;width:90%;" ><\/div><\/div>'; e = t(u); l = e.find(".vis-apanel-busy").hide(); v = e.find(".market-validate"); y = e.find(".market-community-key"); w = e.find(".market-input-key"); p = e.find(".market-kd-title"); d() } function d() { v.on("click", function () { var r = w.val(), e, i; if (!r || r.length < 1) { e = n.Msg.getMsg("EnterKey"); n.ADialog.error("Error?", !0, e); return } a(!0); i = {}; i.Url = n.Application.contextUrl; i.Client_ID = n.Env.getCtx().getAD_Client_ID(); i.UserName = n.Env.getCtx().getAD_User_Name(); i.RoleName = n.Env.getCtx().getAD_Role_Name(); i.ClientName = n.Env.getCtx().getAD_Client_Name(); i.Token = r; i.IsDemoCheck = !1; i.IsEntCheck = f.checkEntKey; t.ajax({ url: n.Application.contextUrl + "Market/Module/InitLoginOrValidate", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(i) }).done(function (t) { var i = JSON.parse(t); if (f.isValid = i.IsValid, f.isProfessinalEdition = i.IsAllowWork, f.tokenKey = i.Token, f.isMarketValid = !i.IsMarketExpired || !i.IsAllowWork, Market.keyMgr.init(i.IsRegistered, i.IsAllowWork, i.IsExpired), i.IsValid) { if (a(!1), c) f.dispose(), c.remove(); else if (i.IsMarketExpired && !b && i.IsAllowWork) { a(!1); n.ADialog.error("Error?", !0, n.Msg.getMsg("Market_MarketExpired")); return } u.close() } else a(!1), n.ADialog.error("Error?", !0, n.Msg.getMsg(i.Message)) }).fail(function (t, i) { n.ADialog.error("Error?", !0, i) }) }); y.on("click", function () { var t = "https://login.viennaadvantage.com/buy.aspx?key"; f.tokenKeyStatus == Market.KeyStatus.Upgrade ? t += "key=" + f.tokenKey + "&request=U" : f.tokenKeyStatus == Market.KeyStatus.Renew ? t += "key=" + f.tokenKey + "&request=R" : t = "http://register.viennaadvantage.com"; n.Env.startBrowser(t) }) } function a(n) { n ? l.show() : l.hide() } this.tokenKey; this.tokenKeyStatus; this.isCloudMarket; this.isValid; this.checkEntKey = !1; this.isProfessinalEdition = !1; this.onClose = null; var u = null, s = "", o, h, c, p, l, v, y, w, f = this, b, e = null; k(); this.show = function (i) { b = i; u = new n.ChildDialog; u.setTitle(""); i && u.removeCloseBtn && u.removeCloseBtn(i); u.setModal(!0); u.show(); u.setContent(e); !u.removeCloseBtn && i && (u.getRoot().dialog({ closeOnEscape: !1 }), t(".ui-dialog-titlebar-close").remove()); u.hideButtons(); u.onClose = function () { f.onClose && f.onClose(); f.dispose() }; u.getRoot().dialog({ position: { at: "center center", of: window } }) }; this.setHeader = function (t) { p.text(n.Msg.getMsg(t)) }; this.closeDialog = function () { u && u.close() }; this.showModel = function () { c = t('<div class="vis-wakeup-main"><\/div><div class="vis-wakeup" style="height: 278px; width: 520px;"><\/div><div class="vis-wakeup-content" style="height: auto; width: auto;" ><\/div><\/div><\/div>'); t("body").append(c).find(".vis-wakeup-content").append(e) }; this.dispose = function () { f = null; u = null; this.show = null; e.remove(); u = s = o = h = e = null; l = v = y = null }; this.getRoot = function () { return e } } i.prototype.getIsValid = function () { return this.isValid }; i.prototype.getIsMarketValid = function () { return this.isMarketValid }; Market.KeyDialog = i }(VIS, jQuery); Market = window.Market || {}, function (n, t) { function r() { this.isFeatured = !1; this.isPaid = !1; this.isFree = !1; this.isMy = !1; this.isPlanned = !1; this.isPrivate = !1; this.isRegisterd = !1; this.isKeyExpired = !1; this.isMarketExpired = !1; this.moduleEdition = ""; this.tokenKey = ""; this.isProfessinalEdition = !1 } function e(i) { function e() { var t = n.Application.contextFullUrl; return (t || (t = n.Application.contextUrl), t && t.toLower().indexOf("softwareonthecloud.com") > -1) ? (r = !0, f = t, !0) : !1 } var r = !1, f = "", u = i; this.getModules = function (i, e, o, s, h, c) { var a = { SqlString: i, PageIndex: e, PageSize: o, ModType: s, IsCloudMarket: r, HostURL: f, TokenKey: h, IsKeyExpired: !0, IsProfessionalEdition: c }, l = null; return t.ajax({ url: n.Application.contextUrl + "Market/Module/GetMarketModules", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(a) }).done(function (n) { l = n; u.getMarketModulesCompleted && u.getMarketModulesCompleted(l) }), l }; this.getIsSystemAdmin = function () { var t = n.Env.getCtx().getAD_User_ID(), i = n.Env.getCtx().getAD_Role_ID(); return (t == 0 || t == 100) && i == 0 ? !0 : !1 }; this.getIsCloudMarket = function () { return r }; e(); this.dispose = function () { u = null; this.getModules = null; this.dispose = null; this.getIsSystemAdmin = null; this.getIsCloudMarket = null } } function i() { function it() { h = u.find(".market-app-menu-a"); c = u.find(".market-close-img"); o = u.find(".market-main-app-list"); l = u.find(".market-right-content"); s = u.find(".vis-apanel-busy"); f = u.find(".market-search-input"); w = u.find(".market-sear"); p = u.find(".market-left-sidebar"); a = u.find(".market-module-template"); v = a.html(); b = Handlebars.compile(v); a = u.find(".market-module-tmp-right"); v = a.html(); k = Handlebars.compile(v); d = u.find(".market-cb"); nt = u.find(".market-header"); tt = u.find(".market-app-menu"); y = u.find(".market-main-container"); ft(); ut(); i.prop.setIsFeatured(!0); i.getModules() } function rt() { } function ut() { Handlebars.registerHelper("Rate", function (n) { n || (n = 1); var t = n / 2, i = Math.floor(t).toString(); return t.toString().indexOf(".") > 0 && (i += "+"), i }); Handlebars.registerHelper("market_star", function (n) { n || (n = 1); var t = n / 2, i = ""; return t < 1 ? i = "half-star" : t >= 1 && t < 2 ? i = t == 1 ? "one-star" : "one-half-stars" : t >= 2 && t < 3 ? i = t == 2 ? "two-stars" : "two-half-stars" : t >= 3 && t < 4 ? i = t == 3 ? "three-stars" : "three-half-stars" : t >= 4 && t < 5 ? i = t == 4 ? "four-stars" : "four-half-stars" : t >= 5 && (i = "full-stars"), i }) } function ft() { h.on("click", function () { var r = t(this), n; r.addClass("market-a-active"); r.parent().siblings().children().removeClass("market-a-active"); n = r.data("action"); n == "All" ? i.prop.setIsFeatured(!0) : n == "Paid" ? i.prop.setIsPaid(!0) : n == "Free" ? i.prop.setIsFree(!0) : n == "Planned" ? i.prop.setIsPlanned(!0) : n == "My" ? i.prop.setIsMy(!0) : n == "Private" && i.prop.setIsPrivate(!0); i.setSearchText(""); i.currentIndex = 0; i.getModules(); i.bindData() }); c.on("click", function () { i.dispose() }); o.on("click", function (n) { for (var e = t(n.target), r = e, u, f; r[0].nodeName != "LI";) r = t(r.parent()); u = r.index(); o.find("LI").removeClass("market-selected-module"); r.addClass("market-selected-module"); f = i.mList[u]; i.bindData(f); rt() }); if (!n.Application.isMobile) f.on("keyup", function (n) { n.keyCode === 13 && (i.performSearch(f.val()), f.focus()) }); w.on("click", function () { i.performSearch(f.val()); f.focus() }); p.on("scroll", function () { t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && (i.currentIndex += 1, i.getModules(), i.isTabScroll = !0) }); l.on("click", function (r) { var u = t(r.target), f; u.hasClass("market-button-Install-detail") && i.installModule(i.selectedItem); u.hasClass("market-video-pic") && (f = u.data("id"), f && n.Env.startBrowser("https://www.youtube.com/watch?v=" + f)); u.hasClass("market-button-version-detail") && i.getVersionHistory(i.selectedItem.AD_Module_ID, 0) }) } function et() { h.off("click"); c.off("click") } var h, c, o, p, l, f, w, a, v, b, k, d, i = this; this.currentIndex = 0; this.Page_Size = 10; this.searchText = ""; this.isBusy = !1; this.totalCount = 0; this.selectedItem = null; var u = t("<div>"), s = t("<div class='vis-apanel-busy'>"), g = t("<div class='market-body'>").append(s), nt, tt, y; u.append(g); this.model = new e(this); this.prop = new r; this.mList = []; g.load(n.Application.contextUrl + "Market/Module/Index", function () { it() }); this.setSize = function (n) { y && y.height(n - (tt.height() + nt.height())) }; this.bindList = function (n, t) { t || (o.empty(), this.bindData(this.mList.length > 0 ? this.mList[0] : null)); o.append(b(n)); t || o.find("LI").first().addClass("market-selected-module") }; this.bindData = function (n) { this.selectedItem = n; l.empty(); n && l.append(k(n)) }; this.showVendorPrivateMod = function () { return d.prop("checked") }; this.getRoot = function () { return u }; this.setBusyPanel = function (n) { s.hide(); n && s.show() }; this.disposeList = function () { }; this.setSearchText = function (n) { n || (n = ""); this.searchText = n; f.val(n) }; this.disposeComponent = function () { i = null; et(); h = null; c = null; u.remove(); u = null; this.mList.length = 0; this.mList = null; this.selectedItem = null; s = null } } function o() { function r(r, u, f) { n = r; t = u; i = f } function u() { return n } function f() { return t } function e() { return i } var n = !1, t = !1, i = !1; return { getIsRegistered: u, getIsProfessional: f, getIsExpired: e, init: r } } Market.ImpModule = {}; r.prototype.setIsFree = function () { this.setAllFalse(); this.isFree = !0 }; r.prototype.getIsFree = function () { return this.isFree }; r.prototype.setIsPlanned = function () { this.setAllFalse(); this.isPlanned = !0 }; r.prototype.getIsPlanned = function () { return this.isPlanned }; r.prototype.setIsMy = function () { this.setAllFalse(); this.isMy = !0 }; r.prototype.getIsMy = function () { return this.isMy }; r.prototype.setIsFeatured = function () { this.setAllFalse(); this.isFeatured = !0 }; r.prototype.getIsFeatured = function () { return this.isFeatured }; r.prototype.setIsPaid = function () { this.setAllFalse(); this.isPaid = !0 }; r.prototype.getIsPaid = function () { return this.isPaid }; r.prototype.setIsPaid = function () { this.setAllFalse(); this.isPaid = !0 }; r.prototype.getIsPaid = function () { return this.isPaid }; r.prototype.setIsPrivate = function () { this.setAllFalse(); this.isPrivate = !0 }; r.prototype.getIsPrivate = function () { return this.isPrivate }; r.prototype.setAllFalse = function () { this.isPlanned = !1; this.isMy = !1; this.isFeatured = !1; this.isFree = !1; this.isPaid = !1; this.isPrivate = !1 }; i.prototype.getModules = function () { var n = !1; this.searchText && this.searchText.length > 0 && (n = !0); this.prop.getIsFeatured() ? this.getFeaturedModule(n) : this.prop.getIsPaid() ? this.getPaidModule(n) : this.prop.getIsFree() ? this.getFreeModule(n) : this.prop.getIsMy() ? this.getMyModule(n) : this.prop.getIsPlanned() ? this.getPlannedModule(n) : this.prop.getIsPrivate() && this.getPrivateModule(n) }; i.prototype.getFeaturedModule = function (n) { this.setIsBusy(!0); this.disposeList(); var t = ""; n ? t += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""); this.model.getModules(t, this.currentIndex * this.Page_Size, this.Page_Size, "FTR") }; i.prototype.getFreeModule = function (n) { this.setIsBusy(!0); this.disposeList(); var t = ""; n ? t += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""); this.model.getModules(t, this.currentIndex * this.Page_Size, this.Page_Size, "FREE") }; i.prototype.getPaidModule = function (n) { this.setIsBusy(!0); this.disposeList(); var t = ""; n ? t += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""); this.model.getModules(t, this.currentIndex * this.Page_Size, this.Page_Size, "PAID") }; i.prototype.getMyModule = function (n) { this.setIsBusy(!0); this.disposeList(); var t = ""; n ? t += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""); this.model.getModules(t, this.currentIndex * 50, 50, "MY") }; i.prototype.getPlannedModule = function (n) { this.setIsBusy(!0); this.disposeList(); var t = ""; n ? t += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""); this.model.getModules(t, this.currentIndex * this.Page_Size, this.Page_Size, "PLAN") }; i.prototype.getPrivateModule = function (n) { var i, t, r; if (this.setIsBusy(!0), this.disposeList(), i = "", n ? i += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""), t = this.showVendorPrivateMod(), t && (!Market.PrivateKey || Market.PrivateKey.length < 10)) { this.bindList(null); this.bindData(null); r = new Market.PrivateKeyDialog(this, n); r.show(); r = null; this.setIsBusy(!1); return } if (!t && !this.getIsTokenKeyValidated()) { this.bindList(null); this.bindData(null); this.setIsBusy(!1); return } this.model.getModules(i, this.currentIndex * 50, 50, "SPL", Market.PrivateKey, t) }; i.prototype.getIsPaidEdition = function (n) { return !n || n.length < 1 ? !1 : n.toUpper() == "PP" || n.toUpper() == "CP" ? !0 : !1 }; i.prototype.setIsBusy = function (n) { this.isBusy = n; this.setBusyPanel(n) }; i.prototype.performSearch = function (n) { this.searchText = n; this.currentIndex = 0; this.getModules() }; i.prototype.getMarketModulesCompleted = function (n) { var t, i, u, f, r; if (n.error && n.error.length > 0 && n.error != "null") { alert(JSON.parse(n.error).Message); this.setIsBusy(!1); return } try { for (t = JSON.parse(n.result), i = this.prop, i.isRegisterd = t.IsRegistered, i.isProfessinalEdition = t.IsProfessionalEdition, i.isKeyExpired = t.IsKeyExpired, i.isMarketExpired = t.IsMarketExpired, i.tokenKey = t.TokenKey, u = null, f = "", r = 0; r < t.lstModuleInfo.length; r++) u = t.lstModuleInfo[r], r == 0 && (this.defaultItem = u, this.totalCount = u.TotalCount); this.isTabScroll ? this.mList.push.apply(this.mList, t.lstModuleInfo) : this.mList = t.lstModuleInfo; this.bindList(t.lstModuleInfo, this.isTabScroll); this.isTabScroll = !1; t = null } catch (n) { } this.setIsBusy(!1) }; i.prototype.installModule = function (t) { var i, r; if (this.setIsBusy(!0), !this.model.getIsSystemAdmin()) { this.setIsBusy(!1); n.ADialog.warn("NotAuthorized", !0, n.Msg.getMsg("LoginAsAdministrator"), ""); return } if (t.ModuleDependency != null && t.ModuleDependency.length > 0 && this.getAllParentModule(t)) { this.setIsBusy(!1); return } if (this.prop.isRegisterd) if (this.prop.isKeyExpired) this.openRegisterKeyDialog(Market.KeyHeader.Expired, t, Market.KeyStatus.Renew); else if (this.prop.isMarketExpired && this.prop.isProfessinalEdition) this.openRegisterKeyDialog(Market.KeyHeader.MExpired, t, Market.KeyStatus.Renew); else if (this.hasModuleInstalledAccess(t.ModuleEdition)) { if (this.prop.getIsPaid() && !t.IsPaymentDone || this.prop.getIsFeatured() && this.getIsPaidEdition(t.ModuleEdition) && !t.IsPaymentDone) { (!t.PaymentUrl || t.PaymentUrl.length < 1) && (t.PaymentUrl = "http://viennaadvantage.com"); i = t.PaymentUrl; t.PaymentUrl.indexOf("?id=") < 0 && (i += "?id=" + t.AD_Module_ID); i += "&key=" + this.prop.tokenKey + "&flag=" + (this.model.getIsCloudMarket() ? "Y" : "N").toString(); n.Env.startBrowser(i); t.IsEnabled = !1; this.setIsBusy(!1); return } if (this.getIsPaidEdition(t.ModuleEdition)) { if ((!t.PaymentUrl || t.PaymentUrl.length < 1) && (t.PaymentUrl = "http://viennaadvantage.com"), i = t.PaymentUrl, t.PaymentUrl.indexOf("?id=") < 0 && (i += "?id=" + t.AD_Module_ID), i += "&key=" + this.prop.tokenKey, !t.IsPaymentDone) { n.Env.startBrowser(i); this.setIsBusy(!1); return } if (t.IsMSubsExpired) { n.ADialog.ask("SubscriptionExpired", !0, n.Msg.getMsg("IsResubscribeModule")) && n.Env.startBrowser(i); this.setIsBusy(!1); return } } r = new Market.ModuleDialog(t); r.tokenKey = this.prop.tokenKey; r.isCloudMarket = this.model.isCloudMarket; r.show() } else this.openRegisterKeyDialog(Market.KeyHeader.Professional, t, Market.KeyStatus.Upgrade); else this.openRegisterKeyDialog(this.hasModuleInstalledAccess(t.ModuleEdition) ? Market.KeyHeader.Community : Market.KeyHeader.Professional, t, Market.KeyStatus.NotRegisterd); this.setIsBusy(!1) }; i.prototype.getVersionHistory = function (n) { var t = new Market.HistoryDialog(n); t.show() }; i.prototype.getAllParentModule = function (n) { for (var i = [], u, r, t = 0; t < n.ModuleDependency.length; t++) u = n.DependentModInstalled[t], u || i.push(n.ModuleDependency[t]); return i.length > 0 ? (r = new Market.DependencyDialog(i, n.Name + " " + n.VersionNo, this), r.show(), r = null, !0) : !1 }; i.prototype.hasModuleInstalledAccess = function (n) { return n ? this.prop.isProfessinalEdition ? !0 : n.toUpper() == "PF" || n.toUpper() == "PP" ? !1 : !0 : !0 }; i.prototype.getIsTokenKeyValidated = function () { if (this.prop.isRegisterd) if (this.prop.isKeyExpired) this.openRegisterKeyDialog(Market.KeyHeader.Expired, null, Market.KeyStatus.Renew, !0); else if (this.prop.isMarketExpired && this.prop.isProfessinalEdition) this.openRegisterKeyDialog(Market.KeyHeader.MExpired, null, Market.KeyStatus.Renew, !0); else return !0; else this.openRegisterKeyDialog(this.hasModuleInstalledAccess() ? Market.KeyHeader.Community : Market.KeyHeader.Professional, null, Market.KeyStatus.NotRegisterd, !0); return !1 }; i.prototype.openRegisterKeyDialog = function (n, t, i, r) { var u = new Market.KeyDialog(n, this.model.getIsCloudMarket()), f = this; u.onClose = function () { f.setIsBusy(!1); u.getIsValid() && u.getIsMarketValid() && (f.prop.isRegisterd = u.isValid, f.prop.isProfessinalEdition = u.isProfessinalEdition, f.prop.tokenKey = u.tokenKey, f.prop.isKeyExpired = !1, f.prop.isMarketExpired = !1, r ? f.getPrivateModule() : f.installModule(t), f = null) }; u.tokenKey = this.prop.tokenKey; u.tokenKeyStatus = i; u.isCloudMarket = this.model.getIsCloudMarket(); u.show() }; i.prototype.show = function () { var t = new n.CFrame; t.setName(n.Msg.getMsg("Market")); t.setTitle(n.Msg.getMsg("Market")); t.hideHeader(!0); t.setContent(this); t.show() }; i.prototype.dispose = function () { this.disposeComponent() }; i.prototype.sizeChanged = function (n, t) { this.getRoot().css({ width: t, height: n }); window.setTimeout(function (i) { i.setSize(n, t) }, 10, this) }; Market.ImpModule.Market_ = i; var f = !1, u = null; Market.checkTokenKey = function (i) { var o = new e(null), r = {}; r.Url = n.Application.contextFullUrl; r.Client_ID = n.Env.getCtx().getAD_Client_ID(); r.UserName = n.Env.getCtx().getAD_User_Name(); r.RoleName = n.Env.getCtx().getAD_Role_Name(); r.ClientName = n.Env.getCtx().getAD_Client_Name(); r.IsDemoCheck = !0; r.IsEntCheck = self.checkEntKey; r.IsAllowWork = o.getIsCloudMarket(); t.ajax({ url: n.Application.contextUrl + "Market/Module/InitLoginOrValidate", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(r) }).done(function (n) { var t = JSON.parse(n); Market.keyMgr.init(t.IsRegistered, t.IsAllowWork, t.IsExpired); !t.IsRegistered || !t.IsAllowWork || t.IsValid || o.getIsCloudMarket() || (i || (u = new Market.KeyDialog(Market.KeyHeader.Expired, o.getIsCloudMarket()), u.show(!0), f = !1, u.tokenKeyStatus = Market.KeyStatus.Renew, u.setHeader(t.Message), u.onClose = function () { f = !0 }), window.setTimeout(function () { f || (u.closeDialog(), f = !1, u = null, Market.checkTokenKey(!1)) }, 3e4)) }).fail(function (t, i) { n.ADialog.error("Error?", !0, i) }) }; Market.keyMgr = o(); Market.checkTokenKey() }(VIS, jQuery), function (n, t) { function i(n, i, r) { function c() { var r, u; for (f = t('<div class="market-dp-da" ><div class="market-app-detail"> <div class="market-about-app vis-pull-left" style="width:100%"><img src="' + VIS.Application.contextUrl + 'Areas/Market/Images/big_app_image.png"><div class="market-app-detail-inner"><p class="market-title">' + i + '<\/p><\/div><\/div> <div class="market-app-rating"><\/div><\/div><\/div>'), r = '<div class="market-app-description"><table style="width:400px;"><tr style="margin-bottom:5px"><th style="width:50%">' + VIS.Msg.getMsg("Name") + '<\/th><th style="width:30%">' + VIS.Msg.getMsg("VERSIONNO") + '<\/th><th style="width:20%">' + VIS.Msg.getMsg("Action") + "<\/th><\/tr>", u = 0; u < n.length; u++) r += "<tr>", r += '<td><p class="market-author" style="padding-right:5px"><small>' + n[u].Name + '<\/small><\/p><\/td><td ><p class="market-author"><small>' + n[u].VersionNo + '<\/small><\/p><\/td><td ><p class="market-install-detail"><a href="javascript:void(0);" class="market-button-Install"', r += h != n[u].Lable ? ' style="background-color:lightgray" disable' : " data-val=" + u, r += ">" + VIS.Msg.getMsg("Install") + "<\/a><\/p><\/td><\/tr>"; r += "<\/table><\/div>"; o = t('<div class="vis-apanel-busy" style="height:90%;width:80%;display:none">'); f.append(t(r)); f.append(o); l() } function l() { f.find(".market-button-Install").on("click", function () { var i, f; e || (e = !0, i = n[t(this).data("val")], i && (f = { AD_ModuleInfo_ID: i.ModuleID, tokenKey: r.prop.tokenKey }, o.show(), t.ajax({ url: VIS.Application.contextUrl + "Market/Module/GetModuleInfo", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(f) }).done(function (n) { n && n.result && n.result != "null" && (i = JSON.parse(n.result), r.installModule(i, !0), u.dispose(), e = !1) }).fail(function () { o.hide(); e = !1 }))) }) } var u, f, o, s = this, h = Math.max.apply(Math, n.map(function (n) { return n.Lable })), e; c(); e = !1; this.getRoot = function () { return f }; this.show = function () { u = new VIS.ChildDialog; u.setTitle(VIS.Msg.getMsg("Market_DependencyFound")); u.setModal(!0); u.show(); u.setContent(f); u.hideButtons(); u.onClose = function () { s.dispose() }; u.getRoot().dialog({ position: { at: "center center", of: window } }) }; this.disposeComponent = function () { f.remove(); parnet = null; this.getRoot = null; this.disposeComponent = null; u = null; s = null } } function r(i, r) { function o() { f = t('<div class="market-app-description" style="margin-top: 0;float:left;padding-top:30px;padding-bottom:0px;"><div class="comm-data"><div class="col50 vis-pull-right" style="width:100%"><label class="market-enter-key">' + VIS.Msg.getMsg("EnterKey") + '<\/label><input type="text" class="market-input-key" style="width:100%" value=' + n.PrivateKey + '><a class="market-validate">' + VIS.Msg.getMsg("OK") + "<\/a><\/div><\/div><\/div>"); s() } function s() { f.find(".market-validate").on("click", function () { var f = t(".market-input-key").val(); if (f && f.length > 0) { n.PrivateKey = f; i.getPrivateModule(r, !0); u.close(); return } alert("enterKey") }) } var u, f, e = this; o(); this.getRoot = function () { return f }; this.show = function () { u = new VIS.ChildDialog; u.setTitle("Market_PrivateKey"); u.setModal(!0); u.show(); u.setContent(f); u.hideButtons(); u.onClose = function () { e.disposeComponent() }; u.getRoot().dialog({ position: { at: "center center", of: window } }) }; this.disposeComponent = function () { f.remove(); parnet = null; this.getRoot = null; this.disposeComponent = null; u = null; e = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.DependencyDialog = i; n.PrivateKey = ""; n.PrivateKeyDialog = r }(Market, jQuery), function (n, t) { function i(i) { function ut(n, i, r) { var u = null; return t.ajax({ url: it, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function ft() { var r = n.Application.contextUrl + "Areas/Market/Images/big_app_image.png"; i.Image && (r = "data:image/png;base64," + i.Image); u = t('<div class="market-popup" ><div class="market-popup-content"><div style="position:relative">  <div class="market-about-app vis-pull-left">    <img src=' + r + ' style="max-width:120px">  <div class="market-app-detail-inner">    <p class="market-title">' + i.Name + '<\/p>  <!--<img src="img/progressbar.jpg">--><div class="market-popup-buttons"> \t<a href="javascript:void(0)" class="market-popup-btn market-install vis-pull-left">' + n.Msg.getMsg("Install") + '<\/a>   <a href="javascript:vois(0)" class="market-popup-btn market-cancel vis-pull-left">' + n.Msg.getMsg("Cancel") + '<\/a><\/div><\/div><!-- end of app_detail_inner --><\/div><!-- end of popup-content-top --><div class="market-popup-viennaLogo vis-pull-right">  <img src="' + n.Application.contextUrl + 'Areas/VIS/Images/logo.jpg"><\/div><!-- end of popup-viennaLogo --><\/div><!-- end of app_detail --><div class="market-app-description" style="float:left;padding-top:25px;"><div class="market-popup-description-inner">\t<div class="market-popup-install-text">      <p>' + n.Msg.getMsg("MigrationText") + ';<\/p>          <\/div><!-- end of popup-install-text -->        <div class="market-popup-client">      \t<h6>' + n.Msg.getMsg("SelectClient") + '<\/h6>        <div class="market-popup-client-options market-clients">                  <\/div><!-- end of popup-client-options -->            <\/div><!-- end of popup-client -->          <div class="market-popup-client" style="margin-right: 0; float: right;">        \t<h6>' + n.Msg.getMsg("SelectLanguage") + '<\/h6>          <div class="market-popup-client-options market-lang">  <\/div><!-- end of popup-client-options --> <\/div><!-- end of popup-client --><\/div><!-- end of popup-description-inner --><div class="market-pop-divider"><\/div> <div class="market-popup-description-inner" style="margin-top: 0;"><progress class="market-progress-in"><\/progress><progress max="100" value="0" class="market-progress"><\/progress>  <div class="market-popup-logs"><\/div><!-- end of popup-client-options --> <\/div><!-- end of popup-description-inner --> <\/div><!-- end of popup-description -->\t<\/div><!-- end of popup-content -->\t<div class="vis-apanel-busy" style="height:90%"><\/div><!-- end of popup-content -->  <\/div><!-- end of market-popup --> '); c = u.find(".market-install"); l = u.find(".market-cancel"); a = u.find(".market-clients"); v = u.find(".market-lang"); w = u.find(".market-popup-logs"); b = u.find(".vis-apanel-busy"); y = u.find(".market-progress"); k = u.find(".market-progress-in").hide(); et(); ot() } function d(n) { n ? b.show() : b.hide() } function s(n) { n ? (y.show(), l.hide(), c.hide()) : (y.hide(), l.show(), c.show()) } function et() { var f, n; a.empty(); v.empty(); f = "SELECT Name as Name,AD_Client_ID as ID FROM AD_Client WHERE "; f += i.AccessLevel == "4" ? " AD_Client_ID = 0  " : i.AccessLevel == "6" ? " AD_Client_ID >= 0 ORDER BY AD_Client_ID  " : " AD_Client_ID > 0 "; i.Translations && i.Translations.length > 0 && (f += "~ SELECT Name as Name,AD_Language as ID FROM AD_Language WHERE AD_Language IN (" + i.Translations + ")"); var r = rt(f), t = null, u = ""; if (r != null && r.getTables().length > 0) { for (t = r.getTables()[0], n = 0; n < t.getRows().length; n++) u += '<div class="market-client-data vis-pull-left"><input type="checkbox" data-val=' + t.getRows()[n].getCell("ID") + " ><label>" + t.getRows()[n].getCell("Name") + "<\/label><\/div>"; if (a.html(u), r.getTables().length > 1) { for (t = r.getTables()[1], u = "", n = 0; n < t.getRows().length; n++) u += '<div class="market-client-data vis-pull-left"><input type="checkbox" data-val=' + t.getRows()[n].getCell("ID") + " ><label>" + t.getRows()[n].getCell("Name") + "<\/label><\/div>"; v.html(u) } t = null; r.dispose() } d(!1) } function ot() { c.on("click", function () { var r = [], u = []; if (a.find("input:checked").each(function () { r.push(t(this).data("val")) }), r.length < 1) { n.ADialog.error("SelectClient", !0); return } s(!0); w.empty(); v.find("input:checked").each(function () { u.push('"' + t(this).data("val") + '"') }); o("[step 1] Initializing Channel"); h(n.Application.contextUrl + "Market/Module/DownloadAndExtractModuleFiles", { AD_ModuleInfo_ID: i.AD_Module_ID }, function (n) { var t, i, e; n.startsWith("Error=>") ? nt(n) : (t = n.indexOf("$ModulePath$"), t > -1 ? (i = n.substring(t), o(n.substring(0, t) + "<br/>[step 2] Importing module..."), e = i.replace("$ModulePath$", ""), f("11", "N"), window.setTimeout(st(r, u, e), 100)) : (nt("Module Path Not Found"), s(!1))) }); o("Downloading and extracting files"); o("Please wait..."); f("1", "Y") }); l.on("click", function () { r.close() }) } function st(t, u, o) { h(n.Application.contextUrl + "Market/Module/ImportModuleFromLocalFile", { moduleName: o, clientIds: t, langCode: u, onlyTranslation: !1, ctxDic: n.context.getWindowCtx() }, function (t) { var c, o, u; if (t && t.Action == "Error") { n.ADialog.error("Error?", !0, t.ActionMsg); f("0", "N"); s(!1); clearTimeout(p); return } if (t && t.Action == "Redirect") { c = t.Status; o = t.ActionMsg; f("99", "N"); u = n.Application.contextUrl + "Market/Module/ModuleLog"; u += "?id=" + c; o && o.length > 0 && (u += "&path=" + o, (e.isCloudMarket || n.Application.isSSL) && (u += "$Y$")); u += "&value=" + e.tokenKey; h(n.Application.contextUrl + "Market/Module/UpdateSubscrption", { AD_Module_ID: i.AD_Module_ID, Product_ID: i.Product_ID, token: e.tokenKey, isFree: !0, version: i.VersionNo }, function () { }); f("100", "N"); r.close(); setTimeout(function () { window.location = u }); return } }); p = window.setTimeout(g, 5e3) } function g() { h(n.Application.contextUrl + "Market/Module/PullMessage", {}, function (t) { var v = JSON.parse(t.result), u, l, y, a, c; if (t.status != "Finish" && v) { for (u = null, l = 0; l < v.length; l++) { if (u = v[l], u.Action == "Error") { n.ADialog.error("Error?", !0, u.ActionMsg); f("0", "N"); s(!1); clearTimeout(p); return } if (u.Action == "Redirect") { y = u.Status; a = u.ActionMsg; f("99", "N"); c = n.Application.contextUrl + "Market/Module/ModuleLog"; c += "?id=" + y; a && a.length > 0 && (c += "&path=" + a, (e.isCloudMarket || n.Application.isSSL) && (c += "$Y$")); c += "&value=" + e.tokenKey; h(n.Application.contextUrl + "Market/Module/UpdateSubscrption", { AD_Module_ID: i.AD_Module_ID, Product_ID: i.Product_ID, token: e.tokenKey, isFree: !0, version: i.VersionNo }, function () { }); f("100", "N"); r.close(); setTimeout(function () { window.location = c }); return } if (u.Action == "Done") { f("0", "N"); s(!1); return } u.Action == "PValue" ? f(u.Status, u.ActionMsg) : o(u.Status) } window.setTimeout(g, 5e3, !0) } }, !0) } function h(n, i, r, u) { var f = !0; u && (f = !1); t.ajax({ url: n, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(i) }).done(function (n) { r && r(n) }).fail(function (n, t) { r && r("Error=>" + t) }) } function nt(n) { o(n); f("0", "N"); d(!1) } function f(n, t) { if (n && n != "") { var i = n; y.val(n); t == "Y" ? k.show() : k.hide() } } function o(n) { var i = t('<p class="market-log">' + n + "<\/p>"); w.append(i); i[0].scrollIntoView(); i = null } var e, r, p; i.AD_Module_ID || (i.AD_Module_ID = i.ModuleID); this.tokenKey; this.isCloudMarket; e = this; r = null; sblog = ""; var tt = n.Application.contextUrl, it = tt + "JsonData/JDataSet", u = null, c, l, a, v, w, b, y, k, rt = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, ut(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }; ft(); p = null; this.show = function () { r = new n.ChildDialog; r.setTitle(n.Msg.getMsg("Market_ModuleDialogHeader")); r.setModal(!0); r.show(); r.setContent(u); r.hideButtons(); r.onClose = function () { e.dispose() }; r.getRoot().dialog({ position: { at: "center center", of: window } }) }; this.dispose = function () { u.remove(); this.show = null; r = null; e = null } } Market.ModuleDialog = i }(VIS, jQuery), function (n, t) { function i(i) { function l() { c() } var r = t("<div>"), s = t("<div style='height: 97%;width: 95%;position: absolute;overflow:auto;'>"), h = t("<div>"), o, c; s.append(h); var u = 0, f = !0, e = t("<div class='vis-apanel-busy' style='height:98%;width:95%;position:absolute;'>"); r.append(s); r.append(e); r.on("scroll", function () { t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && (u += 1, o()) }); o = function () { f != !1 && (e[0].style.visibility = "visible", t.ajax({ url: n.Application.contextUrl + "Module/GetModuleVersionHistory", dataType: "json", type: "POST", data: { AD_Module_ID: i, PageNo: u }, success: function (t) { var i = JSON.parse(t.result), s = "", o; if (i && i.length > 0) for (i.length < 10 && (f = !1), o = 0; o < i.length; o++) s += "<div style='border-top: 1px solid #dfdfdf;border-bottom: 1px solid #dfdfdf;padding: 10px;margin-right: 10px;float: left;width: 97%;min-height: 80px;'><div style='float: left;width: 100%;overflow: hidden;'><p>" + i[o].Version + "<\/p><\/div><span style='margin-top: 5px;float: left;'>" + i[o].Detail + "<\/span><\/div>"; else f = !1, u == 0 && (s += n.Msg.getMsg("FRPT_NoHistory")); h.append(s); u == 0 && r.dialog({ width: 620, height: 400, resizable: !1, modal: !0, close: l, title: n.Msg.getMsg("Market_VersionHistory") }); e[0].style.visibility = "hidden" } })) }; this.show = function () { o() }; c = function () { } } Market.HistoryDialog = i }(VIS, jQuery)